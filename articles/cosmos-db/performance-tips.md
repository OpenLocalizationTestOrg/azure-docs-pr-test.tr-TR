---
title: "Performans İpuçları - Azure Cosmos DB NoSQL | Microsoft Docs"
description: "Azure Cosmos DB veritabanı performansını iyileştirmek için istemci yapılandırma seçenekleri öğrenin"
keywords: "Veritabanı performansı nasıl"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="0b650-104">Azure Cosmos DB performans ipuçları</span><span class="sxs-lookup"><span data-stu-id="0b650-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="0b650-105">Azure Cosmos DB garantili gecikme süresi ve verimlilik ile sorunsuz bir şekilde ölçeklendirilebilen bir hızlı ve esnek dağıtılmış veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="0b650-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="0b650-106">Büyük mimari değişiklikler yaptığınızda veya veritabanınızla Cosmos DB ölçeklendirmek için karmaşık kodlar yazmak zorunda değildir.</span><span class="sxs-lookup"><span data-stu-id="0b650-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="0b650-107">Yukarı ve aşağı doğru ölçeklendirme tek bir API çağrısı yapma olarak kadar kolay veya [SDK yöntem çağrısı](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="0b650-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="0b650-108">Ancak, Cosmos DB ağ çağrıları erişilir en yüksek performans elde etmek için yapabileceğiniz istemci-tarafı iyileştirmeler vardır.</span><span class="sxs-lookup"><span data-stu-id="0b650-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="0b650-109">Soran, "nasıl ı my veritabanı performansını geliştirebilir şekilde?"</span><span class="sxs-lookup"><span data-stu-id="0b650-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="0b650-110">Aşağıdaki seçenekleri göz önünde bulundurun:</span><span class="sxs-lookup"><span data-stu-id="0b650-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="0b650-111">Ağ</span><span class="sxs-lookup"><span data-stu-id="0b650-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="0b650-112">**Bağlantı İlkesi: doğrudan bağlantı modu kullan**</span><span class="sxs-lookup"><span data-stu-id="0b650-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="0b650-113">Bir istemci Cosmos DB nasıl bağlandığını gözlemlenen istemci-tarafı gecikme açısından özellikle performansı önemli etkilere sahiptir.</span><span class="sxs-lookup"><span data-stu-id="0b650-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="0b650-114">İki anahtar yapılandırma ayarlarını istemci bağlantı İlkesi – bağlantı yapılandırmak için kullanılabilir *modu* ve [bağlantı *Protokolü*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="0b650-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="0b650-115">İki kullanılabilir modları şunlardır:</span><span class="sxs-lookup"><span data-stu-id="0b650-115">The two available modes are:</span></span>

   1. <span data-ttu-id="0b650-116">Ağ geçidi modunda (varsayılan)</span><span class="sxs-lookup"><span data-stu-id="0b650-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="0b650-117">Doğrudan modu</span><span class="sxs-lookup"><span data-stu-id="0b650-117">Direct Mode</span></span>

      <span data-ttu-id="0b650-118">Ağ geçidi modu tüm SDK platformlarda desteklenir ve yapılandırılmış varsayılandır.</span><span class="sxs-lookup"><span data-stu-id="0b650-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="0b650-119">Uygulamanız bir şirket ağı içinde katı güvenlik duvarı kısıtlamalarıyla çalışıyorsa standart HTTPS bağlantı noktası ve tek bir uç nokta kullandığından ağ geçidi modu en iyi seçimdir.</span><span class="sxs-lookup"><span data-stu-id="0b650-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="0b650-120">Performans kolaylığını ancak, veri okuma veya Cosmos Veritabanına yazılan her zaman ağ geçidi modu ek ağ atlama içermesidir.</span><span class="sxs-lookup"><span data-stu-id="0b650-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="0b650-121">Bu nedenle, doğrudan modu daha az ağ atlamalarını nedeniyle daha iyi performans sunar.</span><span class="sxs-lookup"><span data-stu-id="0b650-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="0b650-122">**Bağlantı İlkesi: TCP protokolünü kullanır**</span><span class="sxs-lookup"><span data-stu-id="0b650-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="0b650-123">Doğrudan modu kullanırken, kullanılabilir iki protokolü seçenek vardır:</span><span class="sxs-lookup"><span data-stu-id="0b650-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="0b650-124">TCP</span><span class="sxs-lookup"><span data-stu-id="0b650-124">TCP</span></span>
   * <span data-ttu-id="0b650-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="0b650-125">HTTPS</span></span>

     <span data-ttu-id="0b650-126">Cosmos DB Basit bir sunar ve HTTPS üzerinden RESTful programlama modeli açın.</span><span class="sxs-lookup"><span data-stu-id="0b650-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="0b650-127">Ayrıca, aynı zamanda RESTful kendi iletişim modelini ve .NET İstemci SDK kullanılabilir verimli bir TCP protokolü sunar.</span><span class="sxs-lookup"><span data-stu-id="0b650-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="0b650-128">Doğrudan TCP ve HTTPS SSL ilk kimlik doğrulaması ve şifreleme trafiği için kullanın.</span><span class="sxs-lookup"><span data-stu-id="0b650-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="0b650-129">En iyi performans için mümkün olduğunda TCP protokolünü kullanır.</span><span class="sxs-lookup"><span data-stu-id="0b650-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="0b650-130">TCP ağ geçidi modunda kullanılırken, TCP bağlantı noktası 443 Cosmos DB bağlantı noktası ve 10255 değerini bulur MongoDB API bağlantı noktası.</span><span class="sxs-lookup"><span data-stu-id="0b650-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="0b650-131">TCP ağ geçidi bağlantı noktalarına ek olarak doğrudan modunda kullanılırken, bağlantı noktası sağlamak zorunda Cosmos DB dinamik TCP bağlantı noktaları kullandığından 10000 20000 arasındaki aralığı açın.</span><span class="sxs-lookup"><span data-stu-id="0b650-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="0b650-132">Bu bağlantı noktalarının açık değildir ve TCP kullanma girişimi 503 Hizmet kullanılamıyor hatası alıyorsunuz.</span><span class="sxs-lookup"><span data-stu-id="0b650-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="0b650-133">Bağlantı modunu ConnectionPolicy parametresi DocumentClient örneğiyle yapımı sırasında yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="0b650-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="0b650-134">Doğrudan modunda kullanılırsa, Protokolü içinde ConnectionPolicy parametresi de ayarlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="0b650-135">Ağ geçidi modunda kullanılırsa, TCP yalnızca doğrudan modunda desteklendiğinden, HTTPS protokolünü her zaman ağ geçidi ile iletişim kurmak için kullanılır ve ConnectionPolicy Protokolü değeri yoksayılır.</span><span class="sxs-lookup"><span data-stu-id="0b650-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Azure Cosmos DB bağlantı İlkesi çizimi](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="0b650-137">**İlk istek başlatma gecikmesine önlemek için OpenAsync çağırın**</span><span class="sxs-lookup"><span data-stu-id="0b650-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="0b650-138">Adres yönlendirme tablosu getirilemedi içerdiğinden varsayılan olarak, ilk isteği daha yüksek gecikme vardır.</span><span class="sxs-lookup"><span data-stu-id="0b650-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="0b650-139">Bu ilk istek başlatma gecikmesine önlemek için OpenAsync() kez başlatma sırasında şu şekilde çağırmalıdır.</span><span class="sxs-lookup"><span data-stu-id="0b650-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="0b650-140">**Performans için aynı Azure bölgesinde istemciler birlikte bulundurma**</span><span class="sxs-lookup"><span data-stu-id="0b650-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="0b650-141">Mümkün olduğunda, Cosmos DB veritabanı ile aynı bölgede Cosmos DB çağırma herhangi bir uygulama yerleştirin.</span><span class="sxs-lookup"><span data-stu-id="0b650-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="0b650-142">Yaklaşık bir karşılaştırma için 1-2 ms içinde Cosmos DB çağrıları aynı bölge içinde tamamlanması, ancak Batı ABD, Doğu Yakası arasındaki gecikme süresi > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="0b650-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="0b650-143">Bu gecikme, Azure veri merkezi sınır istemciden geçerken istek tarafından izlenen yolu bağlı olarak istemek için büyük olasılıkla farklılık gösterebilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="0b650-144">Olası en düşük gecikme, çağıran uygulama sağlanan Cosmos DB uç nokta olduğu Azure bölgesinin içinde bulunduğu sağlanarak elde edilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="0b650-145">Kullanılabilir bölgelerin bir listesi için bkz: [Azure bölgeleri](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="0b650-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="0b650-146">![Azure Cosmos DB bağlantı İlkesi çizimi](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="0b650-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="0b650-147">**İş parçacıkları/görevleri sayısını artırın**</span><span class="sxs-lookup"><span data-stu-id="0b650-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="0b650-148">Azure Cosmos DB çağrıları ağ üzerinden yapılan olduğundan, böylece istemci uygulaması bekleyen istekler arasında çok az zaman harcayan, istekleri paralellik derecesini farklılık gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="0b650-149">Örneğin, kullanıyorsanız. NET'in [görev paralel Kitaplığı](https://msdn.microsoft.com//library/dd460717.aspx), 100s okunurken veya yazılırken Cosmos DB görev sırasına göre oluşturun.</span><span class="sxs-lookup"><span data-stu-id="0b650-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="0b650-150">SDK kullanımı</span><span class="sxs-lookup"><span data-stu-id="0b650-150">SDK Usage</span></span>
1. <span data-ttu-id="0b650-151">**En son SDK'sını yükleyin**</span><span class="sxs-lookup"><span data-stu-id="0b650-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="0b650-152">Cosmos DB SDK'ları en iyi performansı sağlamak için sürekli geliştirilen.</span><span class="sxs-lookup"><span data-stu-id="0b650-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="0b650-153">Bkz: [Cosmos DB SDK](documentdb-sdk-dotnet.md) en son SDK belirlemek ve geliştirmeleri gözden geçirmek için sayfaları.</span><span class="sxs-lookup"><span data-stu-id="0b650-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="0b650-154">**Bir singleton Cosmos DB istemci uygulamanızın ömrü boyunca kullanın**</span><span class="sxs-lookup"><span data-stu-id="0b650-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="0b650-155">Her DocumentClient örnek iş parçacığı açısından güvenli ve verimli bağlantı yönetimi ve doğrudan modunda çalışırken adresi önbelleğe alma gerçekleştirir unutmayın.</span><span class="sxs-lookup"><span data-stu-id="0b650-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="0b650-156">Verimli bağlantı yönetimi ve daha iyi performans DocumentClient ile izin vermek için uygulama yaşam süresi için DocumentClient AppDomain başına tek bir örneğini kullanmak için önerilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="0b650-157">**Ağ geçidi modu kullanırken System.Net MaxConnections ana bilgisayar başına artırın**</span><span class="sxs-lookup"><span data-stu-id="0b650-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="0b650-158">Cosmos DB istekleri, HTTPS/REST yapılır, ağ geçidi modu kullanırken ve varsayılan bağlantı sınırını ana bilgisayar adı veya IP adresi başına tabi.</span><span class="sxs-lookup"><span data-stu-id="0b650-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="0b650-159">Böylece istemci kitaplığı Cosmos DB birden çok eşzamanlı bağlantıların kullanabilir MaxConnections daha yüksek bir değer (100-1000) ayarlamanız gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="0b650-160">.NET SDK'sındaki 1.8.0 ve varsayılan değerin üzerinde [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) 50'dir ve değerini değiştirmek için ayarlayabileceğiniz [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx)daha yüksek bir değere.</span><span class="sxs-lookup"><span data-stu-id="0b650-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="0b650-161">**Paralel sorgular bölümlenmiş koleksiyonlar için ayarlama**</span><span class="sxs-lookup"><span data-stu-id="0b650-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="0b650-162">DocumentDB .NET SDK sürüm 1.9.0 ve paralel bölümlendirilmiş bir koleksiyon sorgulamak etkinleştirme desteği paralel sorgular yukarıda (bkz [SDK'ları ile çalışma](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) ve ilgili [kod örnekleri](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) daha fazla bilgi için bilgileri).</span><span class="sxs-lookup"><span data-stu-id="0b650-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="0b650-163">Paralel sorgular seri bunların karşılık gelen sorgu gecikme süresi ve üretilen işi artırmak için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="0b650-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="0b650-164">Paralel sorguları, kullanıcılar için özel Sığdır gereksinimlerine, (a) MaxDegreeOfParallelism ayarlayabilirsiniz iki parametre sağlar: en çok sonra bölüm sayısı sorgulanan paralel ve (b) MaxBufferedItemCount denetlemek için: sayısını kontrol etmek için önceden getirilen sonuç.</span><span class="sxs-lookup"><span data-stu-id="0b650-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="0b650-165">(a) ***ayarlama MaxDegreeOfParallelism\: *** paralel sorgu works birden çok bölümü paralel sorgulayarak.</span><span class="sxs-lookup"><span data-stu-id="0b650-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="0b650-166">Ancak, tek bir bölümlenmiş toplama verileri seri olarak sorgu göre getirilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="0b650-167">Bu nedenle, diğer tüm sistem koşulları aynı kalır sağlanan çoğu kullanıcı sorgu elde maksimum fırsat bir bölüm sayısı MaxDegreeOfParallelism ayarlama sahiptir.</span><span class="sxs-lookup"><span data-stu-id="0b650-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="0b650-168">Bölüm sayısı bilmiyorsanız, yüksek bir sayıya MaxDegreeOfParallelism ayarlayabilir ve sistem MaxDegreeOfParallelism en az (bölüm, kullanıcı tarafından sağlanan girdi sayısı) seçer.</span><span class="sxs-lookup"><span data-stu-id="0b650-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="0b650-169">Verileri sorgu göre tüm bölümleri arasında eşit olarak dağıtılır, paralel sorgular en iyi avantajları oluşturduğunun dikkate almak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="0b650-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="0b650-170">Bölümlenmiş koleksiyonu (en kötü durumda bir bölüm) birkaç bölümlerdeki tamamı veya bir sorgu tarafından döndürülen verilerin çoğunu bir yoğunlaşmıştır, ardından sorgu performansını tarafından bu bölümler nedeniyle düşük performansa şekilde bölümlenmiş durumunda.</span><span class="sxs-lookup"><span data-stu-id="0b650-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="0b650-171">(b) ***ayarlama MaxBufferedItemCount\: *** paralel sorgu sonuçlarının geçerli toplu işlem istemci tarafından gerçekleştirilirken sonuçları önceden getirmek için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="0b650-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="0b650-172">Önceden getirme sorgu genel gecikme gelişme yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="0b650-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="0b650-173">MaxBufferedItemCount önceden getirilen sonuç sayısını sınırlamak için parametresidir.</span><span class="sxs-lookup"><span data-stu-id="0b650-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="0b650-174">Döndürülen sonuçları beklenen sayıda MaxBufferedItemCount (veya daha yüksek bir sayı) ayarlamayı önceden getirme maksimum avantajı almak sorgu sağlar.</span><span class="sxs-lookup"><span data-stu-id="0b650-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="0b650-175">Önceden getirme MaxDegreeOfParallelism bağımsız olarak aynı şekilde çalışır ve tüm bölümleri verileri için tek bir arabelleğe olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="0b650-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="0b650-176">**Sunucu tarafı GC üzerinde Aç**</span><span class="sxs-lookup"><span data-stu-id="0b650-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="0b650-177">Çöp toplama sıklığını azaltmayı bazı durumlarda yardımcı olabilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="0b650-178">.NET ile ayarlamak [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) true.</span><span class="sxs-lookup"><span data-stu-id="0b650-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="0b650-179">**Geri Çekilme RetryAfter aralıklarla uygulama**</span><span class="sxs-lookup"><span data-stu-id="0b650-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="0b650-180">Performans testi sırasında istekleri küçük oranını kısıtlanan kadar yük artırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="0b650-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="0b650-181">Kısıtlanan, istemci uygulamasına geri Çekilme kısıtlama üzerinde sunucu belirtilen yeniden deneme aralığını gerekir.</span><span class="sxs-lookup"><span data-stu-id="0b650-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="0b650-182">Geri Çekilme uyarak denemeler arasındaki bekleme süresi en az miktarda harcamanızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="0b650-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="0b650-183">Yeniden deneme ilkesi desteği eklenmiştir sürümünde 1.8.0 ve yukarıdaki documentdb'nin [.NET](documentdb-sdk-dotnet.md) ve [Java](documentdb-sdk-java.md), sürüm 1.9.0 ve üstü, [Node.js](documentdb-sdk-node.md) ve [Python ](documentdb-sdk-python.md), ve tüm desteklenen sürümlerinde [.NET Core](documentdb-sdk-dotnet-core.md) SDK'ları.</span><span class="sxs-lookup"><span data-stu-id="0b650-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="0b650-184">Daha fazla bilgi için bkz: [Exceeding ayrılmış işleme sınırları](request-units.md#RequestRateTooLarge) ve [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="0b650-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="0b650-185">**İstemci-iş yükünü ölçeklendirme**</span><span class="sxs-lookup"><span data-stu-id="0b650-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="0b650-186">Yüksek işleme düzeyleri sınıyorsanız (> 50.000 RU/s), istemci uygulaması makine çıkışı CPU veya ağ kullanımını capping nedeniyle ayak bağı.</span><span class="sxs-lookup"><span data-stu-id="0b650-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="0b650-187">Bu noktaya ulaştıysanız, birden çok sunucu arasında istemci uygulamalarının ölçeklendirme tarafından Cosmos DB hesap ek itme devam edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="0b650-188">**Daha düşük okuma gecikmesi için önbellek belge URI'ler**</span><span class="sxs-lookup"><span data-stu-id="0b650-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="0b650-189">Önbellek belge URI'ler okuma en iyi performans için mümkün.</span><span class="sxs-lookup"><span data-stu-id="0b650-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="0b650-190">**Sorguları/okuma akışları daha iyi performans için sayfa boyutunu ayarlama**</span><span class="sxs-lookup"><span data-stu-id="0b650-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="0b650-191">Bir toplu gerçekleştirme belgeleri okuma akışı işlevleri (örneğin, ReadDocumentFeedAsync) kullanarak veya bir DocumentDB SQL sorgu gönderirken okurken sonuç kümesi çok büyük ise sonuçları bölümlenmiş bir şekilde döndürülür.</span><span class="sxs-lookup"><span data-stu-id="0b650-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="0b650-192">Varsayılan olarak, ilk isabet sınırlarından hangisi olduğunu, sonuçları 100 öğeleri ya da 1 MB yığınlar halinde döndürdü.</span><span class="sxs-lookup"><span data-stu-id="0b650-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="0b650-193">Sayısını azaltmak için ağ gidiş dönüşleri tüm geçerli sonuçları almak için gerekli, en fazla 1000 x-ms-max-öğesi-count istek üstbilgisi kullanarak sayfa boyutunu artırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="0b650-194">Burada yalnızca birkaç sonuçları görüntülemek için gereken durumlarda Örneğin, kullanıcı arabirimi veya uygulama API yalnızca 10 döndürürse birer sonuçları, aynı zamanda okuma ve sorgular için tüketilen verimlilik azaltmak için 10 sayfa boyutunu azaltabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="0b650-195">Sayfa boyutu kullanılabilir Cosmos DB SDK'ları kullanarak da ayarlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="0b650-196">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="0b650-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="0b650-197">**İş parçacıkları/görevleri sayısını artırın**</span><span class="sxs-lookup"><span data-stu-id="0b650-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="0b650-198">Bkz: [iş parçacıkları/görevlerin sayısını artırmak](#increase-threads) ağ bölümünde.</span><span class="sxs-lookup"><span data-stu-id="0b650-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="0b650-199">**64-bit ana bilgisayar işleme kullanın**</span><span class="sxs-lookup"><span data-stu-id="0b650-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="0b650-200">DocumentDB SDK'sı bir 32-bit ana işlem DocumentDB .NET SDK sürüm 1.11.4 kullanırken ve üstünde çalışır.</span><span class="sxs-lookup"><span data-stu-id="0b650-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="0b650-201">Ancak, çapraz bölüm sorguları kullanıyorsanız, 64-bit ana bilgisayar işleme Gelişmiş performans için önerilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="0b650-202">64 bit izleyin değiştirmek için aşağıdaki adımları uygulamanız türüne bağlı şekilde aşağıdaki uygulama türlerini varsayılan olarak, 32-bit ana bilgisayar işlemi vardır:</span><span class="sxs-lookup"><span data-stu-id="0b650-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="0b650-203">Yürütülebilir uygulamalar için bu kaldırarak yapılabilir **tercih 32-bit** seçeneğini **proje özelliklerini** penceresi, **yapı** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="0b650-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="0b650-204">Test projeleri VSTest tabanlı için bu seçerek yapılabilir **Test**->**Test ayarlarını**->**varsayılan İşlemci mimarisi X64 olarak**, gelen **Visual Studio Test** menü seçeneği.</span><span class="sxs-lookup"><span data-stu-id="0b650-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="0b650-205">Yerel olarak dağıtılan ASP.NET Web uygulamaları için bu kontrol ederek yapılabilir **web siteleri ve projeler için IIS Express 64-bit sürümünü kullanmanız**altında **Araçları**->**seçenekleri**  -> **Projeler ve çözümler**->**Web projeleri**.</span><span class="sxs-lookup"><span data-stu-id="0b650-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="0b650-206">Azure üzerinde dağıtılan ASP.NET Web uygulamaları için bu seçerek yapılabilir **64-bit olarak Platform** içinde **uygulama ayarları** Azure portalındaki.</span><span class="sxs-lookup"><span data-stu-id="0b650-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="0b650-207">Dizin oluşturma ilkesi</span><span class="sxs-lookup"><span data-stu-id="0b650-207">Indexing Policy</span></span>
1. <span data-ttu-id="0b650-208">**Kullanım için daha hızlı yoğun zamanı alım hızlarını dizin geç**</span><span class="sxs-lookup"><span data-stu-id="0b650-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="0b650-209">Cosmos DB belgeleri otomatik olarak veya olmayan listelenecek koleksiyonundaki isteyip istemediğinizi seçmenize olanak tanıyan bir dizin oluşturma ilkesi – koleksiyon düzeyinde – belirtmenize olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="0b650-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="0b650-210">Ayrıca, zaman uyumlu (CONSISTENT) ve zaman uyumsuz (Lazy) dizin güncelleştirmeleri arasında da seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="0b650-211">Varsayılan olarak, dizin her ekleme, değiştirme veya koleksiyona bir belgeyi silme zaman uyumlu olarak güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="0b650-212">Zaman uyumlu olarak aynı vermenizin sorguları modunu etkinleştirir [tutarlılık düzeyi](consistency-levels.md) belgenin "yakala" dizin için herhangi bir gecikme olmadan okuyan gibi.</span><span class="sxs-lookup"><span data-stu-id="0b650-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="0b650-213">Yavaş dizin oluşturma verileri WINS'e içinde yazılmış senaryoları için düşünülebilecek ve daha uzun bir süre boyunca dizin içerik için gereken iş İtfası istiyorsunuz.</span><span class="sxs-lookup"><span data-stu-id="0b650-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="0b650-214">Yavaş dizin oluşturma, sağlanan işleme etkili bir şekilde kullanmak ve en düşük gecikme süresi ile yoğun saatlerde yazma isteklerine hizmet sağlar.</span><span class="sxs-lookup"><span data-stu-id="0b650-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="0b650-215">Ancak, yavaş dizin oluşturma etkin olduğunda, sorgu sonuçları Cosmos DB hesabı için yapılandırılan tutarlılık düzeyi bakılmaksızın sonunda tutarlı olduğunu dikkate almak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="0b650-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="0b650-216">Bu nedenle, (IndexingPolicy.IndexingMode CONSISTENT için ayarlanır) tutarlı dizin oluşturma modu Lazy modu (Lazy için IndexingPolicy.IndexingMode ayarlanır) ve dizin oluşturma dizin oluşturma işlemi sırasında yazma başına en yüksek istek birimi ücret doğurur (IndexingPolicy.Automatic ayarlanır False) dizin sıfır maliyet yazma zamanda vardır.</span><span class="sxs-lookup"><span data-stu-id="0b650-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="0b650-217">**Daha hızlı yazmalar için dizin oluşturma kullanılmayan yolu dışla**</span><span class="sxs-lookup"><span data-stu-id="0b650-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="0b650-218">Cosmos veritabanı dizin oluşturma ilkesini de dahil etmek veya hariç dizin yolları (IndexingPolicy.IncludedPaths ve IndexingPolicy.ExcludedPaths) yararlanarak dizin hangi belge yolları belirtmenize olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="0b650-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="0b650-219">Dizin oluşturma maliyetleri doğrudan dizine benzersiz yolları sayısı bağıntılı gibi yolları dizin kullanımını geliştirilmiş yazma performansı ve sorgu desenlerine önceden bilinir senaryoları için alt dizini depolama sunabilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="0b650-220">Örneğin, aşağıdaki kod belgeleri bölümünün tamamını (paketini dışlama gösterir</span><span class="sxs-lookup"><span data-stu-id="0b650-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="0b650-221">bir alt ağacı) dizin kullanarak "*" joker karakter.</span><span class="sxs-lookup"><span data-stu-id="0b650-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="0b650-222">Daha fazla bilgi için bkz: [Azure Cosmos ilkeleri dizin DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="0b650-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="0b650-223">Aktarım hızı</span><span class="sxs-lookup"><span data-stu-id="0b650-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="0b650-224">**Ölçmek ve alt istek için saniye başına birim kullanım ayarlayın.**</span><span class="sxs-lookup"><span data-stu-id="0b650-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="0b650-225">Cosmos DB zengin bir ilişkisel ve hiyerarşik sorgularıyla UDF'ler, saklı yordamları ve Tetikleyicileri – tüm işletim veritabanı koleksiyon içindeki belgelerde dahil olmak üzere veritabanı işlemleri sunar.</span><span class="sxs-lookup"><span data-stu-id="0b650-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="0b650-226">Bu işlemlerin her biri ile ilişkili maliyet CPU, g/ç ve işlemi tamamlamak için gereken bellek göre değişir.</span><span class="sxs-lookup"><span data-stu-id="0b650-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="0b650-227">Göz önünde bulundurulması ve donanım kaynaklarını yönetmek yerine, bir uygulama isteği hizmet ve çeşitli veritabanı işlemlerini gerçekleştirmek için gereken kaynakları için tek bir ölçü olarak bir istek birimi (RU) düşünebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="0b650-228">[İstek birimleri](request-units.md) satın aldığınız kapasite birimlerinin sayısına göre her bir veritabanı hesabı için sağlanır.</span><span class="sxs-lookup"><span data-stu-id="0b650-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="0b650-229">İstek birimi tüketim saniye başına oranı olarak değerlendirilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="0b650-230">Sağlanan istek birimi oranı oranı hesabı için ayrılmış düzeyinin altına düşene kadar hesaplarında sınırlıdır aşan uygulamalar.</span><span class="sxs-lookup"><span data-stu-id="0b650-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="0b650-231">Uygulamanız daha yüksek düzeyde üretilen iş gerektiriyorsa, ek kapasite birimleri satın alabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0b650-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="0b650-232">Kaç tane istek birimlerine bir işlem için kullanılan bir sorgu karmaşıklığını etkiler.</span><span class="sxs-lookup"><span data-stu-id="0b650-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="0b650-233">Koşulları sayısı, koşulları, UDF'ler sayısı ve tüm kaynak veri kümesi boyutunu yapısını sorgu işlemlerinin maliyetini etkiler.</span><span class="sxs-lookup"><span data-stu-id="0b650-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="0b650-234">Herhangi bir işlem yükü ölçmek için (oluşturma, güncelleştirme veya silme), x-ms-istek-ücret üstbilgi inceleyin (veya eşdeğer RequestCharge özelliği ResourceResponse ile<T> veya FeedResponse<T> .NET SDK'sındaki) sayısını ölçmek için Bu işlemler tarafından tüketilen istek birimleri.</span><span class="sxs-lookup"><span data-stu-id="0b650-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="0b650-235">Bu üstbilgisinde döndürülen istek ücret bir sağlanan işleme bölümüdür (yani, 2000 RUs / saniye).</span><span class="sxs-lookup"><span data-stu-id="0b650-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="0b650-236">Örneğin, önceki sorgunun 1000 1 KB-belgeleri döndürürse, işlem maliyetini 1000'dir.</span><span class="sxs-lookup"><span data-stu-id="0b650-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="0b650-237">Bu nedenle, bir saniye içinde sonraki istekler azaltma önce sunucunun yalnızca iki tür isteklere korur.</span><span class="sxs-lookup"><span data-stu-id="0b650-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="0b650-238">Daha fazla bilgi için bkz: [istek birimleri](request-units.md) ve [istek birimi hesaplayıcı](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="0b650-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="0b650-239">**Tanıtıcı oranı sınırlama istek oranı çok büyük**</span><span class="sxs-lookup"><span data-stu-id="0b650-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="0b650-240">Bir istemci bir hesap için ayrılmış işleme aşan girişiminde bulunduğunda, sunucuda bir performans düşüşü olmadan ve işleme kapasitesi ayrılmış düzeyinin ötesine hiçbir kullanımını yoktur.</span><span class="sxs-lookup"><span data-stu-id="0b650-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="0b650-241">Sunucu erken önlem isteği RequestRateTooLarge (HTTP durum kodu 429) ile bitmelidir ve kullanıcı isteği reattempting önce beklemesi gereken milisaniye cinsinden süreyi belirten x-ms-yeniden deneme-sonra-ms üstbilgi döndürür.</span><span class="sxs-lookup"><span data-stu-id="0b650-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="0b650-242">SDK'ları tüm örtük olarak bu yanıt catch, yeniden deneme sonra sunucu tarafından belirtilen üstbilgi saygı ve isteği yeniden deneyin.</span><span class="sxs-lookup"><span data-stu-id="0b650-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="0b650-243">Hesabınızı eşzamanlı olarak birden çok istemci tarafından erişilen sürece, sonraki yeniden deneme işlemi başarılı olur.</span><span class="sxs-lookup"><span data-stu-id="0b650-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="0b650-244">Birden fazla istemci üst üste istek hızı tutarlı bir şekilde işletim varsa, 9 istemci tarafından dahili olarak ayarlanmış varsayılan yeniden deneme sayısı yeterli değil; Bu durumda, istemci uygulamaya 429 durum koduyla bir DocumentClientException oluşturur.</span><span class="sxs-lookup"><span data-stu-id="0b650-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="0b650-245">Varsayılan yeniden deneme sayısı ConnectionPolicy örneğinde RetryOptions ayarlayarak değiştirilebilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="0b650-246">İstek istek hızı çalışmaya devam ederse, varsayılan olarak, 30 saniye sonra bir toplam bekleme süresi 429 durum koduyla DocumentClientException döndürülür.</span><span class="sxs-lookup"><span data-stu-id="0b650-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="0b650-247">Bu geçerli yeniden deneme sayısı en fazla yeniden deneme sayısından daha az olduğunda bile oluşur, varsayılan 9 veya kullanıcı tanımlı bir değer olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="0b650-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="0b650-248">Dayanıklılık ve kullanılabilirlik çoğu uygulamalar geliştirmek için otomatik yeniden deneme davranışı yardımcı olsa da, bu performans kıyaslamaları, özellikle gecikme süresini ölçme zaman yaparken at odds gelebilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="0b650-249">Denemeyi sunucu kısıtlama isabetler ve sessiz bir şekilde yeniden denemek için SDK istemci neden olursa istemci gözlenen gecikme çıkmasına.</span><span class="sxs-lookup"><span data-stu-id="0b650-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="0b650-250">Performans denemeleri sırasında gecikme ani önlemek için her işlem tarafından döndürülen farkı ölçmek ve istekleri ayrılmış istek hızı çalıştığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="0b650-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="0b650-251">Daha fazla bilgi için bkz: [istek birimleri](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="0b650-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="0b650-252">**Daha fazla üretilen işi için daha küçük belgeler için Tasarım**</span><span class="sxs-lookup"><span data-stu-id="0b650-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="0b650-253">Belirli bir işlemi isteği giderleri (yani istek işleme maliyet) doğrudan belgenin boyutunu ilişkilendirilir.</span><span class="sxs-lookup"><span data-stu-id="0b650-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="0b650-254">Büyük belgeleri işlemleri birden çok küçük belgeler için işlemleri maliyeti.</span><span class="sxs-lookup"><span data-stu-id="0b650-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0b650-255">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="0b650-255">Next steps</span></span>
<span data-ttu-id="0b650-256">Birkaç istemci makineler yüksek performanslı senaryoları için Cosmos DB değerlendirmek için kullanılan örnek bir uygulama için bkz: [performansı ve ölçeği Cosmos DB ile test](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="0b650-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="0b650-257">Ayrıca, uygulamanız ölçeği ve yüksek performans için tasarlama hakkında daha fazla bilgi için bkz. [bölümleme ve Azure Cosmos DB'de ölçeklendirme](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="0b650-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
