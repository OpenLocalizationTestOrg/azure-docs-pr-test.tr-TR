---
title: "Yük Dengeleyici özel araştırmalar ve sistem durumu izleme | Microsoft Docs"
description: "Yük dengeleyicinin arkasındaki örnekleri izlemek için Azure yük dengeleyici için özel araştırmalara kullanmayı öğrenin"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: cab028fed58d544a56f2f6b12b72364c7baf4d86
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="b0e6f-103">Yük dengeleyici araştırmalarını anlama</span><span class="sxs-lookup"><span data-stu-id="b0e6f-103">Understand load balancer probes</span></span>

<span data-ttu-id="b0e6f-104">Azure yük dengeleyici araştırmalar kullanarak sunucu örneklerinin durumunu izleme yeteneği sağlar.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-104">Azure Load Balancer offers the capability to monitor the health of server instances by using probes.</span></span> <span data-ttu-id="b0e6f-105">Yanıt bir araştırma başarısız olduğunda, yük dengeleyici sağlıksız örneğine yeni bağlantılar gönderme durdurur.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-105">When a probe fails to respond, Load Balancer stops sending new connections to the unhealthy instance.</span></span> <span data-ttu-id="b0e6f-106">Var olan bağlantıların etkilenmez ve yeni bağlantılar sağlıklı örneklerine gönderilir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-106">The existing connections are not affected, and new connections are sent to healthy instances.</span></span>

<span data-ttu-id="b0e6f-107">Bulut hizmeti rollerinizi (çalışan rolleri ve web rolleri) bir konuk Aracısı araştırma izlemek için kullanın.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="b0e6f-108">Sanal makineler yük dengeleyici arkasında kullandığınızda, TCP veya HTTP özel araştırmalara yapılandırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="b0e6f-109">Araştırma sayısı ve zaman aşımı anlama</span><span class="sxs-lookup"><span data-stu-id="b0e6f-109">Understand probe count and timeout</span></span>

<span data-ttu-id="b0e6f-110">Araştırma davranışı bağlıdır:</span><span class="sxs-lookup"><span data-stu-id="b0e6f-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="b0e6f-111">Bir örnek olarak etiketlenmiş izin başarılı araştırmalar sayısı olarak çalışır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-111">The number of successful probes that allow an instance to be labeled as up.</span></span>
* <span data-ttu-id="b0e6f-112">Bir örnek olarak etiketlenmiş neden başarısız araştırmalar sayısı olarak aşağı.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-112">The number of failed probes that cause an instance to be labeled as down.</span></span>

<span data-ttu-id="b0e6f-113">Zaman aşımı ve sıklığı değeri SuccessFailCount ayarlanmış belirlemek örneğini çalıştıran veya çalışmıyor onaylanıp onaylanmadığını.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-113">The timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed to be running or not running.</span></span> <span data-ttu-id="b0e6f-114">Azure portalında zaman aşımı için sıklığı değerini iki kez ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-114">In the Azure portal, the timeout is set to two times the value of the frequency.</span></span>

<span data-ttu-id="b0e6f-115">Tüm örneklerin yük dengeli bir uç nokta (diğer bir deyişle, yük dengeli kümesi) için araştırma yapılandırması aynı olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-115">The probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be the same.</span></span> <span data-ttu-id="b0e6f-116">Başka bir deyişle, belirli bir uç nokta birleşimi için aynı barındırılan hizmetindeki her rol örneği veya sanal makine için farklı araştırma yapılandırmasını sahip olamaz.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-116">This means you cannot have a different probe configuration for each role instance or virtual machine in the same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="b0e6f-117">Örneğin, her bir örneği aynı yerel bağlantı noktaları ve zaman aşımlarına olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b0e6f-118">Bir yük dengeleyici araştırmasını 168.63.129.16 IP adresini kullanır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-118">A Load Balancer probe uses the IP address 168.63.129.16.</span></span> <span data-ttu-id="b0e6f-119">Bu ortak IP adresini Getir-bilgisayarınızı-kendi-IP Azure sanal ağı senaryosu için iç platform kaynaklarına iletişimi kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-119">This public IP address facilitates communication to internal platform resources for the bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="b0e6f-120">Genel sanal IP adresi 168.63.129.16 tüm bölgelerde kullanılır ve değişmez.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-120">The virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="b0e6f-121">Tüm yerel güvenlik duvarı ilkeleri bu IP adresine izin öneririz.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="b0e6f-122">Yalnızca dahili Azure platformu bu adresi bir iletiden kaynağı bir güvenlik riski düşünülmemelidir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-122">It should not be considered a security risk because only the internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="b0e6f-123">Bunu yaparsanız, çeşitli senaryolarda 168.63.129.16 ve IP adreslerini yinelenen aynı IP adresi aralığı yapılandırma gibi beklenmeyen davranışlara olacaktır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring the same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-the-types-of-probes"></a><span data-ttu-id="b0e6f-124">Araştırmalar türleri hakkında bilgi edinin</span><span class="sxs-lookup"><span data-stu-id="b0e6f-124">Learn about the types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="b0e6f-125">Konuk aracı araştırması</span><span class="sxs-lookup"><span data-stu-id="b0e6f-125">Guest agent probe</span></span>

<span data-ttu-id="b0e6f-126">Bu araştırma yalnızca Azure bulut Hizmetleri için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="b0e6f-127">Yük Dengeleyici sanal makine içinde Konuk Aracısı'nı kullanır ve dinler ve yalnızca örnek hazır durumda olduğunda bir HTTP 200 Tamam yanıt ile yanıt verir (diğer bir deyişle, içinde başka durum geri dönüştürme ya da durdurma meşgul gibi).</span><span class="sxs-lookup"><span data-stu-id="b0e6f-127">Load Balancer utilizes the guest agent inside the virtual machine, and then listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="b0e6f-128">Daha fazla bilgi için bkz: [Hizmet tanım dosyası (csdef) için sistem durumu araştırmalarının yapılandırma](https://msdn.microsoft.com/library/azure/ee758710.aspx) veya [bulut Hizmetleri için bir Internet'e yönelik Yük Dengeleyici oluşturmaya başlamak](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="b0e6f-128">For more information, see [Configuring the service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="b0e6f-129">Bir örneği sağlıksız olarak işaretlemek Konuk aracı araştırması ne yapar?</span><span class="sxs-lookup"><span data-stu-id="b0e6f-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="b0e6f-130">Konuk Aracısı ile HTTP 200 Tamam yanıt vermiyorsa, yük dengeleyici örneği yanıt olarak işaretler ve trafiği için bu örneği göndermeye durdurur.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-130">If the guest agent fails to respond with HTTP 200 OK, the load balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="b0e6f-131">Yük Dengeleyici örneği ping işlemi devam eder.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-131">The load balancer continues to ping the instance.</span></span> <span data-ttu-id="b0e6f-132">Yük Dengeleyici trafiği için bu örneği ile bir HTTP 200 Konuk aracısı yanıt verirse, yeniden gönderir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-132">If the guest agent responds with an HTTP 200, the load balancer sends traffic to that instance again.</span></span>

<span data-ttu-id="b0e6f-133">Web rolü kullandığınızda, Web sitesi kodu genellikle Azure tarafından izlenmeyen w3wp.exe çalışan doku veya konuk Aracısı.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-133">When you use a web role, the website code typically runs in w3wp.exe, which is not monitored by the Azure fabric or guest agent.</span></span> <span data-ttu-id="b0e6f-134">Bu w3wp.exe (örneğin, HTTP 500 yanıtları) hatalarına Konuk aracıya raporlanmayacaktır ve yük dengeleyici döndürme dışında bu örneği olmayacak anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported to the guest agent, and the load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="b0e6f-135">HTTP özel araştırma</span><span class="sxs-lookup"><span data-stu-id="b0e6f-135">HTTP custom probe</span></span>

<span data-ttu-id="b0e6f-136">Özel HTTP yük dengeleyici araştırmasını rol örneğinin sistem durumunu belirlemek için kendi özel mantık oluşturabileceğiniz anlamına gelir varsayılan Konuk aracı araştırması geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-136">The custom HTTP Load Balancer probe overrides the default guest agent probe, which means that you can create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="b0e6f-137">Yük Dengeleyici uç noktanızı varsayılan olarak 15 dakikada araştırmaları.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-137">The load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="b0e6f-138">Örnek, bir HTTP 200 ile (varsayılan olarak 31 saniye) zaman aşımı süresi içinde yanıt verirse yük dengeleyici döndürme olarak kabul edilir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-138">The instance is considered to be in the load balancer rotation if it responds with an HTTP 200 within the timeout period (31 seconds by default).</span></span>

<span data-ttu-id="b0e6f-139">Bu yük dengeleyici döndürme örneklerini kaldırmak için kendi mantığını uygulamak istediğinizde yararlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-139">This can be useful if you want to implement your own logic to remove instances from load balancer rotation.</span></span> <span data-ttu-id="b0e6f-140">Örneğin, % 90 CPU ise ve 200 olmayan durum döndürür örneği kaldırmaya karar.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-140">For example, you could decide to remove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="b0e6f-141">W3wp.exe kullanan web rolleri varsa, bu da otomatik al anlamına gelir, Web sitesini, Web sitesi kodunuzdaki hataları için yük dengeleyici araştırmasını 200 durum geri getireceğinden izleme.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status to the load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="b0e6f-142">HTTP özel araştırma göreli yollar ve yalnızca HTTP protokolünü destekler.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-142">The HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="b0e6f-143">HTTPS desteklenmiyor.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="b0e6f-144">Bir örneği sağlıksız olarak işaretlemek bir HTTP özel araştırma ne yapar?</span><span class="sxs-lookup"><span data-stu-id="b0e6f-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="b0e6f-145">HTTP uygulama 200 (örneğin, 403, 404 veya 500) dışında bir HTTP yanıt kodunu döndürür.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-145">The HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="b0e6f-146">Uygulama örneğinin hizmet dışı hemen alınıp alınmayacağını pozitif bir bildirim budur.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-146">This is a positive acknowledgment that the application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="b0e6f-147">HTTP sunucusu zaman aşımı süresinden sonra hiç yanıt vermez.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-147">The HTTP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="b0e6f-148">Belirlenen zaman aşımı değeri bağlı olarak, birden çok araştırma istekleri yoklama çalışmıyor olarak işaretlenmiş önce yanıtlanmadan Git bu anlamına gelebilir (diğer bir deyişle, önce SuccessFailCount araştırmalar gönderilir).</span><span class="sxs-lookup"><span data-stu-id="b0e6f-148">Depending on the timeout value that is set, this might mean that multiple probe requests go unanswered before the probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="b0e6f-149">Sunucu TCP sıfırlama aracılığıyla bağlantıyı kapatır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-149">The server closes the connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="b0e6f-150">TCP özel araştırma</span><span class="sxs-lookup"><span data-stu-id="b0e6f-150">TCP custom probe</span></span>

<span data-ttu-id="b0e6f-151">TCP araştırmalar üç yönlü el sıkışma tanımlanan bağlantı noktası ile gerçekleştirerek bir bağlantı başlatır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-151">TCP probes initiate a connection by performing a three-way handshake with the defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="b0e6f-152">Bir örneği sağlıksız olarak işaretlemek TCP özel bir araştırma yapan nedir?</span><span class="sxs-lookup"><span data-stu-id="b0e6f-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="b0e6f-153">TCP sunucu zaman aşımı süresinden sonra hiç yanıt vermez.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-153">The TCP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="b0e6f-154">Ne zaman araştırma çalışmıyor olarak işaretlenmiş sayısı, araştırma çalışmıyor olarak işaretlemek önce yanıtlanmadan gitmek için yapılandırılmış olan başarısız araştırma isteklerinin bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-154">When the probe is marked as not running depends on the number of failed probe requests that were configured to go unanswered before marking the probe as not running.</span></span>
* <span data-ttu-id="b0e6f-155">Rol örneğinden sıfırlama bir TCP araştırması alır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-155">The probe receives a TCP reset from the role instance.</span></span>

<span data-ttu-id="b0e6f-156">Bir HTTP durum araştırması veya bir TCP araştırması yapılandırma hakkında daha fazla bilgi için bkz: [PowerShell kullanarak Kaynak Yöneticisi'nde bir Internet'e yönelik Yük Dengeleyici oluşturmaya başlamak](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="b0e6f-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="b0e6f-157">Yük Dengeleyici döndürme uygulamasına geri sağlıklı örnekleri Ekle</span><span class="sxs-lookup"><span data-stu-id="b0e6f-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="b0e6f-158">TCP ve HTTP araştırmaları sağlıklı olarak kabul edilir ve rol örneği sağlıklı olduğunda olarak işaretleyin:</span><span class="sxs-lookup"><span data-stu-id="b0e6f-158">TCP and HTTP probes are considered healthy and mark the role instance as healthy when:</span></span>

* <span data-ttu-id="b0e6f-159">Yük Dengeleyici VM ilk kez önyükleme pozitif bir araştırma alır.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-159">The load balancer gets a positive probe the first time the VM boots.</span></span>
* <span data-ttu-id="b0e6f-160">(Daha önce açıklanan) numara SuccessFailCount rol örneği sağlıklı olarak işaretlemek için gerekli başarılı araştırmalar değerini tanımlar.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-160">The number SuccessFailCount (described earlier) defines the value of successful probes that are required to mark the role instance as healthy.</span></span> <span data-ttu-id="b0e6f-161">Rol örneği kaldırılmışsa, başarılı, art arda araştırmalar sayısı eşit veya rol örneği çalışıyor olarak işaretlemek için SuccessFailCount değerini aşıyor.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-161">If a role instance was removed, the number of successful, successive probes must equal or exceed the value of SuccessFailCount to mark the role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="b0e6f-162">Rol örneği durumunu dalgalı, yük dengeleyici artık rol örneği sağlam durumda geçirmeden önce bekler.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-162">If the health of a role instance is fluctuating, the load balancer waits longer before putting the role instance back in the healthy state.</span></span> <span data-ttu-id="b0e6f-163">Bu, kullanıcı ve altyapıyı koruma ilke aracılığıyla gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-163">This is done via policy to protect the user and the infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="b0e6f-164">Yük Dengeleyici için günlük analizi kullanın</span><span class="sxs-lookup"><span data-stu-id="b0e6f-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="b0e6f-165">Kullanabileceğiniz [analytics yük dengeleyici için oturum](load-balancer-monitor-log.md) araştırma sistem durumunu ve araştırma sayısı denetlemek için.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) to check on the probe health status and probe count.</span></span> <span data-ttu-id="b0e6f-166">Günlüğe kaydetme, Power BI veya Azure Operational Insights ile yük dengeleyici sistem durumu hakkındaki istatistiklerdir sağlamak için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="b0e6f-166">Logging can be used with Power BI or Azure Operational Insights to provide statistics about Load Balancer health status.</span></span>
