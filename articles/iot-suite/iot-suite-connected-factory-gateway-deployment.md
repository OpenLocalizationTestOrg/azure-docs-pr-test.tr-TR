---
title: "Azure IOT paketi bağlı Fabrika ağ geçidi dağıtma | Microsoft Docs"
description: "Bir ağ geçidi bağlı Fabrika bağlantıyı etkinleştirmek için Windows veya Linux üzerinde dağıtma önceden yapılandırılmış çözümü."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: b0e6ae705911d7c18643c77b7fe08fdffffa5eb1
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/03/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-the-connected-factory-preconfigured-solution"></a><span data-ttu-id="66943-103">Windows veya Linux üzerinde bir ağ geçidi bağlı Fabrika önceden yapılandırılmış çözümü dağıtma</span><span class="sxs-lookup"><span data-stu-id="66943-103">Deploy a gateway on Windows or Linux for the connected factory preconfigured solution</span></span>

<span data-ttu-id="66943-104">Bağlı Fabrika önceden yapılandırılmış çözüm için bir ağ geçidi dağıtmak için gerekli yazılımı iki bileşenden oluşur:</span><span class="sxs-lookup"><span data-stu-id="66943-104">The software required to deploy a gateway for the connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="66943-105">*OPC Proxy* IOT Hub bağlantı kurar.</span><span class="sxs-lookup"><span data-stu-id="66943-105">The *OPC Proxy* establishes a connection to IoT Hub.</span></span> <span data-ttu-id="66943-106">*OPC Proxy* tarayıcıdan tümleşik OPC bağlı Fabrika çözüm Portalı'nda çalışan komut ve Denetim iletileri bekler.</span><span class="sxs-lookup"><span data-stu-id="66943-106">The *OPC Proxy* then waits for command and control messages from the integrated OPC Browser that runs in the connected factory solution portal.</span></span>
* <span data-ttu-id="66943-107">*OPC yayımcı* var olan şirket içi OPC UA sunucularına bağlanır ve iletir telemetri iletilerini onlardan IOT Hub'ına.</span><span class="sxs-lookup"><span data-stu-id="66943-107">The *OPC Publisher* connects to existing on-premises OPC UA servers and forwards telemetry messages from them to IoT Hub.</span></span>

<span data-ttu-id="66943-108">Her iki bileşenler açık kaynaklı ve GitHub kaynağına ve Docker kapsayıcılar olarak kullanılabilir:</span><span class="sxs-lookup"><span data-stu-id="66943-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="66943-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="66943-109">GitHub</span></span> | <span data-ttu-id="66943-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="66943-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="66943-111">[OPC yayımcı][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="66943-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="66943-112">[OPC yayımcı][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="66943-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="66943-113">[OPC Proxy][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="66943-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="66943-114">[OPC Proxy][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="66943-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="66943-115">Genel kullanıma yönelik IP adresi veya ağ geçidi Güvenlik Duvarı'nda delik ya da bileşen için gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="66943-115">No public-facing IP address or holes in the gateway firewall are required for either component.</span></span> <span data-ttu-id="66943-116">OPC Proxy ve OPC yayımcı yalnızca giden bağlantı noktası 443, 5671 ve 8883 kullanın.</span><span class="sxs-lookup"><span data-stu-id="66943-116">The OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="66943-117">Bu makaledeki adımları Docker üzerinde kullanarak bir ağ geçidi dağıtma Göster [Windows](#windows-deployment) veya [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="66943-117">The steps in this article show you how to deploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="66943-118">Ağ geçidi bağlı Fabrika önceden yapılandırılmış çözüm bağlantısı sağlar.</span><span class="sxs-lookup"><span data-stu-id="66943-118">The gateway enables connectivity to the connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="66943-119">Docker kapsayıcısı içinde çalışan bir ağ geçidi yazılımdır [Azure IOT kenar].</span><span class="sxs-lookup"><span data-stu-id="66943-119">The gateway software that runs in the Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="66943-120">Windows Dağıtım</span><span class="sxs-lookup"><span data-stu-id="66943-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="66943-121">Bir ağ geçidi cihazı henüz yoksa, Microsoft ticari bir ağ geçidi ortaklarımızdan birinden satın önerir.</span><span class="sxs-lookup"><span data-stu-id="66943-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="66943-122">Ziyaret [Azure IOT cihaz katalog] ağ geçidi aygıtlarını bağlı Fabrika çözümüyle uyumlu bir listesi.</span><span class="sxs-lookup"><span data-stu-id="66943-122">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="66943-123">Ağ geçidi kurun aygıtla birlikte gelen yönergeleri izleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-123">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="66943-124">Alternatif olarak, var olan geçitlerinizin birinde el ile ayarlamak için aşağıdaki yönergeleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="66943-124">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="66943-125">Docker yükleyin</span><span class="sxs-lookup"><span data-stu-id="66943-125">Install Docker</span></span>

<span data-ttu-id="66943-126">Yükleme [Windows için Docker] , Windows tabanlı ağ geçidi Cihazınızda.</span><span class="sxs-lookup"><span data-stu-id="66943-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="66943-127">Windows Docker Kurulum sırasında Docker ile paylaşmak için konak makinesi üzerinde bir sürücü seçin.</span><span class="sxs-lookup"><span data-stu-id="66943-127">During Windows Docker setup, select a drive on your host machine to share with Docker.</span></span> <span data-ttu-id="66943-128">Aşağıdaki ekran görüntüsü, D sürücüsündeki Windows sisteminize paylaşımı gösterir:</span><span class="sxs-lookup"><span data-stu-id="66943-128">The following screenshot shows sharing the D drive on your Windows system:</span></span>

![Docker yükleyin][img-install-docker]

<span data-ttu-id="66943-130">Adlı bir klasör oluşturun **docker** paylaşılan sürücü kök.</span><span class="sxs-lookup"><span data-stu-id="66943-130">Then create a folder called **docker** in the root of the shared drive.</span></span>
<span data-ttu-id="66943-131">Docker gelen yükledikten sonra da bu adımı gerçekleştirebilirsiniz **ayarları** menüsü.</span><span class="sxs-lookup"><span data-stu-id="66943-131">You can also perform this step after installing docker from the **Settings** menu.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="66943-132">Ağ geçidini yapılandırma</span><span class="sxs-lookup"><span data-stu-id="66943-132">Configure the gateway</span></span>

1. <span data-ttu-id="66943-133">Gereksinim duyduğunuz **iothubowner** Azure IOT paketi bağlantı dizesi ağ geçidi dağıtımını tamamlamak için Fabrika dağıtım bağlı.</span><span class="sxs-lookup"><span data-stu-id="66943-133">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="66943-134">İçinde [Azure portal], IOT Hub'ınıza bağlı Fabrika çözümü dağıttığınızda oluşturduğunuz kaynak grubunda gidin.</span><span class="sxs-lookup"><span data-stu-id="66943-134">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="66943-135">Tıklatın **paylaşılan erişim ilkeleri** erişimi **iothubowner** bağlantı dizesi:</span><span class="sxs-lookup"><span data-stu-id="66943-135">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![IOT Hub bağlantı dizesini bulun][img-hub-connection]

    <span data-ttu-id="66943-137">Kopya **bağlantı dizesi--birincil anahtar** değeri.</span><span class="sxs-lookup"><span data-stu-id="66943-137">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="66943-138">İki ağ geçidi modülleri çalıştırarak ağ geçidi için IOT Hub'ınızı yapılandırma **sonra** ile bir komut isteminden:</span><span class="sxs-lookup"><span data-stu-id="66943-138">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="66943-139">**&lt;ApplicationName&gt;**  OPC UA yayımcınıza biçimde sağlamak için ad **yayımcı.&lt; tam etki alanı adınızı&gt;**.</span><span class="sxs-lookup"><span data-stu-id="66943-139">**&lt;ApplicationName&gt;** is the name to give to your OPC UA Publisher in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="66943-140">Örneğin, Fabrika ağ olarak adlandırılır, **myfactorynetwork.com**, **ApplicationName** değer **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="66943-140">For example, if your factory network is called **myfactorynetwork.com**, the **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="66943-141">**&lt;IoTHubOwnerConnectionString&gt;**  olan **iothubowner** önceki adımda kopyaladığınız bağlantı dizesi.</span><span class="sxs-lookup"><span data-stu-id="66943-141">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="66943-142">Bu bağlantı dizesini yalnızca bu adımda kullanılır, aşağıdaki adımlarda gerekmez:</span><span class="sxs-lookup"><span data-stu-id="66943-142">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="66943-143">Eşlenen D: kullandığınız\\docker klasörü ( `-v` bağımsız değişkeni) daha sonra ağ geçidi modülleri kullanan iki X.509 sertifikaları kalıcı hale getirmek için.</span><span class="sxs-lookup"><span data-stu-id="66943-143">You use the mapped D:\\docker folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="66943-144">Ağ geçidi çalıştırın</span><span class="sxs-lookup"><span data-stu-id="66943-144">Run the gateway</span></span>

1. <span data-ttu-id="66943-145">Aşağıdaki komutları kullanarak ağ geçidini yeniden başlatın:</span><span class="sxs-lookup"><span data-stu-id="66943-145">Restart the gateway using the following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="66943-146">Güvenlik nedenleriyle, iki X.509 sertifikalarını D: kalıcı\\docker klasör özel anahtarı içerir.</span><span class="sxs-lookup"><span data-stu-id="66943-146">For security reasons, the two X.509 certificates persisted in the D:\\docker folder contain the private key.</span></span> <span data-ttu-id="66943-147">Bu klasör kimlik bilgilerine erişimi sınırlayabilir (genellikle **Yöneticiler**) Docker kapsayıcısı çalıştırmak için kullanın.</span><span class="sxs-lookup"><span data-stu-id="66943-147">Limit access to this folder to the credentials (typically **Administrators**) you use to run the Docker container.</span></span> <span data-ttu-id="66943-148">D: sağ\\docker klasörü seçin **özellikleri**, ardından **güvenlik**ve ardından **Düzenle**.</span><span class="sxs-lookup"><span data-stu-id="66943-148">Right-click the D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="66943-149">Vermek **Yöneticiler** tam denetim ve diğerlerinin kaldırın:</span><span class="sxs-lookup"><span data-stu-id="66943-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Docker paylaşım izinleri][img-docker-share]

1. <span data-ttu-id="66943-151">Ağ bağlantısını doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="66943-151">Verify network connectivity.</span></span> <span data-ttu-id="66943-152">Bir komut isteminden aşağıdaki komutu girin `ping publisher.<your fully qualified domain name>` ağ geçidiniz ping işlemi yapmak için.</span><span class="sxs-lookup"><span data-stu-id="66943-152">From a command prompt, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="66943-153">Hedef ulaşılamaz durumda olduğunda, ağ geçidi, ağ geçidi ana bilgisayar dosyasının adını ve IP adresi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-153">If the destination is unreachable, add the IP address and name of your gateway to the hosts file on your gateway.</span></span> <span data-ttu-id="66943-154">Hosts dosyasını bulunan **Windows\\System32\\sürücüleri\\vb.** klasör.</span><span class="sxs-lookup"><span data-stu-id="66943-154">The hosts file is located in the **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="66943-155">Ardından, ağ geçidinde çalıştıran yerel bir OPC UA istemcisi kullanarak yayımcı bağlanmayı deneyin.</span><span class="sxs-lookup"><span data-stu-id="66943-155">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="66943-156">URL OPC UA uç nokta `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="66943-156">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="66943-157">OPC UA istemci yoksa kullanın indirin ve bir [açık kaynak OPC UA istemci].</span><span class="sxs-lookup"><span data-stu-id="66943-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="66943-158">Bu yerel testleri başarıyla tamamladıktan sonra Gözat **kendi OPC UA sunucusuna** bağlı Fabrika çözüm portalında sayfası.</span><span class="sxs-lookup"><span data-stu-id="66943-158">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="66943-159">Yayımcı uç noktasının URL'sini girin (`tcp://publisher.<your fully qualified domain name>:62222`) tıklatıp **Bağlan**.</span><span class="sxs-lookup"><span data-stu-id="66943-159">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="66943-160">Bir sertifika uyarısı almak, ardından tıklatın **devam et.**</span><span class="sxs-lookup"><span data-stu-id="66943-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="66943-161">Sonraki hata, aldığınız UA Web istemcisi yayımcısına güvendiğinizden değil.</span><span class="sxs-lookup"><span data-stu-id="66943-161">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="66943-162">Bu hatayı gidermek için kopyalama **UA Web istemcisi** gelen sertifika **D:\\docker\\reddetti sertifikaları\\sertifikaları** klasörüne **D: \\docker\\UA uygulamaları\\sertifikaları** ağ geçidinde klasör.</span><span class="sxs-lookup"><span data-stu-id="66943-162">To resolve this error, copy the **UA Web Client** certificate from the **D:\\docker\\Rejected Certificates\\certs** folder to the **D:\\docker\\UA Applications\\certs** folder on the gateway.</span></span> <span data-ttu-id="66943-163">Ağ geçidi için yeniden başlatmanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="66943-163">You do not need to restart of the gateway.</span></span> <span data-ttu-id="66943-164">Bu adımı yineleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-164">Repeat this step.</span></span> <span data-ttu-id="66943-165">Ağ geçidi buluttan şimdi bağlanabilir ve çözüme OPC UA sunucuları eklemek hazırsınız.</span><span class="sxs-lookup"><span data-stu-id="66943-165">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="66943-166">OPC UA sunucularınızı ekleme</span><span class="sxs-lookup"><span data-stu-id="66943-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="66943-167">Gözat **kendi OPC UA sunucusuna** bağlı Fabrika çözüm portalında sayfası.</span><span class="sxs-lookup"><span data-stu-id="66943-167">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="66943-168">Bağlı Fabrika portal OPC UA sunucusu arasında güven oluşturmak için önceki bölümde olduğu gibi aynı adımları izleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-168">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="66943-169">Bu adım bağlı Fabrika portal ve OPC UA sunucu sertifikaları karşılıklı güven oluşturur ve bir bağlantı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="66943-169">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="66943-170">OPC UA sunucunuzun OPC UA düğümleri ağaç gidin, OPC düğümleri sağ tıklatın ve seçin **yayımlama**.</span><span class="sxs-lookup"><span data-stu-id="66943-170">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="66943-171">Bu şekilde çalışmaya yayımlamak için OPC UA sunucusu ve yayımcı, aynı ağ üzerinde olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="66943-171">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="66943-172">Diğer bir deyişle, tam etki alanı adı, yayımcı ise **publisher.mydomain.com** OPC UA sunucunun tam etki alanı adını, örneğin, bu olmalıdır **myopcuaserver.mydomain.com**.</span><span class="sxs-lookup"><span data-stu-id="66943-172">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="66943-173">Kurulumunuzu farklıysa, el ile düğümleri bulunan publishesnodes.json dosya ekleyebileceğiniz **D:\\docker** klasör.</span><span class="sxs-lookup"><span data-stu-id="66943-173">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **D:\\docker** folder.</span></span> <span data-ttu-id="66943-174">Publishesnodes.json dosyanın ilk otomatik olarak oluşturulan başarılı bir OPC düğümünün yayımlayın.</span><span class="sxs-lookup"><span data-stu-id="66943-174">The publishesnodes.json file is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="66943-175">Telemetri şimdi ağ geçidi aygıttan akar.</span><span class="sxs-lookup"><span data-stu-id="66943-175">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="66943-176">Telemetriyi de görüntüleyebilirsiniz **Fabrika konumları** altında bağlı Fabrika portal görünümünü **yeni Fabrika**.</span><span class="sxs-lookup"><span data-stu-id="66943-176">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="66943-177">Linux dağıtımı</span><span class="sxs-lookup"><span data-stu-id="66943-177">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="66943-178">Bir ağ geçidi cihazı henüz yoksa, Microsoft ticari bir ağ geçidi ortaklarımızdan birinden satın önerir.</span><span class="sxs-lookup"><span data-stu-id="66943-178">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="66943-179">Ziyaret [Azure IOT cihaz katalog] ağ geçidi aygıtlarını bağlı Fabrika çözümüyle uyumlu bir listesi.</span><span class="sxs-lookup"><span data-stu-id="66943-179">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="66943-180">Ağ geçidi kurun aygıtla birlikte gelen yönergeleri izleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-180">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="66943-181">Alternatif olarak, var olan geçitlerinizin birinde el ile ayarlamak için aşağıdaki yönergeleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="66943-181">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

<span data-ttu-id="66943-182">[Docker yükleme] Linux ağ geçidi cihazınız üzerinde.</span><span class="sxs-lookup"><span data-stu-id="66943-182">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="66943-183">Ağ geçidini yapılandırma</span><span class="sxs-lookup"><span data-stu-id="66943-183">Configure the gateway</span></span>

1. <span data-ttu-id="66943-184">Gereksinim duyduğunuz **iothubowner** Azure IOT paketi bağlantı dizesi ağ geçidi dağıtımını tamamlamak için Fabrika dağıtım bağlı.</span><span class="sxs-lookup"><span data-stu-id="66943-184">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="66943-185">İçinde [Azure portal], IOT Hub'ınıza bağlı Fabrika çözümü dağıttığınızda oluşturduğunuz kaynak grubunda gidin.</span><span class="sxs-lookup"><span data-stu-id="66943-185">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="66943-186">Tıklatın **paylaşılan erişim ilkeleri** erişimi **iothubowner** bağlantı dizesi:</span><span class="sxs-lookup"><span data-stu-id="66943-186">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![IOT Hub bağlantı dizesini bulun][img-hub-connection]

    <span data-ttu-id="66943-188">Kopya **bağlantı dizesi--birincil anahtar** değeri.</span><span class="sxs-lookup"><span data-stu-id="66943-188">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="66943-189">İki ağ geçidi modülleri çalıştırarak ağ geçidi için IOT Hub'ınızı yapılandırma **sonra** ile Kabuğu'ndan:</span><span class="sxs-lookup"><span data-stu-id="66943-189">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="66943-190">**&lt;ApplicationName&gt;**  ağ geçidi oluşturur biçiminde OPC UA uygulama adı **yayımcı.&lt; tam etki alanı adınızı&gt;**.</span><span class="sxs-lookup"><span data-stu-id="66943-190">**&lt;ApplicationName&gt;** is the name of the OPC UA application the gateway creates in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="66943-191">Örneğin, **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="66943-191">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="66943-192">**&lt;IoTHubOwnerConnectionString&gt;**  olan **iothubowner** önceki adımda kopyaladığınız bağlantı dizesi.</span><span class="sxs-lookup"><span data-stu-id="66943-192">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="66943-193">Bu bağlantı dizesini yalnızca bu adımda kullanılır, aşağıdaki adımlarda gerekmez:</span><span class="sxs-lookup"><span data-stu-id="66943-193">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="66943-194">Kullandığınız **/ paylaşılan** klasörü ( `-v` bağımsız değişkeni) daha sonra ağ geçidi modülleri kullanan iki X.509 sertifikaları kalıcı hale getirmek için.</span><span class="sxs-lookup"><span data-stu-id="66943-194">You use the **/shared** folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="66943-195">Ağ geçidi çalıştırın</span><span class="sxs-lookup"><span data-stu-id="66943-195">Run the gateway</span></span>

1. <span data-ttu-id="66943-196">Aşağıdaki komutları kullanarak ağ geçidini yeniden başlatın:</span><span class="sxs-lookup"><span data-stu-id="66943-196">Restart the gateway using the following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="66943-197">Güvenlik nedenleriyle, kalıcı hale iki X.509 sertifikalarını **/ paylaşılan** klasör özel anahtarı içerir.</span><span class="sxs-lookup"><span data-stu-id="66943-197">For security reasons, the two X.509 certificates persisted in the **/shared** folder contain the private key.</span></span> <span data-ttu-id="66943-198">Bu klasör, Docker kapsayıcısı çalıştırmak için kullandığınız kimlik bilgilerine erişimi sınırlayın.</span><span class="sxs-lookup"><span data-stu-id="66943-198">Limit access to this folder to the credentials you use to run the Docker container.</span></span> <span data-ttu-id="66943-199">İzinlerini ayarlamak için **kök** yalnızca kullanın `chmod` kabuk klasörü komutu.</span><span class="sxs-lookup"><span data-stu-id="66943-199">To set the permissions for **root** only, use the `chmod` shell command on the folder.</span></span>

1. <span data-ttu-id="66943-200">Ağ bağlantısını doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="66943-200">Verify network connectivity.</span></span> <span data-ttu-id="66943-201">Komutu bir kabuğundan girin `ping publisher.<your fully qualified domain name>` ağ geçidiniz ping işlemi yapmak için.</span><span class="sxs-lookup"><span data-stu-id="66943-201">From a shell, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="66943-202">Hedef ulaşılamaz durumda olduğunda, ağ geçidi, ağ geçidinde hosts dosyasına adını ve IP adresi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-202">If the destination is unreachable, add the IP address and name of your gateway to your hosts file on your gateway.</span></span> <span data-ttu-id="66943-203">Hosts dosyasını bulunan **/vb.** klasör.</span><span class="sxs-lookup"><span data-stu-id="66943-203">The hosts file is located in the **/etc** folder.</span></span>

1. <span data-ttu-id="66943-204">Ardından, ağ geçidinde çalıştıran yerel bir OPC UA istemcisi kullanarak yayımcı bağlanmayı deneyin.</span><span class="sxs-lookup"><span data-stu-id="66943-204">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="66943-205">URL OPC UA uç nokta `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="66943-205">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="66943-206">OPC UA istemci yoksa kullanın indirin ve bir [açık kaynak OPC UA istemci].</span><span class="sxs-lookup"><span data-stu-id="66943-206">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="66943-207">Bu yerel testleri başarıyla tamamladıktan sonra Gözat **kendi OPC UA sunucusuna** bağlı Fabrika çözüm portalında sayfası.</span><span class="sxs-lookup"><span data-stu-id="66943-207">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="66943-208">Yayımcı uç noktasının URL'sini girin (`tcp://publisher.<your fully qualified domain name>:62222`) tıklatıp **Bağlan**.</span><span class="sxs-lookup"><span data-stu-id="66943-208">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="66943-209">Bir sertifika uyarısı almak, ardından tıklatın **devam et.**</span><span class="sxs-lookup"><span data-stu-id="66943-209">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="66943-210">Sonraki hata, aldığınız UA Web istemcisi yayımcısına güvendiğinizden değil.</span><span class="sxs-lookup"><span data-stu-id="66943-210">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="66943-211">Bu hatayı gidermek için kopyalama **UA Web istemcisi** gelen sertifika **/paylaşılan/reddedildi sertifikaları/sertifikaları** klasörüne **/shared/UA uygulamalar/sertifikaları** klasörü ağ geçidi.</span><span class="sxs-lookup"><span data-stu-id="66943-211">To resolve this error, copy the **UA Web Client** certificate from the **/shared/Rejected Certificates/certs** folder to the **/shared/UA Applications/certs** folder on the gateway.</span></span> <span data-ttu-id="66943-212">Ağ geçidi için yeniden başlatmanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="66943-212">You do not need to restart of the gateway.</span></span> <span data-ttu-id="66943-213">Bu adımı yineleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-213">Repeat this step.</span></span> <span data-ttu-id="66943-214">Ağ geçidi buluttan şimdi bağlanabilir ve çözüme OPC UA sunucuları eklemek hazırsınız.</span><span class="sxs-lookup"><span data-stu-id="66943-214">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="66943-215">OPC UA sunucularınızı ekleme</span><span class="sxs-lookup"><span data-stu-id="66943-215">Add your OPC UA servers</span></span>

1. <span data-ttu-id="66943-216">Gözat **kendi OPC UA sunucusuna** bağlı Fabrika çözüm portalında sayfası.</span><span class="sxs-lookup"><span data-stu-id="66943-216">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="66943-217">Bağlı Fabrika portal OPC UA sunucusu arasında güven oluşturmak için önceki bölümde olduğu gibi aynı adımları izleyin.</span><span class="sxs-lookup"><span data-stu-id="66943-217">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="66943-218">Bu adım bağlı Fabrika portal ve OPC UA sunucu sertifikaları karşılıklı güven oluşturur ve bir bağlantı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="66943-218">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="66943-219">OPC UA sunucunuzun OPC UA düğümleri ağaç gidin, OPC düğümleri sağ tıklatın ve seçin **yayımlama**.</span><span class="sxs-lookup"><span data-stu-id="66943-219">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="66943-220">Bu şekilde çalışmaya yayımlamak için OPC UA sunucusu ve yayımcı, aynı ağ üzerinde olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="66943-220">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="66943-221">Diğer bir deyişle, tam etki alanı adı, yayımcı ise **publisher.mydomain.com** OPC UA sunucunun tam etki alanı adını, örneğin, bu olmalıdır **myopcuaserver.mydomain.com**.</span><span class="sxs-lookup"><span data-stu-id="66943-221">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="66943-222">Kurulumunuzu farklıysa, el ile düğümleri bulunan publishesnodes.json dosya ekleyebileceğiniz **/ paylaşılan** klasör.</span><span class="sxs-lookup"><span data-stu-id="66943-222">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **/shared** folder.</span></span> <span data-ttu-id="66943-223">Publishesnodes.json ilk otomatik olarak oluşturulan başarılı bir OPC düğümünün yayımlayın.</span><span class="sxs-lookup"><span data-stu-id="66943-223">The publishesnodes.json is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="66943-224">Telemetri şimdi ağ geçidi aygıttan akar.</span><span class="sxs-lookup"><span data-stu-id="66943-224">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="66943-225">Telemetriyi de görüntüleyebilirsiniz **Fabrika konumları** altında bağlı Fabrika portal görünümünü **yeni Fabrika**.</span><span class="sxs-lookup"><span data-stu-id="66943-225">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="66943-226">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="66943-226">Next steps</span></span>

<span data-ttu-id="66943-227">Bağlı Fabrika önceden yapılandırılmış çözüm mimarisi hakkında daha fazla bilgi için bkz: [bağlı Fabrika önceden yapılandırılmış çözüm izlenecek][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="66943-227">To learn more about the architecture of the connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

<span data-ttu-id="66943-228">[Windows için Docker]: https://www.docker.com/docker-windows</span><span class="sxs-lookup"><span data-stu-id="66943-228">[Docker for Windows]: https://www.docker.com/docker-windows</span></span>
<span data-ttu-id="66943-229">[Azure IOT cihaz katalog]: https://catalog.azureiotsuite.com/?q=opc</span><span class="sxs-lookup"><span data-stu-id="66943-229">[Azure IoT device catalog]: https://catalog.azureiotsuite.com/?q=opc</span></span>
<span data-ttu-id="66943-230">[Azure portal]: http://portal.azure.com/</span><span class="sxs-lookup"><span data-stu-id="66943-230">[Azure portal]: http://portal.azure.com/</span></span>
<span data-ttu-id="66943-231">[açık kaynak OPC UA istemci]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span><span class="sxs-lookup"><span data-stu-id="66943-231">[open-source OPC UA client]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span></span>
<span data-ttu-id="66943-232">[Docker yükleme]: https://www.docker.com/community-edition#/download</span><span class="sxs-lookup"><span data-stu-id="66943-232">[Install Docker]: https://www.docker.com/community-edition#/download</span></span>
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
<span data-ttu-id="66943-233">[Azure IOT kenar]: https://github.com/Azure/iot-edge</span><span class="sxs-lookup"><span data-stu-id="66943-233">[Azure IoT Edge]: https://github.com/Azure/iot-edge</span></span>

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy