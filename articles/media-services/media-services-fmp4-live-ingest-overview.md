---
title: "Azure Media Services parçalanmış MP4 Canlı alma belirtimi | Microsoft Docs"
description: "Bu belirtimi protokolü ve parçalanmış MP4 tabanlı canlı akış alımı için Azure Media Services biçimini açıklar. Azure Media Services, canlı olay akışını ve bulut platformu olarak Azure kullanarak gerçek zamanlı içeriği yayını için kullanabilirsiniz. Bu belge, ayrıca en iyi anlatılmaktadır Canlı yüksek oranda yedekli ve sağlam oluşturmaya yönelik yöntemler mekanizmaları alma."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 6250b73504bec765b8299060a29e84e771791cc9
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/29/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="7ef64-105">Azure Media Services parçalanmış MP4 Canlı belirtimi alma</span><span class="sxs-lookup"><span data-stu-id="7ef64-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="7ef64-106">Bu belirtimi protokolü ve parçalanmış MP4 tabanlı canlı akış alımı için Azure Media Services biçimini açıklar.</span><span class="sxs-lookup"><span data-stu-id="7ef64-106">This specification describes the protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="7ef64-107">Media Services müşteriler canlı olay akışını ve bulut platformu olarak Azure kullanarak gerçek zamanlı içeriği yayını için kullanabileceğiniz bir canlı akış hizmeti sağlar.</span><span class="sxs-lookup"><span data-stu-id="7ef64-107">Media Services provides a live streaming service that customers can use to stream live events and broadcast content in real time by using Azure as the cloud platform.</span></span> <span data-ttu-id="7ef64-108">Bu belge, ayrıca en iyi anlatılmaktadır Canlı yüksek oranda yedekli ve sağlam oluşturmaya yönelik yöntemler mekanizmaları alma.</span><span class="sxs-lookup"><span data-stu-id="7ef64-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="7ef64-109">1. Uygunluk gösterimi</span><span class="sxs-lookup"><span data-stu-id="7ef64-109">1. Conformance notation</span></span>
<span data-ttu-id="7ef64-110">Anahtar sözcükler ","Değil gerekir,"gerekir" "Gerekli", "SHALL," "GELECEKTİR değil," "SHOULD," "Olmamalıdır," "Önerilen", "Olabilir," ve "İsteğe bağlı" Bu belgeyi olduğu RFC 2119 açıklanan yorumlanacağını.</span><span class="sxs-lookup"><span data-stu-id="7ef64-110">The key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are to be interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="7ef64-111">2. Hizmet diyagramı</span><span class="sxs-lookup"><span data-stu-id="7ef64-111">2. Service diagram</span></span>
<span data-ttu-id="7ef64-112">Aşağıdaki diyagramda, Media Services ile canlı akış hizmeti üst düzey mimarisi gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="7ef64-112">The following diagram shows the high-level architecture of the live streaming service in Media Services:</span></span>

1. <span data-ttu-id="7ef64-113">Gerçek zamanlı Kodlayıcı Canlı akışlar oluşturulan ve sağlanan kanallar Azure Media Services SDK'sı iter.</span><span class="sxs-lookup"><span data-stu-id="7ef64-113">A live encoder pushes live feeds to channels that are created and provisioned via the Azure Media Services SDK.</span></span>
2. <span data-ttu-id="7ef64-114">Kanallar, programları ve Media Services akış uç noktalarını alma biçimlendirme dahil olmak üzere tüm canlı akış işlevlerini, işleme, DVR, güvenlik, ölçeklenebilirlik ve artıklık bulut.</span><span class="sxs-lookup"><span data-stu-id="7ef64-114">Channels, programs, and streaming endpoints in Media Services handle all the live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="7ef64-115">İsteğe bağlı olarak, müşteriler, Azure içerik teslim ağı katman akış uç noktası ve istemci uç noktaları arasında dağıtmayı seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-115">Optionally, customers can choose to deploy an Azure Content Delivery Network layer between the streaming endpoint and the client endpoints.</span></span>
4. <span data-ttu-id="7ef64-116">HTTP Uyarlamalı akış protokolleri kullanarak akış uç noktasından istemci uç noktaları akış.</span><span class="sxs-lookup"><span data-stu-id="7ef64-116">Client endpoints stream from the streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="7ef64-117">Microsoft kesintisiz akış, dinamik Uyarlamalı akış HTTP (tire veya MPEG-DASH) ve Apple HTTP canlı akışı (HLS) üzerinden örnekler.</span><span class="sxs-lookup"><span data-stu-id="7ef64-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![Akış alma][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="7ef64-119">3. Bitstream biçimi – ISO 14496-12 parçalanmış MP4</span><span class="sxs-lookup"><span data-stu-id="7ef64-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="7ef64-120">Canlı akış alma için gönderim biçimi de ele alınan bu belgeyi [ISO-14496-12] dayanır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-120">The wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="7ef64-121">Ayrıntılı açıklaması parçalanmış MP4 biçimindeki ve hem uzantıları için isteğe bağlı video dosyaları ve canlı akış alımı için bkz: [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ef64-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="7ef64-122">Canlı biçim tanımlarını alma</span><span class="sxs-lookup"><span data-stu-id="7ef64-122">Live ingest format definitions</span></span>
<span data-ttu-id="7ef64-123">Aşağıdaki listede, Azure Media Services'e Canlı uygulamak tanımları alma özel biçim açıklanmaktadır:</span><span class="sxs-lookup"><span data-stu-id="7ef64-123">The following list describes special format definitions that apply to live ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="7ef64-124">**Ftyp**, **Canlı sunucusu bildirim kutusu**, ve **moov** her istek (HTTP POST) ile kutuları gönderilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-124">The **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="7ef64-125">Bu kutuları akış başında gönderilmelidir ve alma dilediğiniz zaman Kodlayıcı akışı sürdürmeyi yeniden bağlanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-125">These boxes MUST be sent at the beginning of the stream and any time the encoder must reconnect to resume stream ingest.</span></span> <span data-ttu-id="7ef64-126">Daha fazla bilgi için bkz: Bölüm 6 [1].</span><span class="sxs-lookup"><span data-stu-id="7ef64-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="7ef64-127">[1] 3.3.2 bölümünde tanımlar adlı isteğe bağlı bir kutu **StreamManifestBox** için Canlı alma.</span><span class="sxs-lookup"><span data-stu-id="7ef64-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="7ef64-128">Azure yük dengeleyici yönlendirme mantığından dolayı bu kutusunu kullanarak kullanım dışıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-128">Due to the routing logic of the Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="7ef64-129">Kutunun olmamalıdır Media Services'e alındıktan olduğunda mevcut.</span><span class="sxs-lookup"><span data-stu-id="7ef64-129">The box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="7ef64-130">Bu kutu mevcut değilse, Media Services sessizce onu yok sayar.</span><span class="sxs-lookup"><span data-stu-id="7ef64-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="7ef64-131">**TrackFragmentExtendedHeaderBox** 3.2.3.2 [1] içinde tanımlı kutusunu her parçası için mevcut olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-131">The **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="7ef64-132">Sürüm 2 **TrackFragmentExtendedHeaderBox** kutusunu, aynı URL'lere sahip birden çok veri merkezlerinde ortam kesimleri oluşturmak için kullanılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-132">Version 2 of the **TrackFragmentExtendedHeaderBox** box SHOULD be used to generate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="7ef64-133">Parça dizini dizin tabanlı akış biçimlerine Apple HLS gibi çapraz veri merkezi yük devretme için gerekli ve dizin tabanlı MPEG-DASH alanıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-133">The fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="7ef64-134">Çapraz veri merkezi yük devretme etkinleştirmek için parça dizin arasında birden çok kodlayıcılar eşitlenen gerekir ve her art arda medya parçası için 1 tarafından bile Kodlayıcı yeniden başlatmalar veya hatalar arasında artırılması.</span><span class="sxs-lookup"><span data-stu-id="7ef64-134">To enable cross-datacenter failover, the fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="7ef64-135">[1] 3.3.6 bölümünde tanımlar adlı bir kutusu **MovieFragmentRandomAccessBox** (**mfra**), gönderilebilir Canlı alım sonunda kanala akış uç (EOS) belirtmek için.</span><span class="sxs-lookup"><span data-stu-id="7ef64-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at the end of live ingestion to indicate end-of-stream (EOS) to the channel.</span></span> <span data-ttu-id="7ef64-136">Media Services alma mantığından dolayı EOS kullanarak kullanım dışı bırakılmıştır ve **mfra** Canlı alım gönderilmez için kutusu.</span><span class="sxs-lookup"><span data-stu-id="7ef64-136">Due to the ingest logic of Media Services, using EOS is deprecated, and the **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="7ef64-137">Gönderilen, Media Services sessizce onu yok sayar.</span><span class="sxs-lookup"><span data-stu-id="7ef64-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="7ef64-138">Alma noktası durumunu sıfırlamak için kullanmanız önerilir [kanal sıfırlama](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="7ef64-138">To reset the state of the ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="7ef64-139">Ayrıca, kullanmanızı öneririz [programı durdurun](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) sunu ve akış sona erdirmek için.</span><span class="sxs-lookup"><span data-stu-id="7ef64-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) to end a presentation and stream.</span></span>
6. <span data-ttu-id="7ef64-140">MP4 parça süresi istemci bildirimleri boyutunu azaltmak için sabit olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-140">The MP4 fragment duration SHOULD be constant, to reduce the size of the client manifests.</span></span> <span data-ttu-id="7ef64-141">İstemci Yükleme buluşsal yöntemler kullanılarak parça süresi de geliştirir sabit bir MP4 etiketleri yineleyin.</span><span class="sxs-lookup"><span data-stu-id="7ef64-141">A constant MP4 fragment duration also improves client download heuristics through the use of repeat tags.</span></span> <span data-ttu-id="7ef64-142">Süre için tamsayı olmayan çerçeve hızlarını dengelemek için dalgalanma.</span><span class="sxs-lookup"><span data-stu-id="7ef64-142">The duration MAY fluctuate to compensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="7ef64-143">MP4 parça süresi yaklaşık 2-6 saniye arasında olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-143">The MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="7ef64-144">MP4 parçalara zaman damgaları ve dizinleri (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` ve `fragment_index`) artan düzende ulaşması.</span><span class="sxs-lookup"><span data-stu-id="7ef64-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="7ef64-145">Media Services yinelenen parçaları esnek olsa da, parçaları medya zaman çizelgesi göre yeniden sıralamak için yeteneği sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-145">Although Media Services is resilient to duplicate fragments, it has limited ability to reorder fragments according to the media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="7ef64-146">4. Protokol biçimi – HTTP</span><span class="sxs-lookup"><span data-stu-id="7ef64-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="7ef64-147">ISO parçalanmış MP4 tabanlı Canlı Media Services hizmetine parçalanmış MP4 biçimindeki paketlenmiş kodlanmış medya verilerini iletmek için bir standart uzun süre çalışan HTTP POST isteği kullanan alma.</span><span class="sxs-lookup"><span data-stu-id="7ef64-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request to transmit encoded media data that is packaged in fragmented MP4 format to the service.</span></span> <span data-ttu-id="7ef64-148">Her HTTP POST tamamı parçalanmış MP4 bitstream ("akış"), üstbilgi kutuları ile en başından başlayarak gönderir (**ftyp**, **Canlı sunucusu bildirim kutusu**, ve **moov** kutuları ) ve parçaları bir dizi devam (**moof** ve **mdat** kutuları).</span><span class="sxs-lookup"><span data-stu-id="7ef64-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from the beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="7ef64-149">HTTP POST isteği için URL sözdizimi için 9.2 in [1] bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-149">For URL syntax for the HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="7ef64-150">Gönderme URL'sini örneğidir:</span><span class="sxs-lookup"><span data-stu-id="7ef64-150">An example of the POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="7ef64-151">Gereksinimler</span><span class="sxs-lookup"><span data-stu-id="7ef64-151">Requirements</span></span>
<span data-ttu-id="7ef64-152">Ayrıntılı gereksinimler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="7ef64-152">Here are the detailed requirements:</span></span>

1. <span data-ttu-id="7ef64-153">Kodlayıcı yayın aynı alım URL'yi kullanarak bir boş "body" (içerik uzunluğu sıfır) ile bir HTTP POST isteği göndererek başlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-153">The encoder SHOULD start the broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using the same ingestion URL.</span></span> <span data-ttu-id="7ef64-154">Bu, hızlı bir şekilde tespit Canlı alım uç noktanın geçerli olup olmadığını ve herhangi bir kimlik doğrulaması ya da gereken diğer koşulları varsa Kodlayıcı yardımcı olabilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-154">This can help the encoder quickly detect whether the live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="7ef64-155">HTTP protokolü sunucu POST gövde dahil olmak üzere tüm istek alınana kadar bir HTTP yanıtının geri gönderemez.</span><span class="sxs-lookup"><span data-stu-id="7ef64-155">Per HTTP protocol, the server can't send back an HTTP response until the entire request, including the POST body, is received.</span></span> <span data-ttu-id="7ef64-156">Bu adım olmadan canlı bir olay uzun süre çalışan yapısını verilen Kodlayıcı tüm verileri gönderme sonlanana kadar tüm hata algılayabilir olmayabilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-156">Given the long-running nature of a live event, without this step, the encoder might not be able to detect any error until it finishes sending all the data.</span></span>
2. <span data-ttu-id="7ef64-157">Kodlayıcı herhangi bir hata veya kimlik doğrulama sınaması (1) nedeniyle işlemesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-157">The encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="7ef64-158">Varsa (1) başarılı bir 200 yanıt ile devam edin.</span><span class="sxs-lookup"><span data-stu-id="7ef64-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="7ef64-159">Kodlayıcı yeni bir HTTP POST isteği parçalanmış MP4 akışı ile başlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-159">The encoder MUST start a new HTTP POST request with the fragmented MP4 stream.</span></span> <span data-ttu-id="7ef64-160">Yükü parçaları tarafından izlenen üstbilgi kutuları ile başlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-160">The payload MUST start with the header boxes, followed by fragments.</span></span> <span data-ttu-id="7ef64-161">Unutmayın **ftyp**, **Canlı sunucusu bildirim kutusu**, ve **moov** (bu sırayla) kutuları gönderileceği her bir istekle Kodlayıcı, çünkü yeniden bağlanmanız gerekir olsa bile önceki İstek akışın sonuna önce sonlandırıldı.</span><span class="sxs-lookup"><span data-stu-id="7ef64-161">Note that the **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if the encoder must reconnect because the previous request was terminated prior to the end of the stream.</span></span> 
4. <span data-ttu-id="7ef64-162">Kodlayıcı öbekli aktarım yüklemek için canlı olay tüm içerik uzunluğu tahmin etmek mümkün olduğundan kodlaması kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-162">The encoder MUST use chunked transfer encoding for uploading, because it’s impossible to predict the entire content length of the live event.</span></span>
5. <span data-ttu-id="7ef64-163">Olay üzerinden, son parça gönderdikten sonra olduğunda Kodlayıcı düzgün biçimde öbekli aktarım (çoğu HTTP istemci yığınları, otomatik olarak işlemek) ileti sırası kodlaması bitmelidir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-163">When the event is over, after sending the last fragment, the encoder MUST gracefully end the chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="7ef64-164">Kodlayıcı hizmetinin son yanıt kodu dönmek için bekleyin ve ardından bağlantıyı sonlandırmasına.</span><span class="sxs-lookup"><span data-stu-id="7ef64-164">The encoder MUST wait for the service to return the final response code, and then terminate the connection.</span></span> 
6. <span data-ttu-id="7ef64-165">Kodlayıcı kullanmamasını gerekir `Events()` 9.2 in [1] Media Services içine Canlı alımı için açıklanan isim.</span><span class="sxs-lookup"><span data-stu-id="7ef64-165">The encoder MUST NOT use the `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="7ef64-166">HTTP POST isteği sonlandırır veya TCP hata akışın sonuna önce zaman aşımına uğradı, kodlayıcı gereken yeni bir bağlantı kullanarak yeni bir POST isteği gönderin ve yukarıdaki gereksinimleri izleyin.</span><span class="sxs-lookup"><span data-stu-id="7ef64-166">If the HTTP POST request terminates or times out with a TCP error prior to the end of the stream, the encoder MUST issue a new POST request by using a new connection, and follow the preceding requirements.</span></span> <span data-ttu-id="7ef64-167">Ayrıca, kodlayıcı gerekir akıştaki her izlemek için önceki iki MP4 parçasının yeniden ve medya zaman çizelgesinde süreksizlik oluşturmaksızın Sürdür.</span><span class="sxs-lookup"><span data-stu-id="7ef64-167">Additionally, the encoder MUST resend the previous two MP4 fragments for each track in the stream, and resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="7ef64-168">Son iki MP4 parçaları her izlemek için yeniden göndermeyi veri kaybı olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="7ef64-168">Resending the last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="7ef64-169">Diğer bir deyişle, ses ve video izleme bir akış içerir ve geçerli POST isteği başarısız olursa, kodlayıcı gerekir yeniden ve ses izlemek için daha önce başarıyla gönderildi, son iki parça ve video için son iki parçalarını yeniden gönderin , hangi daha önce başarıyla, veri kaybı olduğundan emin olmak için gönderilen izler.</span><span class="sxs-lookup"><span data-stu-id="7ef64-169">In other words, if a stream contains both an audio and a video track, and the current POST request fails, the encoder must reconnect and resend the last two fragments for the audio track, which were previously successfully sent, and the last two fragments for the video track, which were previously successfully sent, to ensure that there is no data loss.</span></span> <span data-ttu-id="7ef64-170">Kodlayıcı bağlandığında, onu yeniden gönderir medya parçasının "İleri" bir arabellek bulundurmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-170">The encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="7ef64-171">5. Zaman Çizelgesi</span><span class="sxs-lookup"><span data-stu-id="7ef64-171">5. Timescale</span></span>
<span data-ttu-id="7ef64-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) ilişkin zaman ölçeğini kullanımını açıklar **SmoothStreamingMedia** (Bölüm 2.2.2.1) **StreamElement** (Bölüm 2.2.2.3) **StreamFragmentElement**(2.2.2.6 bölüm) ve **LiveSMIL** (Bölüm 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="7ef64-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes the usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="7ef64-173">Ölçeği değer yoksa, kullanılan varsayılan değeri 10,000,000 (10 MHz) kullanılır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-173">If the timescale value is not present, the default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="7ef64-174">Kesintisiz akış biçim belirtimi diğer ölçeği değerleri kullanımını engellemez rağmen çoğu Kodlayıcı uygulamaları bu varsayılan kullanmak değeri (MHz 10 kesintisiz akış oluşturmak için) veri alın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-174">Although the Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) to generate Smooth Streaming ingest data.</span></span> <span data-ttu-id="7ef64-175">Nedeniyle [Azure medya dinamik paketleme](media-services-dynamic-packaging-overview.md) özelliği, öneririz, 90 KHz ölçeği video akışları ve 44,1 KHz veya 48.1 KHz ses akışları için kullanmanızı.</span><span class="sxs-lookup"><span data-stu-id="7ef64-175">Due to the [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="7ef64-176">Farklı bir zaman ölçeğine göre değerleri için farklı akışları kullandıysanız, akış düzeyi ölçeği gönderilmelidir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-176">If different timescale values are used for different streams, the stream-level timescale MUST be sent.</span></span> <span data-ttu-id="7ef64-177">Daha fazla bilgi için bkz: [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ef64-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="7ef64-178">6. "Akış" tanımı</span><span class="sxs-lookup"><span data-stu-id="7ef64-178">6. Definition of “stream”</span></span>
<span data-ttu-id="7ef64-179">Akış işleme akış yük devretme ve artıklık senaryoları temel Canlı sunuları oluşturma için Canlı alım işlemde birimidir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-179">Stream is the basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="7ef64-180">Akış, tek bir parça içerebilecek bir benzersiz, parçalanmış MP4 bitstream veya birden çok parçaları tanımlanır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="7ef64-181">Tam canlı sunu gerçek zamanlı kodlayıcılar yapılandırmasına bağlı olarak bir veya daha fazla akışlar içerebilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-181">A full live presentation might contain one or more streams, depending on the configuration of the live encoders.</span></span> <span data-ttu-id="7ef64-182">Aşağıdaki örneklerde tam canlı sunu oluşturmak için akışlar kullanmanın çeşitli seçenekler gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-182">The following examples illustrate various options of using streams to compose a full live presentation.</span></span>

<span data-ttu-id="7ef64-183">**Örnek:**</span><span class="sxs-lookup"><span data-stu-id="7ef64-183">**Example:**</span></span> 

<span data-ttu-id="7ef64-184">Bir müşteri aşağıdaki ses/video bit içeren bir canlı akış sunumu oluşturmak ister:</span><span class="sxs-lookup"><span data-stu-id="7ef64-184">A customer wants to create a live streaming presentation that includes the following audio/video bitrates:</span></span>

<span data-ttu-id="7ef64-185">Video – 3000 KB/sn, 1500 KB/sn, 750 KB/sn</span><span class="sxs-lookup"><span data-stu-id="7ef64-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="7ef64-186">Ses – 128 Kb/sn</span><span class="sxs-lookup"><span data-stu-id="7ef64-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="7ef64-187">Seçenek 1: Tüm parçaları bir akış</span><span class="sxs-lookup"><span data-stu-id="7ef64-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="7ef64-188">Bu seçenek, tek bir kodlayıcı tüm ses/video parçalar oluşturur ve bunları bir parçalanmış MP4 bitstream sunmaktadır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="7ef64-189">Parçalanmış MP4 bitstream tek bir HTTP POST bağlantısı üzerinden gönderilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-189">The fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="7ef64-190">Bu örnekte, bu canlı sunu için yalnızca bir akış yoktur.</span><span class="sxs-lookup"><span data-stu-id="7ef64-190">In this example, there is only one stream for this live presentation.</span></span>

![Akışlar bir izleme][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="7ef64-192">Seçenek 2: Ayrı akıştaki her izleme</span><span class="sxs-lookup"><span data-stu-id="7ef64-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="7ef64-193">Bu seçenek Kodlayıcı bir izleme her parça MP4 bitstream yerleştirir ve tüm akışlar ayrı HTTP bağlantıları üzerinden gönderir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-193">In this option, the encoder puts one track into each fragment MP4 bitstream, and then posts all of the streams over separate HTTP connections.</span></span> <span data-ttu-id="7ef64-194">Bu, birden çok kodlayıcılar veya bir kodlayıcı ile yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="7ef64-195">Canlı alım bu canlı sunu dört akışları olarak görür.</span><span class="sxs-lookup"><span data-stu-id="7ef64-195">The live ingestion sees this live presentation as composed of four streams.</span></span>

![Akışlar ayrı izler][image3]

### <a name="option-3-bundle-audio-track-with-the-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="7ef64-197">Seçenek 3: Paket ses izleme bir akışa düşük bit hızlı video İzle</span><span class="sxs-lookup"><span data-stu-id="7ef64-197">Option 3: Bundle audio track with the lowest bitrate video track into one stream</span></span>
<span data-ttu-id="7ef64-198">Bu seçenek, bir parça MP4 bitstream düşük bit hızlı video kanalı ile ses izleme paketini ve diğer iki video parçaları olarak ayrı akışları bırakmak müşteri seçer.</span><span class="sxs-lookup"><span data-stu-id="7ef64-198">In this option, the customer chooses to bundle the audio track with the lowest-bitrate video track in one fragment MP4 bitstream, and leave the other two video tracks as separate streams.</span></span> 

![Akışlar ses ve video izler][image4]

### <a name="summary"></a><span data-ttu-id="7ef64-200">Özet</span><span class="sxs-lookup"><span data-stu-id="7ef64-200">Summary</span></span>
<span data-ttu-id="7ef64-201">Bu örneğin tüm olası alım seçenekleri kapsamlı bir listesi değil.</span><span class="sxs-lookup"><span data-stu-id="7ef64-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="7ef64-202">Gibi bir matter, hatta herhangi bir gruplama akışları içine parçalarının Canlı alım tarafından desteklenir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="7ef64-203">Müşteriler ve Kodlayıcı satıcılar mühendislik karmaşıklık, kodlayıcı kapasite ve artıklık ve yük devretme konuları göre kendi uygulamaları seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="7ef64-204">Ancak, çoğu durumda, tüm canlı sunu için yalnızca bir ses izleme yoktur.</span><span class="sxs-lookup"><span data-stu-id="7ef64-204">However, in most cases, there is only one audio track for the entire live presentation.</span></span> <span data-ttu-id="7ef64-205">Bu nedenle, ses parçası içeren alma akış healthiness emin olmak önemlidir. Bu faktör genellikle kendi akış (seçenek 2) olduğu gibi ses izleme almadan veya en düşük bit hızlı video İzle (olduğu gibi seçeneği 3) ile paketleme sonuçlanır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-205">So, it’s important to ensure the healthiness of the ingest stream that contains the audio track. This consideration often results in putting the audio track in its own stream (as in Option 2) or bundling it with the lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="7ef64-206">Ayrıca, daha iyi yedeklik ve hataya dayanıklılık için aynı ses izleme iki farklı akışlar (yedekli ses izleri seçeneği 2) içinde gönderirken ya da ses izleme en az iki düşük bit hızlı video izler (seçenek 3 en az iki paketlenmiş sesle paketleme video akışları) için Canlı önerilir medya Hizmetleri içine alın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-206">Also, for better redundancy and fault tolerance, sending the same audio track in two different streams (Option 2 with redundant audio tracks) or bundling the audio track with at least two of the lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="7ef64-207">7. Hizmet yük devretmesi</span><span class="sxs-lookup"><span data-stu-id="7ef64-207">7. Service failover</span></span>
<span data-ttu-id="7ef64-208">Canlı akış yapısı, iyi yük devretme desteği hizmetin kullanılabilirliğini sağlamak için önemlidir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-208">Given the nature of live streaming, good failover support is critical for ensuring the availability of the service.</span></span> <span data-ttu-id="7ef64-209">Media Services, ağ hataları, sunucu hataları ve depolama sorunlarını hataları gibi çeşitli türlerde işlemek için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-209">Media Services is designed to handle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="7ef64-210">Müşteriler, uygun yük devretme mantığı gerçek zamanlı Kodlayıcı taraftaki ile birlikte kullanıldığında, yüksek oranda güvenilir bir canlı akış hizmetine bulutta elde edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-210">When used in conjunction with proper failover logic from the live encoder side, customers can achieve a highly reliable live streaming service from the cloud.</span></span>

<span data-ttu-id="7ef64-211">Bu bölümde, hizmet bir yük devretme senaryosu açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="7ef64-212">Bu durumda hizmet içinde herhangi bir yerde başarısız olur ve bir ağ hatası çıkmaktadır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-212">In this case, the failure happens somewhere within the service, and it manifests itself as a network error.</span></span> <span data-ttu-id="7ef64-213">Hizmet yük devretmesi işlemek için Kodlayıcı uygulaması için bazı öneriler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="7ef64-213">Here are some recommendations for the encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="7ef64-214">10 saniye zaman aşımını TCP bağlantısı kurmak için kullanın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-214">Use a 10-second timeout for establishing the TCP connection.</span></span> <span data-ttu-id="7ef64-215">Bağlantı kurma girişimi 10 saniyeden uzun sürerse, işlemi durdurmak ve yeniden deneyin.</span><span class="sxs-lookup"><span data-stu-id="7ef64-215">If an attempt to establish the connection takes longer than 10 seconds, abort the operation and try again.</span></span> 
2. <span data-ttu-id="7ef64-216">Kısa bir zaman aşımı iletisi öbekleri HTTP isteği göndermek için kullanın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-216">Use a short timeout for sending the HTTP request message chunks.</span></span> <span data-ttu-id="7ef64-217">Hedef MP4 parça süresi N saniye ise, N ve 2 N saniye arasında gönderilen zaman aşımı kullanın; Örneğin, MP4 parça süresi 6 saniye ise, 6 ila 12 saniyelik zaman aşımı kullanın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-217">If the target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if the MP4 fragment duration is 6 seconds, use a timeout of 6 to 12 seconds.</span></span> <span data-ttu-id="7ef64-218">Zaman aşımı meydana gelirse, bağlantıyı sıfırlar, yeni bir bağlantı açmak ve akış sürdürme yeni bağlantıda alma.</span><span class="sxs-lookup"><span data-stu-id="7ef64-218">If a timeout occurs, reset the connection, open a new connection, and resume stream ingest on the new connection.</span></span> 
3. <span data-ttu-id="7ef64-219">Başarılı bir şekilde ve tamamen hizmete gönderilen son iki parça her parçasının sahip çalışırken bir arabellek korur.</span><span class="sxs-lookup"><span data-stu-id="7ef64-219">Maintain a rolling buffer that has the last two fragments for each track that were successfully and completely sent to the service.</span></span>  <span data-ttu-id="7ef64-220">Bir akış için HTTP POST isteği sonlandırılır veya öncesinde zaman aşımına akışın sonuna yeni bir bağlantı açmak ve başka bir HTTP POST isteği başlatmak, akış üstbilgileri yeniden, her izleme için son iki parça yeniden ve d oluşturmaksızın akış Sürdür medya zaman çizelgesinde iscontinuity.</span><span class="sxs-lookup"><span data-stu-id="7ef64-220">If the HTTP POST request for a stream is terminated or times out prior to the end of the stream, open a new connection and begin another HTTP POST request, resend the stream headers, resend the last two fragments for each track, and resume the stream without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="7ef64-221">Bu, veri kaybı olasılığını azaltır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-221">This reduces the chance of data loss.</span></span>
4. <span data-ttu-id="7ef64-222">Kodlayıcı bağlantı kurun veya TCP hata oluştuktan sonra akış sürdürmek için yeniden deneme sayısını sınırlamaz öneririz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-222">We recommend that the encoder does NOT limit the number of retries to establish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="7ef64-223">TCP hatasından sonra:</span><span class="sxs-lookup"><span data-stu-id="7ef64-223">After a TCP error:</span></span>
  
    <span data-ttu-id="7ef64-224">a.</span><span class="sxs-lookup"><span data-stu-id="7ef64-224">a.</span></span> <span data-ttu-id="7ef64-225">Geçerli bağlantının kapatılması gerekir ve yeni bir bağlantı için yeni bir HTTP POST isteği oluşturulması gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-225">The current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="7ef64-226">b.</span><span class="sxs-lookup"><span data-stu-id="7ef64-226">b.</span></span> <span data-ttu-id="7ef64-227">Yeni HTTP POST URL ilk gönderme URL'SİYLE aynı olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-227">The new HTTP POST URL MUST be the same as the initial POST URL.</span></span>
  
    <span data-ttu-id="7ef64-228">c.</span><span class="sxs-lookup"><span data-stu-id="7ef64-228">c.</span></span> <span data-ttu-id="7ef64-229">Yeni HTTP POST içermelidir akış üstbilgileri (**ftyp**, **Canlı sunucusu bildirim kutusu**, ve **moov** kutuları), ilk POST akış üstbilgilerinde aynı.</span><span class="sxs-lookup"><span data-stu-id="7ef64-229">The new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical to the stream headers in the initial POST.</span></span>
  
    <span data-ttu-id="7ef64-230">d.</span><span class="sxs-lookup"><span data-stu-id="7ef64-230">d.</span></span> <span data-ttu-id="7ef64-231">Her parça için gönderilen son iki parça gönderilmesi gerekir ve akış medya zaman çizelgesinde süreksizlik oluşturmaksızın çıkmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-231">The last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="7ef64-232">MP4 parça zaman damgaları sürekli olarak bile HTTP POST istekleri artırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-232">The MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="7ef64-233">MP4 parça süresiyle orantılı bir hızda veri gönderilmiyor varsa Kodlayıcı HTTP POST isteği sonlanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-233">The encoder SHOULD terminate the HTTP POST request if data is not being sent at a rate commensurate with the MP4 fragment duration.</span></span>  <span data-ttu-id="7ef64-234">Veri göndermediğini bir HTTP POST isteği Media Services hızlı bir şekilde kodlayıcıdan bir hizmet güncelleştirmesi durumunda bağlantıyı kesme gelen engelleyebilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update.</span></span> <span data-ttu-id="7ef64-235">Bu nedenle, HTTP POST için seyrek (ad sinyali) parçaları olmalıdır kısa süreli seyrek parça gönderilen hemen sonlandırılıyor.</span><span class="sxs-lookup"><span data-stu-id="7ef64-235">For this reason, the HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as the sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="7ef64-236">8. Kodlayıcı yük devretme</span><span class="sxs-lookup"><span data-stu-id="7ef64-236">8. Encoder failover</span></span>
<span data-ttu-id="7ef64-237">Kodlayıcı yük devretme için uçtan uca canlı akış halinde teslim ele alınması gereken yük devretme senaryosu ikinci türüdür.</span><span class="sxs-lookup"><span data-stu-id="7ef64-237">Encoder failover is the second type of failover scenario that needs to be addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="7ef64-238">Bu senaryoda, hata durumu Kodlayıcı tarafında gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-238">In this scenario, the error condition occurs on the encoder side.</span></span> 

![Kodlayıcı yük devretme][image5]

<span data-ttu-id="7ef64-240">Kodlayıcı yük devretme gerçekleştiğinde aşağıdaki beklentilerini Canlı alım uç noktasından Uygula:</span><span class="sxs-lookup"><span data-stu-id="7ef64-240">The following expectations apply from the live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="7ef64-241">Yeni bir kodlayıcı örneği (3000 k kesikli çizgi ile video için akış) diyagramda gösterildiği gibi akış, devam etmek için oluşturulmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-241">A new encoder instance SHOULD be created to continue streaming, as illustrated in the diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="7ef64-242">Yeni Kodlayıcı aynı URL için HTTP POST istekleri başarısız örneği olarak kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-242">The new encoder MUST use the same URL for HTTP POST requests as the failed instance.</span></span>
3. <span data-ttu-id="7ef64-243">Yeni Kodlayıcı'nın POST isteği başarısız örnekle aynı parçalanmış MP4 üstbilgi kutuları eklemeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-243">The new encoder’s POST request MUST include the same fragmented MP4 header boxes as the failed instance.</span></span>
4. <span data-ttu-id="7ef64-244">Yeni Kodlayıcı hizalanmış parça sınırlarla eşitlenen ses/video örnekleri oluşturmak için tüm diğer çalışan kodlayıcılar aynı Canlı sunum ile düzgün olarak eşitlenmedi gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-244">The new encoder MUST be properly synced with all other running encoders for the same live presentation to generate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="7ef64-245">Yeni akış önceki akışıyla anlam olarak eşdeğer olmalıdır ve üstbilgi ve parça düzeylerinde değiştirilebilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-245">The new stream MUST be semantically equivalent with the previous stream, and interchangeable at the header and fragment levels.</span></span>
6. <span data-ttu-id="7ef64-246">Yeni Kodlayıcı, veri kaybını en aza indirmek denemelisiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-246">The new encoder SHOULD try to minimize data loss.</span></span> <span data-ttu-id="7ef64-247">`fragment_absolute_time` Ve `fragment_index` ortam parçaları Kodlayıcı son durduğu noktasından artırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-247">The `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from the point where the encoder last stopped.</span></span> <span data-ttu-id="7ef64-248">`fragment_absolute_time` Ve `fragment_index` sürekli bir biçimde artırmanız gerekir, ancak, gerekirse, süreksizlik tanıtmak için izin verilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-248">The `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible to introduce a discontinuity, if necessary.</span></span> <span data-ttu-id="7ef64-249">Medya zaman çizelgesinde discontinuities tanıtmak üzere daha parçaları yeniden göndermeyi yan tarafında hata daha iyidir şekilde Media Services, daha önce alındı ve işlenen, parça yok sayar.</span><span class="sxs-lookup"><span data-stu-id="7ef64-249">Media Services ignores fragments that it has already received and processed, so it's better to err on the side of resending fragments than to introduce discontinuities in the media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="7ef64-250">9. Kodlayıcı artıklık</span><span class="sxs-lookup"><span data-stu-id="7ef64-250">9. Encoder redundancy</span></span>
<span data-ttu-id="7ef64-251">Bazı önemli olayları isteğe bağlı daha yüksek kullanılabilirlik ve kaliteli bir deneyim, veri kaybı olmadan sorunsuz yük devretme elde etmek için aktif-aktif yedekli kodlayıcılar kullanmak önerilir, dinamik.</span><span class="sxs-lookup"><span data-stu-id="7ef64-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders to achieve seamless failover with no data loss.</span></span>

![Kodlayıcı artıklık][image6]

<span data-ttu-id="7ef64-253">Bu diyagramda gösterildiği gibi kodlayıcılar iki grupları her akış iki kopyasını Canlı hizmetinde aynı anda iletin.</span><span class="sxs-lookup"><span data-stu-id="7ef64-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into the live service.</span></span> <span data-ttu-id="7ef64-254">Media Services akışı kimliği ve parçası zaman damgasını göre yinelenen parçaları filtrelemenize çünkü bu kurulumu desteklenir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="7ef64-255">Sonuçta elde edilen canlı akış ve Arşiv iki kaynaklardan gelen en iyi olası toplama olan tek bir kopyasını tüm akışlar olur.</span><span class="sxs-lookup"><span data-stu-id="7ef64-255">The resulting live stream and archive is a single copy of all the streams that is the best possible aggregation from the two sources.</span></span> <span data-ttu-id="7ef64-256">Örneğin, durumda bir kuramsal aşırı yoktur (adla aynı olması gerekmez) bir kodlayıcı sürece belirli bir anda her akış için zaman içinde sonuçta ortaya çıkan bir canlı akışı hizmetinden veri kaybı olmadan sürekli çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="7ef64-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have to be the same one) running at any given point in time for each stream, the resulting live stream from the service is continuous without data loss.</span></span> 

<span data-ttu-id="7ef64-257">Bu senaryo için gereksinimler neredeyse gereksinimleri "Kodlayıcı yük devretme" durumda, ikinci kodlayıcılar kümesi çalıştıran birincil kodlayıcılar aynı zamanda özel durumu ile aynıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-257">The requirements for this scenario are almost the same as the requirements in the "Encoder failover" case, with the exception that the second set of encoders are running at the same time as the primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="7ef64-258">10. Hizmet artıklık</span><span class="sxs-lookup"><span data-stu-id="7ef64-258">10. Service redundancy</span></span>
<span data-ttu-id="7ef64-259">Yüksek oranda yedekli genel dağıtım için bazen bölgesel afetler işlemek için çapraz bölge yedekleme olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-259">For highly redundant global distribution, sometimes you must have cross-region backup to handle regional disasters.</span></span> <span data-ttu-id="7ef64-260">"Kodlayıcı artıklık" topolojisine genişleterek, müşterilerin yedekli hizmet dağıtımı kodlayıcılar ikinci kümesiyle bağlı farklı bir bölgede sahip olmayı seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-260">Expanding on the “Encoder redundancy” topology, customers can choose to have a redundant service deployment in a different region that's connected with the second set of encoders.</span></span> <span data-ttu-id="7ef64-261">Müşteriler, aynı zamanda genel trafik sorunsuz bir şekilde istemci trafiğini yönlendirmek için Yöneticisi önünde iki hizmet dağıtımları dağıtmak için içerik teslim ağı sağlayıcı ile çalışabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-261">Customers also can work with a Content Delivery Network provider to deploy a Global Traffic Manager in front of the two service deployments to seamlessly route client traffic.</span></span> <span data-ttu-id="7ef64-262">Kodlayıcılar gereksinimleri "Kodlayıcı artıklık" servis talebi ile aynıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-262">The requirements for the encoders are the same as the “Encoder redundancy” case.</span></span> <span data-ttu-id="7ef64-263">Farklı bir canlı yönlendirilmesi için kodlayıcılar gereksinimlerini ikinci kümesi uç noktasını alın tek özel durumdur.</span><span class="sxs-lookup"><span data-stu-id="7ef64-263">The only exception is that the second set of encoders needs to be pointed to a different live ingest endpoint.</span></span> <span data-ttu-id="7ef64-264">Aşağıdaki diyagramda, bu kurulum gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="7ef64-264">The following diagram shows this setup:</span></span>

![Hizmet artıklık][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="7ef64-266">11. Özel türde alım biçimleri</span><span class="sxs-lookup"><span data-stu-id="7ef64-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="7ef64-267">Bu bölümde belirli senaryolar işlemek üzere tasarlanmış Canlı alım biçimlerinin özel türleri açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-267">This section discusses special types of live ingestion formats that are designed to handle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="7ef64-268">Seyrek İzle</span><span class="sxs-lookup"><span data-stu-id="7ef64-268">Sparse track</span></span>
<span data-ttu-id="7ef64-269">Bir zengin istemci deneyimi ile canlı akış sunu genellikle, zaman eşitlenmiş olayları iletmek gerekli olan veya bant dışı ana medya verilerle işaret eder.</span><span class="sxs-lookup"><span data-stu-id="7ef64-269">When delivering a live streaming presentation with a rich client experience, often it's necessary to transmit time-synced events or signals in-band with the main media data.</span></span> <span data-ttu-id="7ef64-270">Bu dinamik Canlı reklam ekleme örneğidir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="7ef64-271">Bu tür olay sinyal seyrek doğası nedeniyle akış normal ses/video farklıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="7ef64-272">Diğer bir deyişle, sinyal verileri genellikle sürekli olarak gerçekleşmez ve aralığı tahmin etmek zor olabilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-272">In other words, the signaling data usually does not happen continuously, and the interval can be hard to predict.</span></span> <span data-ttu-id="7ef64-273">Seyrek izleme kavramı, alma ve bant dışı sinyal veri yayını için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-273">The concept of sparse track was designed to ingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="7ef64-274">Aşağıdaki adımlar seyrek izleme alma için önerilen uygulama şunlardır:</span><span class="sxs-lookup"><span data-stu-id="7ef64-274">The following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="7ef64-275">Ses/video parçaları olmadan yalnızca seyrek parçaları içeren ayrı bir parçalanmış MP4 bitstream oluşturun.</span><span class="sxs-lookup"><span data-stu-id="7ef64-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="7ef64-276">İçinde **Canlı sunucusu bildirim kutusu** [1] Bölüm 6'tanımlandığı gibi kullanmak *parentTrackName* üst izleme adını belirtmek için parametre. [1] 4.2.1.2.1.2 bölümünde daha fazla bilgi için bkz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-276">In the **Live Server Manifest Box** as defined in Section 6 in [1], use the *parentTrackName* parameter to specify the name of the parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="7ef64-277">İçinde **Canlı sunucusu bildirim kutusu**, **manifestOutput** ayarlanmalıdır **doğru**.</span><span class="sxs-lookup"><span data-stu-id="7ef64-277">In the **Live Server Manifest Box**, **manifestOutput** MUST be set to **true**.</span></span>
4. <span data-ttu-id="7ef64-278">Sinyal Olayı seyrek yapısını verildiğinde, aşağıdakiler önerilir:</span><span class="sxs-lookup"><span data-stu-id="7ef64-278">Given the sparse nature of the signaling event, we recommended the following:</span></span>
   
    <span data-ttu-id="7ef64-279">a.</span><span class="sxs-lookup"><span data-stu-id="7ef64-279">a.</span></span> <span data-ttu-id="7ef64-280">Canlı olay başında Kodlayıcı ilk üstbilgi kutuları istemci bildiriminde seyrek izleme kaydedilecek hizmet veren hizmetine gönderir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-280">At the beginning of the live event, the encoder sends the initial header boxes to the service, which allows the service to register the sparse track in the client manifest.</span></span>
   
    <span data-ttu-id="7ef64-281">b.</span><span class="sxs-lookup"><span data-stu-id="7ef64-281">b.</span></span> <span data-ttu-id="7ef64-282">Veri gönderilmiyor zaman Kodlayıcı HTTP POST isteği sonlanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7ef64-282">The encoder SHOULD terminate the HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="7ef64-283">Veri göndermediğini uzun süre çalışan HTTP POST Media Services hızlı bir şekilde kodlayıcıdan hizmet güncelleştirmesi veya sunucu yeniden başlatma durumunda bağlantıyı kesme gelen engelleyebilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update or server reboot.</span></span> <span data-ttu-id="7ef64-284">Bu durumlarda, ortam sunucusu yuvada alma işleminde geçici olarak engellendi.</span><span class="sxs-lookup"><span data-stu-id="7ef64-284">In these cases, the media server is temporarily blocked in a receive operation on the socket.</span></span>
   
    <span data-ttu-id="7ef64-285">c.</span><span class="sxs-lookup"><span data-stu-id="7ef64-285">c.</span></span> <span data-ttu-id="7ef64-286">Sinyal veri kullanılabilir olmadığında olduğu süre boyunca SHOULD Kodlayıcı Kapat HTTP POST isteği.</span><span class="sxs-lookup"><span data-stu-id="7ef64-286">During the time when signaling data is not available, the encoder SHOULD close the HTTP POST request.</span></span> <span data-ttu-id="7ef64-287">POST isteğini etkinken Kodlayıcı veri göndermesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-287">While the POST request is active, the encoder SHOULD send data.</span></span>

    <span data-ttu-id="7ef64-288">d.</span><span class="sxs-lookup"><span data-stu-id="7ef64-288">d.</span></span> <span data-ttu-id="7ef64-289">Kullanılabilir durumdaysa Kodlayıcı seyrek parçaları gönderirken, açık bir content-length üstbilgisi ayarlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-289">When sending sparse fragments, the encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="7ef64-290">e.</span><span class="sxs-lookup"><span data-stu-id="7ef64-290">e.</span></span> <span data-ttu-id="7ef64-291">Yeni bir bağlantıyla seyrek parçaları gönderirken Kodlayıcı tarafından yeni parçaları ardından üstbilgi kutularından gönderme başlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-291">When sending sparse fragments with a new connection, the encoder SHOULD start sending from the header boxes, followed by the new fragments.</span></span> <span data-ttu-id="7ef64-292">Bu, yük devretme ortası olur ve seyrek izleme önce görmediği yeni bir sunucu için yeni seyrek bağlantı kuruldu durumlarda içindir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-292">This is for cases in which failover happens in-between, and the new sparse connection is being established to a new server that has not seen the sparse track before.</span></span>

    <span data-ttu-id="7ef64-293">f.</span><span class="sxs-lookup"><span data-stu-id="7ef64-293">f.</span></span> <span data-ttu-id="7ef64-294">Eşit veya daha büyük bir zaman damgası değeri karşılık gelen üst parça parça istemciye kullanılabilir olduğunda seyrek parça parça istemciye kullanılabilir hale gelir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-294">The sparse track fragment becomes available to the client when the corresponding parent track fragment that has an equal or larger timestamp value is made available to the client.</span></span> <span data-ttu-id="7ef64-295">Bir zaman damgası t seyrek parça varsa, örneğin, = 1000, beklenen, "video" (üst izleme adı "video" olduğunu varsayarak) parçalara zaman damgası 1000 veya sonrasını, seyrek parça t indirebilirsiniz istemci görür sonra = 1000.</span><span class="sxs-lookup"><span data-stu-id="7ef64-295">For example, if the sparse fragment has a timestamp of t=1000, it is expected that after the client sees "video" (assuming the parent track name is "video") fragment timestamp 1000 or beyond, it can download the sparse fragment t=1000.</span></span> <span data-ttu-id="7ef64-296">Gerçek sinyal sunu zaman çizelgesi farklı bir konuma için belirlenen amacı için kullanılabilir olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-296">Note that the actual signal could be used for a different position in the presentation timeline for its designated purpose.</span></span> <span data-ttu-id="7ef64-297">Bu örnekte, mümkündür, seyrek parça t = 1000 olan birkaç saniye olan bir konuma bir ad eklemek için bir XML yükü daha sonra.</span><span class="sxs-lookup"><span data-stu-id="7ef64-297">In this example, it’s possible that the sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="7ef64-298">g.</span><span class="sxs-lookup"><span data-stu-id="7ef64-298">g.</span></span> <span data-ttu-id="7ef64-299">Seyrek parça parça yükü senaryoya bağlı olarak (örneğin, XML, metin veya ikili), farklı biçimlerde olabilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-299">The payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on the scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="7ef64-300">Yedek ses İzle</span><span class="sxs-lookup"><span data-stu-id="7ef64-300">Redundant audio track</span></span>
<span data-ttu-id="7ef64-301">Tipik bir HTTP Uyarlamalı akış senaryoda (örneğin, kesintisiz akış veya tire), genellikle var. tüm sunuya yalnızca bir ses İzle</span><span class="sxs-lookup"><span data-stu-id="7ef64-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in the entire presentation.</span></span> <span data-ttu-id="7ef64-302">Ses parçası içeren akış alımı bozuk ise hata koşulları seçmek istemcinin birden çok kalitesi düzeylerini olan video parçaları tek hata noktası ses parçası olabilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-302">Unlike video tracks, which have multiple quality levels for the client to choose from in error conditions, the audio track can be a single point of failure if the ingestion of the stream that contains the audio track is broken.</span></span> 

<span data-ttu-id="7ef64-303">Bu sorunu çözmek için yedek ses izleri, Canlı alım Media Services destekler.</span><span class="sxs-lookup"><span data-stu-id="7ef64-303">To solve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="7ef64-304">Birden çok kez farklı akış gönderilebilir aynı ses parçası olur.</span><span class="sxs-lookup"><span data-stu-id="7ef64-304">The idea is that the same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="7ef64-305">Hizmet yalnızca ses izleme kez istemci bildirimini kaydeder rağmen birincil ses izleme sorunlar varsa, ses parçaları almak için bunu yedekli ses izleri yedek olarak kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7ef64-305">Although the service only registers the audio track once in the client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if the primary audio track has issues.</span></span> <span data-ttu-id="7ef64-306">Yedek ses izleri alma için Kodlayıcı gerekir:</span><span class="sxs-lookup"><span data-stu-id="7ef64-306">To ingest redundant audio tracks, the encoder needs to:</span></span>

1. <span data-ttu-id="7ef64-307">Birden çok parçadaki MP4 bitstreams aynı ses kaydı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="7ef64-307">Create the same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="7ef64-308">Yedek ses izleri ile aynı parça zaman damgaları anlam olarak eşdeğer ve üstbilgi ve parça düzeylerinde değiştirilebilir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-308">The redundant audio tracks MUST be semantically equivalent, with the same fragment timestamps, and be interchangeable at the header and fragment levels.</span></span>
2. <span data-ttu-id="7ef64-309">Canlı sunucu bildirimi (Bölüm 6 [1].) "ses" girdisinde tüm gereksiz ses izleri için aynı olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="7ef64-309">Ensure that the “audio” entry in the Live Server Manifest (Section 6 in [1]) is the same for all redundant audio tracks.</span></span>

<span data-ttu-id="7ef64-310">Aşağıdaki uygulama için yedek ses izleri önerilir:</span><span class="sxs-lookup"><span data-stu-id="7ef64-310">The following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="7ef64-311">Her benzersiz ses izleme tek başına bir akışa gönderin.</span><span class="sxs-lookup"><span data-stu-id="7ef64-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="7ef64-312">Ayrıca, her burada ikinci akış farklı birinciden bu ses izleme akışlar için yedek bir akış Gönder yalnızca HTTP POST URL'de tanımlayıcısı tarafından: {protokol} :// {sunucu adresi} / {noktası path}/Streams({identifier}) yayımlama.</span><span class="sxs-lookup"><span data-stu-id="7ef64-312">Also, send a redundant stream for each of these audio track streams, where the second stream differs from the first only by the identifier in the HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="7ef64-313">İki düşük video bit göndermek için ayrı akışları kullanın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-313">Use separate streams to send the two lowest video bitrates.</span></span> <span data-ttu-id="7ef64-314">Her bu akışlar benzersiz her ses izleme bir kopyasını da içermelidir. Örneğin, birden fazla dili desteklendiğinde, bu akışları her dil için ses izleri içermelidir.</span><span class="sxs-lookup"><span data-stu-id="7ef64-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="7ef64-315">Kodlamak ve belirtilen yedek akışlar (1) ve (2) göndermek için ayrı bir sunucu (kodlayıcı) örneği kullanın.</span><span class="sxs-lookup"><span data-stu-id="7ef64-315">Use separate server (encoder) instances to encode and send the redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="7ef64-316">Media Services’i öğrenme yolları</span><span class="sxs-lookup"><span data-stu-id="7ef64-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="7ef64-317">Geri bildirimde bulunma</span><span class="sxs-lookup"><span data-stu-id="7ef64-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
