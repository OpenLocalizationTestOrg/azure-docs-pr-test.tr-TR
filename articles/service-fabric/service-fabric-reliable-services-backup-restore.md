---
title: "aaaService doku yedekleme ve geri yükleme | Microsoft Docs"
description: "Service Fabric yedekleme ve geri yükleme için kavramsal belgeler"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: subramar,jessebenson
ms.assetid: 91ea6ca4-cc2a-4155-9823-dcbd0b996349
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/18/2017
ms.author: mcoskun
ms.openlocfilehash: e502b59c84999c3fe825167383f00a5ebd70c9b5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="back-up-and-restore-reliable-services-and-reliable-actors"></a><span data-ttu-id="66e60-103">Ve Reliable Services ve Reliable Actors geri yükleme</span><span class="sxs-lookup"><span data-stu-id="66e60-103">Back up and restore Reliable Services and Reliable Actors</span></span>
<span data-ttu-id="66e60-104">Azure Service Fabric hello durumu arasında birden fazla düğüm toomaintain bu yüksek oranda kullanılabilir çoğaltan bir yüksek kullanılabilirlik platformudur.</span><span class="sxs-lookup"><span data-stu-id="66e60-104">Azure Service Fabric is a high-availability platform that replicates hello state across multiple nodes toomaintain this high availability.</span></span>  <span data-ttu-id="66e60-105">Bu nedenle, hello kümedeki bir düğümün başarısız olsa bile, hello Hizmetleri toobe kullanılabilir devam edin.</span><span class="sxs-lookup"><span data-stu-id="66e60-105">Thus, even if one node in hello cluster fails, hello services continue toobe available.</span></span> <span data-ttu-id="66e60-106">Belirli durumlarda daha Hello platform tarafından sağlanan bu-yerleşik artıklık bazı için yeterli olsa bile hello hizmet tooback verileri (tooan dış deposu) için tercih edilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-106">While this in-built redundancy provided by hello platform may be sufficient for some, in certain cases it is desirable for hello service tooback up data (tooan external store).</span></span>

> [!NOTE]
> <span data-ttu-id="66e60-107">Kritik toobackup olduğundan ve verilerinizi (ve beklendiği gibi çalıştığını test) geri yüklemek için veri kaybı senaryolarını kurtarabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="66e60-107">It is critical toobackup and restore your data (and test that it works as expected) so you can recover from data loss scenarios.</span></span>
> 
> 

<span data-ttu-id="66e60-108">Örneğin, bir hizmet sırası tooprotect senaryoları aşağıdaki hello gelen verilerini tooback isteyebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="66e60-108">For example, a service may want tooback up data in order tooprotect from hello following scenarios:</span></span>

- <span data-ttu-id="66e60-109">Merhaba olayı tüm Service Fabric kümesinin hello kalıcı kaybı.</span><span class="sxs-lookup"><span data-stu-id="66e60-109">In hello event of hello permanent loss of an entire Service Fabric cluster.</span></span>
- <span data-ttu-id="66e60-110">Bir hizmet bölüm hello çoğaltmalarının çoğunu kalıcı kaybı</span><span class="sxs-lookup"><span data-stu-id="66e60-110">Permanent loss of a majority of hello replicas of a service partition</span></span>
- <span data-ttu-id="66e60-111">Yapabildiği hello durumu yanlışlıkla silinen bozuk alır veya yönetimsel hatalar.</span><span class="sxs-lookup"><span data-stu-id="66e60-111">Administrative errors whereby hello state accidentally gets deleted or corrupted.</span></span> <span data-ttu-id="66e60-112">Örneğin, yeterli ayrıcalığa sahip bir yönetici yanlışlıkla hello hizmet silerse bu ortaya çıkabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-112">For example, this may happen if an administrator with sufficient privilege erroneously deletes hello service.</span></span>
- <span data-ttu-id="66e60-113">Veri bozulmasına neden hatalar hello hizmetindeki.</span><span class="sxs-lookup"><span data-stu-id="66e60-113">Bugs in hello service that cause data corruption.</span></span> <span data-ttu-id="66e60-114">Örneğin, bir hizmet kod yükseltme hatalı veri tooa güvenilir koleksiyonu yazma başlatıldığında bu ortaya çıkabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-114">For example, this may happen when a service code upgrade starts writing faulty data tooa Reliable Collection.</span></span> <span data-ttu-id="66e60-115">Böyle bir durumda, her ikisi de kodu hello ve hello veri toobe olabilir tooan geri önceki belirtin.</span><span class="sxs-lookup"><span data-stu-id="66e60-115">In such a case, both hello code and hello data may have toobe reverted tooan earlier state.</span></span>
- <span data-ttu-id="66e60-116">Çevrimdışı veri işleme.</span><span class="sxs-lookup"><span data-stu-id="66e60-116">Offline data processing.</span></span> <span data-ttu-id="66e60-117">Uygun toohave çevrimdışı hello veriler üretir hello hizmetinden ayrı ayrı gerçekleşir iş zekası verileri işlenmesini olabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-117">It might be convenient toohave offline processing of data for business intelligence that happens separately from hello service that generates hello data.</span></span>

<span data-ttu-id="66e60-118">Merhaba yedekleme/geri yükleme özelliği hello güvenilir Hizmetleri API toocreate ve geri yükleme yedeklemelerin üzerine kurulmuş hizmetler sağlar.</span><span class="sxs-lookup"><span data-stu-id="66e60-118">hello Backup/Restore feature allows services built on hello Reliable Services API toocreate and restore backups.</span></span> <span data-ttu-id="66e60-119">Merhaba hello platform tarafından sağlanan yedekleme API'ler engelleme okuma veya yazma işlemleri olmadan bir hizmet bölümünün durumunun yedekleri izin verir.</span><span class="sxs-lookup"><span data-stu-id="66e60-119">hello backup APIs provided by hello platform allow backup(s) of a service partition's state, without blocking read or write operations.</span></span> <span data-ttu-id="66e60-120">Merhaba geri yükleme API'leri seçilen bir yedekten geri yüklenmiş bir hizmet bölümünün durumu toobe izin verir.</span><span class="sxs-lookup"><span data-stu-id="66e60-120">hello restore APIs allow a service partition's state toobe restored from a chosen backup.</span></span>

## <a name="types-of-backup"></a><span data-ttu-id="66e60-121">Yedekleme türleri</span><span class="sxs-lookup"><span data-stu-id="66e60-121">Types of Backup</span></span>
<span data-ttu-id="66e60-122">Yedekleme iki seçenek vardır: tam ve artımlı.</span><span class="sxs-lookup"><span data-stu-id="66e60-122">There are two backup options: Full and Incremental.</span></span>
<span data-ttu-id="66e60-123">Tam yedekleme tüm hello gerekli verileri toorecreate hello durum hello çoğaltmasının içeren yedeğidir: denetim noktaları ve tüm günlük kayıtları.</span><span class="sxs-lookup"><span data-stu-id="66e60-123">A full backup is a backup that contains all hello data required toorecreate hello state of hello replica: checkpoints and all log records.</span></span>
<span data-ttu-id="66e60-124">Hello kontrol noktalarına ve hello günlük olduğundan, tek başına bir yedekten geri yüklenebilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-124">Since it has hello checkpoints and hello log, a full backup can be restored by itself.</span></span>

<span data-ttu-id="66e60-125">Merhaba kontrol noktaları büyük olduğunda tam yedeklemeler hello sorun ortaya çıkar.</span><span class="sxs-lookup"><span data-stu-id="66e60-125">hello problem with full backups arises when hello checkpoints are large.</span></span>
<span data-ttu-id="66e60-126">Örneğin, 16 GB durumuna sahip bir çoğaltma yaklaşık too16 GB eklemek kontrol noktaları sahip olur.</span><span class="sxs-lookup"><span data-stu-id="66e60-126">For example, a replica that has 16 GB of state will have checkpoints that add up approximately too16 GB.</span></span>
<span data-ttu-id="66e60-127">Biz beş dakikalık bir kurtarma noktası hedefi varsa hello çoğaltma beş dakikada yedeklenen toobe gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-127">If we have a Recovery Point Objective of five minutes, hello replica needs toobe backed up every five minutes.</span></span>
<span data-ttu-id="66e60-128">İsteğe bağlı olarak yedekler her zaman toocopy gereken kontrol noktaları ayrıca 16 GB too50 MB (yapılandırılabilir kullanarak `CheckpointThresholdInMB`) günlükleri tutarında.</span><span class="sxs-lookup"><span data-stu-id="66e60-128">Each time it backs up it needs toocopy 16 GB of checkpoints in addition too50 MB (configurable using `CheckpointThresholdInMB`) worth of logs.</span></span>

![Tam yedekleme örnek.](media/service-fabric-reliable-services-backup-restore/FullBackupExample.PNG)

<span data-ttu-id="66e60-130">Merhaba çözüm toothis artımlı yedeklemeler, yedekleme yalnızca değiştirilen hello günlük kayıtlarını hello son yedeklemeden içerdiği bir sorundur.</span><span class="sxs-lookup"><span data-stu-id="66e60-130">hello solution toothis problem is incremental backups, where backup only contains hello changed log records since hello last backup.</span></span>

![Artımlı yedekleme örnek.](media/service-fabric-reliable-services-backup-restore/IncrementalBackupExample.PNG)

<span data-ttu-id="66e60-132">Artımlı yedeklemeler yalnızca değişiklikleri (Merhaba kontrol noktalarını içermez) hello son yedeklemeden olduğundan, toobe daha hızlı eğilimindedir ancak bunlar, kendi geri yüklenemez.</span><span class="sxs-lookup"><span data-stu-id="66e60-132">Since incremental backups are only changes since hello last backup (does not include hello checkpoints), they tend toobe faster but they cannot be restored on their own.</span></span>
<span data-ttu-id="66e60-133">toorestore artımlı yedekleme, hello tamamını yedekleme zinciri gereklidir.</span><span class="sxs-lookup"><span data-stu-id="66e60-133">toorestore an incremental backup, hello entire backup chain is required.</span></span>
<span data-ttu-id="66e60-134">Bir yedekleme zinciri, tam yedekleme ile başlayan yedekleme zinciri ve bitişik artımlı yedeklemeler sayısına göre gelmelidir.</span><span class="sxs-lookup"><span data-stu-id="66e60-134">A backup chain is a chain of backups starting with a full backup and followed by a number of contiguous incremental backups.</span></span>

## <a name="backup-reliable-services"></a><span data-ttu-id="66e60-135">Yedekleme güvenilir hizmetler</span><span class="sxs-lookup"><span data-stu-id="66e60-135">Backup Reliable Services</span></span>
<span data-ttu-id="66e60-136">Merhaba hizmet Yazar sahip olduğunda üzerinde tam denetimi toomake yedeklemeler ve yedeklemeleri depolanacağı.</span><span class="sxs-lookup"><span data-stu-id="66e60-136">hello service author has full control of when toomake backups and where backups will be stored.</span></span>

<span data-ttu-id="66e60-137">toostart bir yedekleme, hello hizmetin ihtiyaç tooinvoke hello devralınan üye işlevi `BackupAsync`.</span><span class="sxs-lookup"><span data-stu-id="66e60-137">toostart a backup, hello service needs tooinvoke hello inherited member function `BackupAsync`.</span></span>  
<span data-ttu-id="66e60-138">Yedeklemeler yalnızca birincil çoğaltmalardan yapılabilir ve verilen yazma durumu toobe gerektirir.</span><span class="sxs-lookup"><span data-stu-id="66e60-138">Backups can be made only from primary replicas, and they require write status toobe granted.</span></span>

<span data-ttu-id="66e60-139">Aşağıda gösterildiği gibi `BackupAsync` alır bir `BackupDescription` nesnesi, burada bir belirtebilirsiniz bir geri çağırma işlevini yanı sıra, bir tam veya artımlı yedekleme, `Func<< BackupInfo, CancellationToken, Task<bool>>>` hello yedekleme klasörü yerel olarak oluşturulduğundan ve toosome kullanıma hazır toobe taşınır çağrılır harici depolama.</span><span class="sxs-lookup"><span data-stu-id="66e60-139">As shown below, `BackupAsync` takes in a `BackupDescription` object, where one can specify a full or incremental backup, as well as a callback function, `Func<< BackupInfo, CancellationToken, Task<bool>>>` that is invoked when hello backup folder has been created locally and is ready toobe moved out toosome external storage.</span></span>

```csharp

BackupDescription myBackupDescription = new BackupDescription(backupOption.Incremental,this.BackupCallbackAsync);

await this.BackupAsync(myBackupDescription);

```

<span data-ttu-id="66e60-140">Artımlı yedekleme başarısız olabilir isteği tootake `FabricMissingFullBackupException`.</span><span class="sxs-lookup"><span data-stu-id="66e60-140">Request tootake an incremental backup can fail with `FabricMissingFullBackupException`.</span></span> <span data-ttu-id="66e60-141">Bu özel bir şey aşağıdaki hello gerçekleşmekte olduğunu gösterir:</span><span class="sxs-lookup"><span data-stu-id="66e60-141">This exception indicates that one of hello following things is happening:</span></span>

- <span data-ttu-id="66e60-142">Birincil oldu beri hello çoğaltma hiçbir zaman bir tam yedekleme sürdü,</span><span class="sxs-lookup"><span data-stu-id="66e60-142">hello replica has never taken a full backup since it has become primary,</span></span>
- <span data-ttu-id="66e60-143">Merhaba bazıları günlük kayıtlarının hello son yedekleme kesildi bu yana veya</span><span class="sxs-lookup"><span data-stu-id="66e60-143">some of hello log records since hello last backup has been truncated or</span></span>
- <span data-ttu-id="66e60-144">Merhaba geçirilen çoğaltma `MaxAccumulatedBackupLogSizeInMB` sınırı.</span><span class="sxs-lookup"><span data-stu-id="66e60-144">replica passed hello `MaxAccumulatedBackupLogSizeInMB` limit.</span></span>

<span data-ttu-id="66e60-145">Kullanıcıların yapılandırarak artımlı yedeklemeler yapabilir toodo olma hello olasılığını artırmak `MinLogSizeInMB` veya `TruncationThresholdFactor`.</span><span class="sxs-lookup"><span data-stu-id="66e60-145">Users can increase hello likelihood of being able toodo incremental backups by configuring `MinLogSizeInMB` or `TruncationThresholdFactor`.</span></span>
<span data-ttu-id="66e60-146">Bu değerleri artırılması çoğaltma disk kullanımı başına hello artırır unutmayın.</span><span class="sxs-lookup"><span data-stu-id="66e60-146">Note that increasing these values increases hello per replica disk usage.</span></span>
<span data-ttu-id="66e60-147">Daha fazla bilgi için bkz: [güvenilir Hizmetleri Yapılandırması](service-fabric-reliable-services-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="66e60-147">For more information, see [Reliable Services Configuration](service-fabric-reliable-services-configuration.md)</span></span>

<span data-ttu-id="66e60-148">`BackupInfo`Merhaba hello çalışma zamanı hello yedekleme kaydedildiği hello klasörünün konumunu dahil olmak üzere, hello yedekleme ile ilgili bilgiler sağlar (`BackupInfo.Directory`).</span><span class="sxs-lookup"><span data-stu-id="66e60-148">`BackupInfo` provides information regarding hello backup, including hello location of hello folder where hello runtime saved hello backup (`BackupInfo.Directory`).</span></span> <span data-ttu-id="66e60-149">Merhaba geri çağırma işlevi hello taşıyabilirsiniz `BackupInfo.Directory` tooan dış depolama veya başka bir konum.</span><span class="sxs-lookup"><span data-stu-id="66e60-149">hello callback function can move hello `BackupInfo.Directory` tooan external store or another location.</span></span>  <span data-ttu-id="66e60-150">Bu işlev, ayrıca mümkün toosuccessfully taşıma hello yedekleme klasörü tooits hedef konumu olup olmadığını gösteren bir Boole döndürür.</span><span class="sxs-lookup"><span data-stu-id="66e60-150">This function also returns a bool that indicates whether it was able toosuccessfully move hello backup folder tooits target location.</span></span>

<span data-ttu-id="66e60-151">Merhaba aşağıdaki kodu gösterir nasıl hello `BackupCallbackAsync` yöntemi kullanılan tooupload hello yedekleme tooAzure depolama olabilir:</span><span class="sxs-lookup"><span data-stu-id="66e60-151">hello following code demonstrates how hello `BackupCallbackAsync` method can be used tooupload hello backup tooAzure Storage:</span></span>

```csharp
private async Task<bool> BackupCallbackAsync(BackupInfo backupInfo, CancellationToken cancellationToken)
{
    var backupId = Guid.NewGuid();

    await externalBackupStore.UploadBackupFolderAsync(backupInfo.Directory, backupId, cancellationToken);

    return true;
}
```

<span data-ttu-id="66e60-152">Merhaba önceki örnekte, `ExternalBackupStore` Azure Blob storage ile kullanılan toointerface hello örnek sınıfı olan ve `UploadBackupFolderAsync` hello klasörü sıkıştırır ve hello Azure Blob deposuna yerleştirir hello yöntemidir.</span><span class="sxs-lookup"><span data-stu-id="66e60-152">In hello preceeding example, `ExternalBackupStore` is hello sample class that is used toointerface with Azure Blob storage, and `UploadBackupFolderAsync` is hello method that compresses hello folder and places it in hello Azure Blob store.</span></span>

<span data-ttu-id="66e60-153">Şunlara dikkat edin:</span><span class="sxs-lookup"><span data-stu-id="66e60-153">Note that:</span></span>

  - <span data-ttu-id="66e60-154">Olabilir yalnızca bir yedekleme işlemi çoğaltma yürütülen herhangi bir zamanda.</span><span class="sxs-lookup"><span data-stu-id="66e60-154">There can be only one backup operation in-flight per replica at any given time.</span></span> <span data-ttu-id="66e60-155">Birden fazla `BackupAsync` birer birer çağrısı throw `FabricBackupInProgressException` toolimit ınflight yedeklemeleri tooone.</span><span class="sxs-lookup"><span data-stu-id="66e60-155">More than one `BackupAsync` call at a time will throw `FabricBackupInProgressException` toolimit inflight backups tooone.</span></span>
  - <span data-ttu-id="66e60-156">Bir yedekleme işlemi devam ederken bir çoğaltma üzerinde başarısız olursa, hello yedekleme tamamlanmamış.</span><span class="sxs-lookup"><span data-stu-id="66e60-156">If a replica fails over while a backup is in progress, hello backup may not have been completed.</span></span> <span data-ttu-id="66e60-157">Merhaba yük devretme tamamlandıktan sonra bu nedenle, onu hello hizmetin sorumluluk toorestart hello çağırarak yedeğidir `BackupAsync` gerektiği.</span><span class="sxs-lookup"><span data-stu-id="66e60-157">Thus, once hello failover finishes, it is hello service's responsibility toorestart hello backup by invoking `BackupAsync` as necessary.</span></span>

## <a name="restore-reliable-services"></a><span data-ttu-id="66e60-158">Güvenilir Hizmetleri geri yükleme</span><span class="sxs-lookup"><span data-stu-id="66e60-158">Restore Reliable Services</span></span>
<span data-ttu-id="66e60-159">Genel olarak, bir geri yükleme işlemi tooperform gerektiğinde hello durumlarda bu kategoriden ayrılır:</span><span class="sxs-lookup"><span data-stu-id="66e60-159">In general, hello cases when you might need tooperform a restore operation fall into one of these categories:</span></span>

  - <span data-ttu-id="66e60-160">Merhaba hizmeti veri kaybı bölüm.</span><span class="sxs-lookup"><span data-stu-id="66e60-160">hello service partition lost data.</span></span> <span data-ttu-id="66e60-161">Örneğin, iki üç çoğaltması (Merhaba birincil çoğaltma dahil) bir bölüm için hello disk bozuk temizlenmeden veya.</span><span class="sxs-lookup"><span data-stu-id="66e60-161">For example, hello disk for two out of three replicas for a partition (including hello primary replica) gets corrupted or wiped.</span></span> <span data-ttu-id="66e60-162">Merhaba yeni birincil toorestore verileri bir yedekten gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-162">hello new primary may need toorestore data from a backup.</span></span>
  - <span data-ttu-id="66e60-163">Merhaba tüm hizmet kaybolur.</span><span class="sxs-lookup"><span data-stu-id="66e60-163">hello entire service is lost.</span></span> <span data-ttu-id="66e60-164">Örneğin, yönetici hello tüm hizmet kaldırır ve bu nedenle geri toobe hello hizmeti ve hello verileri gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-164">For example, an administrator removes hello entire service and thus hello service and hello data need toobe restored.</span></span>
  - <span data-ttu-id="66e60-165">Merhaba hizmet bozuk uygulama verileri (örneğin, bir uygulama hatası nedeniyle) çoğaltılan.</span><span class="sxs-lookup"><span data-stu-id="66e60-165">hello service replicated corrupt application data (e.g., because of an application bug).</span></span> <span data-ttu-id="66e60-166">Bu durumda, hello hizmet yükseltme toobe veya toobe geri döndürülen tooremove hello nedenini hello bozulması ve bozuk olmayan veri içeriyor.</span><span class="sxs-lookup"><span data-stu-id="66e60-166">In this case, hello service has toobe upgraded or reverted tooremove hello cause of hello corruption, and non-corrupt data has toobe restored.</span></span>

<span data-ttu-id="66e60-167">Birçok yaklaşım mümkün olsa da, kullanarak ilişkin bazı örnekler sunuyoruz `RestoreAsync` senaryoları yukarıda hello gelen toorecover.</span><span class="sxs-lookup"><span data-stu-id="66e60-167">While many approaches are possible, we offer some examples on using `RestoreAsync` toorecover from hello above scenarios.</span></span>

## <a name="partition-data-loss-in-reliable-services"></a><span data-ttu-id="66e60-168">Bölüm veri kaybına güvenilir hizmetler</span><span class="sxs-lookup"><span data-stu-id="66e60-168">Partition data loss in Reliable Services</span></span>
<span data-ttu-id="66e60-169">Bu durumda, hello çalışma zamanı otomatik olarak hello veri kaybı algılaması ve hello çağırma `OnDataLossAsync` API.</span><span class="sxs-lookup"><span data-stu-id="66e60-169">In this case, hello runtime would automatically detect hello data loss and invoke hello `OnDataLossAsync` API.</span></span>

<span data-ttu-id="66e60-170">Merhaba hizmet Yazar toorecover aşağıdaki tooperform hello gerekir:</span><span class="sxs-lookup"><span data-stu-id="66e60-170">hello service author needs tooperform hello following toorecover:</span></span>

  - <span data-ttu-id="66e60-171">Merhaba sanal temel sınıf yöntemini geçersiz kılın `OnDataLossAsync`.</span><span class="sxs-lookup"><span data-stu-id="66e60-171">Override hello virtual base class method `OnDataLossAsync`.</span></span>
  - <span data-ttu-id="66e60-172">Hello son yedekleme hello hizmetin yedeklemeleri içeren hello dış konumda bulur.</span><span class="sxs-lookup"><span data-stu-id="66e60-172">Find hello latest backup in hello external location that contains hello service's backups.</span></span>
  - <span data-ttu-id="66e60-173">Merhaba son yedekleme indirin (ve onu sıkıştırılmış hello yedekleme hello yedekleme klasörüne sıkıştırmasını açın).</span><span class="sxs-lookup"><span data-stu-id="66e60-173">Download hello latest backup (and uncompress hello backup into hello backup folder if it was compressed).</span></span>
  - <span data-ttu-id="66e60-174">Merhaba `OnDataLossAsync` yöntemi sağlayan bir `RestoreContext`.</span><span class="sxs-lookup"><span data-stu-id="66e60-174">hello `OnDataLossAsync` method provides a `RestoreContext`.</span></span> <span data-ttu-id="66e60-175">Merhaba çağrısı `RestoreAsync` sağlanan hello API `RestoreContext`.</span><span class="sxs-lookup"><span data-stu-id="66e60-175">Call hello `RestoreAsync` API on hello provided `RestoreContext`.</span></span>
  - <span data-ttu-id="66e60-176">Merhaba geri yükleme başarılı olursa true döndürür.</span><span class="sxs-lookup"><span data-stu-id="66e60-176">Return true if hello restoration was a success.</span></span>

<span data-ttu-id="66e60-177">Aşağıdadır hello örnek uygulaması `OnDataLossAsync` yöntemi:</span><span class="sxs-lookup"><span data-stu-id="66e60-177">Following is an example implementation of hello `OnDataLossAsync` method:</span></span>

```csharp
protected override async Task<bool> OnDataLossAsync(RestoreContext restoreCtx, CancellationToken cancellationToken)
{
    var backupFolder = await this.externalBackupStore.DownloadLastBackupAsync(cancellationToken);

    var restoreDescription = new RestoreDescription(backupFolder);

    await restoreCtx.RestoreAsync(restoreDescription);

    return true;
}
```

<span data-ttu-id="66e60-178">`RestoreDescription`içinde toohello geçirilen `RestoreContext.RestoreAsync` çağrı içerir adında bir üyeye `BackupFolderPath`.</span><span class="sxs-lookup"><span data-stu-id="66e60-178">`RestoreDescription` passed in toohello `RestoreContext.RestoreAsync` call contains a member called `BackupFolderPath`.</span></span>
<span data-ttu-id="66e60-179">Tek bir tam yedekleme geri yüklerken bu `BackupFolderPath` tam yedekleme içeren hello klasörün yerel yol toohello ayarlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-179">When restoring a single full backup, this `BackupFolderPath` should be set toohello local path of hello folder that contains your full backup.</span></span>
<span data-ttu-id="66e60-180">Tam yedekleme ve artımlı yedeklemeler, bir dizi geri yüklerken `BackupFolderPath` hello tam yedekleme, ancak aynı zamanda tüm hello artımlı yedeklemeler yalnızca içeren hello klasörün yerel yol toohello ayarlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-180">When restoring a full backup and a number of incremental backups, `BackupFolderPath` should be set toohello local path of hello folder that not only contains hello full backup, but also all hello incremental backups.</span></span>
<span data-ttu-id="66e60-181">`RestoreAsync`Arama throw `FabricMissingFullBackupException` hello varsa `BackupFolderPath` sağlanan tam yedekleme içermiyor.</span><span class="sxs-lookup"><span data-stu-id="66e60-181">`RestoreAsync` call can throw `FabricMissingFullBackupException` if hello `BackupFolderPath` provided does not contain a full backup.</span></span>
<span data-ttu-id="66e60-182">Ayrıca atabilirsiniz `ArgumentException` varsa `BackupFolderPath` artımlı yedeklemeler bozuk zincirine sahiptir.</span><span class="sxs-lookup"><span data-stu-id="66e60-182">It can also throw `ArgumentException` if `BackupFolderPath` has a broken chain of incremental backups.</span></span>
<span data-ttu-id="66e60-183">Örneğin, tam yedekleme hello içeriyorsa, ilk artımlı hello ve üçüncü artımlı yedekleme ancak hiçbir hello ikinci artımlı yedekleme hello.</span><span class="sxs-lookup"><span data-stu-id="66e60-183">For example, if it contains hello full backup, hello first incremental and hello third incremental backup but no hello second incremental backup.</span></span>

> [!NOTE]
> <span data-ttu-id="66e60-184">Merhaba RestorePolicy tooSafe varsayılan olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="66e60-184">hello RestorePolicy is set tooSafe by default.</span></span>  <span data-ttu-id="66e60-185">Bu hello yani `RestoreAsync` bu hello yedekleme klasörü içerir, bu çoğaltma bulunan eşit veya daha eski toohello durumu bir durum algılarsa, API ArgumentException ile başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="66e60-185">This means that hello `RestoreAsync` API will fail with ArgumentException if it detects that hello backup folder contains a state that is older than or equal toohello state contained in this replica.</span></span>  <span data-ttu-id="66e60-186">`RestorePolicy.Force`kullanılan tooskip bu güvenlik denetimi olabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-186">`RestorePolicy.Force` can be used tooskip this safety check.</span></span> <span data-ttu-id="66e60-187">Bu bir parçası olarak belirtilen `RestoreDescription`.</span><span class="sxs-lookup"><span data-stu-id="66e60-187">This is specified as part of `RestoreDescription`.</span></span>
> 

## <a name="deleted-or-lost-service"></a><span data-ttu-id="66e60-188">Silinen veya kayıp hizmeti</span><span class="sxs-lookup"><span data-stu-id="66e60-188">Deleted or lost service</span></span>
<span data-ttu-id="66e60-189">Bir hizmet kaldırılırsa, hello veri geri yüklenebilmesi için önce ilk hello hizmeti yeniden oluşturmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-189">If a service is removed, you must first re-create hello service before hello data can be restored.</span></span>  <span data-ttu-id="66e60-190">Bu önemli toocreate hello düzeni, veri hello şekilde bölümleme aynı yapılandırması, örn., sorunsuz bir şekilde geri yüklenebilir hello ile hizmetidir.</span><span class="sxs-lookup"><span data-stu-id="66e60-190">It is important toocreate hello service with hello same configuration, e.g., partitioning scheme, so that hello data can be restored seamlessly.</span></span>  <span data-ttu-id="66e60-191">Merhaba hizmetin çalışır durumda sonra API toorestore veri hello (`OnDataLossAsync` yukarıda) sahip toobe bu hizmetin her bölüme çağrılır.</span><span class="sxs-lookup"><span data-stu-id="66e60-191">Once hello service is up, hello API toorestore data (`OnDataLossAsync` above) has toobe invoked on every partition of this service.</span></span> <span data-ttu-id="66e60-192">Tek yönlü elde kullanarak bu olup `[FabricClient.TestManagementClient.StartPartitionDataLossAsync](https://msdn.microsoft.com/library/mt693569.aspx)` her bölüm üzerinde.</span><span class="sxs-lookup"><span data-stu-id="66e60-192">One way of achieving this is by using `[FabricClient.TestManagementClient.StartPartitionDataLossAsync](https://msdn.microsoft.com/library/mt693569.aspx)` on every partition.</span></span>  

<span data-ttu-id="66e60-193">Bu noktadan uygulaması olan hello hello yukarıda senaryo ile aynı.</span><span class="sxs-lookup"><span data-stu-id="66e60-193">From this point, implementation is hello same as hello above scenario.</span></span> <span data-ttu-id="66e60-194">Her bölüm toorestore hello son ilgili yedekleme hello dış depolama alanından gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-194">Each partition needs toorestore hello latest relevant backup from hello external store.</span></span> <span data-ttu-id="66e60-195">Bir uyarı hello çalışma zamanı dinamik olarak bölüm kimlikleri oluşturduğundan kimliği artık, değişmiş olabilir, hello bölümdür.</span><span class="sxs-lookup"><span data-stu-id="66e60-195">One caveat is that hello partition ID may have now changed, since hello runtime creates partition IDs dynamically.</span></span> <span data-ttu-id="66e60-196">Bu nedenle, hello hizmet toostore hello uygun bölüm bilgileri ve hizmet adı tooidentify hello doğru son yedekleme toorestore gelen her bölüm için gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-196">Thus, hello service needs toostore hello appropriate partition information and service name tooidentify hello correct latest backup toorestore from for each partition.</span></span>

> [!NOTE]
> <span data-ttu-id="66e60-197">Toouse önerilmez `FabricClient.ServiceManager.InvokeDataLossAsync` , küme durumunu bozabilir bu yana her bölüm toorestore hello tüm hizmet,.</span><span class="sxs-lookup"><span data-stu-id="66e60-197">It is not recommended toouse `FabricClient.ServiceManager.InvokeDataLossAsync` on each partition toorestore hello entire service, since that may corrupt your cluster state.</span></span>
> 

## <a name="replication-of-corrupt-application-data"></a><span data-ttu-id="66e60-198">Bozuk uygulama verilerinin çoğaltma</span><span class="sxs-lookup"><span data-stu-id="66e60-198">Replication of corrupt application data</span></span>
<span data-ttu-id="66e60-199">Yeni dağıtılan hello uygulama yükseltmesi bir hata varsa, veri bozulmasına neden.</span><span class="sxs-lookup"><span data-stu-id="66e60-199">If hello newly deployed application upgrade has a bug, that may cause corruption of data.</span></span> <span data-ttu-id="66e60-200">Örneğin, geçersiz bir alan kodu ile güvenilir sözlükteki uygulama yükseltme tooupdate her telefon numarası kaydı başlayabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-200">For example, an application upgrade may start tooupdate every phone number record in a Reliable Dictionary with an invalid area code.</span></span>  <span data-ttu-id="66e60-201">Bu durumda, Service Fabric hello depolanıyor hello veri yapısını farkında olmadığından hello geçersiz telefon numaraları çoğaltılır.</span><span class="sxs-lookup"><span data-stu-id="66e60-201">In this case, hello invalid phone numbers will be replicated since Service Fabric is not aware of hello nature of hello data that is being stored.</span></span>

<span data-ttu-id="66e60-202">Hello ilk şey, veri bozulması neden olan böyle bir egregious hata algılamanıza sonra toodo toofreeze hello hello uygulama düzeyinde hizmetidir ve, mümkünse, hello hata yok hello uygulama kodu toohello sürümüne yükseltme.</span><span class="sxs-lookup"><span data-stu-id="66e60-202">hello first thing toodo after you detect such an egregious bug that causes data corruption is toofreeze hello service at hello application level and, if possible, upgrade toohello version of hello application code that does not have hello bug.</span></span>  <span data-ttu-id="66e60-203">Ancak, hello servis kodu dahi giderildikten sonra hello veri hala bozuk olabilir ve böylece veri geri toobe gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-203">However, even after hello service code is fixed, hello data may still be corrupt and thus data may need toobe restored.</span></span>  <span data-ttu-id="66e60-204">Merhaba son yedekleme de bozuk olabileceğinden bu gibi durumlarda, yeterli toorestore hello son yedekleme, onu olmayabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-204">In such cases, it may not be sufficient toorestore hello latest backup, since hello latest backups may also be corrupt.</span></span>  <span data-ttu-id="66e60-205">Dolayısıyla, hello verileri bozuk önce yapan toofind hello son yedekleme sahip.</span><span class="sxs-lookup"><span data-stu-id="66e60-205">Thus, you have toofind hello last backup that was made before hello data got corrupted.</span></span>

<span data-ttu-id="66e60-206">Hangi yedeklemeler bozuk olduğundan emin değilseniz, yeni bir Service Fabric kümesi dağıtma ve "Silinen veya kayıp hizmeti" yukarıda hello gibi etkilenen bölümlerinin hello yedeklerini geri senaryo.</span><span class="sxs-lookup"><span data-stu-id="66e60-206">If you are not sure which backups are corrupt, you could deploy a new Service Fabric cluster and restore hello backups of affected partitions just like hello above "Deleted or lost service" scenario.</span></span>  <span data-ttu-id="66e60-207">Her bölüm için en az hello en son toohello hello yedekleri geri yükleme başlatın.</span><span class="sxs-lookup"><span data-stu-id="66e60-207">For each partition, start restoring hello backups from hello most recent toohello least.</span></span> <span data-ttu-id="66e60-208">Merhaba Bozulması sahip olmayan bir yedek bulduktan sonra taşıma / (Yedekleme) daha yeni tüm yedeklemeler bu bölümün silme.</span><span class="sxs-lookup"><span data-stu-id="66e60-208">Once you find a backup that does not have hello corruption, move/delete all backups of this partition that were more recent (than that backup).</span></span> <span data-ttu-id="66e60-209">Her bölüm için bu işlemi yineleyin.</span><span class="sxs-lookup"><span data-stu-id="66e60-209">Repeat this process for each partition.</span></span> <span data-ttu-id="66e60-210">Şimdi, ne zaman `OnDataLossAsync` çağrılır hello üretim kümedeki hello bölüme hello son yedekleme hello dış depolama bir çekilen hello işlem yukarıda hello tarafından bulunabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-210">Now, when `OnDataLossAsync` is called on hello partition in hello production cluster, hello last backup found in hello external store will be hello one picked by hello above process.</span></span>

<span data-ttu-id="66e60-211">Şimdi, hello "Silinen veya kayıp hizmeti" Merhaba adımları bölümü olabilir hello buggy kod hello durumu bozuk önce toorestore hello durumu hello hizmet toohello durumunun kullanıldı.</span><span class="sxs-lookup"><span data-stu-id="66e60-211">Now, hello steps in hello "Deleted or lost service" section can be used toorestore hello state of hello service toohello state before hello buggy code corrupted hello state.</span></span>

<span data-ttu-id="66e60-212">Şunlara dikkat edin:</span><span class="sxs-lookup"><span data-stu-id="66e60-212">Note that:</span></span>

  - <span data-ttu-id="66e60-213">Geri yüklendiğinde hello veriler kayboldu önce yedekleme hello şansı yapılıyor geri hello bölüm hello durumunu eski yoktur.</span><span class="sxs-lookup"><span data-stu-id="66e60-213">When you restore, there is a chance that hello backup being restored is older than hello state of hello partition before hello data was lost.</span></span> <span data-ttu-id="66e60-214">Bu nedenle, son çare toorecover yalnızca bir kadar verileri mümkün olduğunca geri yüklemeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-214">Because of this, you should restore only as a last resort toorecover as much data as possible.</span></span>
  - <span data-ttu-id="66e60-215">hello yedekleme klasörünün yolunu temsil eden dize hello ve hello hello yedekleme klasörü içindeki dosyaları yollarına bağlı olarak hello FabricDataRoot yol ve uygulama türü adı'nın uzunluğu 255 karakterden daha büyük olabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-215">hello string that represents hello backup folder path and hello paths of files inside hello backup folder can be greater than 255 characters, depending on hello FabricDataRoot path and Application Type name's length.</span></span> <span data-ttu-id="66e60-216">Bu gibi bazı .NET yöntemleri neden `Directory.Move`, toothrow hello `PathTooLongException` özel durum.</span><span class="sxs-lookup"><span data-stu-id="66e60-216">This can cause some .NET methods, like `Directory.Move`, toothrow hello `PathTooLongException` exception.</span></span> <span data-ttu-id="66e60-217">Bir geçici çözüm toodirectly olduğu gibi kernel32 API'leri çağırmak `CopyFile`.</span><span class="sxs-lookup"><span data-stu-id="66e60-217">One workaround is toodirectly call kernel32 APIs, like `CopyFile`.</span></span>

## <a name="backup-and-restore-reliable-actors"></a><span data-ttu-id="66e60-218">Yedekleme ve geri yükleme Reliable Actors</span><span class="sxs-lookup"><span data-stu-id="66e60-218">Backup and restore Reliable Actors</span></span>


<span data-ttu-id="66e60-219">Güvenilir aktörler Framework Reliable Services üzerinde oluşturulmuştur.</span><span class="sxs-lookup"><span data-stu-id="66e60-219">Reliable Actors Framework is built on top of Reliable Services.</span></span> <span data-ttu-id="66e60-220">Merhaba hello actor(s) barındıran ActorService bir durum bilgisi olan güvenilir hizmetidir.</span><span class="sxs-lookup"><span data-stu-id="66e60-220">hello ActorService which hosts hello actor(s) is a stateful reliable service.</span></span> <span data-ttu-id="66e60-221">Bu nedenle, tüm hello yedekleme ve geri yükleme işlevleri güvenilir Hizmetleri'nde kullanılabilir de kullanılabilir tooReliable aktörler (dışında durumu sağlayıcısı belirli davranışlarını).</span><span class="sxs-lookup"><span data-stu-id="66e60-221">Hence, all hello backup and restore functionality available in Reliable Services is also available tooReliable Actors (except behaviors that are state provider specific).</span></span> <span data-ttu-id="66e60-222">Yedeklemeler bir bölüm başına temelinde gerçekleştirilecek olduğundan, tüm aktörleri bölüm yedeklenecek (ve geri yükleme benzer ve bölüm başına temelinde gerçekleşir,) belirtir.</span><span class="sxs-lookup"><span data-stu-id="66e60-222">Since backups will be taken on a per-partition basis, states for all actors in that partition will be backed up (and restoration is similar and will happen on a per-partition basis).</span></span> <span data-ttu-id="66e60-223">tooperform yedekleme/geri yükleme, hello hizmet sahibi ActorService sınıfından türetilen özel aktör hizmeti sınıfı oluşturmanız gerekir ve ardından yedekleme/benzer tooReliable yukarıda önceki bölümlerde açıklandığı gibi hizmetleri geri yükleme.</span><span class="sxs-lookup"><span data-stu-id="66e60-223">tooperform backup/restore, hello service owner should create a custom actor service class that derives from ActorService class and then do backup/restore similar tooReliable Services as described above in previous sections.</span></span>

```csharp
class MyCustomActorService : ActorService
{
     public MyCustomActorService(StatefulServiceContext context, ActorTypeInformation actorTypeInfo)
            : base(context, actorTypeInfo)
     {                  
     }
    
    //
   // Method overrides and other code.
    //
}
```

<span data-ttu-id="66e60-224">Özel aktör hizmet sınıfı oluşturduğunuzda, hello aktör kaydedilirken tooregister bu de gerekir.</span><span class="sxs-lookup"><span data-stu-id="66e60-224">When you create a custom actor service class, you need tooregister that as well when registering hello actor.</span></span>

```csharp
ActorRuntime.RegisterActorAsync<MyActor>(
   (context, typeInfo) => new MyCustomActorService(context, typeInfo)).GetAwaiter().GetResult();
```

<span data-ttu-id="66e60-225">Merhaba varsayılan durumu Sağlayıcısı güvenilir aktörler için `KvsActorStateProvider`.</span><span class="sxs-lookup"><span data-stu-id="66e60-225">hello default state provider for Reliable Actors is `KvsActorStateProvider`.</span></span> <span data-ttu-id="66e60-226">Artımlı yedekleme için varsayılan olarak etkin değil `KvsActorStateProvider`.</span><span class="sxs-lookup"><span data-stu-id="66e60-226">Incremental backup is not enabled by default for `KvsActorStateProvider`.</span></span> <span data-ttu-id="66e60-227">Artımlı yedekleme oluşturarak etkinleştirebilirsiniz `KvsActorStateProvider` kurucusunda ayarlama ve aşağıdaki kod parçacığında gösterildiği gibi tooActorService Oluşturucusu geçirme ile Merhaba uygun:</span><span class="sxs-lookup"><span data-stu-id="66e60-227">You can enable incremental backup by creating `KvsActorStateProvider` with hello appropriate setting in its constructor and then passing it tooActorService constructor as shown in following code snippet:</span></span>

```csharp
class MyCustomActorService : ActorService
{
     public MyCustomActorService(StatefulServiceContext context, ActorTypeInformation actorTypeInfo)
            : base(context, actorTypeInfo, null, null, new KvsActorStateProvider(true)) // Enable incremental backup
     {                  
     }
    
    //
   // Method overrides and other code.
    //
}
```

<span data-ttu-id="66e60-228">Artımlı yedekleme etkinleştirildikten sonra bir artımlı yedekleme yapmayı FabricMissingFullBackupException ile aşağıdaki nedenlerden birinden dolayı başarısız olabilir ve artımlı yedekleri çıkarmadan önce tootake tam yedekleme gerekir:</span><span class="sxs-lookup"><span data-stu-id="66e60-228">After incremental backup has been enabled, taking an incremental backup can fail with FabricMissingFullBackupException for one of following reasons and you will need tootake a full backup before taking incremental backup(s):</span></span>

  - <span data-ttu-id="66e60-229">Birincil hale geldi beri hello çoğaltma hiçbir zaman tam yedekleme sürdü.</span><span class="sxs-lookup"><span data-stu-id="66e60-229">hello replica has never taken a full backup since it became primary.</span></span>
  - <span data-ttu-id="66e60-230">Son yedekleme alındıktan sonra bazı hello günlük kayıtlarını kesildi.</span><span class="sxs-lookup"><span data-stu-id="66e60-230">Some of hello log records were truncated since last backup was taken.</span></span>

<span data-ttu-id="66e60-231">Artımlı yedekleme etkinleştirildiğinde, `KvsActorStateProvider` kendi günlük kaydeder ve düzenli aralıklarla kesen döngüsel arabellek toomanage kullanmaz.</span><span class="sxs-lookup"><span data-stu-id="66e60-231">When incremental backup is enabled, `KvsActorStateProvider` does not use circular buffer toomanage its log records and periodically truncates it.</span></span> <span data-ttu-id="66e60-232">Yedekleme, kullanıcı tarafından 45 dakika boyunca alınmışsa hello sistem hello günlük kayıtları otomatik olarak keser.</span><span class="sxs-lookup"><span data-stu-id="66e60-232">If no backup is taken by user for a period of 45 minutes, hello system automatically truncates hello log records.</span></span> <span data-ttu-id="66e60-233">Bu zaman aralığını belirterek yapılandırılabilir `logTrunctationIntervalInMinutes` içinde `KvsActorStateProvider` Oluşturucusu (artımlı yedeklemeyi etkinleştirme benzer toowhen).</span><span class="sxs-lookup"><span data-stu-id="66e60-233">This interval can be configured by specifying `logTrunctationIntervalInMinutes` in `KvsActorStateProvider` constructor (similar toowhen enabling incremental backup).</span></span> <span data-ttu-id="66e60-234">Birincil çoğaltma toobuild başka bir çoğaltma kendi veri göndererek gerekiyorsa hello günlük kayıtlarını da kesilmiş.</span><span class="sxs-lookup"><span data-stu-id="66e60-234">hello log records may also get truncated if primary replica need toobuild another replica by sending all its data.</span></span>

<span data-ttu-id="66e60-235">Bir yedekleme zincirinden benzer tooReliable Hizmetleri geri yükleme yaparken hello BackupFolderPath tam yedekleme ve diğerleri artımlı yedekleri içeren alt dizinleri içeren bir alt alt dizinleri içermelidir.</span><span class="sxs-lookup"><span data-stu-id="66e60-235">When doing restore from a backup chain, similar tooReliable Services, hello BackupFolderPath should contain subdirectories with one subdirectory containing full backup and others subdirectories containing incremental backup(s).</span></span> <span data-ttu-id="66e60-236">Merhaba yedekleme zinciri doğrulama başarısız olursa hello geri yükleme API ile ilgili hata iletisi FabricException durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="66e60-236">hello restore API will throw FabricException with appropriate error message if hello backup chain validation fails.</span></span> 

> [!NOTE]
> <span data-ttu-id="66e60-237">`KvsActorStateProvider`şu anda hello seçenek RestorePolicy.Safe yok sayar.</span><span class="sxs-lookup"><span data-stu-id="66e60-237">`KvsActorStateProvider` currently ignores hello option RestorePolicy.Safe.</span></span> <span data-ttu-id="66e60-238">Bu özellik için destek gelecek bir sürümde planlanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="66e60-238">Support for this feature is planned in an upcoming release.</span></span>
> 

## <a name="testing-backup-and-restore"></a><span data-ttu-id="66e60-239">Yedekleme ve geri yükleme test etme</span><span class="sxs-lookup"><span data-stu-id="66e60-239">Testing Backup and Restore</span></span>
<span data-ttu-id="66e60-240">Kritik verileri yedeklenmekte ve geri yüklenebileceği önemli tooensure olur.</span><span class="sxs-lookup"><span data-stu-id="66e60-240">It is important tooensure that critical data is being backed up, and can be restored from.</span></span> <span data-ttu-id="66e60-241">Bu hello çağırarak yapılabilir `Start-ServiceFabricPartitionDataLoss` hello veri yedekleme ve hizmetinizi beklendiği gibi çalıştığını için işlevselliği geri yüklemek isteyip belirli bölüm tootest veri kaybına anlamına PowerShell cmdlet'ini.</span><span class="sxs-lookup"><span data-stu-id="66e60-241">This can be done by invoking hello `Start-ServiceFabricPartitionDataLoss` cmdlet in PowerShell that can induce data loss in a particular partition tootest whether hello data backup and restore functionality for your service is working as expected.</span></span>  <span data-ttu-id="66e60-242">Olası tooprogrammatically da olan veri kaybı çağırma ve bu olaydan geri yükleyin.</span><span class="sxs-lookup"><span data-stu-id="66e60-242">It is also possible tooprogrammatically invoke data loss and restore from that event as well.</span></span>

> [!NOTE]
> <span data-ttu-id="66e60-243">Yedekleme için bir örnek uygulama bulmak ve hello Web başvuru uygulaması github'da işlevindeki geri yükleyin.</span><span class="sxs-lookup"><span data-stu-id="66e60-243">You can find a sample implementation of backup and restore functionality in hello Web Reference App on GitHub.</span></span> <span data-ttu-id="66e60-244">Lütfen hello bakın `Inventory.Service` daha fazla ayrıntı için hizmet.</span><span class="sxs-lookup"><span data-stu-id="66e60-244">Please look at hello `Inventory.Service` service for more details.</span></span>
> 
> 

## <a name="under-hello-hood-more-details-on-backup-and-restore"></a><span data-ttu-id="66e60-245">Merhaba başlık altında: yedekleme ve geri yükleme hakkında daha fazla bilgi</span><span class="sxs-lookup"><span data-stu-id="66e60-245">Under hello hood: more details on backup and restore</span></span>
<span data-ttu-id="66e60-246">Burada, bazı yedekleme ve geri yükleme hakkında daha fazla ayrıntı verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="66e60-246">Here's some more details on backup and restore.</span></span>

### <a name="backup"></a><span data-ttu-id="66e60-247">Backup</span><span class="sxs-lookup"><span data-stu-id="66e60-247">Backup</span></span>
<span data-ttu-id="66e60-248">Merhaba güvenilir durum Yöneticisi herhangi bir engelleme olmadan hello özelliği toocreate tutarlı yedeklemeler okuma veya yazma işlemlerini sağlar.</span><span class="sxs-lookup"><span data-stu-id="66e60-248">hello Reliable State Manager provides hello ability toocreate consistent backups without blocking any read or write operations.</span></span> <span data-ttu-id="66e60-249">toodo bu nedenle, bir denetim noktası ve günlük Kalıcılık mekanizması kullanır.</span><span class="sxs-lookup"><span data-stu-id="66e60-249">toodo so, it utilizes a checkpoint and log persistence mechanism.</span></span>  <span data-ttu-id="66e60-250">Merhaba güvenilir durum Yöneticisi belirli noktaları toorelieve baskısı hello işlem günlüğündeki belirsiz (Basit) denetim noktası alır ve kurtarma sürelerini geliştirebilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-250">hello Reliable State Manager takes fuzzy (lightweight) checkpoints at certain points toorelieve pressure from hello transactional log and improve recovery times.</span></span>  <span data-ttu-id="66e60-251">Zaman `BackupAsync` olarak adlandırılan, hello güvenilir durum Yöneticisi tüm güvenilir nesneler toocopy bunların en son denetim noktası dosyaları tooa yerel yedekleme klasörü bildirir.</span><span class="sxs-lookup"><span data-stu-id="66e60-251">When `BackupAsync` is called, hello Reliable State Manager instructs all Reliable objects toocopy their latest checkpoint files tooa local backup folder.</span></span>  <span data-ttu-id="66e60-252">Ardından, hello güvenilir durum Yöneticisi hello "işaretçi Başlat" toohello en son günlük kaydından hello yedekleme klasörüne başlayan tüm günlük kayıtları kopyalar.</span><span class="sxs-lookup"><span data-stu-id="66e60-252">Then, hello Reliable State Manager copies all log records, starting from hello "start pointer" toohello latest log record into hello backup folder.</span></span>  <span data-ttu-id="66e60-253">Toohello en son günlük kaydı tüm hello günlük kayıtları hello yedeklemeye dahil edilir ve hello güvenilir durum Yöneticisi korur yazma tamamlanan günlük olduğundan, tüm işlemler, kaydedilmiş olduğunu hello güvenilir durum Yöneticisi garanti eder (`CommitAsync` döndürdü başarılı bir şekilde) hello yedeklemeye dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-253">Since all hello log records up toohello latest log record are included in hello backup and hello Reliable State Manager preserves write-ahead logging, hello Reliable State Manager guarantees that all transactions that are committed (`CommitAsync` has returned successfully) are included in hello backup.</span></span>

<span data-ttu-id="66e60-254">Sonra uygulayan herhangi bir işlem `BackupAsync` Mayıs adlı veya hello yedeklemeye olmayabilir.</span><span class="sxs-lookup"><span data-stu-id="66e60-254">Any transaction that commits after `BackupAsync` has been called may or may not be in hello backup.</span></span>  <span data-ttu-id="66e60-255">Merhaba yerel yedekleme klasörü hello platformu tarafından doldurulmuş sonra (yani, yerel yedekleme hello çalışma zamanı tarafından tamamlandığını), yedekleme geri çağırma hello hizmetin çağrılır.</span><span class="sxs-lookup"><span data-stu-id="66e60-255">Once hello local backup folder has been populated by hello platform (i.e., local backup is completed by hello runtime), hello service's backup callback is invoked.</span></span>  <span data-ttu-id="66e60-256">Bu geri çağırma hello yedekleme klasörü tooan Azure depolama gibi dış konuma taşımak için sorumludur.</span><span class="sxs-lookup"><span data-stu-id="66e60-256">This callback is responsible for moving hello backup folder tooan external location such as Azure Storage.</span></span>

### <a name="restore"></a><span data-ttu-id="66e60-257">Geri Yükleme</span><span class="sxs-lookup"><span data-stu-id="66e60-257">Restore</span></span>
<span data-ttu-id="66e60-258">Merhaba güvenilir durum Yöneticisi hello özelliği toorestore bir yedek kopyadan hello kullanarak sağlar `RestoreAsync` API.</span><span class="sxs-lookup"><span data-stu-id="66e60-258">hello Reliable State Manager provides hello ability toorestore from a backup by using hello `RestoreAsync` API.</span></span>  
<span data-ttu-id="66e60-259">Merhaba `RestoreAsync` yöntemi `RestoreContext` yalnızca hello içinde çağrılabilir `OnDataLossAsync` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="66e60-259">hello `RestoreAsync` method on `RestoreContext` can be called only inside hello `OnDataLossAsync` method.</span></span>
<span data-ttu-id="66e60-260">bool tarafından döndürülen hello `OnDataLossAsync` hello hizmet bir dış kaynaktan durumuna geri olup olmadığını gösterir.</span><span class="sxs-lookup"><span data-stu-id="66e60-260">hello bool returned by `OnDataLossAsync` indicates whether hello service restored its state from an external source.</span></span>
<span data-ttu-id="66e60-261">Merhaba, `OnDataLossAsync` döndürür true, Service Fabric yeniden oluşturma bu birincil diğer tüm çoğaltmalardan.</span><span class="sxs-lookup"><span data-stu-id="66e60-261">If hello `OnDataLossAsync` returns true, Service Fabric will rebuild all other replicas from this primary.</span></span> <span data-ttu-id="66e60-262">Service Fabric sağlar alacak çoğaltmaları `OnDataLossAsync` çağrısı ilk geçiş toohello birincil rolü, ancak durum verilen okuma değil ya da durum yazma.</span><span class="sxs-lookup"><span data-stu-id="66e60-262">Service Fabric ensures that replicas that will receive `OnDataLossAsync` call first transition toohello primary role but are not granted read status or write status.</span></span>
<span data-ttu-id="66e60-263">Bu, StatefulService uygulayıcılar için gelir `RunAsync` kadar çağrılmaz `OnDataLossAsync` başarıyla tamamlanır.</span><span class="sxs-lookup"><span data-stu-id="66e60-263">This implies that for StatefulService implementers, `RunAsync` will not be called until `OnDataLossAsync` finishes successfully.</span></span>
<span data-ttu-id="66e60-264">Ardından, `OnDataLossAsync` hello yeni birincil çağrılır.</span><span class="sxs-lookup"><span data-stu-id="66e60-264">Then, `OnDataLossAsync` will be invoked on hello new primary.</span></span>
<span data-ttu-id="66e60-265">Bir hizmet başarıyla (true veya false döndürerek) Bu API tamamlandıktan ve hello ilgili yeniden yapılandırma tamamlanana kadar hello API birer birer çağrılan tutmak.</span><span class="sxs-lookup"><span data-stu-id="66e60-265">Until a service completes this API successfully (by returning true or false) and finishes hello relevant reconfiguration, hello API will keep being called one at a time.</span></span>

<span data-ttu-id="66e60-266">`RestoreAsync`ilk kez çağrıldı birincil çoğaltma hello tüm mevcut durumda bırakır.</span><span class="sxs-lookup"><span data-stu-id="66e60-266">`RestoreAsync` first drops all existing state in hello primary replica that it was called on.</span></span>  
<span data-ttu-id="66e60-267">Daha sonra hello güvenilir durum Yöneticisi hello yedekleme klasörde bulunan tüm hello güvenilir nesneler oluşturur.</span><span class="sxs-lookup"><span data-stu-id="66e60-267">Then hello Reliable State Manager creates all hello Reliable objects that exist in hello backup folder.</span></span>  
<span data-ttu-id="66e60-268">Ardından, hello güvenilir belirtildiği toorestore hello yedekleme klasörü bunların denetim noktaları gelen nesneleridir.</span><span class="sxs-lookup"><span data-stu-id="66e60-268">Next, hello Reliable objects are instructed toorestore from their checkpoints in hello backup folder.</span></span>  
<span data-ttu-id="66e60-269">Son olarak, hello güvenilir durum Yöneticisi hello yedekleme klasöründe hello günlük kayıtlarından kendi durumuna kurtarır ve kurtarma işlemini gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="66e60-269">Finally, hello Reliable State Manager recovers its own state from hello log records in hello backup folder and performs recovery.</span></span>  
<span data-ttu-id="66e60-270">Merhaba kurtarma işleminin bir parçası olarak, tamamlama günlük kayıtlarını hello yedekleme klasörüne sahip hello "başlangıç noktasından" Başlangıç işlemleri yeniden yürütülmüş toohello güvenilir nesneleridir.</span><span class="sxs-lookup"><span data-stu-id="66e60-270">As part of hello recovery process, operations starting from hello "starting point" that have commit log records in hello backup folder are replayed toohello Reliable objects.</span></span>  
<span data-ttu-id="66e60-271">Bu adım, hello sağlar kurtarılan durumu tutarlı değil.</span><span class="sxs-lookup"><span data-stu-id="66e60-271">This step ensures that hello recovered state is consistent.</span></span>

## <a name="next-steps"></a><span data-ttu-id="66e60-272">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="66e60-272">Next steps</span></span>
  - [<span data-ttu-id="66e60-273">Güvenilir Koleksiyonlar</span><span class="sxs-lookup"><span data-stu-id="66e60-273">Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
  - [<span data-ttu-id="66e60-274">Güvenilir hizmetler hızlı başlangıç</span><span class="sxs-lookup"><span data-stu-id="66e60-274">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  - [<span data-ttu-id="66e60-275">Güvenilir hizmetler bildirimleri</span><span class="sxs-lookup"><span data-stu-id="66e60-275">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
  - [<span data-ttu-id="66e60-276">Güvenilir Hizmetleri Yapılandırması</span><span class="sxs-lookup"><span data-stu-id="66e60-276">Reliable Services configuration</span></span>](service-fabric-reliable-services-configuration.md)
  - [<span data-ttu-id="66e60-277">Güvenilir koleksiyonlar için Geliştirici Başvurusu</span><span class="sxs-lookup"><span data-stu-id="66e60-277">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

