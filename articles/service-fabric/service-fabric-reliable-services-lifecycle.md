---
title: "Azure Service Fabric güvenilir hizmetlerini hello yaşam döngüsünün aaaOverview | Microsoft Docs"
description: "Service Fabric güvenilir hizmetler hello farklı yaşam döngüsü olayları hakkında bilgi edinin"
services: Service-Fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: vturecek;
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 0d75ed5ee7cda85ac9af6a02e160727277804a2b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="13fb5-103">Güvenilir hizmetler yaşam döngüsüne genel bakış</span><span class="sxs-lookup"><span data-stu-id="13fb5-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="13fb5-104">Windows üzerinde C#</span><span class="sxs-lookup"><span data-stu-id="13fb5-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="13fb5-105">Linux üzerinde Java</span><span class="sxs-lookup"><span data-stu-id="13fb5-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="13fb5-106">Güvenilir hizmetler Hello yaşam döngüleri hakkında düşünürken, hello yaşam döngüsü hello temelleri hello en önemli olan.</span><span class="sxs-lookup"><span data-stu-id="13fb5-106">When thinking about hello lifecycles of Reliable Services, hello basics of hello lifecycle are hello most important.</span></span> <span data-ttu-id="13fb5-107">Genel olarak:</span><span class="sxs-lookup"><span data-stu-id="13fb5-107">In general:</span></span>

- <span data-ttu-id="13fb5-108">Başlatma sırasında</span><span class="sxs-lookup"><span data-stu-id="13fb5-108">During Startup</span></span>
  - <span data-ttu-id="13fb5-109">Hizmetleri oluşturulur</span><span class="sxs-lookup"><span data-stu-id="13fb5-109">Services are constructed</span></span>
  - <span data-ttu-id="13fb5-110">Bir fırsat tooconstruct olması ve sıfır veya daha fazla dinleyicileri Döndür</span><span class="sxs-lookup"><span data-stu-id="13fb5-110">They have an opportunity tooconstruct and return zero or more listeners</span></span>
  - <span data-ttu-id="13fb5-111">Merhaba hizmeti ile iletişimi sağlayan tüm döndürülen dinleyiciler açıldı</span><span class="sxs-lookup"><span data-stu-id="13fb5-111">Any returned listeners are opened, allowing communication with hello service</span></span>
  - <span data-ttu-id="13fb5-112">yöntemi çağrıldığında, hello hizmetin RunAsync toodo uzun süredir çalışıp hizmet hello izin verme veya iş arka plan</span><span class="sxs-lookup"><span data-stu-id="13fb5-112">hello Service's RunAsync method is called, allowing hello service toodo long running or background work</span></span>
- <span data-ttu-id="13fb5-113">Kapatma sırasında</span><span class="sxs-lookup"><span data-stu-id="13fb5-113">During shutdown</span></span>
  - <span data-ttu-id="13fb5-114">Merhaba iptal belirteci geçirilen tooRunAsync iptal edilir ve hello dinleyicileri kapalı</span><span class="sxs-lookup"><span data-stu-id="13fb5-114">hello cancellation token passed tooRunAsync is canceled, and hello listeners are closed</span></span>
  - <span data-ttu-id="13fb5-115">Bu işlem tamamlandıktan sonra destructed hello hizmeti nesnesinin kendisi</span><span class="sxs-lookup"><span data-stu-id="13fb5-115">Once that is complete, hello service object itself is destructed</span></span>

<span data-ttu-id="13fb5-116">Bu olaylar sıralama tam hello ayrıntılarla vardır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-116">There are details around hello exact ordering of these events.</span></span> <span data-ttu-id="13fb5-117">Özellikle, olayların hello sırası biraz hello güvenilir hizmet Stateless veya durum bilgisi olan olmasına bağlı olarak değişebilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-117">In particular, hello order of events may change slightly depending on whether hello Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="13fb5-118">Ayrıca, durum bilgisi olan hizmetler için toodeal hello birincil takas senaryo ile sahibiz.</span><span class="sxs-lookup"><span data-stu-id="13fb5-118">In addition, for stateful services, we have toodeal with hello Primary swap scenario.</span></span> <span data-ttu-id="13fb5-119">Bu dizisi sırasında birincil hello rolü aktarılan tooanother çoğaltma (veya geri gelir) olmadan hello hizmet kapatılıyor.</span><span class="sxs-lookup"><span data-stu-id="13fb5-119">During this sequence, hello role of Primary is transferred tooanother replica (or comes back) without hello service shutting down.</span></span> <span data-ttu-id="13fb5-120">Son olarak, hata veya hata durumları hakkında toothink sahip.</span><span class="sxs-lookup"><span data-stu-id="13fb5-120">Finally, we have toothink about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="13fb5-121">Durum bilgisiz hizmetini başlatma</span><span class="sxs-lookup"><span data-stu-id="13fb5-121">Stateless service startup</span></span>
<span data-ttu-id="13fb5-122">bir durum bilgisi olmayan hizmetin Hello yaşam döngüsü oldukça basittir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-122">hello lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="13fb5-123">Olayların hello sırası şöyledir:</span><span class="sxs-lookup"><span data-stu-id="13fb5-123">Here's hello order of events:</span></span>

1. <span data-ttu-id="13fb5-124">Merhaba hizmet oluşturulur</span><span class="sxs-lookup"><span data-stu-id="13fb5-124">hello Service is constructed</span></span>
2. <span data-ttu-id="13fb5-125">Ardından paralel iki şey olur:</span><span class="sxs-lookup"><span data-stu-id="13fb5-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="13fb5-126">`StatelessService.CreateServiceInstanceListeners()`çağrılır ve tüm döndürülen dinleyiciler açılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-126">`StatelessService.CreateServiceInstanceListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="13fb5-127">`ICommunicationListener.OpenAsync()`Her Dinleyicide çağrılır</span><span class="sxs-lookup"><span data-stu-id="13fb5-127">`ICommunicationListener.OpenAsync()` is called on each listener</span></span>
    - <span data-ttu-id="13fb5-128">Merhaba hizmetin `StatelessService.RunAsync()` yöntemi çağrılır</span><span class="sxs-lookup"><span data-stu-id="13fb5-128">hello service's `StatelessService.RunAsync()` method is called</span></span>
3. <span data-ttu-id="13fb5-129">Varsa, hizmetin hello `StatelessService.OnOpenAsync()` yöntemi çağrılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-129">If present, hello service's `StatelessService.OnOpenAsync()` method is called.</span></span> <span data-ttu-id="13fb5-130">Seyrek bir geçersiz kılma budur ancak kullanılabilir değildir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-130">This is an uncommon override, but it is available.</span></span>

<span data-ttu-id="13fb5-131">Merhaba çağrıları toocreate ve açık hello dinleyicileri ve RunAsync arasında sıralamaya olduğu önemli toonote olur.</span><span class="sxs-lookup"><span data-stu-id="13fb5-131">It is important toonote that there is no ordering between hello calls toocreate and open hello listeners and RunAsync.</span></span> <span data-ttu-id="13fb5-132">RunAsync başlatılmadan önce hello dinleyicileri açılabilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-132">hello listeners may open before RunAsync is started.</span></span> <span data-ttu-id="13fb5-133">Benzer şekilde, RunAsync hello iletişim dinleyicileri açık veya hatta oluşturulan önce çağrılan bitirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="13fb5-133">Similarly, RunAsync may end up invoked before hello communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="13fb5-134">Herhangi bir eşitleme gerekiyorsa, bir alıştırma toohello uygulayan kalır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-134">If any synchronization is required, it is left as an exercise toohello implementer.</span></span> <span data-ttu-id="13fb5-135">Yaygın çözümleri:</span><span class="sxs-lookup"><span data-stu-id="13fb5-135">Common solutions:</span></span>

  - <span data-ttu-id="13fb5-136">Bazen diğer bazı bilgiler oluşturulur veya çalışma kadar dinleyicileri çalışamaz.</span><span class="sxs-lookup"><span data-stu-id="13fb5-136">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="13fb5-137">İş genellikle başka bir konumda gibi yapılabilir durum bilgisi olmayan hizmetler için:</span><span class="sxs-lookup"><span data-stu-id="13fb5-137">For stateless services that work can usually be done in other locations, such as:</span></span> 
    - <span data-ttu-id="13fb5-138">Merhaba hizmetin Oluşturucusu</span><span class="sxs-lookup"><span data-stu-id="13fb5-138">in hello service's constructor</span></span>
    - <span data-ttu-id="13fb5-139">Merhaba sırasında `CreateServiceInstanceListeners()` çağırın</span><span class="sxs-lookup"><span data-stu-id="13fb5-139">during hello `CreateServiceInstanceListeners()` call</span></span>
    - <span data-ttu-id="13fb5-140">Merhaba dinleyicisi kendisini hello yapımı bir parçası olarak</span><span class="sxs-lookup"><span data-stu-id="13fb5-140">as a part of hello construction of hello listener itself</span></span>
  - <span data-ttu-id="13fb5-141">Merhaba dinleyicileri açık kadar bazen hello RunAsync kodda toostart istemiyor.</span><span class="sxs-lookup"><span data-stu-id="13fb5-141">Sometimes hello code in RunAsync does not want toostart until hello listeners are open.</span></span> <span data-ttu-id="13fb5-142">Bu durumda ek koordinasyon gereklidir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-142">In this case additional coordination is necessary.</span></span> <span data-ttu-id="13fb5-143">Bir ortak bunlar tamamlandığında belirten hello dinleyicileri içinde bazı bayrağı çözümüdür.</span><span class="sxs-lookup"><span data-stu-id="13fb5-143">One common solution is some flag within hello listeners indicating when they have completed.</span></span> <span data-ttu-id="13fb5-144">Bu bayrak, ardından tooactual iş devam etmeden önce RunAsync içinde denetlenir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-144">This flag is then checked in RunAsync before continuing tooactual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="13fb5-145">Durum bilgisiz hizmet kapanması</span><span class="sxs-lookup"><span data-stu-id="13fb5-145">Stateless service shutdown</span></span>
<span data-ttu-id="13fb5-146">Durum bilgisi olmayan bir hizmeti kapatılıyor, hello aynı düzeni, yalnızca geriye doğru izlenir:</span><span class="sxs-lookup"><span data-stu-id="13fb5-146">When shutting down a stateless service, hello same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="13fb5-147">Paralel olarak</span><span class="sxs-lookup"><span data-stu-id="13fb5-147">In parallel</span></span>
    - <span data-ttu-id="13fb5-148">Tüm açık dinleyiciler kapatılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-148">Any open listeners are Closed.</span></span> <span data-ttu-id="13fb5-149">`ICommunicationListener.CloseAsync()`Her dinleyici adı verilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-149">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="13fb5-150">Merhaba iptal belirteci geçirilen çok`RunAsync()` iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-150">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="13fb5-151">Denetimi hello iptal belirteci `IsCancellationRequested` özelliği true döndürür ve hello belirtecin çağrıldıklarında `ThrowIfCancellationRequested` yöntemi atar bir `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="13fb5-151">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="13fb5-152">Bir kez `CloseAsync()` her Dinleyicide tamamlandıktan ve `RunAsync()` tamamlandıktan ayrıca hello hizmetin `StatelessService.OnCloseAsync()` yöntemi çağrıldığında, varsa.</span><span class="sxs-lookup"><span data-stu-id="13fb5-152">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatelessService.OnCloseAsync()` method is called, if present.</span></span> <span data-ttu-id="13fb5-153">Seyrek toooverride olan `StatelessService.OnCloseAsync()`.</span><span class="sxs-lookup"><span data-stu-id="13fb5-153">It is uncommon toooverride `StatelessService.OnCloseAsync()`.</span></span>
3. <span data-ttu-id="13fb5-154">Sonra `StatelessService.OnCloseAsync()` tamamlandıktan hello hizmet nesnesi destructed</span><span class="sxs-lookup"><span data-stu-id="13fb5-154">After `StatelessService.OnCloseAsync()` completes, hello service object is destructed</span></span>

## <a name="stateful-service-startup"></a><span data-ttu-id="13fb5-155">Durum bilgisi olan hizmet başlatma</span><span class="sxs-lookup"><span data-stu-id="13fb5-155">Stateful service Startup</span></span>
<span data-ttu-id="13fb5-156">Durum bilgisi olan hizmetler birkaç değişikliklerle benzer bir desen toostateless Hizmetleri sahiptir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-156">Stateful services have a similar pattern toostateless services, with a few changes.</span></span> <span data-ttu-id="13fb5-157">Bir durum bilgisi olan hizmet başlatılırken olayların hello sırası aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="13fb5-157">When starting up a stateful service, hello order of events is as follows:</span></span>

1. <span data-ttu-id="13fb5-158">Merhaba hizmet oluşturulur</span><span class="sxs-lookup"><span data-stu-id="13fb5-158">hello Service is constructed</span></span>
2. <span data-ttu-id="13fb5-159">`StatefulServiceBase.OnOpenAsync()`adı verilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-159">`StatefulServiceBase.OnOpenAsync()` is called.</span></span> <span data-ttu-id="13fb5-160">Bu uncommonly hello hizmetinde geçersiz kılındı.</span><span class="sxs-lookup"><span data-stu-id="13fb5-160">This is uncommonly overridden in hello service.</span></span>
3. <span data-ttu-id="13fb5-161">Merhaba aşağıdaki paralel olarak olacaklar</span><span class="sxs-lookup"><span data-stu-id="13fb5-161">hello following things happen in parallel</span></span>
    - <span data-ttu-id="13fb5-162">`StatefulServiceBase.CreateServiceReplicaListeners()`çağrılır</span><span class="sxs-lookup"><span data-stu-id="13fb5-162">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked</span></span> 
      - <span data-ttu-id="13fb5-163">Merhaba service birincil ise tüm döndürülen dinleyicileri açılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-163">If hello service is a Primary all returned listeners are Opened.</span></span> <span data-ttu-id="13fb5-164">`ICommunicationListener.OpenAsync()`Her dinleyici adı verilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-164">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
      - <span data-ttu-id="13fb5-165">Merhaba service ikincil ise, yalnızca bu dinleyicileri olarak işaretlenmiş `ListenOnSecondary = true` açılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-165">If hello service is a Secondary, only those listeners marked as `ListenOnSecondary = true` are opened.</span></span> <span data-ttu-id="13fb5-166">İkincil üzerinde açık dinleyicileri sahip daha az yaygın bir durumdur.</span><span class="sxs-lookup"><span data-stu-id="13fb5-166">Having listeners that are open on Secondaries is less common.</span></span>
    - <span data-ttu-id="13fb5-167">Merhaba Hizmet şu anda bir birincil hello hizmetin ise hello `StatefulServiceBase.RunAsync()` yöntemi çağrılır</span><span class="sxs-lookup"><span data-stu-id="13fb5-167">hello if hello Service is currently a Primary, hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
4. <span data-ttu-id="13fb5-168">Tüm çoğaltma dinleyicisi'nın hello sonra `OpenAsync()` çağrılarını tamamlamak ve `RunAsync()` olarak adlandırılır, `StatefulServiceBase.OnChangeRoleAsync()` olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-168">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` is called, `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="13fb5-169">Bu uncommonly hello hizmetinde geçersiz kılındı.</span><span class="sxs-lookup"><span data-stu-id="13fb5-169">This is uncommonly overridden in hello service.</span></span>

<span data-ttu-id="13fb5-170">Benzer şekilde toostateless Hizmetleri hangi hello dinleyicileri oluşturulur ve açılan hello sipariş arasında hiçbir düzenlemesi yoktur ve RunAsync zaman çağrılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-170">Similarly toostateless services, there's no coordination between hello order in which hello listeners are created and opened and when RunAsync is called.</span></span> <span data-ttu-id="13fb5-171">Düzenleme gerekiyorsa, hello çözümleri olan çok hello aynı.</span><span class="sxs-lookup"><span data-stu-id="13fb5-171">If you need coordination, hello solutions are much hello same.</span></span> <span data-ttu-id="13fb5-172">Bir ek söz konusu değildir: hello iletişim dinleyicileri ulaşan hello çağrılar bazı içinde tutulur Bilgi gerektirir söyleyin [güvenilir koleksiyonları](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="13fb5-172">THere is one additional case: say that hello calls arriving at hello communication listeners require information kept inside some [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="13fb5-173">Hello iletişim dinleyicileri açamadı. önce Hello güvenilir koleksiyonları okunabilir veya yazılabilir olduğundan ve RunAsync başlamadan önce bazı ek koordinasyon gereklidir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-173">Because hello communication listeners could open before hello reliable collections are readable or writeable, and before RunAsync could start, some additional coordination is necessary.</span></span> <span data-ttu-id="13fb5-174">Merhaba basit ve en yaygın çözümü hello iletişim dinleyicileri tooreturn için istemci kullanır tooknow tooretry hello istek hello bazı hata kodudur.</span><span class="sxs-lookup"><span data-stu-id="13fb5-174">hello simplest and most common solution is for hello communication listeners tooreturn some error code that hello client uses tooknow tooretry hello request.</span></span>

## <a name="stateful-service-shutdown"></a><span data-ttu-id="13fb5-175">Durum bilgisi olan hizmet kapatma</span><span class="sxs-lookup"><span data-stu-id="13fb5-175">Stateful service Shutdown</span></span>
<span data-ttu-id="13fb5-176">Benzer şekilde tooStateless Hizmetleri hello yaşam döngüsü olayları kapatma sırasında aynı şekilde başlatılırken hello olsa da tersine.</span><span class="sxs-lookup"><span data-stu-id="13fb5-176">Similarly tooStateless services, hello lifecycle events during shutdown are hello same as during startup, but reversed.</span></span> <span data-ttu-id="13fb5-177">Durum bilgisi olan hizmet kapatılıyor hello aşağıdaki olaylar oluşur:</span><span class="sxs-lookup"><span data-stu-id="13fb5-177">When a stateful service is being shut down, hello following events occur:</span></span>

1. <span data-ttu-id="13fb5-178">Paralel olarak</span><span class="sxs-lookup"><span data-stu-id="13fb5-178">In parallel</span></span>
    - <span data-ttu-id="13fb5-179">Tüm açık dinleyiciler kapatılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-179">Any open listeners are Closed.</span></span> <span data-ttu-id="13fb5-180">`ICommunicationListener.CloseAsync()`Her dinleyici adı verilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-180">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="13fb5-181">Merhaba iptal belirteci geçirilen çok`RunAsync()` iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-181">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="13fb5-182">Denetimi hello iptal belirteci `IsCancellationRequested` özelliği true döndürür ve hello belirtecin çağrıldıklarında `ThrowIfCancellationRequested` yöntemi atar bir `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="13fb5-182">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="13fb5-183">Bir kez `CloseAsync()` her Dinleyicide tamamlandıktan ve `RunAsync()` tamamlandıktan ayrıca hello hizmetin `StatefulServiceBase.OnChangeRoleAsync()` olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-183">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="13fb5-184">(Bu uncommonly hello hizmetinde geçersiz kılınır.)</span><span class="sxs-lookup"><span data-stu-id="13fb5-184">(This is uncommonly overridden in hello service.)</span></span>
    - <span data-ttu-id="13fb5-185">RunAsync için bekleyen toocomplete yalnızca bu hizmeti çoğaltma birincil ise gereklidir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-185">Waiting for RunAsync toocomplete is only necessary if this service replica was a Primary.</span></span>
3. <span data-ttu-id="13fb5-186">Bir kez hello `StatefulServiceBase.OnChangeRoleAsync()` yöntemi tamamlayan, hello `StatefulServiceBase.OnCloseAsync()` yöntemi çağrılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-186">Once hello `StatefulServiceBase.OnChangeRoleAsync()` method completes, hello `StatefulServiceBase.OnCloseAsync()` method is called.</span></span> <span data-ttu-id="13fb5-187">Seyrek bir geçersiz kılma budur ancak kullanılabilir değildir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-187">This is an uncommon override, but it is available.</span></span>
3. <span data-ttu-id="13fb5-188">Sonra `StatefulServiceBase.OnCloseAsync()` tamamlandıktan hello hizmet nesnesi destructed.</span><span class="sxs-lookup"><span data-stu-id="13fb5-188">After `StatefulServiceBase.OnCloseAsync()` completes, hello service object is destructed.</span></span>

## <a name="stateful-service-primary-swaps"></a><span data-ttu-id="13fb5-189">Durum bilgisi olan hizmet birincil değiştirir</span><span class="sxs-lookup"><span data-stu-id="13fb5-189">Stateful service primary swaps</span></span>
<span data-ttu-id="13fb5-190">Durum bilgisi olan hizmet çalışırken, yalnızca hello durum bilgisi olan hizmet birincil çoğaltmalarının açılan kendi iletişim dinleyicileri ve adlı kendi RunAsync yöntemi vardır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-190">While a stateful service is running, only hello Primary replicas of that stateful services have their communication listeners opened and their RunAsync method called.</span></span> <span data-ttu-id="13fb5-191">İkincil oluşturulur ancak hiçbir sonraki çağrılar bakın.</span><span class="sxs-lookup"><span data-stu-id="13fb5-191">Secondary are constructed but see no further calls.</span></span> <span data-ttu-id="13fb5-192">Durum bilgisi olan hizmet ancak çalışırken, hangi şu anda hello birincil çoğaltmadır değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="13fb5-192">While a stateful service is running however, which replica is currently hello Primary can change.</span></span> <span data-ttu-id="13fb5-193">Bu ne bir çoğaltma görebilirsiniz hello yaşam döngüsü olayları şartlarında anlama geliyor? Merhaba davranışı hello durum bilgisi olan çoğaltma görür hello çoğaltma veya indirgenir hello takas sırasında yükseltilmiş olmasından bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-193">What does this mean in terms of hello lifecycle events that a replica can see? hello behavior hello stateful replica sees depends on whether it is hello replica being demoted or promoted during hello swap.</span></span>

### <a name="for-hello-primary-being-demoted"></a><span data-ttu-id="13fb5-194">Merhaba indirgenen birincil</span><span class="sxs-lookup"><span data-stu-id="13fb5-194">For hello primary being demoted</span></span>
<span data-ttu-id="13fb5-195">Service Fabric iletileri işleme Bu çoğaltma toostop gerekiyor ve yapmakta olduğu herhangi bir arka plan iş çıkın.</span><span class="sxs-lookup"><span data-stu-id="13fb5-195">Service Fabric needs this replica toostop processing messages and quit any background work it is doing.</span></span> <span data-ttu-id="13fb5-196">Sonuç olarak, bu adım görünüyor benzer toowhen hello hizmet kapatılıyor.</span><span class="sxs-lookup"><span data-stu-id="13fb5-196">As a result, this step looks similar toowhen hello service is being shut down.</span></span> <span data-ttu-id="13fb5-197">Hizmet değil veya destructed ikincil olarak kalır beri kapalı bu hello bir farktır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-197">One difference is that hello Service isn't destructed or closed since it remains as a Secondary.</span></span> <span data-ttu-id="13fb5-198">API'ler aşağıdaki hello çağrılır:</span><span class="sxs-lookup"><span data-stu-id="13fb5-198">hello following APIs are called:</span></span>

1. <span data-ttu-id="13fb5-199">Paralel olarak</span><span class="sxs-lookup"><span data-stu-id="13fb5-199">In parallel</span></span>
    - <span data-ttu-id="13fb5-200">Tüm açık dinleyiciler kapatılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-200">Any open listeners are Closed.</span></span> <span data-ttu-id="13fb5-201">`ICommunicationListener.CloseAsync()`Her dinleyici adı verilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-201">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="13fb5-202">Merhaba iptal belirteci geçirilen çok`RunAsync()` iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-202">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="13fb5-203">Denetimi hello iptal belirteci `IsCancellationRequested` özelliği true döndürür ve hello belirtecin çağrıldıklarında `ThrowIfCancellationRequested` yöntemi atar bir `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="13fb5-203">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="13fb5-204">Bir kez `CloseAsync()` her Dinleyicide tamamlandıktan ve `RunAsync()` tamamlandıktan ayrıca hello hizmetin `StatefulServiceBase.OnChangeRoleAsync()` olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-204">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="13fb5-205">Bu uncommonly hello hizmetinde geçersiz kılındı.</span><span class="sxs-lookup"><span data-stu-id="13fb5-205">This is uncommonly overridden in hello service.</span></span>

### <a name="for-hello-secondary-being-promoted"></a><span data-ttu-id="13fb5-206">Merhaba yükseltilmekte ikincil</span><span class="sxs-lookup"><span data-stu-id="13fb5-206">For hello secondary being promoted</span></span>
<span data-ttu-id="13fb5-207">Benzer şekilde, Service Fabric hello hat üzerinde iletiler için dinleme Bu çoğaltma toostart gerekiyor ve ilgili cares herhangi bir arka plan görevi başlatın.</span><span class="sxs-lookup"><span data-stu-id="13fb5-207">Similarly, Service Fabric needs this replica toostart listening for messages on hello wire and start any background tasks it cares about.</span></span> <span data-ttu-id="13fb5-208">Sonuç olarak, benzer toowhen hello hizmeti oluşturulur, bu işlem görünüyor dışında hello yineleme kendisini zaten mevcut.</span><span class="sxs-lookup"><span data-stu-id="13fb5-208">As a result, this process looks similar toowhen hello service is created, except that hello replica itself already exists.</span></span> <span data-ttu-id="13fb5-209">API'ler aşağıdaki hello çağrılır:</span><span class="sxs-lookup"><span data-stu-id="13fb5-209">hello following APIs are called:</span></span>

1. <span data-ttu-id="13fb5-210">Paralel olarak</span><span class="sxs-lookup"><span data-stu-id="13fb5-210">In parallel</span></span>
    - <span data-ttu-id="13fb5-211">`StatefulServiceBase.CreateServiceReplicaListeners()`çağrılır ve tüm döndürülen dinleyiciler açılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-211">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="13fb5-212">`ICommunicationListener.OpenAsync()`Her dinleyici adı verilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-212">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="13fb5-213">Merhaba hizmetin `StatefulServiceBase.RunAsync()` yöntemi çağrılır</span><span class="sxs-lookup"><span data-stu-id="13fb5-213">hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
2. <span data-ttu-id="13fb5-214">Tüm çoğaltma dinleyicisi'nın hello sonra `OpenAsync()` çağrılarını tamamlamak ve `RunAsync()` çağrıldı, `StatefulServiceBase.OnChangeRoleAsync()` olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-214">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` has been called,  `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="13fb5-215">Bu uncommonly hello hizmetinde geçersiz kılındı.</span><span class="sxs-lookup"><span data-stu-id="13fb5-215">This is uncommonly overridden in hello service.</span></span>

### <a name="common-issues-during-stateful-service-shutdown-and-primary-demotion"></a><span data-ttu-id="13fb5-216">Durum bilgisi olan hizmet kapanması ve birincil indirgeme sırasında ortak sorunlar</span><span class="sxs-lookup"><span data-stu-id="13fb5-216">Common issues during stateful service shutdown and primary demotion</span></span>
<span data-ttu-id="13fb5-217">Service Fabric değişiklikleri birincil bir durum bilgisi olan hizmet çeşitli nedenlerle hello.</span><span class="sxs-lookup"><span data-stu-id="13fb5-217">Service Fabric changes hello Primary of a stateful service for a variety of reasons.</span></span> <span data-ttu-id="13fb5-218">Merhaba en yaygın olan [küme dengelenmesi](service-fabric-cluster-resource-manager-balancing.md) ve [uygulama yükseltme](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="13fb5-218">hello most common are [cluster rebalancing](service-fabric-cluster-resource-manager-balancing.md) and [application upgrade](service-fabric-application-upgrade.md).</span></span> <span data-ttu-id="13fb5-219">Bu işlemleri sırasında (yanı sıra hello hizmeti silinmiş olup olmadığını göreceğiniz gibi normal hizmet kapatma sırasında), önemlidir, hello hizmet saygı hello `CancellationToken`.</span><span class="sxs-lookup"><span data-stu-id="13fb5-219">During these operations (as well as during normal service shutdown, like you'd see if hello service was deleted), it is important that hello service respect hello `CancellationToken`.</span></span> <span data-ttu-id="13fb5-220">İptal düzgün bir şekilde işleyemez Hizmetleri birkaç sorunlarıyla karşılaşırsınız.</span><span class="sxs-lookup"><span data-stu-id="13fb5-220">Services that do not handle cancellation cleanly will experience several issues.</span></span> <span data-ttu-id="13fb5-221">Service Fabric hello Hizmetleri toostop için düzgün biçimde bekler özellikle, bu işlemlerin yavaş olur.</span><span class="sxs-lookup"><span data-stu-id="13fb5-221">In particular, these operations will be slow since Service Fabric waits for hello services toostop gracefully.</span></span> <span data-ttu-id="13fb5-222">Sonuç olarak bu zaman aşımı toofailed yükseltmeler sağlama ve geri alma olabilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-222">This can ultimately lead toofailed upgrades that time out and roll back.</span></span> <span data-ttu-id="13fb5-223">Hata toohonor hello iptal belirteci de neden olabilir imbalanced küme düğümleri etkin alır ancak hello Hizmetleri olamaz yeniden dengelenir uzun toomove sürdüğünü beri olduğundan bunları başka bir yerde.</span><span class="sxs-lookup"><span data-stu-id="13fb5-223">Failure toohonor hello cancellation token can also cause imbalanced clusters because nodes get hot but hello services can't be rebalanced since it takes too long toomove them elsewhere.</span></span> 

<span data-ttu-id="13fb5-224">Merhaba hizmetler durum bilgisi olduğundan, ayrıca hello kullanıyorsanız büyük olasılıkla [güvenilir koleksiyonları](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="13fb5-224">Since hello services are stateful, it is also likely that they are using hello [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="13fb5-225">Birincil indirgenir, Service Fabric içinde gerçekleşen hello ilk şey yazma erişimi toohello alttaki durumu iptal edilmediğini biridir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-225">In Service Fabric, when a Primary is demoted, one of hello first things that happens is that write access toohello underlying state is revoked.</span></span> <span data-ttu-id="13fb5-226">Bu tooa ikinci hello hizmet yaşam döngüsü etkileyebilir sorun kümesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="13fb5-226">This leads tooa second set of issues that can impact hello service lifecycle.</span></span> <span data-ttu-id="13fb5-227">dönüş özel durumlar hello zamanlama ve hello çoğaltma olup taşındığı göre hello koleksiyonları veya kapat.</span><span class="sxs-lookup"><span data-stu-id="13fb5-227">hello collections return Exceptions based on hello timing and whether hello replica is being moved or shut down.</span></span> <span data-ttu-id="13fb5-228">Bu özel durumlar doğru yapılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-228">These exceptions should be handled correctly.</span></span> <span data-ttu-id="13fb5-229">Service Fabric tarafından oluşturulan özel durumları kalan kalıcı [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) ve geçici [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) kategoriler.</span><span class="sxs-lookup"><span data-stu-id="13fb5-229">Exceptions thrown by Service Fabric fall into permanent [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) and transient [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) categories.</span></span> <span data-ttu-id="13fb5-230">Kalıcı özel durumları günlüğe ve bazı yeniden deneme mantığına göre hello geçici özel durumlar denenen ancak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="13fb5-230">Permanent exceptions should be logged and thrown, while hello transient exceptions may be retried based on some retry logic.</span></span>

<span data-ttu-id="13fb5-231">Merhaba kullanımdan gelen hello özel durumları işleme `ReliableCollections` hizmet yaşam döngüsü olayları ile birlikte test etme ve güvenilir bir hizmeti doğrulanıyor önemli bir parçasıdır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-231">Handling hello exceptions that come from use of hello `ReliableCollections` in conjunction with service lifecycle events is an important part of testing and validating a Reliable Service.</span></span> <span data-ttu-id="13fb5-232">Merhaba öneri her zaman yükseltme gerçekleştirilirken toorun hizmetinizi yük altında olduğu ve [chaos sınama](service-fabric-controlled-chaos.md) hiç tooproduction dağıtmadan önce.</span><span class="sxs-lookup"><span data-stu-id="13fb5-232">hello recommendation is always toorun your service under load while performing upgrades and [chaos testing](service-fabric-controlled-chaos.md) before ever deploying tooproduction.</span></span> <span data-ttu-id="13fb5-233">Bu temel adımları hizmetinizin doğru uygulanır ve yaşam döngüsü olayları doğru olarak işler sağlamaya yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="13fb5-233">These basic steps help ensure that your service is correctly implemented and handles lifecycle events correctly.</span></span>


## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="13fb5-234">Hizmet yaşam döngüsü ile ilgili notlar</span><span class="sxs-lookup"><span data-stu-id="13fb5-234">Notes on service lifecycle</span></span>
  - <span data-ttu-id="13fb5-235">Her iki hello `RunAsync()` yöntemi ve hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` çağrıları isteğe bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-235">Both hello `RunAsync()` method and hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="13fb5-236">Bir hizmeti bunları, her ikisini birden veya hiçbiri olabilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-236">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="13fb5-237">Örneğin, hello hizmet yanıt toouser çağrıları tüm işlerini varsa, gerek yoktur, için tooimplement `RunAsync()`.</span><span class="sxs-lookup"><span data-stu-id="13fb5-237">For example, if hello service does all its work in response toouser calls, there is no need for it tooimplement `RunAsync()`.</span></span> <span data-ttu-id="13fb5-238">Yalnızca hello iletişim dinleyicileri ve bunların ilişkili kodu gereklidir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-238">Only hello communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="13fb5-239">Benzer şekilde, oluşturma ve iletişim dinleyicileri döndürme hello hizmeti yalnızca toodo iş arka plan seçilmiş olabilir isteğe bağlıdır ve yalnızca tooimplement bekliyor`RunAsync()`</span><span class="sxs-lookup"><span data-stu-id="13fb5-239">Similarly, creating and returning communication listeners is optional, as hello service may have only background work toodo, and so only needs tooimplement `RunAsync()`</span></span>
  - <span data-ttu-id="13fb5-240">Hizmet toocomplete için geçerli `RunAsync()` başarıyla ve dönüş almaktır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-240">It is valid for a service toocomplete `RunAsync()` successfully and return from it.</span></span> <span data-ttu-id="13fb5-241">Tamamlanıyor bir hata durumu değil.</span><span class="sxs-lookup"><span data-stu-id="13fb5-241">Completing is not a failure condition.</span></span> <span data-ttu-id="13fb5-242">Tamamlanıyor `RunAsync()` hello hizmetinin hello arka plan çalışması tamamlandı gösterir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-242">Completing `RunAsync()` indicates that hello background work of hello service has completed.</span></span> <span data-ttu-id="13fb5-243">Durum bilgisi olan güvenilir hizmetler için `RunAsync()` hello çoğaltma birincil tooSecondary indirgendi ve geri tooPrimary yükseltilmiş yeniden adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-243">For stateful reliable services, `RunAsync()` is called again if hello replica were demoted from Primary tooSecondary and then promoted back tooPrimary.</span></span>
  - <span data-ttu-id="13fb5-244">Gelen bir hizmet bulunup bulunmadığını `RunAsync()` bazı beklenmeyen bir özel durum atma tarafından bu bir hata oluşturduğunu.</span><span class="sxs-lookup"><span data-stu-id="13fb5-244">If a service exits from `RunAsync()` by throwing some unexpected exception, this constitutes a failure.</span></span> <span data-ttu-id="13fb5-245">Merhaba hizmet nesnesi kapatılır ve bir sistem durumu hatası bildirdi.</span><span class="sxs-lookup"><span data-stu-id="13fb5-245">hello service object is shut down and a health error reported.</span></span>
  - <span data-ttu-id="13fb5-246">Varken hiçbir zaman sınırı bu yöntemlerden döndürme, hemen hello özelliği toowrite tooReliable koleksiyonları kaybeder ve bu nedenle herhangi bir gerçek iş tamamlayamıyor.</span><span class="sxs-lookup"><span data-stu-id="13fb5-246">While there is no time limit on returning from these methods, you immediately lose hello ability toowrite tooReliable Collections and therefore cannot complete any real work.</span></span> <span data-ttu-id="13fb5-247">Merhaba iptal isteği aldıktan sonra hızlı bir şekilde olabildiğince dönüş önerilir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-247">It is recommended that you return as quickly as possible upon receiving hello cancellation request.</span></span> <span data-ttu-id="13fb5-248">Hizmetiniz bir makul sürede Service Fabric zorla olabilir toothese API çağrıları yanıt vermezse, hizmetiniz sonlanır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-248">If your service does not respond toothese API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="13fb5-249">Genellikle yalnızca uygulama yükseltmelerini ya da hizmet zaman siliniyor sırasında meydana gelir.</span><span class="sxs-lookup"><span data-stu-id="13fb5-249">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="13fb5-250">Bu zaman aşımı, varsayılan değer 15 dakikadır.</span><span class="sxs-lookup"><span data-stu-id="13fb5-250">This timeout is 15 minutes by default.</span></span>
  - <span data-ttu-id="13fb5-251">Merhaba hatalarına `OnCloseAsync()` yolu sonucunda `OnAbort()` hello için bir son olasılığı en yüksek çaba fırsat olduğu çağrılan hizmet tooclean yukarı ve talep tüm kaynakları serbest bırakmak.</span><span class="sxs-lookup"><span data-stu-id="13fb5-251">Failures in hello `OnCloseAsync()` path result in `OnAbort()` being called which is a last-chance best-effort opportunity for hello service tooclean up and release any resources that they have claimed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="13fb5-252">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="13fb5-252">Next steps</span></span>
- [<span data-ttu-id="13fb5-253">Giriş tooReliable Hizmetleri</span><span class="sxs-lookup"><span data-stu-id="13fb5-253">Introduction tooReliable Services</span></span>](service-fabric-reliable-services-introduction.md)
- [<span data-ttu-id="13fb5-254">Güvenilir hizmetler hızlı başlangıç</span><span class="sxs-lookup"><span data-stu-id="13fb5-254">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
- [<span data-ttu-id="13fb5-255">Kullanım Gelişmiş güvenilir hizmetler</span><span class="sxs-lookup"><span data-stu-id="13fb5-255">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
