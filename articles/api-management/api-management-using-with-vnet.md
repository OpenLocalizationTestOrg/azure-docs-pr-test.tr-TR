---
title: "Sanal ağlarla aaaHow toouse Azure API Yönetimi"
description: "Toosetup bir bağlantı tooa sanal ağında Azure API Management ve erişim web üzerinden hizmetleri nasıl öğrenin."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="a046c-103">Nasıl toouse Azure API Management ile sanal ağlar</span><span class="sxs-lookup"><span data-stu-id="a046c-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="a046c-104">Azure sanal ağlar (Vnet'ler) herhangi birini Azure kaynaklarınızı denetim Internet olmayan routeable ağ erişimi tooplace izin verin.</span><span class="sxs-lookup"><span data-stu-id="a046c-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="a046c-105">Bu ağlar sonra çeşitli VPN teknolojilerini kullanarak bağlı tooyour şirket içi ağlar olabilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="a046c-106">Azure sanal ağlar hakkında daha fazla Başlat burada hello bilgilerle toolearn: [Azure Virtual Network'e genel bakış](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a046c-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="a046c-107">Merhaba ağından arka uç hizmetlerini erişebilmesi için azure API Management hello sanal ağ (VNET) içinde dağıtılabilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="a046c-108">Geliştirici Portalı ve API ağ geçidi Merhaba, yapılandırılmış toobe hello Internet ya da yalnızca hello sanal ağ içinde erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="a046c-109">Azure API Management hem Klasik hem de Azure Kaynak Yöneticisi sanal ağlar destekler.</span><span class="sxs-lookup"><span data-stu-id="a046c-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="a046c-110"><a name="enable-vpn"></a>Etkinleştir VNET bağlantısı</span><span class="sxs-lookup"><span data-stu-id="a046c-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="a046c-111">VNET bağlantısı hello kullanılabilir **Premium** ve **Geliştirici** katmanları.</span><span class="sxs-lookup"><span data-stu-id="a046c-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="a046c-112">Merhaba katmanları arasında tooswitch API Management hizmetiniz hello Azure portalını açın, sonra hello açın **ölçek ve fiyatlandırma** sekmesi. Merhaba altında **fiyatlandırma katmanı** bölümünde hello Premium veya Geliştirici katmanı seçin ve Kaydet'i tıklatın.</span><span class="sxs-lookup"><span data-stu-id="a046c-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="a046c-113">tooenable VNET bağlantısı, API Management hizmetiniz hello Azure portalını açın ve açmak hello **sanal ağ** sayfası.</span><span class="sxs-lookup"><span data-stu-id="a046c-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Sanal ağ menü API Yönetimi][api-management-using-vnet-menu]

<span data-ttu-id="a046c-115">İstenen hello erişim türünü seçin:</span><span class="sxs-lookup"><span data-stu-id="a046c-115">Select hello desired access type:</span></span>

* <span data-ttu-id="a046c-116">**Dış**: hello API Yönetimi ağ geçidi ve Geliştirici Portalı erişilebilir ortak Internet üzerinden bir dış yük dengeleyici hello.</span><span class="sxs-lookup"><span data-stu-id="a046c-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="a046c-117">Merhaba ağ geçidi hello sanal ağ içindeki kaynaklara erişebilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-117">hello gateway can access resources within hello virtual network.</span></span>

![Ortak eşleme][api-management-vnet-public]

* <span data-ttu-id="a046c-119">**İç**: hello API Yönetimi ağ geçidi ve Geliştirici Portalı bir iç yük dengeleyici aracılığıyla hello sanal ağ içinde yalnızca üzerinden erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="a046c-120">Merhaba ağ geçidi hello sanal ağ içindeki kaynaklara erişebilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-120">hello gateway can access resources within hello virtual network.</span></span>

![Özel eşleme][api-management-vnet-private]

<span data-ttu-id="a046c-122">API Management hizmetiniz burada sağlanan tüm bölgelerin bir listesi şimdi görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="a046c-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="a046c-123">VNET ve her bölge için alt ağ seçin.</span><span class="sxs-lookup"><span data-stu-id="a046c-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="a046c-124">Merhaba liste Klasik ve Resource Manager yapılandırmakta olduğunuz hello bölgede kurulmuş, Azure aboneliklerinize bulunan sanal ağlar ile doldurulur.</span><span class="sxs-lookup"><span data-stu-id="a046c-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="a046c-125">**Hizmet uç noktası** Ağ Geçidi/Proxy, yayımcı portalında, Geliştirici Portalı, GIT ve hello doğrudan yönetim uç noktası diyagramı yukarıda hello içerir.</span><span class="sxs-lookup"><span data-stu-id="a046c-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="a046c-126">**Yönetim uç noktası** hello diyagramı yukarıda yer hello hizmet toomanage yapılandırması Azure portal ve Powershell aracılığıyla barındırılan hello uç noktası.</span><span class="sxs-lookup"><span data-stu-id="a046c-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="a046c-127">Ayrıca, aşağıdakilere dikkat edin, hello diyagramı IP adreslerini çeşitli uç için API Management hizmeti göstermektedir olsa bile, **yalnızca** üzerinde yapılandırılmış kendi ana bilgisayar adları yanıt verir.</span><span class="sxs-lookup"><span data-stu-id="a046c-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a046c-128">Bir Azure API Management örneği tooa Resource Manager VNET'i dağıtırken hello hizmeti Azure API Management örnekleri dışında başka kaynaklar içeren özel bir alt ağda olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="a046c-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="a046c-129">Bir Azure API Management örneği tooa içeren diğer kaynaklar, hello dağıtım Resource Manager VNET'i alt girişimde toodeploy başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="a046c-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![VPN seçin][api-management-setup-vpn-select]

<span data-ttu-id="a046c-131">Tıklatın **kaydetmek** Merhaba ekranında hello üstünde.</span><span class="sxs-lookup"><span data-stu-id="a046c-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="a046c-132">Merhaba VIP adresi hello API Management örneğinin VNET etkin veya devre dışı her zaman değiştirir.</span><span class="sxs-lookup"><span data-stu-id="a046c-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="a046c-133">Merhaba VIP adresi API Management gelen taşındığında da değiştirir **dış** çok**dahili** veya tersi</span><span class="sxs-lookup"><span data-stu-id="a046c-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="a046c-134">API Management bir sanal ağdan kaldırın veya bir içinde dağıtılan hello değiştirin, daha önce kullanılan VNET kalabileceği hello için too4 saatleri kilitli.</span><span class="sxs-lookup"><span data-stu-id="a046c-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="a046c-135">Bu süre boyunca bu değil olası toodelete hello VNET veya kaldırılacak yeni bir kaynak tooit dağıtın.</span><span class="sxs-lookup"><span data-stu-id="a046c-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="a046c-136"><a name="enable-vnet-powershell"></a>PowerShell cmdlet'lerini kullanarak etkinleştir VNET bağlantısı</span><span class="sxs-lookup"><span data-stu-id="a046c-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="a046c-137">VNET bağlantısı hello PowerShell cmdlet'lerini kullanarak da etkinleştirebilirsiniz</span><span class="sxs-lookup"><span data-stu-id="a046c-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="a046c-138">**Bir sanal ağ içinde bir API Management hizmeti oluşturma**: hello cmdlet'ini kullanın [yeni AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate VNET içinde bir Azure API Management hizmeti.</span><span class="sxs-lookup"><span data-stu-id="a046c-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="a046c-139">**VNET içinde varolan bir API Management hizmetini dağıtma**: hello cmdlet'ini kullanın [güncelleştirme AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove bir sanal ağ içinde var olan bir Azure API Management hizmeti.</span><span class="sxs-lookup"><span data-stu-id="a046c-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="a046c-140"><a name="connect-vnet"></a>Bir sanal ağ içinde barındırılan tooa web hizmetine bağlanma</span><span class="sxs-lookup"><span data-stu-id="a046c-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="a046c-141">API Management hizmetiniz bağlı toohello VNET sonra içindeki arka uç hizmetlerine erişme ortak Hizmetleri erişimden çok farklı değildir.</span><span class="sxs-lookup"><span data-stu-id="a046c-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="a046c-142">Yalnızca hello hello yerel IP adresi veya web hizmeti (DNS sunucusu VNET hello için yapılandırılmışsa) hello ana bilgisayar adı yazın **Web hizmeti URL'si** alan yeni bir API oluştururken veya var olan bir düzenleme.</span><span class="sxs-lookup"><span data-stu-id="a046c-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![VPN bağlantısını API ekleme][api-management-setup-vpn-add-api]

## <span data-ttu-id="a046c-144"><a name="network-configuration-issues"></a>Ortak ağ yapılandırma sorunları</span><span class="sxs-lookup"><span data-stu-id="a046c-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="a046c-145">Sanal ağınıza API Management hizmeti dağıtırken oluşabilecek yaygın yetersizliğini sorunların bir listesi verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="a046c-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="a046c-146">**Özel DNS Sunucusu Kurulumu**: hello API Management hizmeti üzerinde çeşitli Azure hizmetlerine bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="a046c-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="a046c-147">API Management, özel bir DNS sunucusu ile bir VNET içinde barındırıldığında Azure hizmetlerin tooresolve hello ana bilgisayar adı gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="a046c-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="a046c-148">Lütfen izleyin [bu](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) özel DNS kurulumu hakkında yönergeler.</span><span class="sxs-lookup"><span data-stu-id="a046c-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="a046c-149">Hello bağlantı noktalarını tabloda ve diğer ağ gereksinimleri başvuru konusuna bakın.</span><span class="sxs-lookup"><span data-stu-id="a046c-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a046c-150">Merhaba VNET özel DNS sunucularını kullanıyorsanız, ayarladığınız, önerilen **önce** içine bir API Management hizmeti dağıtma.</span><span class="sxs-lookup"><span data-stu-id="a046c-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="a046c-151">Aksi takdirde, çok hello API Management hizmeti hello DNS sunucuları (s) değiştirdiğinizde hello çalıştırarak güncelleştirmeniz [ağ yapılandırma işlemi Uygula](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="a046c-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="a046c-152">**API yönetimi için gereken bağlantı noktaları**: gelen ve giden trafik API Management dağıtıldığı hello alt içine kullanılarak denetlenebilir [ağ güvenlik grubu][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="a046c-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="a046c-153">Bu bağlantı noktalarının hiçbirinde yoksa, API Management düzgün çalışmayabilir ve erişilemez duruma gelebilir.</span><span class="sxs-lookup"><span data-stu-id="a046c-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="a046c-154">Bir veya daha fazla engellenen Bu bağlantı noktalarına sahip başka bir ortak yetersizliğini API Management bir VNET ile birlikte kullanırken bir sorundur.</span><span class="sxs-lookup"><span data-stu-id="a046c-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="a046c-155">API Management hizmet örneği sanal ağ içinde barındırıldığında, aşağıdaki tablonun hello hello bağlantı noktaları kullanılır.</span><span class="sxs-lookup"><span data-stu-id="a046c-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="a046c-156">Kaynak / hedef bağlantı noktaları</span><span class="sxs-lookup"><span data-stu-id="a046c-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="a046c-157">Yön</span><span class="sxs-lookup"><span data-stu-id="a046c-157">Direction</span></span> | <span data-ttu-id="a046c-158">Aktarım Protokolü</span><span class="sxs-lookup"><span data-stu-id="a046c-158">Transport protocol</span></span> | <span data-ttu-id="a046c-159">Amaç</span><span class="sxs-lookup"><span data-stu-id="a046c-159">Purpose</span></span> | <span data-ttu-id="a046c-160">Kaynak / hedef</span><span class="sxs-lookup"><span data-stu-id="a046c-160">Source / Destination</span></span> | <span data-ttu-id="a046c-161">Erişim türü</span><span class="sxs-lookup"><span data-stu-id="a046c-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="a046c-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="a046c-162">* / 80, 443</span></span> |<span data-ttu-id="a046c-163">Gelen</span><span class="sxs-lookup"><span data-stu-id="a046c-163">Inbound</span></span> |<span data-ttu-id="a046c-164">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-164">TCP</span></span> |<span data-ttu-id="a046c-165">İstemci iletişimi tooAPI Yönetimi</span><span class="sxs-lookup"><span data-stu-id="a046c-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="a046c-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a046c-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a046c-167">Dış</span><span class="sxs-lookup"><span data-stu-id="a046c-167">External</span></span> |
| <span data-ttu-id="a046c-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="a046c-168">* / 3443</span></span> |<span data-ttu-id="a046c-169">Gelen</span><span class="sxs-lookup"><span data-stu-id="a046c-169">Inbound</span></span> |<span data-ttu-id="a046c-170">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-170">TCP</span></span> |<span data-ttu-id="a046c-171">Azure portalı ve Powershell yönetim uç noktası</span><span class="sxs-lookup"><span data-stu-id="a046c-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="a046c-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a046c-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a046c-173">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-173">External & Internal</span></span> |
| <span data-ttu-id="a046c-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="a046c-174">* / 80, 443</span></span> |<span data-ttu-id="a046c-175">Giden</span><span class="sxs-lookup"><span data-stu-id="a046c-175">Outbound</span></span> |<span data-ttu-id="a046c-176">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-176">TCP</span></span> |<span data-ttu-id="a046c-177">Azure depolama ve Azure hizmet veri yolu bağımlılığı</span><span class="sxs-lookup"><span data-stu-id="a046c-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="a046c-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="a046c-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a046c-179">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-179">External & Internal</span></span> |
| <span data-ttu-id="a046c-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="a046c-180">* / 1433</span></span> |<span data-ttu-id="a046c-181">Giden</span><span class="sxs-lookup"><span data-stu-id="a046c-181">Outbound</span></span> |<span data-ttu-id="a046c-182">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-182">TCP</span></span> |<span data-ttu-id="a046c-183">Azure SQL bağımlılığı</span><span class="sxs-lookup"><span data-stu-id="a046c-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="a046c-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="a046c-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a046c-185">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-185">External & Internal</span></span> |
| <span data-ttu-id="a046c-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="a046c-186">* / 11000 - 11999</span></span> |<span data-ttu-id="a046c-187">Giden</span><span class="sxs-lookup"><span data-stu-id="a046c-187">Outbound</span></span> |<span data-ttu-id="a046c-188">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-188">TCP</span></span> |<span data-ttu-id="a046c-189">Azure SQL V12 bağımlılığı</span><span class="sxs-lookup"><span data-stu-id="a046c-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="a046c-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="a046c-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a046c-191">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-191">External & Internal</span></span> |
| <span data-ttu-id="a046c-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="a046c-192">* / 14000 - 14999</span></span> |<span data-ttu-id="a046c-193">Giden</span><span class="sxs-lookup"><span data-stu-id="a046c-193">Outbound</span></span> |<span data-ttu-id="a046c-194">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-194">TCP</span></span> |<span data-ttu-id="a046c-195">Azure SQL V12 bağımlılığı</span><span class="sxs-lookup"><span data-stu-id="a046c-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="a046c-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="a046c-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a046c-197">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-197">External & Internal</span></span> |
| <span data-ttu-id="a046c-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="a046c-198">* / 5671</span></span> |<span data-ttu-id="a046c-199">Giden</span><span class="sxs-lookup"><span data-stu-id="a046c-199">Outbound</span></span> |<span data-ttu-id="a046c-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="a046c-200">AMQP</span></span> |<span data-ttu-id="a046c-201">Bağımlılık günlük tooEvent Hub İlkesi ve İzleme Aracısı</span><span class="sxs-lookup"><span data-stu-id="a046c-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="a046c-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="a046c-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a046c-203">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-203">External & Internal</span></span> |
| <span data-ttu-id="a046c-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="a046c-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="a046c-205">Gelen ve giden</span><span class="sxs-lookup"><span data-stu-id="a046c-205">Inbound & Outbound</span></span> |<span data-ttu-id="a046c-206">UDP</span><span class="sxs-lookup"><span data-stu-id="a046c-206">UDP</span></span> |<span data-ttu-id="a046c-207">Redis önbelleği bağımlılığı</span><span class="sxs-lookup"><span data-stu-id="a046c-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="a046c-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a046c-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a046c-209">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-209">External & Internal</span></span> |-
| <span data-ttu-id="a046c-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="a046c-210">* / 445</span></span> |<span data-ttu-id="a046c-211">Giden</span><span class="sxs-lookup"><span data-stu-id="a046c-211">Outbound</span></span> |<span data-ttu-id="a046c-212">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-212">TCP</span></span> |<span data-ttu-id="a046c-213">Azure dosya paylaşımı için GIT bağımlılığı</span><span class="sxs-lookup"><span data-stu-id="a046c-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="a046c-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="a046c-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a046c-215">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-215">External & Internal</span></span> |
| <span data-ttu-id="a046c-216">* / *</span><span class="sxs-lookup"><span data-stu-id="a046c-216">* / *</span></span> | <span data-ttu-id="a046c-217">Gelen</span><span class="sxs-lookup"><span data-stu-id="a046c-217">Inbound</span></span> |<span data-ttu-id="a046c-218">TCP</span><span class="sxs-lookup"><span data-stu-id="a046c-218">TCP</span></span> |<span data-ttu-id="a046c-219">Azure altyapı yük dengeleyici</span><span class="sxs-lookup"><span data-stu-id="a046c-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="a046c-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a046c-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a046c-221">Dış & iç</span><span class="sxs-lookup"><span data-stu-id="a046c-221">External & Internal</span></span> |

* <span data-ttu-id="a046c-222">**SSL işlevselliği**: tooenable SSL sertifika zinciri oluşturma ve doğrulama hello API Management hizmeti, giden ağ bağlantısı tooocsp.msocsp.com, mscrl.microsoft.com ve crl.microsoft.com gerekiyor. Merhaba tam zincir toohello CA kök tooAPI yönetim karşıya yüklediğiniz herhangi bir sertifika içeriyorsa, bu bağımlılık gerekli değil.</span><span class="sxs-lookup"><span data-stu-id="a046c-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="a046c-223">**DNS erişim**: DNS sunucuları ile iletişim için bağlantı noktası 53 giden erişim gereklidir.</span><span class="sxs-lookup"><span data-stu-id="a046c-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="a046c-224">Özel bir DNS sunucusu üzerinde varsa bir VPN ağ geçidi diğer ucundaki Merhaba, hello DNS Sunucusu API Management barındırma hello alt ağ üzerinden erişilebilir olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="a046c-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="a046c-225">**Ölçümleri ve sistem durumu izleme**: hangi etki alanları aşağıdaki hello altında çözmek giden ağ bağlantısı tooAzure izleme uç noktaları,: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="a046c-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="a046c-226">**Hızlı rota Kurulum**: genel bir müşteri yapılandırma toodefine giden Internet trafiği tooinstead akış içi zorlar kendi varsayılan yol (0.0.0.0/0) olacaktır.</span><span class="sxs-lookup"><span data-stu-id="a046c-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="a046c-227">Bu trafik akışı neredeyse şaşmaz biçimde hello giden trafiği ya da engellenen şirket içi veya NAT tooan tanınmayan artık çeşitli Azure uç noktaları ile çalışma adresleri kümesini 'd olduğundan Azure API Management ile bağlantısını keser.</span><span class="sxs-lookup"><span data-stu-id="a046c-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="a046c-228">Merhaba toodefine bir (veya daha fazla) kullanıcı tanımlı yollar çözümdür ([Udr'ler][UDRs]) hello Azure API Management içeren hello alt ağdaki.</span><span class="sxs-lookup"><span data-stu-id="a046c-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="a046c-229">Bir UDR hello varsayılan yol yerine uyulacaktır alt özel yollar tanımlar.</span><span class="sxs-lookup"><span data-stu-id="a046c-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="a046c-230">Mümkünse, bu yapılandırma aşağıdaki toouse hello önerilir:</span><span class="sxs-lookup"><span data-stu-id="a046c-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="a046c-231">Merhaba ExpressRoute yapılandırma 0.0.0.0/0 tanıtır ve varsayılan olarak tüm giden trafiği şirket içi zorlamalı tünel oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a046c-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="a046c-232">Merhaba uygulanan UDR toohello alt ağ Hello Azure API Management içeren Internet sonraki atlama türü olan 0.0.0.0/0 tanımlar.</span><span class="sxs-lookup"><span data-stu-id="a046c-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="a046c-233">Merhaba birleşik bu adımları hello alt düzey UDR hello böylece Azure API Management hello giden Internet erişimden sağlama zorlanan tünel, ExpressRoute üzerinden öncelik kazanır etkisidir.</span><span class="sxs-lookup"><span data-stu-id="a046c-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="a046c-234">Azure API Management ile ExpressRoute yapılandırmaları desteklenmez, **yanlış cross-hello ortak eşleme yolu toohello özel eşleme yolu yolları tanıtma**.</span><span class="sxs-lookup"><span data-stu-id="a046c-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="a046c-235">Yapılandırılmış, ortak eşleme sahip ExpressRoute yapılandırmaları alacağı Yol tanıtımlarını Microsoft'tan çok sayıda Microsoft Azure IP adres aralıkları için.</span><span class="sxs-lookup"><span data-stu-id="a046c-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="a046c-236">Bu adres aralıklarını yanlış cross-hello özel eşleme yoluna tanıtılan varsa, hello sonuç tüm giden ağ paketlerinin hello Azure API Management örneğinin alt ağdan hatalı zorlamalı tünel tooa müşterinin şirket içi ağ olmasıdır Altyapı.</span><span class="sxs-lookup"><span data-stu-id="a046c-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="a046c-237">Bu ağ akışı Azure API Management keser.</span><span class="sxs-lookup"><span data-stu-id="a046c-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="a046c-238">Merhaba ortak eşleme yolu toohello özel eşleme yolu toostop arası reklam yolları Hello çözüm toothis sorunudur.</span><span class="sxs-lookup"><span data-stu-id="a046c-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="a046c-239"><a name="troubleshooting"></a>Sorunlarını giderme</span><span class="sxs-lookup"><span data-stu-id="a046c-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="a046c-240">Değişiklikleri tooyour ağ yaparken çok başvuran[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), hello API Management hizmeti erişim tooany Merhaba, bağlı olduğu kritik kaynaklara değil kaybederse toovalidate.</span><span class="sxs-lookup"><span data-stu-id="a046c-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="a046c-241">Merhaba bağlantı durumunun her 15 dakikada güncelleştirilmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="a046c-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="a046c-242"><a name="limitations"></a>Sınırlamaları</span><span class="sxs-lookup"><span data-stu-id="a046c-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="a046c-243">API Management örnekleri içeren bir alt ağ başka bir Azure kaynak türleri içeremez.</span><span class="sxs-lookup"><span data-stu-id="a046c-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="a046c-244">Merhaba alt ağı ve hello API Management hizmeti olması gerekir. aynı abonelik hello.</span><span class="sxs-lookup"><span data-stu-id="a046c-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="a046c-245">API Management örnekleri içeren bir alt ağ, abonelikler arasında taşınamaz.</span><span class="sxs-lookup"><span data-stu-id="a046c-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="a046c-246">Merhaba aralığı iç IP adresi kullanılabilir yalnızca bir iç sanal ağ kullanırken, belirtilen [RFC 1918](https://tools.ietf.org/html/rfc1918), bir ortak IP adresi sağlanamaz.</span><span class="sxs-lookup"><span data-stu-id="a046c-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="a046c-247">Bölgeli API Management dağıtımları için yapılandırılmış, iç sanal ağlar ile kullanıcılar, kendi yük hello DNS oldukları gibi Dengeleme yönetmek için sorumludur.</span><span class="sxs-lookup"><span data-stu-id="a046c-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="a046c-248"><a name="related-content"></a>İlgili içerik</span><span class="sxs-lookup"><span data-stu-id="a046c-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="a046c-249">VPN ağ geçidi kullanarak bir sanal ağ toobackend bağlanma</span><span class="sxs-lookup"><span data-stu-id="a046c-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="a046c-250">Farklı dağıtım modelinden bir sanal ağa bağlanma</span><span class="sxs-lookup"><span data-stu-id="a046c-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="a046c-251">Azure API Management'te toouse hello API denetçisi tootrace nasıl çağırır</span><span class="sxs-lookup"><span data-stu-id="a046c-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
