---
title: "aaaAzure Active Directory kimlik doğrulama ve Resource Manager | Microsoft Docs"
description: "Bir uygulama başka Azure abonelikleri ile tümleştirmek için bir Geliştirici Kılavuzu tooauthentication hello Azure Kaynak Yöneticisi API'si ve Azure Active Directory ile."
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 757e45fdb28488b45de70647746461888bf35a56
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="use-resource-manager-authentication-api-tooaccess-subscriptions"></a><span data-ttu-id="bd80a-103">Resource Manager kimlik doğrulaması API'sini tooaccess abonelikleri kullanın</span><span class="sxs-lookup"><span data-stu-id="bd80a-103">Use Resource Manager authentication API tooaccess subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="bd80a-104">Giriş</span><span class="sxs-lookup"><span data-stu-id="bd80a-104">Introduction</span></span>
<span data-ttu-id="bd80a-105">Toocreate müşterinin Azure kaynaklarını yöneten uygulama gereken bir yazılım geliştirici varsa, bu konuda nasıl tooauthenticate ile Azure Resource Manager API'leri hello ve diğer abonelikler erişim tooresources geçirmesine gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-105">If you are a software developer who needs toocreate an app that manages customer's Azure resources, this topic shows you how tooauthenticate with hello Azure Resource Manager APIs and gain access tooresources in other subscriptions.</span></span>

<span data-ttu-id="bd80a-106">Uygulamanızı hello çeşitli şekillerde Resource Manager API'leri erişebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="bd80a-106">Your app can access hello Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="bd80a-107">**Kullanıcı + uygulama erişimi**: oturum açmış bir kullanıcı adına kaynaklara uygulamalar için.</span><span class="sxs-lookup"><span data-stu-id="bd80a-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="bd80a-108">Bu yaklaşım, web uygulamaları ve yalnızca "Etkileşimli Yönetimi" Azure kaynakları ile ilgili komut satırı araçları gibi uygulamalar için çalışır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="bd80a-109">**Yalnızca uygulama erişim**: arka plan programı Hizmetleri ve zamanlanmış işler çalışan uygulamalar için.</span><span class="sxs-lookup"><span data-stu-id="bd80a-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="bd80a-110">Merhaba uygulamanın kimliğini toohello kaynaklarına doğrudan erişim verilir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-110">hello app's identity is granted direct access toohello resources.</span></span> <span data-ttu-id="bd80a-111">Bu yaklaşım, uzun vadeli gözetimsiz (katılımsız) erişim tooAzure gerektiren uygulamalar için çalışır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-111">This approach works for apps that need long-term headless (unattended) access tooAzure.</span></span>

<span data-ttu-id="bd80a-112">Bu konu hakkında adım adım yönergeler toocreate her iki yetkilendirme yöntemi kullanan bir uygulama sağlar.</span><span class="sxs-lookup"><span data-stu-id="bd80a-112">This topic provides step-by-step instructions toocreate an app that employs both these authorization methods.</span></span> <span data-ttu-id="bd80a-113">Bunu nasıl tooperform her adım REST API veya C# ile gösterilir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-113">It shows how tooperform each step with REST API or C#.</span></span> <span data-ttu-id="bd80a-114">Merhaba tam ASP.NET MVC uygulaması kullanılabilir [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="bd80a-114">hello complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-hello-web-app-does"></a><span data-ttu-id="bd80a-115">Hangi hello web uygulaması yapar</span><span class="sxs-lookup"><span data-stu-id="bd80a-115">What hello web app does</span></span>
<span data-ttu-id="bd80a-116">Merhaba web uygulaması:</span><span class="sxs-lookup"><span data-stu-id="bd80a-116">hello web app:</span></span>

1. <span data-ttu-id="bd80a-117">Bir Azure kullanıcı oturum açtığında.</span><span class="sxs-lookup"><span data-stu-id="bd80a-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="bd80a-118">Kullanıcı toogrant hello web uygulama erişim tooResource Yöneticisi sorar.</span><span class="sxs-lookup"><span data-stu-id="bd80a-118">Asks user toogrant hello web app access tooResource Manager.</span></span>
3. <span data-ttu-id="bd80a-119">Resource Manager erişmek için kullanıcı + uygulama erişim belirtecini alır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="bd80a-120">(3. adım) belirtecine toocall Resource Manager ve ata hello uygulamanın hizmet asıl tooa rolü hello uygulama uzun vadeli erişim toohello abonelik verir hello abonelikte kullanır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-120">Uses token (from step 3) toocall Resource Manager and assign hello app's service principal tooa role in hello subscription, which gives hello app long-term access toohello subscription.</span></span>
5. <span data-ttu-id="bd80a-121">Yalnızca uygulama erişim belirtecini alır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="bd80a-122">(5. adım) belirtecine toomanage kaynakları hello abonelik Kaynak Yöneticisi'ni kullanır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-122">Uses token (from step 5) toomanage resources in hello subscription through Resource Manager.</span></span>

<span data-ttu-id="bd80a-123">Merhaba uçtan uca akış hello web uygulamasının aşağıdadır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-123">Here's hello end-to-end flow of hello web application.</span></span>

![Kaynak Yöneticisi kimlik doğrulama akışı](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="bd80a-125">Bir kullanıcı olarak sağladığınız hello abonelik kimliği toouse istediğiniz hello abonelik için:</span><span class="sxs-lookup"><span data-stu-id="bd80a-125">As a user, you provide hello subscription id for hello subscription you want toouse:</span></span>

![Abonelik kimliği sağlayın](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="bd80a-127">Oturum açma için hello hesap toouse seçin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-127">Select hello account toouse for logging in.</span></span>

![hesabı seçin](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="bd80a-129">Kimlik bilgilerinizi sağlayın.</span><span class="sxs-lookup"><span data-stu-id="bd80a-129">Provide your credentials.</span></span>

![kimlik bilgilerini sağlayın](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="bd80a-131">Merhaba uygulama erişim tooyour Azure abonelikleri verin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-131">Grant hello app access tooyour Azure subscriptions:</span></span>

![Erişim verme](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="bd80a-133">Bağlı aboneliklerinizi yönetin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-133">Manage your connected subscriptions:</span></span>

![Abonelik Bağlan](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="bd80a-135">Uygulamayı Kaydet</span><span class="sxs-lookup"><span data-stu-id="bd80a-135">Register application</span></span>
<span data-ttu-id="bd80a-136">Kodlama başlamadan önce web uygulamanızı Azure Active Directory (AD ile) kaydedin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="bd80a-137">Merhaba uygulama kaydı Azure AD'de, uygulamanız için merkezi bir kimliği oluşturur.</span><span class="sxs-lookup"><span data-stu-id="bd80a-137">hello app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="bd80a-138">Uygulamanızı tooauthenticate ve erişim Azure Resource Manager API'leri kullanır uygulamanız OAuth istemci kimliği, yanıt URL'leri ve kimlik bilgileri gibi ilgili temel bilgileri tutar.</span><span class="sxs-lookup"><span data-stu-id="bd80a-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses tooauthenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="bd80a-139">Merhaba uygulama kaydı ayrıca çeşitli Microsoft APIs hello kullanıcı adına erişirken uygulamanız gereken izinleri atanmış hello kaydeder.</span><span class="sxs-lookup"><span data-stu-id="bd80a-139">hello app registration also records hello various delegated permissions that your application needs when accessing Microsoft APIs on behalf of hello user.</span></span>

<span data-ttu-id="bd80a-140">Uygulamanızı diğer abonelik eriştiği için bir çok kiracılı uygulama olarak yapılandırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="bd80a-141">toopass doğrulama, Azure Active Directory ile ilişkilendirilmiş bir etki alanı belirtin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-141">toopass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="bd80a-142">toosee hello etki alanları toohello günlüğünde, Azure Active Directory ile ilişkili [Klasik portal](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="bd80a-142">toosee hello domains associated with your Azure Active Directory, log in toohello [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="bd80a-143">Azure Active Directory'yi seçin ve ardından **etki alanları**.</span><span class="sxs-lookup"><span data-stu-id="bd80a-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="bd80a-144">Aşağıdaki örnek hello nasıl tooregister hello uygulama Azure PowerShell kullanarak gösterir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-144">hello following example shows how tooregister hello app by using Azure PowerShell.</span></span> <span data-ttu-id="bd80a-145">Hello için en son sürümünü (Ağustos 2016) Azure PowerShell Bu komut toowork olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-145">You must have hello latest version (August 2016) of Azure PowerShell for this command toowork.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="bd80a-146">Merhaba AD uygulaması olarak toolog içinde hello uygulama kimliği ve parola gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-146">toolog in as hello AD application, you need hello application id and password.</span></span> <span data-ttu-id="bd80a-147">Merhaba önceki komuttan, kullanım döndürülen toosee hello uygulama kimliği:</span><span class="sxs-lookup"><span data-stu-id="bd80a-147">toosee hello application id that is returned from hello previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="bd80a-148">Aşağıdaki örnek hello nasıl tooregister hello uygulama Azure CLI kullanarak gösterir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-148">hello following example shows how tooregister hello app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="bd80a-149">Merhaba sonuçları hello Merhaba uygulaması doğrulanırken ihtiyacınız AppID içerir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-149">hello results include hello AppId, which you need when authenticating as hello application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="bd80a-150">İsteğe bağlı yapılandırma - sertifika kimlik bilgisi</span><span class="sxs-lookup"><span data-stu-id="bd80a-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="bd80a-151">Azure AD uygulamaları için de sertifika kimlik bilgileri destekler: otomatik olarak imzalanan bir sertifika oluşturun, hello özel anahtarı tutmak ve hello ortak anahtar tooyour Azure AD uygulama kaydı ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep hello private key, and add hello public key tooyour Azure AD application registration.</span></span> <span data-ttu-id="bd80a-152">Kimlik doğrulaması için bir küçük yükü tooAzure özel anahtarınızı kullanarak imzalanmış AD ve Azure AD kaydettiğiniz hello ortak anahtarı kullanılarak hello imzayı doğrular, uygulamanızın gönderir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-152">For authentication, your application sends a small payload tooAzure AD signed using your private key, and Azure AD validates hello signature using hello public key that you registered.</span></span>

<span data-ttu-id="bd80a-153">Bir sertifika ile AD uygulaması oluşturma hakkında daha fazla bilgi için bkz [kullanım Azure PowerShell toocreate bir hizmet sorumlusu tooaccess kaynakları](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) veya [kullanım Azure CLI toocreate bir hizmet sorumlusu tooaccess kaynakları](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="bd80a-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="bd80a-154">Abonelik kimliği Kiracı kimliğinizi alma</span><span class="sxs-lookup"><span data-stu-id="bd80a-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="bd80a-155">toorequest kullanılan toocall Resource Manager olabilir bir belirteç, tooknow hello Kiracı kimliği hello Azure aboneliği barındıran hello Azure AD Kiracı uygulamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-155">toorequest a token that can be used toocall Resource Manager, your application needs tooknow hello tenant ID of hello Azure AD tenant that hosts hello Azure subscription.</span></span> <span data-ttu-id="bd80a-156">Büyük olasılıkla, kullanıcılarınızın abonelik kimlikleri biliyorum, ancak bunlar kendi Kiracı kimlikleri için Azure Active Directory anlamayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bd80a-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="bd80a-157">tooget hello abonelik kimliği için isteyin hello kullanıcı hello kullanıcının Kiracı kimliği. Bu abonelik kimliği hello abonelik ilgili bir istek gönderirken sağlar:</span><span class="sxs-lookup"><span data-stu-id="bd80a-157">tooget hello user's tenant id, ask hello user for hello subscription id. Provide that subscription id when sending a request about hello subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="bd80a-158">Merhaba isteği hello kullanıcı henüz oturum açmasını değil, ancak hello Kiracı kimliği hello yanıt almak için başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="bd80a-158">hello request fails because hello user has not logged in yet, but you can retrieve hello tenant id from hello response.</span></span> <span data-ttu-id="bd80a-159">Bu özel durum için hello yanıt üstbilgisi değeri hello Kiracı Kimliği almak **WWW-Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="bd80a-159">In that exception, retrieve hello tenant id from hello response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="bd80a-160">Bu hello uygulamasında gördüğünüz [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) yöntemi.</span><span class="sxs-lookup"><span data-stu-id="bd80a-160">You see this implementation in hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="bd80a-161">Kullanıcı + uygulama erişim belirteci alın</span><span class="sxs-lookup"><span data-stu-id="bd80a-161">Get user + app access token</span></span>
<span data-ttu-id="bd80a-162">Uygulamanız hello kullanıcı tooAzure AD bir OAuth 2.0 yetkilendirme isteği - tooauthenticate hello kullanıcının kimlik bilgileri ile yeniden yönlendirir ve bir kimlik doğrulama kodu dönebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bd80a-162">Your application redirects hello user tooAzure AD with an OAuth 2.0 Authorize Request - tooauthenticate hello user's credentials and get back an authorization code.</span></span> <span data-ttu-id="bd80a-163">Uygulamanız için kaynak yöneticisi hello yetkilendirme kodu tooget bir erişim belirteci kullanır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-163">Your application uses hello authorization code tooget an access token for Resource Manager.</span></span> <span data-ttu-id="bd80a-164">Merhaba [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) yöntemi hello yetkilendirme isteği oluşturur.</span><span class="sxs-lookup"><span data-stu-id="bd80a-164">hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates hello authorization request.</span></span>

<span data-ttu-id="bd80a-165">Bu konu hello REST API istekleri tooauthenticate hello kullanıcı gösterir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-165">This topic shows hello REST API requests tooauthenticate hello user.</span></span> <span data-ttu-id="bd80a-166">Kodunuzda Yardımcısı kitaplıkları tooperform kimlik doğrulaması de kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bd80a-166">You can also use helper libraries tooperform authentication in your code.</span></span> <span data-ttu-id="bd80a-167">Bu kitaplıklar hakkında daha fazla bilgi için bkz: [Azure Active Directory kimlik doğrulama kitaplıkları](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="bd80a-167">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="bd80a-168">Kimlik Yönetimi uygulamada tümleştirme ile ilgili yönergeler için bkz: [Azure Active Directory Geliştirici Kılavuzu](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="bd80a-168">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="bd80a-169">Kimlik doğrulama isteği (OAuth 2.0)</span><span class="sxs-lookup"><span data-stu-id="bd80a-169">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="bd80a-170">Açık Bağlan/OAuth2.0 yetkilendirmek istek kimliği toohello Azure AD Authorize son nokta yürütün:</span><span class="sxs-lookup"><span data-stu-id="bd80a-170">Issue an Open ID Connect/OAuth2.0 Authorize Request toohello Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="bd80a-171">Bu istek için kullanılabilir hello sorgu dizesi parametreleri hello açıklanan [bir kimlik doğrulama kodu isteme](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) konu.</span><span class="sxs-lookup"><span data-stu-id="bd80a-171">hello query string parameters that are available for this request are described in hello [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="bd80a-172">örnekte gösterildiği nasıl aşağıdaki hello toorequest OAuth2.0 yetkilendirme:</span><span class="sxs-lookup"><span data-stu-id="bd80a-172">hello following example shows how toorequest OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="bd80a-173">Azure AD hello kullanıcının kimliğini doğrular ve gerekirse, hello kullanıcı toogrant izin toohello uygulama sorar.</span><span class="sxs-lookup"><span data-stu-id="bd80a-173">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="bd80a-174">Merhaba yetkilendirme kodu toohello, uygulamanızın yanıt URL'si döndürür.</span><span class="sxs-lookup"><span data-stu-id="bd80a-174">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="bd80a-175">Merhaba bağlı olarak response_mode, verileri sorgu dizesi veya gönderme verisi olarak da gönderir geri hello Azure AD istedi.</span><span class="sxs-lookup"><span data-stu-id="bd80a-175">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="bd80a-176">Kimlik doğrulama isteği (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="bd80a-176">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="bd80a-177">Bir açık bağlanma yetkisi istek kimliği, yalnızca tooaccess Azure Resource Manager hello kullanıcı adına istiyor, ancak Ayrıca kendi Azure AD hesabını kullanarak tooyour uygulamada hello kullanıcı toosign izin verin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-177">If you not only wish tooaccess Azure Resource Manager on behalf of hello user, but also allow hello user toosign in tooyour application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="bd80a-178">Open ID Connect ile uygulamanızı uygulamanızı hello kullanıcı toosign kullanabileceğiniz Azure AD'den bir id_token de alır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-178">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use toosign in hello user.</span></span>

<span data-ttu-id="bd80a-179">Bu istek için kullanılabilir hello sorgu dizesi parametreleri hello açıklanan [oturum açma gönderme hello isteği](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) konu.</span><span class="sxs-lookup"><span data-stu-id="bd80a-179">hello query string parameters that are available for this request are described in hello [Send hello sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="bd80a-180">Bir örnek Open ID Connect isteğidir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-180">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="bd80a-181">Azure AD hello kullanıcının kimliğini doğrular ve gerekirse, hello kullanıcı toogrant izin toohello uygulama sorar.</span><span class="sxs-lookup"><span data-stu-id="bd80a-181">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="bd80a-182">Merhaba yetkilendirme kodu toohello, uygulamanızın yanıt URL'si döndürür.</span><span class="sxs-lookup"><span data-stu-id="bd80a-182">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="bd80a-183">Merhaba bağlı olarak response_mode, verileri sorgu dizesi veya gönderme verisi olarak da gönderir geri hello Azure AD istedi.</span><span class="sxs-lookup"><span data-stu-id="bd80a-183">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

<span data-ttu-id="bd80a-184">Open ID Connect yanıt örneğidir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-184">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="bd80a-185">Belirteç isteği (OAuth2.0 kod Grant akış)</span><span class="sxs-lookup"><span data-stu-id="bd80a-185">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="bd80a-186">Uygulamanızı Azure AD'den hello yetkilendirme kodu aldı, zaman tooget hello erişim belirteci için Azure Resource Manager var.</span><span class="sxs-lookup"><span data-stu-id="bd80a-186">Now that your application has received hello authorization code from Azure AD, it is time tooget hello access token for Azure Resource Manager.</span></span>  <span data-ttu-id="bd80a-187">Bir OAuth2.0 kod Grant belirteç isteği toohello Azure AD belirteç uç noktası gönderin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-187">Post an OAuth2.0 Code Grant Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="bd80a-188">Bu istek için kullanılabilir hello sorgu dizesi parametreleri hello açıklanan [hello yetkilendirme kodu kullanın](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) konu.</span><span class="sxs-lookup"><span data-stu-id="bd80a-188">hello query string parameters that are available for this request are described in hello [use hello authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="bd80a-189">Aşağıdaki örneğine hello kod grant belirteci parola kimlik bilgisi için bir istek gösterir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-189">hello following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="bd80a-190">Sertifika kimlik bilgileri ile çalışırken, bir JSON Web Token (JWT) ve uygulamanızın sertifika kimlik bilgisi özel anahtarı hello kullanarak oturum (RSA SHA256) oluşturun.</span><span class="sxs-lookup"><span data-stu-id="bd80a-190">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using hello private key of your application's certificate credential.</span></span> <span data-ttu-id="bd80a-191">Merhaba hello belirteci için talep türleri gösterilir [JWT belirteci taleplerini](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="bd80a-191">hello claim types for hello token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="bd80a-192">Başvuru için bkz: Merhaba [Active Directory kimlik doğrulama kitaplığı (.NET) kod](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign istemci onaylama JWT belirteçleri.</span><span class="sxs-lookup"><span data-stu-id="bd80a-192">For reference, see hello [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="bd80a-193">Merhaba bkz [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) istemci kimlik doğrulaması hakkında ayrıntılı bilgi için.</span><span class="sxs-lookup"><span data-stu-id="bd80a-193">See hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="bd80a-194">Aşağıdaki örneğine hello kod grant belirteciyle sertifika kimlik bilgisi için bir istek gösterir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-194">hello following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="bd80a-195">Bir örnek yanıt kodu için belirteç verin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-195">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="bd80a-196">Kod grant belirteç yanıtı işlemek</span><span class="sxs-lookup"><span data-stu-id="bd80a-196">Handle code grant token response</span></span>
<span data-ttu-id="bd80a-197">Başarılı bir token yanıt için Azure Resource Manager hello (kullanıcı + uygulama) erişim belirteci içeriyor.</span><span class="sxs-lookup"><span data-stu-id="bd80a-197">A successful token response contains hello (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="bd80a-198">Uygulamanız hello kullanıcı adına bu erişim belirteci tooaccess Kaynak Yöneticisi'ni kullanır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-198">Your application uses this access token tooaccess Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="bd80a-199">Azure AD tarafından verilen erişim belirteçleri Hello yaşam süresi bir saattir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-199">hello lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="bd80a-200">Web uygulamanızı toorenew hello (kullanıcı + uygulama) erişim belirtecine ihtiyaç duyduğu düşüktür.</span><span class="sxs-lookup"><span data-stu-id="bd80a-200">It is unlikely that your web application needs toorenew hello (user + app) access token.</span></span> <span data-ttu-id="bd80a-201">Toorenew hello erişim belirteci alması gerekiyorsa, uygulamanızın hello belirteci yanıtta alır hello yenileme belirteci kullanın.</span><span class="sxs-lookup"><span data-stu-id="bd80a-201">If it needs toorenew hello access token, use hello refresh token that your application receives in hello token response.</span></span> <span data-ttu-id="bd80a-202">Bir OAuth2.0 belirteci isteği toohello Azure AD belirteç uç noktası gönderin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-202">Post an OAuth2.0 Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="bd80a-203">Merhaba parametreleri toouse hello yenileme isteği ile açıklanan [yenileme hello erişim belirteci](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="bd80a-203">hello parameters toouse with hello refresh request are described in [refreshing hello access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="bd80a-204">Merhaba aşağıdaki örnekte nasıl toouse hello yenileme belirteci gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-204">hello following example shows how toouse hello refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="bd80a-205">Yenileme belirteçleri kullanılan tooget yeni erişim belirteçleri için Azure Resource Manager olsa da, bunlar uygulamanızı çevrimdışı erişmek için uygun değildir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-205">Although refresh tokens can be used tooget new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="bd80a-206">Merhaba yenileme belirteçleri ömrü sınırlı olduğunu ve yenileme belirteçleri ilişkili toohello kullanıcı.</span><span class="sxs-lookup"><span data-stu-id="bd80a-206">hello refresh tokens lifetime is limited, and refresh tokens are bound toohello user.</span></span> <span data-ttu-id="bd80a-207">Merhaba kullanıcı hello kuruluş bırakırsa hello yenileme belirtecini kullanarak hello uygulama erişim kaybeder.</span><span class="sxs-lookup"><span data-stu-id="bd80a-207">If hello user leaves hello organization, hello application using hello refresh token loses access.</span></span> <span data-ttu-id="bd80a-208">Bu yaklaşım olan uygulamalar için uygun değil Azure kaynaklarını takımlar toomanage tarafından kullanılır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-208">This approach isn't suitable for applications that are used by teams toomanage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-toosubscription"></a><span data-ttu-id="bd80a-209">Kullanıcı erişim toosubscription atamaktır denetleyin</span><span class="sxs-lookup"><span data-stu-id="bd80a-209">Check if user can assign access toosubscription</span></span>
<span data-ttu-id="bd80a-210">Uygulamanız artık Azure Resource Manager hello kullanıcı adına bir belirteç tooaccess sahiptir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-210">Your application now has a token tooaccess Azure Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="bd80a-211">Merhaba sonraki adım, uygulama toohello aboneliğinizin tooconnect olduğunu.</span><span class="sxs-lookup"><span data-stu-id="bd80a-211">hello next step is tooconnect your app toohello subscription.</span></span> <span data-ttu-id="bd80a-212">Merhaba kullanıcı mevcut değilse bile bağladıktan sonra uygulamanızı bu abonelikleri yönetebilirsiniz (uzun süreli çevrimdışı erişim).</span><span class="sxs-lookup"><span data-stu-id="bd80a-212">After connecting, your app can manage those subscriptions even when hello user isn't present (long-term offline access).</span></span>

<span data-ttu-id="bd80a-213">Her abonelik tooconnect için hello çağrısı [Resource Manager liste izinlerini](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine hello kullanıcı hello abonelik için erişim yönetim haklarına sahip olup olmadığını belirler.</span><span class="sxs-lookup"><span data-stu-id="bd80a-213">For each subscription tooconnect, call hello [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine whether hello user has access management rights for hello subscription.</span></span>

<span data-ttu-id="bd80a-214">Merhaba [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) yöntemi hello ASP.NET MVC örnek uygulaması, bu çağrıyı uygular.</span><span class="sxs-lookup"><span data-stu-id="bd80a-214">hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of hello ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="bd80a-215">örnekte gösterildiği nasıl aşağıdaki hello toorequest bir abonelik bir kullanıcının izinleri.</span><span class="sxs-lookup"><span data-stu-id="bd80a-215">hello following example shows how toorequest a user's permissions on a subscription.</span></span> <span data-ttu-id="bd80a-216">83cfe939-2402-4581-b761-4f59b0a041e4 hello hello abonelik kimliğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-216">83cfe939-2402-4581-b761-4f59b0a041e4 is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="bd80a-217">Abonelik hello yanıt tooget kullanıcının izinlerini örneğidir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-217">An example of hello response tooget user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="bd80a-218">Merhaba izinleri API birden çok izin verir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-218">hello permissions API returns multiple permissions.</span></span> <span data-ttu-id="bd80a-219">Her izin izin verilen eylemleri (Eylemler) oluşur ve eylemleri (notactions) izin verilmiyor.</span><span class="sxs-lookup"><span data-stu-id="bd80a-219">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="bd80a-220">Herhangi bir izni eylemler listesi izin hello bir eylem varsa ve bu izni hello notactions listesinde, hello kullanıcı yoksa tooperform Bu eyleme izin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-220">If an action is present in hello allowed actions list of any permission and not present in hello notactions list of that permission, hello user is allowed tooperform that action.</span></span> <span data-ttu-id="bd80a-221">**Microsoft.Authorization/roleassignments/Write** hello eylem, yönetim haklarına erişim verir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-221">**microsoft.authorization/roleassignments/write** is hello action that that grants access management rights.</span></span> <span data-ttu-id="bd80a-222">Uygulamanızı hello izinleri sonuç toolook regex eşleşme hello eylemleri ve her izin notactions Bu eylem dizesini ayrıştırma gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-222">Your application must parse hello permissions result toolook for a regex match on this action string in hello actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="bd80a-223">Yalnızca uygulama erişim belirteci alma</span><span class="sxs-lookup"><span data-stu-id="bd80a-223">Get app-only access token</span></span>
<span data-ttu-id="bd80a-224">Şimdi, Hello kullanıcı erişimi toohello Azure aboneliği atayabilirsiniz varsa bilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bd80a-224">Now, you know if hello user can assign access toohello Azure subscription.</span></span> <span data-ttu-id="bd80a-225">Merhaba sonraki adımlar şunlardır:</span><span class="sxs-lookup"><span data-stu-id="bd80a-225">hello next steps are:</span></span>

1. <span data-ttu-id="bd80a-226">Merhaba uygun RBAC rolü tooyour uygulamanın kimliğini hello abonelikte atayın.</span><span class="sxs-lookup"><span data-stu-id="bd80a-226">Assign hello appropriate RBAC role tooyour application's identity on hello subscription.</span></span>
2. <span data-ttu-id="bd80a-227">Merhaba erişim atama hello abonelik hello uygulamanın izni sorgulanırken veya Kaynak Yöneticisi'ni yalnızca uygulama belirteci kullanarak erişerek doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="bd80a-227">Validate hello access assignment by querying for hello Application's permission on hello subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="bd80a-228">Merhaba hello abonelik kimliğini kalıcı uygulamaları "bağlı abonelikleri" veri yapınızı - kayıt hello bağlantı.</span><span class="sxs-lookup"><span data-stu-id="bd80a-228">Record hello connection in your applications "connected subscriptions" data structure - persisting hello id of hello subscription.</span></span>

<span data-ttu-id="bd80a-229">Merhaba ilk adımda daha yakın olarak bakalım.</span><span class="sxs-lookup"><span data-stu-id="bd80a-229">Let's look closer at hello first step.</span></span> <span data-ttu-id="bd80a-230">tooassign hello uygun RBAC rolü toohello uygulamanın kimliği belirlemeniz gerekir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-230">tooassign hello appropriate RBAC role toohello application's identity, you must determine:</span></span>

* <span data-ttu-id="bd80a-231">Uygulamanızın kimlik hello kullanıcının Azure Active Directory'de Hello nesne kimliği</span><span class="sxs-lookup"><span data-stu-id="bd80a-231">hello object id of your application's identity in hello user's Azure Active Directory</span></span>
* <span data-ttu-id="bd80a-232">Merhaba abonelikte uygulamanızın gerektirdiği hello RBAC rolü Hello tanıtıcısı</span><span class="sxs-lookup"><span data-stu-id="bd80a-232">hello identifier of hello RBAC role that your application requires on hello subscription</span></span>

<span data-ttu-id="bd80a-233">Uygulamanız bir Azure AD'den bir kullanıcı kimliği doğruladığında, Azure AD'de, uygulamanız için bir hizmet sorumlusu nesnesi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="bd80a-233">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="bd80a-234">Azure RBAC rolleri toobe tooservice ilkeleri atanan toogrant doğrudan erişim toocorresponding uygulamalar Azure kaynaklar sağlar.</span><span class="sxs-lookup"><span data-stu-id="bd80a-234">Azure allows RBAC roles toobe assigned tooservice principals toogrant direct access toocorresponding applications on Azure resources.</span></span> <span data-ttu-id="bd80a-235">Bu tam olarak ne toodo istediğimiz eylemdir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-235">This action is exactly what we wish toodo.</span></span> <span data-ttu-id="bd80a-236">Sorgu hello Azure AD grafik API'si toodetermine hello tanıtıcısı hello hizmet sorumlusu hello oturum açmış kullanıcı, uygulamanızın Azure AD kullanıcının.</span><span class="sxs-lookup"><span data-stu-id="bd80a-236">Query hello Azure AD Graph API toodetermine hello identifier of hello service principal of your application in hello signed-in user's Azure AD.</span></span>

<span data-ttu-id="bd80a-237">Azure kaynak yöneticisi için yalnızca bir erişim belirteci sahip - yeni bir erişim belirteci toocall hello Azure AD Graph API gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-237">You only have an access token for Azure Resource Manager - you need a new access token toocall hello Azure AD Graph API.</span></span> <span data-ttu-id="bd80a-238">Azure AD'de her uygulama izni tooquery kendi hizmet sorumlusu nesnesi sahiptir, böylece yalnızca uygulama erişim belirteci yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-238">Every application in Azure AD has permission tooquery its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="bd80a-239">Yalnızca uygulama erişimi için Azure AD Graph API belirteci alma</span><span class="sxs-lookup"><span data-stu-id="bd80a-239">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="bd80a-240">tooauthenticate, uygulama ve get belirteci tooAzure AD grafik API'si, sertifika bir istemci kimlik bilgileri verin OAuth2.0 akış belirteç isteği tooAzure AD belirteç uç noktası (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/Token**).</span><span class="sxs-lookup"><span data-stu-id="bd80a-240">tooauthenticate your app and get a token tooAzure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request tooAzure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="bd80a-241">Merhaba [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) ASP.net MVC örnek uygulama yalnızca uygulama access grafik API'sini kullanarak için belirteç alır hello yöntemi hello Active Directory kimlik doğrulama kitaplığı .NET için.</span><span class="sxs-lookup"><span data-stu-id="bd80a-241">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of hello ASP.net MVC sample application gets an app-only access token for Graph API using hello Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="bd80a-242">Bu istek için kullanılabilir hello sorgu dizesi parametreleri hello açıklanan [bir erişim belirteci isteği](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) konu.</span><span class="sxs-lookup"><span data-stu-id="bd80a-242">hello query string parameters that are available for this request are described in hello [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="bd80a-243">İstemci kimlik bilgileri için bir örnek isteği belirteci verin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-243">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="bd80a-244">İstemci kimlik bilgisi için bir örnek yanıt belirteç verin:</span><span class="sxs-lookup"><span data-stu-id="bd80a-244">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="bd80a-245">Kullanıcı Azure AD uygulama hizmet sorumlusu objectID alın</span><span class="sxs-lookup"><span data-stu-id="bd80a-245">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="bd80a-246">Şimdi hello yalnızca uygulama erişim belirteci tooquery hello kullanın [Azure AD grafik hizmet asıl adı](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello hello uygulamanın hizmet sorumlusu hello dizinindeki nesne kimliği.</span><span class="sxs-lookup"><span data-stu-id="bd80a-246">Now, use hello app-only access token tooquery hello [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello Object Id of hello application's service principal in hello directory.</span></span>

<span data-ttu-id="bd80a-247">Merhaba [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) yöntemi hello ASP.net MVC örnek uygulaması, bu çağrıyı uygular.</span><span class="sxs-lookup"><span data-stu-id="bd80a-247">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of hello ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="bd80a-248">örnekte gösterildiği nasıl aşağıdaki hello toorequest bir uygulamanın hizmet sorumlusu.</span><span class="sxs-lookup"><span data-stu-id="bd80a-248">hello following example shows how toorequest an application's service principal.</span></span> <span data-ttu-id="bd80a-249">a0448380-c346-4f9f-b897-c18733de9394 hello istemci Merhaba uygulaması kimliğidir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client id of hello application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="bd80a-250">Merhaba aşağıdaki örnek bir uygulama hizmeti için bir yanıt toohello isteği asıl gösterir</span><span class="sxs-lookup"><span data-stu-id="bd80a-250">hello following example shows a response toohello request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow hello application tooaccess CloudSense on behalf of hello signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow hello application tooaccess CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="bd80a-251">Azure RBAC rolü tanımlayıcısını alın</span><span class="sxs-lookup"><span data-stu-id="bd80a-251">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="bd80a-252">tooassign hello uygun RBAC rolü tooyour hizmet sorumlusu, hello Azure RBAC rolü hello tanıtıcısı belirlemeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-252">tooassign hello appropriate RBAC role tooyour service principal, you must determine hello identifier of hello Azure RBAC role.</span></span>

<span data-ttu-id="bd80a-253">Merhaba uygun RBAC rolü uygulamanız için:</span><span class="sxs-lookup"><span data-stu-id="bd80a-253">hello right RBAC role for your application:</span></span>

* <span data-ttu-id="bd80a-254">Yalnızca uygulamanızı herhangi bir değişiklik yapmadan hello abonelik izler, yalnızca hello abonelik okuyucusu izinleri gerektirir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-254">If your application only monitors hello subscription, without making any changes, it requires only reader permissions on hello subscription.</span></span> <span data-ttu-id="bd80a-255">Merhaba atamak **okuyucu** rol.</span><span class="sxs-lookup"><span data-stu-id="bd80a-255">Assign hello **Reader** role.</span></span>
* <span data-ttu-id="bd80a-256">Uygulamanızı Azure hello abonelik, varlıkları oluşturma/değiştirme/silme, yönetiyorsa hello katkıda bulunan izinleri birini gerektirir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-256">If your application manages Azure hello subscription, creating/modifying/deleting entities, it requires one of hello contributor permissions.</span></span>
  * <span data-ttu-id="bd80a-257">toomanage kaynak, belirli bir tür atama hello kaynak özgü katkıda bulunan rollerinin (sanal makine Katılımcısı, sanal ağ Katılımcısı, depolama hesabı katkıda bulunan, vb.)</span><span class="sxs-lookup"><span data-stu-id="bd80a-257">toomanage a particular type of resource, assign hello resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="bd80a-258">toomanage herhangi bir kaynak türü, Ata hello **katkıda bulunan** rol.</span><span class="sxs-lookup"><span data-stu-id="bd80a-258">toomanage any resource type, assign hello **Contributor** role.</span></span>

<span data-ttu-id="bd80a-259">Merhaba rol ataması, uygulamanız için gereken en az ayrıcalık seçin hello görünür toousers olduğundan.</span><span class="sxs-lookup"><span data-stu-id="bd80a-259">hello role assignment for your application is visible toousers, so select hello least-required privilege.</span></span>

<span data-ttu-id="bd80a-260">Merhaba çağrısı [Kaynağı Yöneticisi rol tanımı API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) tüm Azure RBAC rolleri ve arama sonra hello sonuç toofind hello yineleme toolist ada göre rol tanımı istenen.</span><span class="sxs-lookup"><span data-stu-id="bd80a-260">Call hello [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist all Azure RBAC roles and search then iterate over hello result toofind hello desired role definition by name.</span></span>

<span data-ttu-id="bd80a-261">Merhaba [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) yöntemi hello ASP.net MVC örnek uygulaması, bu çağrıyı uygular.</span><span class="sxs-lookup"><span data-stu-id="bd80a-261">hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="bd80a-262">Merhaba aşağıdaki örnekte gösterildiği nasıl isteği tooget Azure RBAC rolü tanımlayıcısı.</span><span class="sxs-lookup"><span data-stu-id="bd80a-262">hello following request example shows how tooget Azure RBAC role identifier.</span></span> <span data-ttu-id="bd80a-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb hello hello abonelik kimliğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="bd80a-264">Merhaba yanıt hello biçimi aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-264">hello response is in hello following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="bd80a-265">Bu API düzenli olarak toocall gerekmez.</span><span class="sxs-lookup"><span data-stu-id="bd80a-265">You do not need toocall this API on an ongoing basis.</span></span> <span data-ttu-id="bd80a-266">Saptadıktan sonra hello rol tanımı iyi bilinen GUID Merhaba, hello rol tanımı kimliği olarak oluşturabileceğiniz:</span><span class="sxs-lookup"><span data-stu-id="bd80a-266">Once you've determined hello well-known GUID of hello role definition, you can construct hello role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="bd80a-267">Yaygın olarak kullanılan yerleşik roller hello iyi bilinen GUID'lerini şunlardır:</span><span class="sxs-lookup"><span data-stu-id="bd80a-267">Here are hello well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="bd80a-268">Rol</span><span class="sxs-lookup"><span data-stu-id="bd80a-268">Role</span></span> | <span data-ttu-id="bd80a-269">GUID</span><span class="sxs-lookup"><span data-stu-id="bd80a-269">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="bd80a-270">Okuyucu</span><span class="sxs-lookup"><span data-stu-id="bd80a-270">Reader</span></span> |<span data-ttu-id="bd80a-271">acdd72a7-3385-48EF-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="bd80a-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="bd80a-272">Katılımcı</span><span class="sxs-lookup"><span data-stu-id="bd80a-272">Contributor</span></span> |<span data-ttu-id="bd80a-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="bd80a-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="bd80a-274">Sanal makine Katılımcısı</span><span class="sxs-lookup"><span data-stu-id="bd80a-274">Virtual Machine Contributor</span></span> |<span data-ttu-id="bd80a-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="bd80a-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="bd80a-276">Sanal ağ Katılımcısı</span><span class="sxs-lookup"><span data-stu-id="bd80a-276">Virtual Network Contributor</span></span> |<span data-ttu-id="bd80a-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="bd80a-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="bd80a-278">Depolama hesabı katkıda bulunan</span><span class="sxs-lookup"><span data-stu-id="bd80a-278">Storage Account Contributor</span></span> |<span data-ttu-id="bd80a-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="bd80a-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="bd80a-280">Web sitesi katkıda bulunan</span><span class="sxs-lookup"><span data-stu-id="bd80a-280">Website Contributor</span></span> |<span data-ttu-id="bd80a-281">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="bd80a-281">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="bd80a-282">Web planı katkıda bulunan</span><span class="sxs-lookup"><span data-stu-id="bd80a-282">Web Plan Contributor</span></span> |<span data-ttu-id="bd80a-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="bd80a-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="bd80a-284">SQL Server katkıda bulunan</span><span class="sxs-lookup"><span data-stu-id="bd80a-284">SQL Server Contributor</span></span> |<span data-ttu-id="bd80a-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="bd80a-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="bd80a-286">SQL DB Katılımcısı</span><span class="sxs-lookup"><span data-stu-id="bd80a-286">SQL DB Contributor</span></span> |<span data-ttu-id="bd80a-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="bd80a-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-tooapplication"></a><span data-ttu-id="bd80a-288">RBAC rolü tooapplication atayın</span><span class="sxs-lookup"><span data-stu-id="bd80a-288">Assign RBAC role tooapplication</span></span>
<span data-ttu-id="bd80a-289">Gereksinim duyduğunuz her şeyi tooassign hello uygun RBAC rolü tooyour hizmet sorumlusu hello kullanarak sahip [Kaynağı Yöneticisi rol ataması oluşturma](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span><span class="sxs-lookup"><span data-stu-id="bd80a-289">You have everything you need tooassign hello appropriate RBAC role tooyour service principal by using hello [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="bd80a-290">Merhaba [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) yöntemi hello ASP.net MVC örnek uygulaması, bu çağrıyı uygular.</span><span class="sxs-lookup"><span data-stu-id="bd80a-290">hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="bd80a-291">Bir örnek istek tooassign RBAC rolü tooapplication:</span><span class="sxs-lookup"><span data-stu-id="bd80a-291">An example request tooassign RBAC role tooapplication:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="bd80a-292">Merhaba istekte değerleri aşağıdaki hello kullanılır:</span><span class="sxs-lookup"><span data-stu-id="bd80a-292">In hello request, hello following values are used:</span></span>

| <span data-ttu-id="bd80a-293">GUID</span><span class="sxs-lookup"><span data-stu-id="bd80a-293">Guid</span></span> | <span data-ttu-id="bd80a-294">Açıklama</span><span class="sxs-lookup"><span data-stu-id="bd80a-294">Description</span></span> |
| --- | --- |
| <span data-ttu-id="bd80a-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="bd80a-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="bd80a-296">Merhaba abonelik Hello kimliği</span><span class="sxs-lookup"><span data-stu-id="bd80a-296">hello id of hello subscription</span></span> |
| <span data-ttu-id="bd80a-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="bd80a-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="bd80a-298">Merhaba hizmet sorumlusu hello uygulamasının Hello nesne kimliği</span><span class="sxs-lookup"><span data-stu-id="bd80a-298">hello object id of hello service principal of hello application</span></span> |
| <span data-ttu-id="bd80a-299">acdd72a7-3385-48EF-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="bd80a-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="bd80a-300">Merhaba okuyucu rolüne Hello kimliği</span><span class="sxs-lookup"><span data-stu-id="bd80a-300">hello id of hello reader role</span></span> |
| <span data-ttu-id="bd80a-301">4f87261d-2816-465D-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="bd80a-301">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="bd80a-302">Merhaba yeni rol ataması için oluşturulan yeni bir GUID</span><span class="sxs-lookup"><span data-stu-id="bd80a-302">a new guid created for hello new role assignment</span></span> |

<span data-ttu-id="bd80a-303">Merhaba yanıt hello biçimi aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="bd80a-303">hello response is in hello following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="bd80a-304">Azure kaynak yöneticisi için yalnızca uygulama erişim belirteci alma</span><span class="sxs-lookup"><span data-stu-id="bd80a-304">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="bd80a-305">toovalidate hello abonelikte bu uygulama istenen hello erişimi, yalnızca uygulama belirteci kullanarak hello abonelikte test görevi gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="bd80a-305">toovalidate that app has hello desired access on hello subscription, perform a test task on hello subscription using an app-only token.</span></span>

<span data-ttu-id="bd80a-306">tooget bir yalnızca uygulama erişim belirteci bölümündeki yönergeleri izleyerek [almak yalnızca uygulama erişim belirteci için Azure AD Graph API](#app-azure-ad-graph), hello kaynak parametresi için farklı bir değere sahip:</span><span class="sxs-lookup"><span data-stu-id="bd80a-306">tooget an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for hello resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="bd80a-307">Merhaba [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) ASP.NET MVC örnek uygulama yalnızca uygulama erişim Azure Kaynak Yöneticisi'ni kullanarak için belirteç alır hello yöntemi hello Active Directory kimlik doğrulama kitaplığı .net için.</span><span class="sxs-lookup"><span data-stu-id="bd80a-307">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using hello Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="bd80a-308">Uygulama izinleri abonelikte Al</span><span class="sxs-lookup"><span data-stu-id="bd80a-308">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="bd80a-309">Uygulamanızı sahip hello toocheck istenen bir Azure aboneliği erişimi, hello da çağırabilir [kaynak yöneticisi izinleri](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span><span class="sxs-lookup"><span data-stu-id="bd80a-309">toocheck that your application has hello desired access on an Azure subscription, you may also call hello [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="bd80a-310">Bu yaklaşım hello kullanıcı hello abonelik için erişim yönetim haklarına sahip olup olmadığını belirledi benzer toohow olur.</span><span class="sxs-lookup"><span data-stu-id="bd80a-310">This approach is similar toohow you determined whether hello user has Access Management rights for hello subscription.</span></span> <span data-ttu-id="bd80a-311">Ancak, bu süre, hello izinleri API hello önceki adımda aldığınız hello yalnızca uygulama erişim belirteci ile çağırın.</span><span class="sxs-lookup"><span data-stu-id="bd80a-311">However, this time, call hello permissions API with hello app-only access token that you received in hello previous step.</span></span>

<span data-ttu-id="bd80a-312">Merhaba [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) yöntemi hello ASP.NET MVC örnek uygulaması, bu çağrıyı uygular.</span><span class="sxs-lookup"><span data-stu-id="bd80a-312">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="bd80a-313">Bağlı aboneliklerini yönetme</span><span class="sxs-lookup"><span data-stu-id="bd80a-313">Manage connected subscriptions</span></span>
<span data-ttu-id="bd80a-314">Merhaba uygun RBAC rolü tooyour uygulamanın hizmet sorumlusu hello abonelikte atandığında, uygulamanızın izleme/Azure kaynak yöneticisi için yalnızca uygulama erişim belirteçleri kullanarak yönetme tutun.</span><span class="sxs-lookup"><span data-stu-id="bd80a-314">When hello appropriate RBAC role is assigned tooyour application's service principal on hello subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="bd80a-315">Artık mümkün tooaccess Bu abonelik ise bir abonelik sahibi, uygulamanızın rol ataması hello Klasik portalında veya komut satırı araçlarını, uygulamanızı kullanarak kaldırır.</span><span class="sxs-lookup"><span data-stu-id="bd80a-315">If a subscription owner removes your application's role assignment using hello classic portal or command-line tools, your application is no longer able tooaccess that subscription.</span></span> <span data-ttu-id="bd80a-316">Bu durumda, dış hello uygulamadan hello aboneliğiyle hello bağlantısı koptu hello kullanıcıya bildirme ve bir seçenek çok "Onar" Merhaba bağlantı vermediğiniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-316">In that case, you should notify hello user that hello connection with hello subscription was severed from outside hello application and give them an option too"repair" hello connection.</span></span> <span data-ttu-id="bd80a-317">"Onar" yalnızca çevrimdışı silindi hello rol ataması yeniden oluşturur.</span><span class="sxs-lookup"><span data-stu-id="bd80a-317">"Repair" would simply re-create hello role assignment that was deleted offline.</span></span>

<span data-ttu-id="bd80a-318">Merhaba kullanıcı tooconnect abonelikleri tooyour uygulaması yalnızca etkin olarak hello kullanıcı toodisconnect abonelikleri çok izin vermeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-318">Just as you enabled hello user tooconnect subscriptions tooyour application, you must allow hello user toodisconnect subscriptions too.</span></span> <span data-ttu-id="bd80a-319">Bir erişim yönetimi açısından bakıldığında, bağlantı kesme hello uygulamanın hizmet sorumlusu hello abonelikte sahip hello rol atamasının kaldırılması anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-319">From an access management point of view, disconnect means removing hello role assignment that hello application's service principal has on hello subscription.</span></span> <span data-ttu-id="bd80a-320">İsteğe bağlı olarak, hello abonelik hello uygulamada herhangi bir durum çok kaldırılmış olabilir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-320">Optionally, any state in hello application for hello subscription might be removed too.</span></span>
<span data-ttu-id="bd80a-321">Yalnızca hello abonelik erişim yönetim izni olan kullanıcılar mümkün toodisconnect hello abonelik ' dir.</span><span class="sxs-lookup"><span data-stu-id="bd80a-321">Only users with access management permission on hello subscription are able toodisconnect hello subscription.</span></span>

<span data-ttu-id="bd80a-322">Merhaba [RevokeRoleFromServicePrincipalOnSubscription yöntemi](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) hello ASP.net MVC örnek uygulama bu çağrıyı uygular.</span><span class="sxs-lookup"><span data-stu-id="bd80a-322">hello [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="bd80a-323">İşte bu kadar - kullanıcılar artık kolayca bağlanabilir ve uygulamanız ile bunların Azure Aboneliklerini yönetmek.</span><span class="sxs-lookup"><span data-stu-id="bd80a-323">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>
