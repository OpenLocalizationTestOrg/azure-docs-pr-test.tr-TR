---
title: "Otomatik ölçeklendirme sanal makine ölçek kümeleri ile ilgili sorunları giderme | Microsoft Docs"
description: "Sanal makine ölçek kümeleri olan otomatik ölçeklendirme sorunlarını giderin. Karşılaşılan tipik sorunları ve bunların nasıl çözüleceği anlayın."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: bd45a0fb99a77851aa7b91d23bd4b830b6f5cc7b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="c64e8-104">Sanal makine ölçek kümeleri ile sorun giderme otomatik ölçeklendirme</span><span class="sxs-lookup"><span data-stu-id="c64e8-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="c64e8-105">**Sorun** – otomatik ölçeklendirmeyi altyapı VM ölçek kümesi kullanarak Azure Resource Manager ile oluşturduğunuz – bu gibi bir şablon dağıtarak örneğin: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss-bottle-otomatik ölçeklendirme – ölçek kurallarınızı tanımlanmış olması ve isteğe bağlı olarak, sanal makinelerin ne kadar yük olursa olsun, otomatik ölçeklendirme olmaz ancak bu harika, çalışır.</span><span class="sxs-lookup"><span data-stu-id="c64e8-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on the VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="c64e8-106">Sorun giderme adımları</span><span class="sxs-lookup"><span data-stu-id="c64e8-106">Troubleshooting steps</span></span>
<span data-ttu-id="c64e8-107">Dikkate alınması gereken bazı noktalar şunlardır:</span><span class="sxs-lookup"><span data-stu-id="c64e8-107">Some things to consider include:</span></span>

* <span data-ttu-id="c64e8-108">Her VM kaç çekirdeğe sahip ve her çekirdek yükleniyor?</span><span class="sxs-lookup"><span data-stu-id="c64e8-108">How many cores does each VM have, and are you loading each core?</span></span>
  <span data-ttu-id="c64e8-109">Yukarıdaki örnek Azure Hızlı Başlangıç şablonu tek bir çekirdek yükleyen bir do_work.php komut dosyası yok.</span><span class="sxs-lookup"><span data-stu-id="c64e8-109">The example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="c64e8-110">Tek bir çekirdek VM boyutu Standard_A1 veya D1 gibi daha büyük bir VM kullanıyorsanız, bu yük birden çok kez çalıştırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-110">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need to run this load multiple times.</span></span> <span data-ttu-id="c64e8-111">Kaç tane Vm'leriniz çekirdek gözden geçirerek denetleyin [boyutları için Windows azure'da sanal makineler](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="c64e8-111">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="c64e8-112">Kaç VM VM ölçek kümesindeki her bir iş yapmakta olduğunuz?</span><span class="sxs-lookup"><span data-stu-id="c64e8-112">How many VMs in the VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="c64e8-113">Olay genişletme yalnızca sürer ne zaman yerleştirin arasında ortalama CPU **tüm** ölçek kümesindeki sanal makineleri otomatik ölçeklendirme kurallarında tanımlanan eşik değeri, iç zamanla aşıyor.</span><span class="sxs-lookup"><span data-stu-id="c64e8-113">A scale out event will only take place when the average CPU across **all** the VMs in a scale set exceeds the threshold value, over the time internal defined in the autoscale rules.</span></span>
* <span data-ttu-id="c64e8-114">Herhangi bir ölçek olayı eksik olabilir mi?</span><span class="sxs-lookup"><span data-stu-id="c64e8-114">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="c64e8-115">Ölçek olayları için Azure portalında denetim günlüklerini denetleyin.</span><span class="sxs-lookup"><span data-stu-id="c64e8-115">Check the audit logs in the Azure portal for scale events.</span></span> <span data-ttu-id="c64e8-116">Belki de var. ölçek yukarı ve bir ölçekte da aşağı kaçırılan.</span><span class="sxs-lookup"><span data-stu-id="c64e8-116">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="c64e8-117">"Ölçek" tarafından filtreleyebilirsiniz...</span><span class="sxs-lookup"><span data-stu-id="c64e8-117">You can filter by “Scale”..</span></span>
  
    ![Denetim Günlükleri][audit]
* <span data-ttu-id="c64e8-119">Ölçek ve genişletme eşikleri yeterince farklı misiniz?</span><span class="sxs-lookup"><span data-stu-id="c64e8-119">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="c64e8-120">Ortalama CPU ortalama CPU % 50'den az olduğunda, ölçek ve % 50'den 5 dakika daha büyük olduğunda genişletmek için bir kural kümesi varsayalım.</span><span class="sxs-lookup"><span data-stu-id="c64e8-120">Suppose you set a rule to scale out when average CPU is greater than 50% over 5 minutes, and to scale in when average CPU is less than 50%.</span></span> <span data-ttu-id="c64e8-121">CPU kullanımı ile sürekli artırma ve kümesinin boyutunu azaltmak ölçeklendirme eylemi Bu eşik yakın olduğunda bu "flapping" sorunu neden olur.</span><span class="sxs-lookup"><span data-stu-id="c64e8-121">This would cause a “flapping” problem when CPU usage is close to this threshold, with scale actions constantly increasing and decreasing the size of the set.</span></span> <span data-ttu-id="c64e8-122">Bu nedenle otomatik ölçeklendirme hizmeti "dalgalanma" önlemek hangi değil ölçeklendirme olarak bildirilebilir çalışır.</span><span class="sxs-lookup"><span data-stu-id="c64e8-122">Because of this, the autoscale service tries to prevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="c64e8-123">Bu nedenle, genişleme ve ölçek bileşenini eşikleri ölçeklendirme Between biraz alan izin vermek için yeterince farklı olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="c64e8-123">Therefore make sure your scale-out and scale-in thresholds are sufficiently different to allow some space in between scaling.</span></span>
* <span data-ttu-id="c64e8-124">Kendi JSON şablonunu yazdım?</span><span class="sxs-lookup"><span data-stu-id="c64e8-124">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="c64e8-125">Hataları olun, böylece iş ve küçük artımlı değişiklikler yapmak için yukarıdaki kanıtlanmış gibi şablonu ile başlayın kolaydır.</span><span class="sxs-lookup"><span data-stu-id="c64e8-125">It is easy to make mistakes, so start with a template like the one above which is proven to work, and make small incremental changes.</span></span> 
* <span data-ttu-id="c64e8-126">El ile içeri veya dışarı ölçekleme yapabilirsiniz?</span><span class="sxs-lookup"><span data-stu-id="c64e8-126">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="c64e8-127">VM ölçek kümesi kaynak VM'lerin sayısını el ile değiştirmek için farklı "kapasitesi" ayarı ile yeniden dağıtmayı deneyin.</span><span class="sxs-lookup"><span data-stu-id="c64e8-127">Try redeploying the VM Scale Set resource with a different “capacity” setting to change the number of VMs manually.</span></span> <span data-ttu-id="c64e8-128">Bunu yapmak için bir örnek şablonu aşağıda verilmiştir: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – ölçek kümesi kullanma gibi aynı makine boyutu olduğundan emin olmak için şablonu düzenlemek gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-128">An example template to do this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need to edit the template to make sure it has the same machine size as your Scale Set is using.</span></span> <span data-ttu-id="c64e8-129">Ardından VM'ler el ile başarılı bir şekilde değiştirirseniz, otomatik ölçeklendirme için yalıtılmış bir sorundur bildiğiniz.</span><span class="sxs-lookup"><span data-stu-id="c64e8-129">If you can successfully change the number of VMs manually, then you know the problem is isolated to autoscale.</span></span>
* <span data-ttu-id="c64e8-130">Microsoft.Compute/virtualMachineScaleSet denetleyin ve Microsoft.ınsights kaynaklarında [Azure kaynak Gezgini](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="c64e8-130">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in the [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="c64e8-131">Azure Resource Manager kaynaklarınızı durumunu gösteren vazgeçilmez bir sorun giderme aracı budur.</span><span class="sxs-lookup"><span data-stu-id="c64e8-131">This is an indispensable troubleshooting tool which shows you the state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="c64e8-132">Aboneliğinizi tıklatın ve sorun gidermekte olduğunuz kaynak grubu arayın.</span><span class="sxs-lookup"><span data-stu-id="c64e8-132">Click on your subscription and look at the Resource Group you are troubleshooting.</span></span> <span data-ttu-id="c64e8-133">İşlem kaynak sağlayıcısı altında VM ölçek oluşturduğunuz kümesi arayın ve bir dağıtım durumunu gösteren örnek görünümünü denetleyin.</span><span class="sxs-lookup"><span data-stu-id="c64e8-133">Under the Compute resource provider look at the VM Scale Set you created and check the Instance View, which shows you the state of a deployment.</span></span> <span data-ttu-id="c64e8-134">Ayrıca Vm'lerde VM ölçek kümesi örnek görünümünü denetleyin.</span><span class="sxs-lookup"><span data-stu-id="c64e8-134">Also check the instance view of VMs in the VM Scale Set.</span></span> <span data-ttu-id="c64e8-135">Ardından Microsoft.ınsights kaynak sağlayıcısını gidin ve otomatik ölçeklendirme kurallarını iyi görünen denetleyin.</span><span class="sxs-lookup"><span data-stu-id="c64e8-135">Then go into the Microsoft.Insights resource provider and check the autoscale rules look good.</span></span>
* <span data-ttu-id="c64e8-136">Tanılama uzantısını çalışma ve performans verilerini yayma?</span><span class="sxs-lookup"><span data-stu-id="c64e8-136">Is the Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="c64e8-137">**Güncelleştirme:** Azure otomatik ölçeklendirme, artık bir tanılama uzantısını yüklü olmasını gerektiren bir ana bilgisayar tabanlı ölçüm ardışık kullanmak için geliştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-137">**Update:** Azure autoscale has been enhanced to use a host based metrics pipeline which no longer requires a diagnostics extension to be installed.</span></span> <span data-ttu-id="c64e8-138">Bu, yeni işlem hattı kullanarak otomatik ölçeklendirmeyi uygulama oluşturursanız, birkaç paragraf artık geçerli sonraki anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-138">This means the next few paragraphs no longer apply if you create an autoscaling application using the new pipeline.</span></span> <span data-ttu-id="c64e8-139">Konak ardışık düzen kullanılacak dönüştürülen Azure şablonları örneğidir: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="c64e8-139">An example of Azure templates which have been converted to use the host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="c64e8-140">Ana bilgisayar tabanlı ölçümleri için otomatik ölçeklendirme aşağıdaki nedenlerle daha iyi kullanmaktır:</span><span class="sxs-lookup"><span data-stu-id="c64e8-140">Using host based metrics for autoscale is better for the following reasons:</span></span>
  
  * <span data-ttu-id="c64e8-141">Daha az hareketli parça tanılama uzantısız olarak yüklenmesi gerekmez.</span><span class="sxs-lookup"><span data-stu-id="c64e8-141">Fewer moving parts as no diagnostics extensions need to be installed.</span></span>
  * <span data-ttu-id="c64e8-142">Daha basit şablonları.</span><span class="sxs-lookup"><span data-stu-id="c64e8-142">Simpler templates.</span></span> <span data-ttu-id="c64e8-143">Var olan bir ölçek kümesi şablonunu Öngörüler otomatik ölçeklendirme kurallarını eklemeniz yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-143">Just add insights autoscale rules to an existing scale set template.</span></span>
  * <span data-ttu-id="c64e8-144">Daha güvenilir raporlama ve yeni Vm'leri daha hızlı başlatma.</span><span class="sxs-lookup"><span data-stu-id="c64e8-144">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="c64e8-145">Tanılama uzantısını kullanarak tutmak isteyebilirsiniz yalnızca nedeniyle Bellek Tanılama raporlama/ölçeklendirme gerekip gerekmediğini olacaktır.</span><span class="sxs-lookup"><span data-stu-id="c64e8-145">The only reasons you might want to keep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="c64e8-146">Ana bilgisayar tabanlı ölçümleri bellek bildirmez.</span><span class="sxs-lookup"><span data-stu-id="c64e8-146">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="c64e8-147">Otomatik ölçeklendirmeyi için hala tanılama uzantılarını kullanıyorsanız, aklınızda yalnızca bu makalenin geri kalanını uygulayın.</span><span class="sxs-lookup"><span data-stu-id="c64e8-147">With that in mind, only follow the rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="c64e8-148">Otomatik ölçeklendirme Azure Kaynak Yöneticisi'nde çalışabilirsiniz (ancak artık gerekir) yoluyla VM uzantısı tanılama uzantısını çağrılır.</span><span class="sxs-lookup"><span data-stu-id="c64e8-148">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called the Diagnostics Extension.</span></span> <span data-ttu-id="c64e8-149">Bir depolama hesabı şablonda tanımlamak için performans verilerini gösterir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-149">It emits performance data to a storage account you define in the template.</span></span> <span data-ttu-id="c64e8-150">Bu veriler, ardından Azure izleme hizmeti tarafından toplanır.</span><span class="sxs-lookup"><span data-stu-id="c64e8-150">This data is then aggregated by the Azure Monitor service.</span></span>
    
    <span data-ttu-id="c64e8-151">Öngörüler hizmeti Vm'lerden veri okunamıyor, onu gerektiği VM'ler aşağı olsaydı bir e-posta – örneğin göndermek, bu nedenle e-posta adresiniz (bir Azure hesabı oluşturulurken belirtilen) denetleyin.</span><span class="sxs-lookup"><span data-stu-id="c64e8-151">If the Insights service can’t read data from the VMs, it is supposed to send you an email – for example if the VMs were down, so check your email (the one you specified when creating the Azure account).</span></span>
    
    <span data-ttu-id="c64e8-152">Ayrıca, Git ve veri kendiniz bakın.</span><span class="sxs-lookup"><span data-stu-id="c64e8-152">You can also go and look at the data yourself.</span></span> <span data-ttu-id="c64e8-153">Cloud explorer'ı kullanarak Azure depolama hesabı arayın.</span><span class="sxs-lookup"><span data-stu-id="c64e8-153">Look at the Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="c64e8-154">Örneğin kullanarak [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), oturum açma ve çekme kullanmakta olduğunuz Azure aboneliği ve tanılama depolama hesabı adı başvurulan dağıtım şablonunuzu tanılama uzantısını tanımında...</span><span class="sxs-lookup"><span data-stu-id="c64e8-154">For example using the [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick the Azure subscription you’re using, and the Diagnostics storage account name referenced in the Diagnostics extension definition in your deployment template..</span></span>
    
    ![Bulut Gezgini][explorer]
    
    <span data-ttu-id="c64e8-156">Burada, her bir VM verilerden depolandığı tabloları bir dizi görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="c64e8-156">Here you will see a bunch of tables where the data from each VM is being stored.</span></span> <span data-ttu-id="c64e8-157">Linux ve bir örnek olarak CPU ölçüm alma, en son satırları arayın.</span><span class="sxs-lookup"><span data-stu-id="c64e8-157">Taking Linux and the CPU metric as an example, look at the most recent rows.</span></span> <span data-ttu-id="c64e8-158">Visual Studio bulut Gezgini, bir sorgu dili destekler, böylece gibi bir sorgu çalıştırabilirsiniz "zaman damgası gt datetime'2016-02-02T21:20:00Z'" (zamanı UTC olarak varsayılmıştır) en son olayların alma emin olmak için.</span><span class="sxs-lookup"><span data-stu-id="c64e8-158">The Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” to make sure you get the most recent events (assume time is in UTC).</span></span> <span data-ttu-id="c64e8-159">Vardır karşılık ölçeği kuralları ayarlamak, gördüğünüz veri mu?</span><span class="sxs-lookup"><span data-stu-id="c64e8-159">Does the data you see in there correspond to the scale rules you set up?</span></span> <span data-ttu-id="c64e8-160">Aşağıdaki örnekte, % 100'e son 5 dakika boyunca artırma makine 20 CPU başlatıldı...</span><span class="sxs-lookup"><span data-stu-id="c64e8-160">In the example below, the CPU for machine 20 started increasing to 100% over the last 5 minutes..</span></span>
    
    ![Depolama tabloları][tables]
    
    <span data-ttu-id="c64e8-162">Veri yoksa, daha sonra Vm'lerde çalışan tanılama uzantılı sorun olduğu anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-162">If the data is not there, then it implies the problem is with the diagnostic extension running in the VMs.</span></span> <span data-ttu-id="c64e8-163">Veri varsa, Ölçek kurallarınızı ile veya Öngörüler hizmeti ile bir sorun var. anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="c64e8-163">If the data is there, it implies there is either a problem with your scale rules, or with the Insights service.</span></span> <span data-ttu-id="c64e8-164">Denetleme [Azure durum](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="c64e8-164">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="c64e8-165">Otomatik ölçeklendirme sorun yaşıyorsanız bu adımları uygularken size atanmış sonra size Forum çalışabilir [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), veya [yığın taşması](http://stackoverflow.com/questions/tagged/azure), veya bir destek çağrısı oturum.</span><span class="sxs-lookup"><span data-stu-id="c64e8-165">Once you’ve been through these steps, if you are still having autoscale problems you could try the forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="c64e8-166">Şablon ve performans verilerini bir görünümünü paylaşmak hazırlıklı olun.</span><span class="sxs-lookup"><span data-stu-id="c64e8-166">Be prepared to share the template and a view of the performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
