---
title: "Bulut hizmeti yaşam döngüsü olayları işlemek | Microsoft Docs"
description: "Bir bulut hizmeti rolü yaşam döngüsü yöntemlerinin .NET içinde nasıl kullanılacağını öğrenin"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: eb78c05df3b3cdf3887334c11bdabd5cebb74747
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/03/2017
---
# <a name="customize-the-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="a7cf1-103">.NET’te Web veya Çalışan rolünün yaşam döngüsünü özelleştirme</span><span class="sxs-lookup"><span data-stu-id="a7cf1-103">Customize the Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="a7cf1-104">Çalışan rolü oluşturduğunuzda, genişlettiğiniz [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) olanak sağlayan yöntemleri geçersiz kılmanıza olanak sağlayan sınıf yaşam döngüsü olaylarına yanıt.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-104">When you create a worker role, you extend the [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you to override that let you respond to lifecycle events.</span></span> <span data-ttu-id="a7cf1-105">Yaşam döngüsü olaylara yanıt vermek kullanmalısınız web rolleri için bu sınıf isteğe bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-105">For web roles this class is optional, so you must use it to respond to lifecycle events.</span></span>

## <a name="extend-the-roleentrypoint-class"></a><span data-ttu-id="a7cf1-106">RoleEntryPoint sınıfını genişletir</span><span class="sxs-lookup"><span data-stu-id="a7cf1-106">Extend the RoleEntryPoint class</span></span>
<span data-ttu-id="a7cf1-107">[RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) sınıfı, Azure tarafından çağrılan yöntemler içerir, bunu **başlatır**, **çalıştıran**, veya **durdurur** web veya çalışan rolü.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-107">The [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="a7cf1-108">İsteğe bağlı olarak rol başlatma, rol kapatma dizileri veya rolünün yürütme iş parçacığı yönetmek için bu yöntemleri geçersiz kılabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-108">You can optionally override these methods to manage role initialization, role shutdown sequences, or the execution thread of the role.</span></span> 

<span data-ttu-id="a7cf1-109">Genişletirken **RoleEntryPoint**, yöntemler aşağıdaki davranışlarını bilincinde olmanız gerekir:</span><span class="sxs-lookup"><span data-stu-id="a7cf1-109">When extending **RoleEntryPoint**, you should be aware of the following behaviors of the methods:</span></span>

* <span data-ttu-id="a7cf1-110">[OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) ve [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) yöntemleri döndürmeyi mümkün olması için bir Boole değeri döndürür **false** bu yöntemlerden.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-110">The [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible to return **false** from these methods.</span></span>
  
   <span data-ttu-id="a7cf1-111">Kodunuzu döndürürse **false**rol işlem beklenmedik şekilde sona erdirildi, tüm kapatma dizisi çalıştırmadan yerinde olabilir.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-111">If your code returns **false**, the role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="a7cf1-112">Genel olarak, döndürme kaçınmalısınız **false** gelen **OnStart** yöntemi.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-112">In general, you should avoid returning **false** from the **OnStart** method.</span></span>
* <span data-ttu-id="a7cf1-113">Herhangi bir aşırı yüklemesini içinde özel durum yakalanmamış bir **RoleEntryPoint** yöntemi, işlenmeyen bir özel durum değerlendirilir.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="a7cf1-114">Yaşam döngüsü yöntemlerden birini içinde bir özel durum oluşursa, Azure oluşturacağı [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) olay ve sonra işlemi sonlandırılır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-114">If an exception occurs within one of the lifecycle methods, Azure will raise the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then the process is terminated.</span></span> <span data-ttu-id="a7cf1-115">Rolünüze çevrimdışı alındıktan sonra Azure tarafından başlatılır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="a7cf1-116">İşlenmeyen bir özel durum oluştuğunda [durdurma](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) olay başlatılmaz ve **OnStop** yöntemi çağrılmaz.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-116">When an unhandled exception occurs, the [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and the **OnStop** method is not called.</span></span>

<span data-ttu-id="a7cf1-117">Rolünüze başlamıyor ya da, meşgul, başlatma ve durdurma durumları arasında geri dönüştürme, kodunuzun her rol yeniden başlatıldığında yaşam döngüsü olayları biri içinde işlenmeyen bir özel durum atma.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-117">If your role does not start, or is recycling between the initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of the lifecycle events each time the role restarts.</span></span> <span data-ttu-id="a7cf1-118">Bu durumda, kullanarak [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) özel durumun nedeni belirlemek ve uygun şekilde işlemek için olay.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-118">In this case, use the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event to determine the cause of the exception and handle it appropriately.</span></span> <span data-ttu-id="a7cf1-119">Rolünüze de gelen döndürüyor olabilir [çalıştırmak](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) yeniden başlatmak rol neden yöntemi.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-119">Your role may also be returning from the [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes the role to restart.</span></span> <span data-ttu-id="a7cf1-120">Dağıtım durumları hakkında daha fazla bilgi için bkz: [ortak sorunları neden rolleri için Geri Dönüşüm](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="a7cf1-120">For more information about deployment states, see [Common Issues Which Cause Roles to Recycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="a7cf1-121">Kullanıyorsanız **Azure Araçları için Microsoft Visual Studio** uygulamanızı geliştirmek için rol proje şablonlarını otomatik olarak genişletmek **RoleEntryPoint** sınıfı, içinde  *WebRole.cs* ve *WorkerRole.cs* dosyaları.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-121">If you are using the **Azure Tools for Microsoft Visual Studio** to develop your application, the role project templates automatically extend the **RoleEntryPoint** class for you, in the *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="a7cf1-122">OnStart yöntemi</span><span class="sxs-lookup"><span data-stu-id="a7cf1-122">OnStart method</span></span>
<span data-ttu-id="a7cf1-123">**OnStart** rol örneğinizi Azure tarafından çevrimiçi duruma getirildiğinde yöntemi çağrılır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-123">The **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="a7cf1-124">OnStart kod yürütülürken rol örneği olarak işaretlenmiş **meşgul** ve dış trafiği için yük dengeleyici tarafından yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-124">While the OnStart code is executing, the role instance is marked as **Busy** and no external traffic will be directed to it by the load balancer.</span></span> <span data-ttu-id="a7cf1-125">Olay işleyicileri uygulama ve başlatma gibi başlatma işini yapmak için bu yöntemi geçersiz kılabilirsiniz [Azure tanılama](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="a7cf1-125">You can override this method to perform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="a7cf1-126">Varsa **OnStart** döndürür **true**örneği başarıyla başlatıldı ve Azure çağırır **RoleEntryPoint.Run** yöntemi.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-126">If **OnStart** returns **true**, the instance is successfully initialized and Azure calls the **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="a7cf1-127">Varsa **OnStart** döndürür **yanlış**, herhangi bir planlı kapatma dizisini çalıştırmadan rolü derhal sona erer.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-127">If **OnStart** returns **false**, the role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="a7cf1-128">Aşağıdaki kod örneğinde nasıl geçersiz kılınacağını gösterir **OnStart** yöntemi.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-128">The following code example shows how to override the **OnStart** method.</span></span> <span data-ttu-id="a7cf1-129">Bu yöntem yapılandırır ve rol örneği başlatır ve günlük veri aktarımını depolama hesabı ayarlar tanı İzleyicisi başlatılır:</span><span class="sxs-lookup"><span data-stu-id="a7cf1-129">This method configures and starts a diagnostic monitor when the role instance starts and sets up a transfer of logging data to a storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="a7cf1-130">OnStop yöntemi</span><span class="sxs-lookup"><span data-stu-id="a7cf1-130">OnStop method</span></span>
<span data-ttu-id="a7cf1-131">**OnStop** yöntemi, bir rol örneği Azure tarafından ve çıkılıyor önce çevrimdışı alındıktan sonra çağrılır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-131">The **OnStop** method is called after a role instance has been taken offline by Azure and before the process exits.</span></span> <span data-ttu-id="a7cf1-132">Düzgün bir şekilde kapatmak, rol örneği için gerekli kod çağırmak için bu yöntemin üzerine yazabilir.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-132">You can override this method to call code required for your role instance to cleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7cf1-133">Çalışan kod **OnStop** yöntemi sahip bir kullanıcı tarafından başlatılan kapatma dışında nedenlerle çağrıldığında tamamlamak için sınırlı bir süre.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-133">Code running in the **OnStop** method has a limited time to finish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="a7cf1-134">Bu süre geçtikten sonra bu kodu emin olmanız gerekir böylece işlemin, sonlandırıldığından **OnStop** yöntemi tamamlanıncaya kadar çalıştırmayan göstereceği veya hızlı bir şekilde çalıştırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-134">After this time elapses, the process is terminated, so you must make sure that code in the **OnStop** method can run quickly or tolerates not running to completion.</span></span> <span data-ttu-id="a7cf1-135">**OnStop** yöntemi çağrıldıktan sonra **durdurma** olayı oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-135">The **OnStop** method is called after the **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="a7cf1-136">Run yöntemi</span><span class="sxs-lookup"><span data-stu-id="a7cf1-136">Run method</span></span>
<span data-ttu-id="a7cf1-137">Geçersiz kılabilirsiniz **çalıştırmak** rol örneği için uzun süre çalışan iş parçacığı uygulamak için yöntem.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-137">You can override the **Run** method to implement a long-running thread for your role instance.</span></span>

<span data-ttu-id="a7cf1-138">Geçersiz kılma **çalıştırmak** yöntemi gerekli değildir; sonsuza kadar uyku bir iş parçacığı varsayılan uygulamasını başlatır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-138">Overriding the **Run** method is not required; the default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="a7cf1-139">Geçersiz kılarsanız **çalıştırmak** yöntemi, kodunuzu engelleme süresiz olarak.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-139">If you do override the **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="a7cf1-140">Varsa **çalıştırmak** yöntemi döndürür, rolü otomatik olarak düzgün bir şekilde geri dönüştürülmeden; diğer bir deyişle, Azure başlatır **durdurma** olay ve çağrıları **OnStop** yöntemi için rolü çevrimdışı duruma önce kapatma sıraları yürütülen.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-140">If the **Run** method returns, the role is automatically gracefully recycled; in other words, Azure raises the **Stopping** event and calls the **OnStop** method so that your shutdown sequences may be executed before the role is taken offline.</span></span>

### <a name="implementing-the-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="a7cf1-141">Web rolü için ASP.NET yaşam döngüsü yöntemleri uygulama</span><span class="sxs-lookup"><span data-stu-id="a7cf1-141">Implementing the ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="a7cf1-142">Tarafından sağlanan ek olarak ASP.NET yaşam döngüsü yöntemlerini kullanabilirsiniz **RoleEntryPoint** web rolü için başlatma ve kapatma sıralarını yönetmek için sınıf.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-142">You can use the ASP.NET lifecycle methods, in addition to those provided by the **RoleEntryPoint** class, to manage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="a7cf1-143">Mevcut bir ASP.NET uygulamasını Azure için bağlantı noktası oluşturma, bu uyumluluk amacıyla yararlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application to Azure.</span></span> <span data-ttu-id="a7cf1-144">ASP.NET yaşam döngüsü yöntemleri içinden adlı **RoleEntryPoint** yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-144">The ASP.NET lifecycle methods are called from within the **RoleEntryPoint** methods.</span></span> <span data-ttu-id="a7cf1-145">**Uygulama\_Başlat** yöntemi çağrıldıktan sonra **RoleEntryPoint.OnStart** yöntemini çağırır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-145">The **Application\_Start** method is called after the **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="a7cf1-146">**Uygulama\_son** yöntemi çağrılmadan önce **RoleEntryPoint.OnStop** yöntemi çağrılır.</span><span class="sxs-lookup"><span data-stu-id="a7cf1-146">The **Application\_End** method is called before the **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a7cf1-147">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="a7cf1-147">Next steps</span></span>
<span data-ttu-id="a7cf1-148">Bilgi edinmek için nasıl [bir bulut hizmet paketi oluşturma](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="a7cf1-148">Learn how to [create a cloud service package](cloud-services-model-and-package.md).</span></span>

