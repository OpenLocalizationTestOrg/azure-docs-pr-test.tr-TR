---
title: "Azure SQL Veritabanı’nda veritabanı performansını izleme | Microsoft Belgeleri"
description: "Azure araçlarını ve dinamik yönetim görünümlerini kullanarak veritabanınızı izleme seçenekleri hakkında bilgi edinin."
keywords: "veritabanı izleme, bulut veritabanı performansı"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: e11ed3275413b428523eef78a5a89b537f6a4afc
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="8b5e2-104">Azure SQL Database'de veritabanı performansını izleme</span><span class="sxs-lookup"><span data-stu-id="8b5e2-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="8b5e2-105">Azure SQL veritabanı performansını izlemeye, seçtiğiniz veritabanı performans düzeyiyle ilgili kaynak kullanımını izleyerek başlarsınız.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-105">Monitoring the performance of a SQL database in Azure starts with monitoring the resource utilization relative to the level of database performance you choose.</span></span> <span data-ttu-id="8b5e2-106">İzleme, veritabanınızın gerekenden fazla kapasiteye sahip olup olmadığını veya veritabanınızda kaynak kullanımının üst sınıra ulaşması nedeniyle bir sorun olup olmadığını belirlemenize yardımcı olur. Böylece veritabanınızın performans düzeyinin ve [hizmet katmanının](sql-database-service-tiers.md) ayarlanma zamanının gelip gelmediğine karar verirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time to adjust the performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="8b5e2-107">Veritabanınızı [Azure portalında](https://portal.azure.com) bulunan grafik araçlarını veya SQL [dinamik yönetim görünümlerini](https://msdn.microsoft.com/library/ms188754.aspx) kullanarak izleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-107">You can monitor your database using graphical tools in the [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-the-azure-portal"></a><span data-ttu-id="8b5e2-108">Azure portalını kullanarak veritabanlarını izleme</span><span class="sxs-lookup"><span data-stu-id="8b5e2-108">Monitor databases using the Azure portal</span></span>
<span data-ttu-id="8b5e2-109">[Azure portalında](https://portal.azure.com/), tek veritabanlarının kullanımını veritabanınızı seçip **İzleme** grafiğine tıklayarak izleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-109">In the [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking the **Monitoring** chart.</span></span> <span data-ttu-id="8b5e2-110">Bu işlem sonrasında bir **Ölçüm** penceresi görüntülenir. **Grafiği düzenle** düğmesine tıklayarak değişiklik yapabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-110">This brings up a **Metric** window that you can change by clicking the **Edit chart** button.</span></span> <span data-ttu-id="8b5e2-111">Şu ölçümleri ekleyin:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-111">Add the following metrics:</span></span>

* <span data-ttu-id="8b5e2-112">CPU yüzdesi</span><span class="sxs-lookup"><span data-stu-id="8b5e2-112">CPU percentage</span></span>
* <span data-ttu-id="8b5e2-113">DTU yüzdesi</span><span class="sxs-lookup"><span data-stu-id="8b5e2-113">DTU percentage</span></span>
* <span data-ttu-id="8b5e2-114">Veri G/Ç yüzdesi</span><span class="sxs-lookup"><span data-stu-id="8b5e2-114">Data IO percentage</span></span>
* <span data-ttu-id="8b5e2-115">Veri boyutu yüzdesi</span><span class="sxs-lookup"><span data-stu-id="8b5e2-115">Database size percentage</span></span>

<span data-ttu-id="8b5e2-116">Bu ölçümleri ekledikten sonra **İzleme** grafiğinde bulunan **Ölçüm** penceresinde bu ölçümleri daha ayrıntılı şekilde görüntülemeye devam edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-116">Once you’ve added these metrics, you can continue to view them in the **Monitoring** chart with more details on the **Metric** window.</span></span> <span data-ttu-id="8b5e2-117">Dört ölçümün tümü de veritabanınızın ortalama **DTU** kullanım yüzdesini gösterir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-117">All four metrics show the average utilization percentage relative to the **DTU** of your database.</span></span> <span data-ttu-id="8b5e2-118">DTU'lar ile ilgili ayrıntılı bilgi için bkz. [hizmet katmanları](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="8b5e2-118">See the [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Hizmet katmanına göre veritabanı performansını izleme.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="8b5e2-120">Performans ölçümlerine ilişkin uyarıları da yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-120">You can also configure alerts on the performance metrics.</span></span> <span data-ttu-id="8b5e2-121">**Ölçüm** penceresindeki **Uyarı ekle** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-121">Click the **Add alert** button in the **Metric** window.</span></span> <span data-ttu-id="8b5e2-122">Uyarınızı yapılandırmak için sihirbazı takip edin.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-122">Follow the wizard to configure your alert.</span></span> <span data-ttu-id="8b5e2-123">Ölçümlerin belirli bir eşiği aşması veya belirli bir eşiğin altına düşmesi halinde uyarı alabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-123">You have the option to alert if the metrics exceed a certain threshold or if the metric falls below a certain threshold.</span></span>

<span data-ttu-id="8b5e2-124">Örneğin, veritabanınızdaki bir iş yükünün artmasını bekliyorsanız bir e-posta uyarısı yapılandırarak veritabanınızın herhangi bir performans ölçümünde %80 sınırına ulaşması halinde uyarı alabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-124">For example, if you expect the workload on your database to grow, you can choose to configure an email alert whenever your database reaches 80% on any of the performance metrics.</span></span> <span data-ttu-id="8b5e2-125">Bu uyarıyı, daha yüksek bir performans düzeyine ne zaman geçmeniz gerektiğini anlamak üzere erken bir uyarı olarak kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-125">You can use this as an early warning to figure out when you might have to switch to the next higher performance level.</span></span>

<span data-ttu-id="8b5e2-126">Performans ölçümleri, daha düşük bir performans düzeyine geçip geçemeyeceğinizi belirlemenize de yardımcı olabilir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-126">The performance metrics can also help you determine if you are able to downgrade to a lower performance level.</span></span> <span data-ttu-id="8b5e2-127">Standart S2 veritabanını kullandığınızı ve tüm performans ölçümlerinin, veritabanının belirli bir zaman için ortalama %10'dan daha fazla kullanımda bulunmadığını gösterdiğini varsayın.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-127">Assume you are using a Standard S2 database and all performance metrics show that the database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="8b5e2-128">Bu, veritabanının Standart S1'de de düzgün şekilde çalışabileceğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-128">It is likely that the database will work well in Standard S1.</span></span> <span data-ttu-id="8b5e2-129">Ancak daha düşük bir performans düzeyine geçmeye karar vermeden önce, ani değişiklik veya dalgalanma gösteren iş yüklerine dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-129">However, be aware of workloads that spike or fluctuate before making the decision to move to a lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="8b5e2-130">DMV'leri kullanarak veritabanlarını izleme</span><span class="sxs-lookup"><span data-stu-id="8b5e2-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="8b5e2-131">Portalda kullanıma sunulan ölçümler aynı zamanda şu sistem görünümleri aracılığıyla da kullanılabilir: sunucunuzun mantıksal **asıl** veritabanında bulunan [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) ve kullanıcı veritabanında bulunan [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="8b5e2-131">The same metrics that are exposed in the portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in the logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in the user database.</span></span> <span data-ttu-id="8b5e2-132">Daha uzun bir sürede daha az ayrıntılı veri izlemeniz gerekiyorsa **sys.resource_stats** görünümünü kullanın.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-132">Use **sys.resource_stats** if you need to monitor less granular data across a longer period of time.</span></span> <span data-ttu-id="8b5e2-133">Daha küçük bir zaman diliminde daha fazla ayrıntılı veri izlemeniz gerekiyorsa **sys.dm_db_resource_stats** görünümünü kullanın.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-133">Use **sys.dm_db_resource_stats** if you need to monitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="8b5e2-134">Daha fazla bilgi için bkz. [Azure SQL Database Performans Rehberi](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="8b5e2-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="8b5e2-135">**sys.dm_db_resource_stats**, Web ve İşletme sürümü veritabanlarında (bu sürümler kullanımdan kaldırılmıştır) kullanıldığında boş bir sonuç kümesi getirir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="8b5e2-136">Kaynak kullanımını izleme</span><span class="sxs-lookup"><span data-stu-id="8b5e2-136">Monitor resource use</span></span>

<span data-ttu-id="8b5e2-137">Kaynak kullanım kullanarak izleyebilirsiniz [SQL veritabanı sorgu performansı öngörüleri](sql-database-query-performance.md) ve [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="8b5e2-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="8b5e2-138">Bu iki görünüm kullanarak kullanımı da izleyebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="8b5e2-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="8b5e2-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="8b5e2-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="8b5e2-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="8b5e2-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="8b5e2-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="8b5e2-142">Kullanabileceğiniz [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) her SQL veritabanını görünümünde.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-142">You can use the [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="8b5e2-143">**Sys.dm_db_resource_stats** son kaynak kullanım verilerini hizmet katmanına göre görüntüler.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-143">The **sys.dm_db_resource_stats** view shows recent resource use data relative to the service tier.</span></span> <span data-ttu-id="8b5e2-144">Ortalama CPU, veri g/ç, günlük yazma ve bellek yüzdelerini 15 dakikada kaydedilir ve 1 saat boyunca saklanır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="8b5e2-145">Bu görünüm kaynak kullanımını daha ayrıntılı bir bakış sağladığından, kullanın **sys.dm_db_resource_stats** tüm geçerli durumu çözümleme için ilk ya da sorun giderme.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="8b5e2-146">Örneğin, bu sorgu geçerli veritabanı için ortalama ve en fazla kaynak kullanımı son bir saat içinde gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-146">For example, this query shows the average and maximum resource use for the current database over the past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="8b5e2-147">Diğer sorgular için örneklere bakın [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="8b5e2-147">For other queries, see the examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="8b5e2-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="8b5e2-148">sys.resource_stats</span></span>
<span data-ttu-id="8b5e2-149">[Sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) görünümünde **ana** veritabanının bulunduğu SQL veritabanınızın belirli hizmet katmanını ve performans düzeyinde performansını izlemenize yardımcı olacak ek bilgiler.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-149">The [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in the **master** database has additional information that can help you monitor the performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="8b5e2-150">Veriler her 5 dakikada bir toplanan ve yaklaşık 35 gün boyunca tutulur.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-150">The data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="8b5e2-151">Bu görünüm, SQL veritabanınız kaynakları nasıl kullandığını, daha uzun vadeli bir geçmiş analize kullanışlıdır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="8b5e2-152">Aşağıdaki grafikte CPU kaynak kullanımı bir Premium veritabanı için P2 performans düzeyine sahip her saat için bir hafta içinde gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-152">The following graph shows the CPU resource use for a Premium database with the P2 performance level for each hour in a week.</span></span> <span data-ttu-id="8b5e2-153">Bu grafik Pazartesi günü başlar, 5 iş günlerini gösterir ve hafta sonu gösterir, uygulamaya göre çok daha az olur.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on the application.</span></span>

![SQL veritabanı kaynak kullanımı](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="8b5e2-155">Verileri, bu veritabanı şu anda yüzde 50'ten sadece en yüksek CPU yükü yok (Öğle saati Salı günü) P2 performans düzeyine göre CPU kullanımı.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-155">From the data, this database currently has a peak CPU load of just over 50 percent CPU use relative to the P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="8b5e2-156">CPU uygulamanın kaynak profilinde baskın faktörü ise, P2 iş yükü her zaman uygun güvence altına almak için doğru performans düzeyinin olduğunu karar verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-156">If CPU is the dominant factor in the application’s resource profile, then you might decide that P2 is the right performance level to guarantee that the workload always fits.</span></span> <span data-ttu-id="8b5e2-157">Bir uygulama zamanla artmasına bekliyorsanız, böylece uygulama herhangi bir zamanda performans düzeyi sınırına ulaştığında olmayan bir ek kaynak arabelleği sağlamak için bir fikirdir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-157">If you expect an application to grow over time, it's a good idea to have an extra resource buffer so that the application doesn't ever reach the performance-level limit.</span></span> <span data-ttu-id="8b5e2-158">Performans düzeyini artırmak için bir veritabanı isteklerini özellikle gecikme süresine duyarlı ortamlarında etkili bir şekilde işlemek için yeterli güç sahip olmadığında ortaya çıkabilir müşteri görünür hataları önlemenize yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-158">If you increase the performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power to process requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="8b5e2-159">Örnek Web sayfalarını veritabanı çağrılarını sonuçlarına dayalı boyar uygulamanın destekleyen bir veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-159">An example is a database that supports an application that paints webpages based on the results of database calls.</span></span>

<span data-ttu-id="8b5e2-160">Diğer uygulama türleriyle aynı grafikte farklı yorumlayabilir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-160">Other application types might interpret the same graph differently.</span></span> <span data-ttu-id="8b5e2-161">Örneğin, bir uygulama her gün bordro verileri işlemek çalışır ve aynı grafik varsa, bu tür bir "toplu" modeli P1 performans düzeyi ince uygulayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-161">For example, if an application tries to process payroll data each day and has the same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="8b5e2-162">200 Dtu'lar P2 performans düzeyinde karşılaştırılan 100 Dtu'lar P1 performans düzeyi vardır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-162">The P1 performance level has 100 DTUs compared to 200 DTUs at the P2 performance level.</span></span> <span data-ttu-id="8b5e2-163">P1 performans düzeyi P2 performans düzeyinin yarım performans sağlar.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-163">The P1 performance level provides half the performance of the P2 performance level.</span></span> <span data-ttu-id="8b5e2-164">Bu nedenle, yüzde 50 ' P2 CPU kullanımı yüzde 100 CPU P1 kullanımda eşittir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="8b5e2-165">Uygulama zaman aşımları yoksa, bir iş 2 saat veya tamamlamak için 2.5 saat sürerse bugün Bitti, önemli değil.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-165">If the application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours to finish, if it gets done today.</span></span> <span data-ttu-id="8b5e2-166">Bu kategorideki bir uygulama, büyük olasılıkla P1 performans düzeyi kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="8b5e2-167">Böylece tüm "büyük yoğun" troughs birine gün içinde sığdırmaya kaynak kullanımının düşük olduğunda gün sırasında süreler olduğunu olayının avantajından yararlanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-167">You can take advantage of the fact that there are periods of time during the day when resource use is lower, so that any "big peak" might spill over into one of the troughs later in the day.</span></span> <span data-ttu-id="8b5e2-168">İşleri her gün saat bitirebilirsiniz sürece P1 performans düzeyi için bu türden uygulamasının (ve tasarruf) iyi olabilir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-168">The P1 performance level might be good for that kind of application (and save money), as long as the jobs can finish on time each day.</span></span>

<span data-ttu-id="8b5e2-169">Azure SQL veritabanı çıkarır tüketilen etkin her veritabanı için kaynak bilgileri **sys.resource_stats** görünümünü **ana** her sunucu veritabanında.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-169">Azure SQL Database exposes consumed resource information for each active database in the **sys.resource_stats** view of the **master** database in each server.</span></span> <span data-ttu-id="8b5e2-170">Tablodaki verileri için 5 dakikalık aralıklarla toplanır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-170">The data in the table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="8b5e2-171">Temel, standart ve Premium hizmet katmanları ile verileri bu verileri neredeyse gerçek zamanlı analiz yerine geçmiş çözümleme için daha yararlı olacak şekilde tabloda görünmesi birden fazla 5 dakika sürebilir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-171">With the Basic, Standard, and Premium service tiers, the data can take more than 5 minutes to appear in the table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="8b5e2-172">Sorgu **sys.resource_stats** bir veritabanı yakın zamandaki geçmişini görmek için görüntülemek ve doğrulamak için mi ayırma seçtiğiniz gerektiğinde istediğiniz performans teslim.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-172">Query the **sys.resource_stats** view to see the recent history of a database and to validate whether the reservation you chose delivered the performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="8b5e2-173">Bağlanmanız gerekir **ana** mantıksal SQL veritabanı sunucunuzun sorgu için veritabanı **sys.resource_stats** aşağıdaki örneklerde.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-173">You must be connected to the **master** database of your logical SQL database server to query **sys.resource_stats** in the following examples.</span></span>
> 
> 

<span data-ttu-id="8b5e2-174">Bu örnek nasıl verileri bu görünümde gösterilen gösterir:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-174">This example shows you how the data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![Sys.resource_stats Katalog görünümü](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="8b5e2-176">Sonraki örnek kullanabileceğiniz farklı yolları gösterir **sys.resource_stats** katalog SQL veritabanınız kaynakları nasıl kullandığı hakkında bilgi almak için görünümü:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-176">The next example shows you different ways that you can use the **sys.resource_stats** catalog view to get information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="8b5e2-177">Geçen hafta kaynakta aramak için bu sorguyu çalıştırmak için veritabanı userdb1 kullanın:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-177">To look at the past week’s resource use for the database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="8b5e2-178">İş yükünüzün performans düzeyine ne kadar iyi uyduğunu değerlendirmek için her kaynak ölçümleri yönü detaya gerekir: CPU, okuma, yazma, çalışan sayısı ve oturum sayısı.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-178">To evaluate how well your workload fits the performance level, you need to drill down into each aspect of the resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="8b5e2-179">İşte bir düzeltilmiş kullanarak sorgu **sys.resource_stats** bu kaynak ölçümleri ortalama ve en yüksek değerleri bildirmek için:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-179">Here's a revised query using **sys.resource_stats** to report the average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="8b5e2-180">Bu her kaynak ölçümü ile ortalama ve en yüksek değerleri hakkında bilgi yükünüzü seçtiğiniz performans düzeyi ne kadar iyi uyduğunu değerlendirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-180">With this information about the average and maximum values of each resource metric, you can assess how well your workload fits into the performance level you chose.</span></span> <span data-ttu-id="8b5e2-181">Genellikle, değerleri ortalama **sys.resource_stats** karşı hedef boyutu kullanmak için iyi bir temel sağlar.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-181">Usually, average values from **sys.resource_stats** give you a good baseline to use against the target size.</span></span> <span data-ttu-id="8b5e2-182">Birincil ölçüm çubuğu olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="8b5e2-183">Bir örnek için standart hizmet katmanında S2 performans düzeyiyle kullanıyor olabilir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-183">For an example, you might be using the Standard service tier with S2 performance level.</span></span> <span data-ttu-id="8b5e2-184">Ortalama CPU ve g/ç okuma yüzdeleri kullanın ve yazma 40 oranın altında olan, çalışan ortalama sayısı 50 olduğu ve ortalama oturum sayısını 200.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-184">The average use percentages for CPU and I/O reads and writes are below 40 percent, the average number of workers is below 50, and the average number of sessions is below 200.</span></span> <span data-ttu-id="8b5e2-185">İş yükünüzün S1 performans düzeyine uygun.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-185">Your workload might fit into the S1 performance level.</span></span> <span data-ttu-id="8b5e2-186">Veritabanı içinde çalışan ve oturumu sınırları uygun olup olmadığını görmek kolaydır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-186">It's easy to see whether your database fits in the worker and session limits.</span></span> <span data-ttu-id="8b5e2-187">Bir veritabanı içine CPU göre daha düşük bir performans düzeyine uygun olup olmadığını görmek için okuma ve yazma, geçerli performans düzeyi DTU sayısına göre daha düşük performans düzeyine DTU sayısı ayırın ve ardından sonucu 100 ile çarpın:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-187">To see whether a database fits into a lower performance level with regards to CPU, reads, and writes, divide the DTU number of the lower performance level by the DTU number of your current performance level, and then multiply the result by 100:</span></span>
   
    <span data-ttu-id="8b5e2-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="8b5e2-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="8b5e2-189">Yüzde cinsinden iki performans düzeyleri arasında göreceli performans farkı sonucudur.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-189">The result is the relative performance difference between the two performance levels in percentage.</span></span> <span data-ttu-id="8b5e2-190">Kaynak kullanımınız bu miktar aşmadığından, iş yükünüzü daha düşük performans düzeyine uygun.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-190">If your resource use doesn't exceed this amount, your workload might fit into the lower performance level.</span></span> <span data-ttu-id="8b5e2-191">Ancak, tüm kaynak kullanım değerleri aralıklarını arayın ve belirlemek, yüzde olarak, veritabanının yükünüzü daha düşük performans düzeyine ne sıklıkta uyar gerekir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-191">However, you need to look at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into the lower performance level.</span></span> <span data-ttu-id="8b5e2-192">Aşağıdaki sorguyu kaynak boyutu, 40 oranında Biz bu örnekte, hesaplanan eşik göre başına uygun yüzde çıkarır:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-192">The following query outputs the fit percentage per resource dimension, based on the threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="8b5e2-193">Veritabanı Hizmet düzeyi hedefi (SLO) bağlı olarak, iş yükünüzü daha düşük performans düzeyine uygun olup olmadığını karar verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-193">Based on your database service level objective (SLO), you can decide whether your workload fits into the lower performance level.</span></span> <span data-ttu-id="8b5e2-194">Veritabanının yükünüzü SLO yüzde 99,9 ise ve önceki sorgunun değerlerinin tüm üç kaynak boyutları için yüzde 99,9 büyük döndürür, büyük olasılıkla, iş yükünü daha düşük performans düzeyine sığar.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-194">If your database workload SLO is 99.9 percent and the preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into the lower performance level.</span></span>
   
    <span data-ttu-id="8b5e2-195">Ayrıca uygun yüzdesiyle arayan, SLO karşılamak için sonraki daha yüksek performans düzeyine olup taşımalısınız içine Insight sağlar.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-195">Looking at the fit percentage also gives you insight into whether you should move to the next higher performance level to meet your SLO.</span></span> <span data-ttu-id="8b5e2-196">Örneğin, userdb1 geçen hafta için aşağıdaki CPU kullanımını gösterir:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-196">For example, userdb1 shows the following CPU use for the past week:</span></span>
   
   | <span data-ttu-id="8b5e2-197">Ortalama CPU yüzdesi</span><span class="sxs-lookup"><span data-stu-id="8b5e2-197">Average CPU percent</span></span> | <span data-ttu-id="8b5e2-198">En fazla CPU yüzdesi</span><span class="sxs-lookup"><span data-stu-id="8b5e2-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="8b5e2-199">24.5</span><span class="sxs-lookup"><span data-stu-id="8b5e2-199">24.5</span></span> |<span data-ttu-id="8b5e2-200">100.00</span><span class="sxs-lookup"><span data-stu-id="8b5e2-200">100.00</span></span> |
   
    <span data-ttu-id="8b5e2-201">Ortalama CPU sınırı veritabanı performans düzeyini de uyar performans düzeyini çeyreği hakkındadır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-201">The average CPU is about a quarter of the limit of the performance level, which would fit well into the performance level of the database.</span></span> <span data-ttu-id="8b5e2-202">Ancak, veritabanı performans düzeyi sınırına ulaştığında en büyük değeri gösterir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-202">But, the maximum value shows that the database reaches the limit of the performance level.</span></span> <span data-ttu-id="8b5e2-203">Sonraki daha yüksek performans düzeyine geçmeye gerekiyor mu?</span><span class="sxs-lookup"><span data-stu-id="8b5e2-203">Do you need to move to the next higher performance level?</span></span> <span data-ttu-id="8b5e2-204">Ne birçok kez iş yükü ulaştığında yüzde 100 arayın ve veritabanı yükünüzü SLO karşılaştırın.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-204">Look at how many times your workload reaches 100 percent, and then compare it to your database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="8b5e2-205">Bu sorgu bir değer döndürürse yüzde 99,9'den az üç kaynak boyutlardan herhangi birinde için sonraki daha yüksek performans düzeyine taşımayı düşünün veya SQL veritabanı üzerindeki yükü azaltmak için uygulama ayarlama tekniklerini kullanın.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-205">If this query returns a value less than 99.9 percent for any of the three resource dimensions, consider either moving to the next higher performance level or use application-tuning techniques to reduce the load on the SQL database.</span></span>
4. <span data-ttu-id="8b5e2-206">Bu alıştırmada ayrıca tahmini iş yükü artış gelecekte göz önünde bulundurur.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-206">This exercise also considers your projected workload increase in the future.</span></span>

<span data-ttu-id="8b5e2-207">Elastik havuzlar için bu bölümde açıklanan olan tekniklerle havuzda bulunan tek veritabanlarını izleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-207">For elastic pools, you can monitor individual databases in the pool with the techniques described in this section.</span></span> <span data-ttu-id="8b5e2-208">Ancak havuzu bir bütün olarak da izleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-208">But you can also monitor the pool as a whole.</span></span> <span data-ttu-id="8b5e2-209">Bilgi için bkz. [Elastik havuz izleme ve yönetme](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="8b5e2-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="8b5e2-210">Maksimum eşzamanlı istek</span><span class="sxs-lookup"><span data-stu-id="8b5e2-210">Maximum concurrent requests</span></span>
<span data-ttu-id="8b5e2-211">Eşzamanlı istek sayısını görmek için bu Transact-SQL sorgusu SQL veritabanınızda çalıştırın:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-211">To see the number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="8b5e2-212">Bir şirket içi SQL Server veritabanının iş yükü çözümlemek için çözümlemek istediğiniz belirli veritabanı üzerinde filtre uygulamak için bu sorguyu değiştirin.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-212">To analyze the workload of an on-premises SQL Server database, modify this query to filter on the specific database you want to analyze.</span></span> <span data-ttu-id="8b5e2-213">Örneğin, Veritabanım adlı bir şirket içi veritabanınız varsa, bu Transact-SQL sorgusu bu veritabanında eşzamanlı istek sayısını döndürür:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns the count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="8b5e2-214">Bu, zaman içinde yalnızca tek bir noktada anlık görüntüsüdür.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="8b5e2-215">İş yükü ve eş zamanlı istek gereksinimlerini daha iyi anlamak için zaman içinde çok sayıda toplamak gerekir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-215">To get a better understanding of your workload and concurrent request requirements, you'll need to collect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="8b5e2-216">En fazla eşzamanlı oturum açma</span><span class="sxs-lookup"><span data-stu-id="8b5e2-216">Maximum concurrent logins</span></span>
<span data-ttu-id="8b5e2-217">Oturum açma bilgileri sıklığını hakkında bir fikir edinmek için kullanıcı ve uygulama desenleri analiz edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-217">You can analyze your user and application patterns to get an idea of the frequency of logins.</span></span> <span data-ttu-id="8b5e2-218">Bu veya bu makalede aşağıdakiler ele diğer sınırları basarsa değil olduğundan emin olmak için bir sınama ortamında gerçek yükleri de çalıştırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-218">You also can run real-world loads in a test environment to make sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="8b5e2-219">Tek bir sorgu veya dinamik yönetim görünümünü (DMV), eşzamanlı oturum açma sayar gösterebilir veya geçmişi yok.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="8b5e2-220">Hizmet birden çok istemci aynı bağlantı dizesini kullanırsanız, her oturum açma kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-220">If multiple clients use the same connection string, the service authenticates each login.</span></span> <span data-ttu-id="8b5e2-221">10 kullanıcılar aynı anda bir veritabanına aynı kullanıcı adı ve parola kullanarak bağlanıyorsa, 10 eşzamanlı oturum açma olacaktır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-221">If 10 users simultaneously connect to a database by using the same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="8b5e2-222">Bu sınır, oturum açma ve kimlik doğrulama süresi uygulanır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-222">This limit applies only to the duration of the login and authentication.</span></span> <span data-ttu-id="8b5e2-223">Aynı 10 kullanıcılar veritabanına sırayla bağlanıyorsa, eşzamanlı oturum açma sayısı hiçbir zaman 1'den büyük olacaktır.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-223">If the same 10 users connect to the database sequentially, the number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="8b5e2-224">Şu anda, bu sınır esnek havuzlar veritabanları için geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-224">Currently, this limit does not apply to databases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="8b5e2-225">En fazla oturum</span><span class="sxs-lookup"><span data-stu-id="8b5e2-225">Maximum sessions</span></span>
<span data-ttu-id="8b5e2-226">Geçerli etkin oturum sayısı görmek için bu Transact-SQL sorgusu SQL veritabanınızda çalıştırın:</span><span class="sxs-lookup"><span data-stu-id="8b5e2-226">To see the number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="8b5e2-227">Bir şirket içi SQL Server iş yükü analiz etme, belirli bir veritabanında odaklanmak için sorguyu değiştirin.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-227">If you're analyzing an on-premises SQL Server workload, modify the query to focus on a specific database.</span></span> <span data-ttu-id="8b5e2-228">Bu sorgu, Azure SQL veritabanına taşıma düşünüyorsanız veritabanı için olası oturum gereksinimlerini belirlemenize yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-228">This query helps you determine possible session needs for the database if you are considering moving it to Azure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="8b5e2-229">Yeniden, bu sorguları zaman içinde nokta sayısını döndürür.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="8b5e2-230">Zaman içinde birden fazla örnek toplarsanız kullanmak en iyi anlaşılmasını oturumunuz sahip olacaksınız.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-230">If you collect multiple samples over time, you’ll have the best understanding of your session use.</span></span>

<span data-ttu-id="8b5e2-231">SQL veritabanı analize geçmiş istatistikleri oturumlarını sorgulayarak alabileceğiniz [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) Görünüm ve gözden geçirme **active_session_count** sütun.</span><span class="sxs-lookup"><span data-stu-id="8b5e2-231">For SQL Database analysis, you can get historical statistics on sessions by querying the [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing the **active_session_count** column.</span></span> 
