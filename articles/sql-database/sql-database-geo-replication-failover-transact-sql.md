---
title: "Azure SQL veritabanı için TSQL:Initiate yük devretme | Microsoft Docs"
description: "Transact-SQL kullanarak Azure SQL veritabanı için planlanmış veya planlanmamış bir yük devretme başlatın"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="268cd-103">Azure SQL Database Transact-SQL ile için planlanmış veya planlanmamış bir yük devretme başlatın</span><span class="sxs-lookup"><span data-stu-id="268cd-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="268cd-104">Bu makale size nasıl gösterir tooinitiate yük devretme tooa ikincil SQL veritabanı Transact-SQL kullanarak.</span><span class="sxs-lookup"><span data-stu-id="268cd-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="268cd-105">tooconfigure coğrafi çoğaltma, bkz: [Azure SQL veritabanı için coğrafi çoğaltma yapılandırma](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="268cd-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="268cd-106">tooinitiate yük devretme hello aşağıdaki gerekir:</span><span class="sxs-lookup"><span data-stu-id="268cd-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="268cd-107">Birincil hello DBManager olan bir oturum açma</span><span class="sxs-lookup"><span data-stu-id="268cd-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="268cd-108">Coğrafi replicate olacak hello yerel veritabanı db_ownership sahip</span><span class="sxs-lookup"><span data-stu-id="268cd-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="268cd-109">DBManager hello partner sunucuları toowhich üzerinde olmanız coğrafi çoğaltma yapılandırır</span><span class="sxs-lookup"><span data-stu-id="268cd-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="268cd-110">En yeni sürümü SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="268cd-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="268cd-111">Her zaman hello kullanmanız önerilir Management Studio tooremain en son sürümünü Azure ve SQL veritabanı güncelleştirmeleri tooMicrosoft ile eşitlenir.</span><span class="sxs-lookup"><span data-stu-id="268cd-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="268cd-112">[SQL Server Management Studio’yu güncelleyin](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="268cd-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="268cd-113">İkincil veritabanı toobecome hello yeni birincil yükseltme planlı bir yük devretme başlatın</span><span class="sxs-lookup"><span data-stu-id="268cd-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="268cd-114">Merhaba kullanabilirsiniz **ALTER DATABASE** deyimi toopromote ikincil veritabanı toobecome hello yeni birincil, ikincil bir hello varolan birincil toobecome indirgeme planlı bir biçimde veritabanı.</span><span class="sxs-lookup"><span data-stu-id="268cd-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="268cd-115">Bu bildirimi hello Azure SQL Database mantıksal sunucusunda hangi hello yükseltilmekte coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu hello ana veritabanı üzerinde yürütülür.</span><span class="sxs-lookup"><span data-stu-id="268cd-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="268cd-116">Bu işlev için planlanan yük devretme, gibi hello DR ayrıntısına sırasında tasarlanmıştır ve bu hello birincil veritabanı kullanılabilir olmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="268cd-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="268cd-117">Merhaba komutu iş akışının izlenmesi hello gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="268cd-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="268cd-118">Geçici olarak anahtarları çoğaltma toosynchronous modu, tüm bekleyen işlemleri toobe neden toohello ikincil ve tüm yeni işlemleri engelleme Temizlenen;</span><span class="sxs-lookup"><span data-stu-id="268cd-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="268cd-119">Anahtarları hello iki hello coğrafi çoğaltma ortaklığı veritabanlarında rolleri hello.</span><span class="sxs-lookup"><span data-stu-id="268cd-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="268cd-120">Bu sıra iki veritabanı hello rolleri geçin ve bu nedenle veri kaybı olmayacaktır önce eşitlenir bu hello güvence altına alır.</span><span class="sxs-lookup"><span data-stu-id="268cd-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="268cd-121">Merhaba rolleri geçiş sırasında hangi sırasında her iki veritabanı (Merhaba 0 too25 saniye üzerinde sırasını) kullanılamaz kısa bir süre yoktur.</span><span class="sxs-lookup"><span data-stu-id="268cd-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="268cd-122">Otomatik olarak Hello birincil veritabanı varsa, birden fazla ikincil veritabanları, hello komutu RECONFIGURE diğer ikincil tooconnect toohello yeni birincil hello.</span><span class="sxs-lookup"><span data-stu-id="268cd-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="268cd-123">Merhaba tüm işlemi normal koşullarda dakika toocomplete değerinden almanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="268cd-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="268cd-124">Daha fazla bilgi için bkz: [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) ve [hizmet katmanları](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="268cd-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="268cd-125">Aşağıdaki adımları tooinitiate planlanmış bir yük devretme hello kullanın.</span><span class="sxs-lookup"><span data-stu-id="268cd-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="268cd-126">Management Studio'da coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu toohello Azure SQL Database mantıksal sunucusuna bağlanın.</span><span class="sxs-lookup"><span data-stu-id="268cd-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="268cd-127">Merhaba Hello veritabanları klasörünü açın, **sistem veritabanları** klasörünü sağ tıklatın **ana**ve ardından **yeni sorgu**.</span><span class="sxs-lookup"><span data-stu-id="268cd-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="268cd-128">Merhaba aşağıdaki kullanın **ALTER DATABASE** deyimi tooswitch hello ikincil veritabanı toohello birincil rolü.</span><span class="sxs-lookup"><span data-stu-id="268cd-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="268cd-129">Tıklatın **yürütme** toorun hello sorgu.</span><span class="sxs-lookup"><span data-stu-id="268cd-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="268cd-130">Nadir durumlarda hello işlemi tamamlayamıyor ve takılan görünebilir mümkündür.</span><span class="sxs-lookup"><span data-stu-id="268cd-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="268cd-131">Bu durumda, hello kullanıcı hello zorla yük devri komutunu yürütün ve veri kaybı kabul edin.</span><span class="sxs-lookup"><span data-stu-id="268cd-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="268cd-132">Merhaba birincil veritabanı toohello ikincil veritabanını planlanmamış bir yük devretmeyi başlatın</span><span class="sxs-lookup"><span data-stu-id="268cd-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="268cd-133">Merhaba kullanabilirsiniz **ALTER DATABASE** deyimi toopromote ikincil veritabanı toobecome hello yeni birincil veritabanı hello varolan birincil toobecome hello indirgeme zorlama bir planlanmamış şekilde, bir ikincil aynı anda zaman hello birincil veritabanı artık kullanılamıyor.</span><span class="sxs-lookup"><span data-stu-id="268cd-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="268cd-134">Bu bildirimi hello Azure SQL Database mantıksal sunucusunda hangi hello yükseltilmekte coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu hello ana veritabanı üzerinde yürütülür.</span><span class="sxs-lookup"><span data-stu-id="268cd-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="268cd-135">Bu işlevsellik, hello veritabanı geri yükleme kullanılabilirliğini kritik ve bazı veri kaybı kabul edilebilir olduğunda, olağanüstü durum kurtarma için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="268cd-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="268cd-136">Merhaba zorla yük devretme çağrıldığında, belirtilen ikincil veritabanı hemen hello birincil veritabanı haline gelir ve yazma işlemleri kabul başlar.</span><span class="sxs-lookup"><span data-stu-id="268cd-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="268cd-137">Bu yeni birincil veritabanı ile mümkün tooreconnect Hello özgün birincil veritabanı olduğunda hemen artımlı yedekleme hello özgün birincil veritabanı alınır ve hello yeni birincil veritabanı için ikincil bir veritabanı içine hello eski birincil veritabanına yapılan; Sonuç olarak, yalnızca eşitleme çoğaltmasının hello yeni birincil değil.</span><span class="sxs-lookup"><span data-stu-id="268cd-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="268cd-138">Ancak, kaydedilen toorecover veri Hello kullanıcı isterse, zaman içinde nokta geri hello ikincil veritabanlarında, desteklenmediğinden hello zorla yük devretme oluşmadan önce değil olsaydı toohello eski birincil veritabanı toohello yeni birincil veritabanı çoğaltılan, Merhaba kullanıcının tooengage destek toorecover gerekir bu verileri kaybolur.</span><span class="sxs-lookup"><span data-stu-id="268cd-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="268cd-139">Otomatik olarak Hello birincil veritabanı varsa, birden fazla ikincil veritabanları, hello komutu RECONFIGURE diğer ikincil tooconnect toohello yeni birincil hello.</span><span class="sxs-lookup"><span data-stu-id="268cd-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="268cd-140">Aşağıdaki adımları tooinitiate planlanmamış bir yük devretme hello kullanın.</span><span class="sxs-lookup"><span data-stu-id="268cd-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="268cd-141">Management Studio'da coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu toohello Azure SQL Database mantıksal sunucusuna bağlanın.</span><span class="sxs-lookup"><span data-stu-id="268cd-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="268cd-142">Merhaba Hello veritabanları klasörünü açın, **sistem veritabanları** klasörünü sağ tıklatın **ana**ve ardından **yeni sorgu**.</span><span class="sxs-lookup"><span data-stu-id="268cd-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="268cd-143">Merhaba aşağıdaki kullanın **ALTER DATABASE** deyimi tooswitch hello ikincil veritabanı toohello birincil rolü.</span><span class="sxs-lookup"><span data-stu-id="268cd-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="268cd-144">Tıklatın **yürütme** toorun hello sorgu.</span><span class="sxs-lookup"><span data-stu-id="268cd-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="268cd-145">Birincil ve ikincil çevrimiçi olduğunda hello komutu verilirse hello eski birincil olacak yeni ikincil veri eşitleme olmadan hemen hello.</span><span class="sxs-lookup"><span data-stu-id="268cd-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="268cd-146">Bazı veri kaybı hello komut verildiğinde uygulanıyor işlemleri Hello birincil olduğunda oluşabilir.</span><span class="sxs-lookup"><span data-stu-id="268cd-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="268cd-147">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="268cd-147">Next steps</span></span>
* <span data-ttu-id="268cd-148">Yük devretme sonrasında hello yeni birincil sunucu ve veritabanı hello kimlik doğrulama gereksinimleri yapılandırılmış emin olun.</span><span class="sxs-lookup"><span data-stu-id="268cd-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="268cd-149">Ayrıntılar için bkz [olağanüstü durum kurtarma işleminden sonra SQL veritabanı güvenlik](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="268cd-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="268cd-150">Aktif coğrafi bir olağanüstü durum kurtarma ayrıntıya gerçekleştirme ve öncesi kurtarma ve kurtarma sonrası adımları dahil olmak üzere çoğaltma, kullanarak sonra bir olağanüstü durum kurtarma toolearn bakın [olağanüstü durum kurtarma](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="268cd-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="268cd-151">Aktif coğrafi çoğaltma hakkında bir Sasha Nosov blog gönderisi için bkz: [Spotlight yeni coğrafi çoğaltma özellikleri hakkında](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="268cd-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="268cd-152">Bulut uygulamaları toouse aktif coğrafi çoğaltma tasarlama hakkında daha fazla bilgi için bkz: [coğrafi çoğaltma'yı kullanarak iş sürekliliği için bulut uygulama tasarlama](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="268cd-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="268cd-153">Aktif coğrafi çoğaltma ile esnek havuzları kullanma hakkında daha fazla bilgi için bkz: [esnek havuz olağanüstü durum kurtarma stratejilerini](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="268cd-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="268cd-154">İş sürekliliği genel bakış için bkz: [iş Sürekliliğine genel bakış](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="268cd-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

