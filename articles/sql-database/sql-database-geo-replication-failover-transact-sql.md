---
title: "Azure SQL veritabanı için TSQL:Initiate yük devretme | Microsoft Docs"
description: "Transact-SQL kullanarak Azure SQL veritabanı için planlanmış veya planlanmamış bir yük devretme başlatın"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 459941d2c82e5d4ef62beab4ccf775ab8f5efce4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="e6612-103">Azure SQL Database Transact-SQL ile için planlanmış veya planlanmamış bir yük devretme başlatın</span><span class="sxs-lookup"><span data-stu-id="e6612-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="e6612-104">Bu makalede Transact-SQL kullanarak bir ikincil SQL veritabanı yük devretme başlatın kullanmayı gösterir.</span><span class="sxs-lookup"><span data-stu-id="e6612-104">This article shows you how to initiate failover to a secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="e6612-105">Coğrafi çoğaltma yapılandırmak için bkz: [Azure SQL veritabanı için coğrafi çoğaltma yapılandırma](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="e6612-105">To configure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="e6612-106">Yük devretme başlatmak için aşağıdakiler gerekir:</span><span class="sxs-lookup"><span data-stu-id="e6612-106">To initiate failover, you need the following:</span></span>

* <span data-ttu-id="e6612-107">Birincil DBManager olan bir oturum açma</span><span class="sxs-lookup"><span data-stu-id="e6612-107">A login that is DBManager on the primary</span></span>
* <span data-ttu-id="e6612-108">Coğrafi replicate olacak yerel veritabanı db_ownership sahip</span><span class="sxs-lookup"><span data-stu-id="e6612-108">Have db_ownership of the local database that you will geo-replicate</span></span>
* <span data-ttu-id="e6612-109">Coğrafi çoğaltma yapılandıracak partner sunucuları üzerinde DBManager olabilir</span><span class="sxs-lookup"><span data-stu-id="e6612-109">Be DBManager on the partner server(s) to which you will configure geo-replication</span></span>
* <span data-ttu-id="e6612-110">En yeni sürümü SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="e6612-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e6612-111">Microsoft Azure ve SQL Veritabanı güncelleştirmeleriyle aynı sürümde olmak için her zaman en güncel Management Studio sürümünü kullanmanız önerilir.</span><span class="sxs-lookup"><span data-stu-id="e6612-111">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="e6612-112">[SQL Server Management Studio’yu güncelleyin](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="e6612-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-to-become-the-new-primary"></a><span data-ttu-id="e6612-113">Yeni birincil olmasını ikincil bir veritabanı yükseltme planlı bir yük devretme başlatın</span><span class="sxs-lookup"><span data-stu-id="e6612-113">Initiate a planned failover promoting a secondary database to become the new primary</span></span>
<span data-ttu-id="e6612-114">Kullanabileceğiniz **ALTER DATABASE** ikincil olmak için var olan birincil indirgeme planlı bir şekilde yeni birincil veritabanı olmak için ikincil bir veritabanını yükseltmek için deyimi.</span><span class="sxs-lookup"><span data-stu-id="e6612-114">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in a planned fashion, demoting the existing primary to become a secondary.</span></span> <span data-ttu-id="e6612-115">Bu ifade, yükseltilmekte coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu Azure SQL Database mantıksal sunucusu üzerindeki ana veritabanı üzerinde yürütülür.</span><span class="sxs-lookup"><span data-stu-id="e6612-115">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="e6612-116">Bu işlev için planlanan yük devretme, DR ayrıntısına sırasında gibi tasarlanmıştır ve birincil veritabanının kullanılabilir olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="e6612-116">This functionality is designed for planned failover, such as during the DR drills, and requires that the primary database be available.</span></span>

<span data-ttu-id="e6612-117">Komutu aşağıdaki iş akışını gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="e6612-117">The command performs the following workflow:</span></span>

1. <span data-ttu-id="e6612-118">Geçici olarak çoğaltma ikincil kopyalanması tüm bekleyen işlemleri neden ve tüm yeni işlemleri engelleme zaman uyumlu moduna geçer;</span><span class="sxs-lookup"><span data-stu-id="e6612-118">Temporarily switches replication to synchronous mode, causing all outstanding transactions to be flushed to the secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="e6612-119">İki veritabanı rolleri coğrafi çoğaltma ortaklığı geçer.</span><span class="sxs-lookup"><span data-stu-id="e6612-119">Switches the roles of the two databases in the geo-replication partnership.</span></span>  

<span data-ttu-id="e6612-120">Bu sıra iki veritabanı rolleri geçin ve bu nedenle veri kaybı olmayacaktır önce eşitlenir güvence altına alır.</span><span class="sxs-lookup"><span data-stu-id="e6612-120">This sequence guarantees that the two databases are synchronized before the roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="e6612-121">Rolleri geçiş sırasında hangi sırasında her iki veritabanı (0-25 saniye terabayt) kullanılamaz kısa bir süre yoktur.</span><span class="sxs-lookup"><span data-stu-id="e6612-121">There is a short period during which both databases are unavailable (on the order of 0 to 25 seconds) while the roles are switched.</span></span> <span data-ttu-id="e6612-122">Birincil veritabanında birden fazla ikincil veritabanı varsa, yeni birincil bağlanmak için diğer ikincil kopya komutu otomatik olarak yeniden yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="e6612-122">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>  <span data-ttu-id="e6612-123">Tüm işlemi normal koşullarda tamamlanması bir dakikadan az zamanınızı.</span><span class="sxs-lookup"><span data-stu-id="e6612-123">The entire operation should take less than a minute to complete under normal circumstances.</span></span> <span data-ttu-id="e6612-124">Daha fazla bilgi için bkz: [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) ve [hizmet katmanları](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="e6612-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="e6612-125">Planlanmış bir yük devretme başlatmak için aşağıdaki adımları kullanın.</span><span class="sxs-lookup"><span data-stu-id="e6612-125">Use the following steps to initiate a planned failover.</span></span>

1. <span data-ttu-id="e6612-126">Management Studio'da coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu Azure SQL Database mantıksal sunucusuna bağlanın.</span><span class="sxs-lookup"><span data-stu-id="e6612-126">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="e6612-127">Veritabanları klasörünü açın, **sistem veritabanları** klasörünü sağ tıklatın **ana**ve ardından **yeni sorgu**.</span><span class="sxs-lookup"><span data-stu-id="e6612-127">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="e6612-128">Aşağıdaki **ALTER DATABASE** ikincil veritabanının birincil role geçiş yapmak için deyimi.</span><span class="sxs-lookup"><span data-stu-id="e6612-128">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="e6612-129">Sorguyu çalıştırmak için **Yürüt**'e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e6612-129">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="e6612-130">Nadir durumlarda işlemi tamamlayamıyor ve takılan görünebilir mümkündür.</span><span class="sxs-lookup"><span data-stu-id="e6612-130">In rare cases, it is possible that the operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="e6612-131">Bu durumda, kullanıcı zorla yük devri komutunu yürütün ve veri kaybı kabul edin.</span><span class="sxs-lookup"><span data-stu-id="e6612-131">In this case, the user can execute the force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-the-primary-database-to-the-secondary-database"></a><span data-ttu-id="e6612-132">Planlanmamış yük devretme birincil veritabanından ikincil veritabanını başlatmak</span><span class="sxs-lookup"><span data-stu-id="e6612-132">Initiate an unplanned failover from the primary database to the secondary database</span></span>
<span data-ttu-id="e6612-133">Kullanabileceğiniz **ALTER DATABASE** birincil veritabanı artık kullanılabilir olmadığında bir kerede bir ikincil olmak için var olan birincil indirgeme zorlama planlanmamış bir şekilde yeni birincil veritabanı olmak için ikincil bir veritabanını yükseltmek için deyimi.</span><span class="sxs-lookup"><span data-stu-id="e6612-133">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in an unplanned fashion, forcing the demotion of the existing primary to become a secondary at a time when the primary database is no longer available.</span></span> <span data-ttu-id="e6612-134">Bu ifade, yükseltilmekte coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu Azure SQL Database mantıksal sunucusu üzerindeki ana veritabanı üzerinde yürütülür.</span><span class="sxs-lookup"><span data-stu-id="e6612-134">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="e6612-135">Bu işlevsellik, kullanılabilirlik veritabanının geri yüklenmesi önemli ve bazı veri kaybı kabul edilebilir olduğunda, olağanüstü durum kurtarma için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="e6612-135">This functionality is designed for disaster recovery when restoring availability of the database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="e6612-136">Zorla yük devretme çağrıldığında, belirtilen ikincil veritabanı hemen birincil veritabanı haline gelir ve yazma işlemleri kabul başlar.</span><span class="sxs-lookup"><span data-stu-id="e6612-136">When forced failover is invoked, the specified secondary database immediately becomes the primary database and begins accepting write transactions.</span></span> <span data-ttu-id="e6612-137">Özgün birincil veritabanı bu yeni birincil veritabanı ile bağlanana hemen artımlı yedekleme özgün birincil veritabanında alınır ve yeni birincil veritabanı için ikincil bir veritabanı içine eski birincil veritabanında yapılan; Sonuç olarak, yalnızca eşitleme çoğaltmasının yeni birincil değil.</span><span class="sxs-lookup"><span data-stu-id="e6612-137">As soon as the original primary database is able to reconnect with this new primary database, an incremental backup is taken on the original primary database and the old primary database is made into a secondary database for the new primary database; subsequently, it is merely a synchronizing replica of the new primary.</span></span>

<span data-ttu-id="e6612-138">Ancak, zorla yük devretme oluşmadan önce yeni birincil veritabanına çoğaltılmamış olmayan eski birincil veritabanına gönderilen verileri kurtarmak kullanıcı isterse, zaman içinde nokta geri ikincil veritabanlarında desteklenmediğinden, bu veri kaybı kurtarmak için destek bulunmaya kullanıcı gerekir.</span><span class="sxs-lookup"><span data-stu-id="e6612-138">However, because Point In Time Restore is not supported on the secondary databases, if the user wishes to recover data committed to the old primary database that had not been replicated to the new primary database before the forced failover occurred, the user will need to engage support to recover this lost data.</span></span>

<span data-ttu-id="e6612-139">Birincil veritabanında birden fazla ikincil veritabanı varsa, yeni birincil bağlanmak için diğer ikincil kopya komutu otomatik olarak yeniden yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="e6612-139">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>

<span data-ttu-id="e6612-140">Planlanmamış bir yük devretme başlatmak için aşağıdaki adımları kullanın.</span><span class="sxs-lookup"><span data-stu-id="e6612-140">Use the following steps to initiate an unplanned failover.</span></span>

1. <span data-ttu-id="e6612-141">Management Studio'da coğrafi olarak çoğaltılmış ikincil veritabanının bulunduğu Azure SQL Database mantıksal sunucusuna bağlanın.</span><span class="sxs-lookup"><span data-stu-id="e6612-141">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="e6612-142">Veritabanları klasörünü açın, **sistem veritabanları** klasörünü sağ tıklatın **ana**ve ardından **yeni sorgu**.</span><span class="sxs-lookup"><span data-stu-id="e6612-142">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="e6612-143">Aşağıdaki **ALTER DATABASE** ikincil veritabanının birincil role geçiş yapmak için deyimi.</span><span class="sxs-lookup"><span data-stu-id="e6612-143">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="e6612-144">Sorguyu çalıştırmak için **Yürüt**'e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e6612-144">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="e6612-145">Birincil ve ikincil çevrimiçi olduğunda komutu verildikten eski birincil veri eşitleme olmadan hemen yeni ikincil olur.</span><span class="sxs-lookup"><span data-stu-id="e6612-145">If the command is issued when both primary and secondary are online the old primary will become the new secondary immediately without data synchronization.</span></span> <span data-ttu-id="e6612-146">Bazı veri kaybı komutu verildiğinde uygulanıyor işlemleri birincil ortaya çıkabilir.</span><span class="sxs-lookup"><span data-stu-id="e6612-146">If the primary is committing transactions when the command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="e6612-147">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="e6612-147">Next steps</span></span>
* <span data-ttu-id="e6612-148">Yük devretme işleminden sonra yeni birincil sunucu ve veritabanı için kimlik doğrulama gereksinimlerini yapılandırılmış emin olun.</span><span class="sxs-lookup"><span data-stu-id="e6612-148">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="e6612-149">Ayrıntılar için bkz [olağanüstü durum kurtarma işleminden sonra SQL veritabanı güvenlik](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="e6612-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="e6612-150">Aktif coğrafi bir olağanüstü durum kurtarma ayrıntıya gerçekleştirme ve öncesi kurtarma ve kurtarma sonrası adımları dahil olmak üzere çoğaltma, kullanarak sonra bir olağanüstü durum kurtarma öğrenmek için bkz: [olağanüstü durum kurtarma](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="e6612-150">To learn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="e6612-151">Aktif coğrafi çoğaltma hakkında bir Sasha Nosov blog gönderisi için bkz: [Spotlight yeni coğrafi çoğaltma özellikleri hakkında](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="e6612-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="e6612-152">Aktif coğrafi çoğaltma kullanmak üzere bulut uygulamaları tasarlama hakkında daha fazla bilgi için bkz: [coğrafi çoğaltma'yı kullanarak iş sürekliliği için bulut uygulama tasarlama](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="e6612-152">For information about designing cloud applications to use active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="e6612-153">Aktif coğrafi çoğaltma ile esnek havuzları kullanma hakkında daha fazla bilgi için bkz: [esnek havuz olağanüstü durum kurtarma stratejilerini](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="e6612-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="e6612-154">İş sürekliliği genel bakış için bkz: [iş Sürekliliğine genel bakış](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="e6612-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

