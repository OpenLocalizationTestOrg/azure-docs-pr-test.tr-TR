---
title: "Azure SQL Database kullanan çok kiracılı uygulama aaaProvision yeni kiracılar | Microsoft Docs"
description: "Nasıl tooprovision ve yeni katalog Kiracı hello Wingtip SaaS uygulama öğrenin"
keywords: "sql veritabanı öğreticisi"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="80865-104">Yeni kiracılar sağlamak ve hello kataloğunda kaydetme</span><span class="sxs-lookup"><span data-stu-id="80865-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="80865-105">Bu öğreticide, hello sağlamak ve Katalog SaaS desenleri ve hello Wingtip SaaS uygulamasının nasıl uygulandığı hakkında bilgi edinin.</span><span class="sxs-lookup"><span data-stu-id="80865-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="80865-106">Oluşturun ve yeni Kiracı veritabanlarını başlatmak ve bunları hello uygulamanın Kiracı kataloğunda kaydedin.</span><span class="sxs-lookup"><span data-stu-id="80865-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="80865-107">başlangıç kataloğu hello eşlemesini hello SaaS uygulamanın birçok kiracılar ve verilerini tutan bir veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="80865-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="80865-108">başlangıç kataloğu uygulama isteklerini toohello doğru veritabanı yönlendirerek önemli bir rol oynar.</span><span class="sxs-lookup"><span data-stu-id="80865-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="80865-109">Bu öğreticide şunların nasıl yapıldığını öğreneceksiniz:</span><span class="sxs-lookup"><span data-stu-id="80865-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="80865-110">Nasıl bu uygulanan aracılığıyla atlama dahil olmak üzere tek yeni bir kiracı sağlama</span><span class="sxs-lookup"><span data-stu-id="80865-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="80865-111">Ek kiracı grubu sağlama</span><span class="sxs-lookup"><span data-stu-id="80865-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="80865-112">Bu öğretici, Önkoşullar aşağıdaki yapma emin hello tamamlanır toocomplete:</span><span class="sxs-lookup"><span data-stu-id="80865-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="80865-113">Merhaba Wingtip SaaS uygulaması dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="80865-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="80865-114">beş dakikadan kısa toodeploy bakın [dağıtma ve Merhaba Wingtip SaaS uygulaması keşfedin.](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="80865-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="80865-115">Azure PowerShell’in yüklendiğinden.</span><span class="sxs-lookup"><span data-stu-id="80865-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="80865-116">Ayrıntılar için bkz. [Azure PowerShell’i kullanmaya başlama](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="80865-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="80865-117">Giriş toohello SaaS katalog düzeni</span><span class="sxs-lookup"><span data-stu-id="80865-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="80865-118">Bir veritabanı yedeği çok kiracılı SaaS uygulamasına, her bir kiracı için bilgi depolandığı önemli tooknow değil.</span><span class="sxs-lookup"><span data-stu-id="80865-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="80865-119">Merhaba SaaS katalog desende katalog her Kiracı arasında verilerini depolandıkları kullanılan toohold hello eşleme veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="80865-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="80865-120">Merhaba Wingtip SaaS uygulaması tek Kiracı veritabanı mimarisi kullanır, ancak bir çok kiracılı veya tek Kiracı veritabanı kullanılıp kullanılmadığını Kiracı veritabanı eşleme bir katalogda depolanması hello temel desenini geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="80865-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="80865-121">Her bir kiracı hello kataloğunda tanımlayan bir anahtar atanır ve olduğu hello uygun veritabanı toohello konumunu eşlenmiş.</span><span class="sxs-lookup"><span data-stu-id="80865-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="80865-122">Merhaba Wingtip SaaS uygulamada karmasını hello kiracının adı hello anahtarı oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="80865-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="80865-123">Bu tooconstruct hello anahtarı hello uygulama URL'si toobe hello Kiracı adı kısmını kullanılan sağlar.</span><span class="sxs-lookup"><span data-stu-id="80865-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="80865-124">Diğer Kiracı anahtar düzenleri kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="80865-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="80865-125">başlangıç kataloğu hello adını veya Merhaba uygulaması üzerinde en az etkiyle değiştirilen hello veritabanı toobe konumunu sağlar.</span><span class="sxs-lookup"><span data-stu-id="80865-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="80865-126">Çok Kiracı veritabanı modelinde, bu da 'Kiracı veritabanları arasında taşıma' düzenler.</span><span class="sxs-lookup"><span data-stu-id="80865-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="80865-127">bir kiracı olup olmadığını Hello katalog de kullanılan tooindicate olabilir veya veritabanı bakım veya başka eylemler için çevrimdışı.</span><span class="sxs-lookup"><span data-stu-id="80865-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="80865-128">Bu hello incelediniz [tek bir kiracı öğretici geri](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="80865-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="80865-129">Ayrıca, bir SaaS uygulaması için bir yönetim veritabanı etkili olur, hello katalog ek Kiracı ya da veritabanı meta veri depolayabilir, hello gibi bir veritabanı, şema sürümü, hizmet planı veya SLA sürümünü veya katmanı tootenants ve diğer bilgiler, sunduğu Uygulama Yönetimi, müşteri desteği veya devops işlemler sağlar.</span><span class="sxs-lookup"><span data-stu-id="80865-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="80865-130">SaaS uygulamasına Hello hello Katalog veritabanı araçları etkinleştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80865-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="80865-131">Hello incelediniz kullanılan tooenable arası Kiracı sorgu Hello Wingtip SaaS örnek hello katalogdur [geçici analytics Öğreticisi](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="80865-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="80865-132">Veritabanları arası iş yönetimi hello incelediniz [Şema Yönetimi](sql-database-saas-tutorial-schema-management.md) ve [Kiracı analytics](sql-database-saas-tutorial-tenant-analytics.md) öğreticileri.</span><span class="sxs-lookup"><span data-stu-id="80865-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="80865-133">Merhaba Wingtip SaaS uygulamada hello katalog hello hello parça yönetim özellikleri kullanılarak uygulanır [esnek veritabanı istemci kitaplığı (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="80865-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="80865-134">bir uygulama toocreate Hello EDCL sağlar, yönetmek ve bir veritabanı yedeği parça eşleme kullanın.</span><span class="sxs-lookup"><span data-stu-id="80865-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="80865-135">Bir parça eşleme parça (veritabanları) ve anahtarları (kiracılar) ile veritabanları arasında hello eşleme listesini içerir.</span><span class="sxs-lookup"><span data-stu-id="80865-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="80865-136">EDCL işlevleri Kiracı toocreate hello girişleri hello parça eşlemesindeki sağlama sırasında uygulamaları veya PowerShell betikleri kullanılabilir ve uygulamaları tooefficiently toohello doğru veritabanı bağlanın.</span><span class="sxs-lookup"><span data-stu-id="80865-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="80865-137">EDCL bağlantı bilgileri toominimize hello trafiği toohello Katalog veritabanı ve Merhaba uygulaması hızlandırmak önbelleğe alır.</span><span class="sxs-lookup"><span data-stu-id="80865-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="80865-138">Merhaba eşleme verilerini hello katalog veritabanında erişilebilir durumda ancak *düzenleme yapmadığınız*!</span><span class="sxs-lookup"><span data-stu-id="80865-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="80865-139">Eşleme verilerini yalnızca Elastik Veritabanı İstemci Kitaplığı API’sini kullanarak düzenleyin.</span><span class="sxs-lookup"><span data-stu-id="80865-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="80865-140">Doğrudan hello bozulmasını riskleri katalog ve desteklenmeyen hello eşleme veri düzenleme.</span><span class="sxs-lookup"><span data-stu-id="80865-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="80865-141">Giriş toohello SaaS sağlama düzeni</span><span class="sxs-lookup"><span data-stu-id="80865-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="80865-142">Ne zaman ekleme tek Kiracı veritabanı modeli yeni bir kiracı veritabanı kullanan bir SaaS uygulaması yeni bir kiracı sağlanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="80865-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="80865-143">Merhaba uygun konumu ve hizmet katmanı ile uygun şema ve başvuru verileri başlatılmadı ve hello uygun Kiracı anahtarı altında hello kataloğunda kayıtlı oluşturulması gerekir.</span><span class="sxs-lookup"><span data-stu-id="80865-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="80865-144">Farklı yaklaşımlar SQL betikleri yürütülürken, bir bacpac dağıtma ya da 'Altın' şablon veritabanı kopyalayarak dahil sağlama, kullanılan toodatabase olabilir.</span><span class="sxs-lookup"><span data-stu-id="80865-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="80865-145">kullandığınız yaklaşım sağlama hello yeni veritabanları ile en son şema hello sağlandığından emin olun, genel şema yönetim stratejinizi içinde comprehended gerekir.</span><span class="sxs-lookup"><span data-stu-id="80865-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="80865-146">Bu hello incelediniz [şema yönetimi Öğreticisi](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="80865-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="80865-147">Altın veritabanı kopyalayarak hello Wingtip SaaS uygulama hükümleri yeni kiracılar hello katalog sunucusunda dağıtılan basetenantdb adlı.</span><span class="sxs-lookup"><span data-stu-id="80865-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="80865-148">Sağlama Merhaba uygulaması bir kayıt deneyimi bir parçası olarak tümleştirilmiş ve/veya desteklenen komut dosyalarını kullanarak çevrimdışı.</span><span class="sxs-lookup"><span data-stu-id="80865-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="80865-149">Bu öğretici, PowerShell kullanarak sağlama inceleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="80865-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="80865-150">Merhaba sağlama komut dosyalarını bir esnek havuz hello basetenantdb toocreate yeni bir kiracı veritabanı kopyalama sonra Kiracı özgü bilgiyle başlatmak ve hello katalog parça eşlemesinde kaydedin.</span><span class="sxs-lookup"><span data-stu-id="80865-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="80865-151">Merhaba örnek uygulamasında veritabanları hello Kiracı adına göre adları verilir, ancak bu hello düzeni önemli bir parçası değil – hello katalog hello kullanılmasına izin verir, herhangi bir ad atanan toobe toohello veritabanı. +</span><span class="sxs-lookup"><span data-stu-id="80865-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="80865-152">Merhaba Wingtip uygulama komut dosyaları alma</span><span class="sxs-lookup"><span data-stu-id="80865-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="80865-153">Merhaba Wingtip SaaS komut dosyaları ve uygulama kaynak koduna hello kullanılabilir [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github depo.</span><span class="sxs-lookup"><span data-stu-id="80865-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="80865-154">[Adımları toodownload hello Wingtip SaaS betikleri](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="80865-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="80865-155">Sağlama ve kataloğa kaydetme ile ilgili ayrıntılı kılavuz</span><span class="sxs-lookup"><span data-stu-id="80865-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="80865-156">toounderstand nasıl uygulama sağlama yeni Kiracı uygulayan Wingtip Merhaba, bir kesme noktası ekleyin ve bir kiracı sağlarken hello akışı adım:</span><span class="sxs-lookup"><span data-stu-id="80865-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="80865-157">Aç... \\Öğrenme modülleri\\ProvisionAndCatalog\\_Demo ProvisionAndCatalog.ps1_ ve kümesi hello aşağıdaki parametreleri:</span><span class="sxs-lookup"><span data-stu-id="80865-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="80865-158">**$TenantName** = hello yeni yerini hello adı (örneğin, *Bushwillow mavi*).</span><span class="sxs-lookup"><span data-stu-id="80865-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="80865-159">**$VenueType** hello önceden tanımlanmış salonundan türlerinden birini =: *mavi*, classicalmusic, dance jazz, judo, motorracing, çok amaçlı, opera, rockmusic, futbol.</span><span class="sxs-lookup"><span data-stu-id="80865-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="80865-160">**$DemoScenario** = **1**çok ayarlayın**1** çok*tek bir kiracı sağlama*.</span><span class="sxs-lookup"><span data-stu-id="80865-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="80865-161">İmlecinizi herhangi bir yere bildiren satır 48 hello satırda koyarak kesme noktası ekleme: *yeni Kiracı '*ve basın **F9**.</span><span class="sxs-lookup"><span data-stu-id="80865-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![kesme noktası](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="80865-163">toorun hello betik tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="80865-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="80865-164">Merhaba komut dosyası yürütme hello kesme noktasında durdurulduktan sonra basın **F11** hello koda toostep.</span><span class="sxs-lookup"><span data-stu-id="80865-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![kesme noktası](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="80865-166">Hello kullanarak hello komut yürütmeyi **hata ayıklama** menü seçenekleri - **F10** ve **F11** toostep üzerinden veya hello işlevleri çağrılır.</span><span class="sxs-lookup"><span data-stu-id="80865-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="80865-167">PowerShell komut dosyalarını hata ayıklama hakkında daha fazla bilgi için bkz: [ile çalışma ve PowerShell betikleri hata ayıklama ipuçları](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="80865-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="80865-168">Merhaba değil adımları tooexplicitly izleyin, ancak bir açıklama, aracılığıyla hello komut dosyası hata ayıklama sırasında adım hello akışının şunlardır:</span><span class="sxs-lookup"><span data-stu-id="80865-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="80865-169">**İçeri aktarma hello SubscriptionManagement.psm1** tooAzure imzalama ve hello çalıştığınız Azure aboneliği seçmek için işlevleri içeren modülü.</span><span class="sxs-lookup"><span data-stu-id="80865-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="80865-170">**İçeri aktarma hello CatalogAndDatabaseManagement.psm1** bir katalog ve Kiracı düzeyinde soyutlama hello sağlar Modülü [parça yönetim](sql-database-elastic-scale-shard-map-management.md) işlevleri.</span><span class="sxs-lookup"><span data-stu-id="80865-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="80865-171">Bu hello katalog düzeni çoğunu yalıtır ve incelenmesi yararlı olan önemli bir modüldür.</span><span class="sxs-lookup"><span data-stu-id="80865-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="80865-172">**Yapılandırma ayrıntılarını alın**.</span><span class="sxs-lookup"><span data-stu-id="80865-172">**Get configuration details**.</span></span> <span data-ttu-id="80865-173">Get-yapılandırmasını (F11) adımla ve nasıl hello uygulama yapılandırma belirtilen bakın.</span><span class="sxs-lookup"><span data-stu-id="80865-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="80865-174">Kaynak adları ve diğer uygulamaya özgü değerleri burada tanımlanan ancak hello kodlarla bilginiz kadar bu değerleri değiştirmeyin.</span><span class="sxs-lookup"><span data-stu-id="80865-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="80865-175">**Başlangıç kataloğu nesnesini almak**.</span><span class="sxs-lookup"><span data-stu-id="80865-175">**Get hello catalog object**.</span></span> <span data-ttu-id="80865-176">Oluşturur ve hello üst düzey komut dosyasında kullanılan bir katalog nesnesi döndüren Get katalog adımla.</span><span class="sxs-lookup"><span data-stu-id="80865-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="80865-177">Bu işlev üzerinden içe aktarılan parça yönetim işlevlerini kullanan **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="80865-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="80865-178">Merhaba Katalog nesnesi hello aşağıdakilerden oluşur:</span><span class="sxs-lookup"><span data-stu-id="80865-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="80865-179">$catalogServerFullyQualifiedName hello standart stem artı kullanıcı adınızı kullanarak yapılandırılmıştır: _katalog -\<kullanıcı\>. database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="80865-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="80865-180">$catalogDatabaseName hello yapılandırma dosyasından alınır: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="80865-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="80865-181">$shardMapManager nesne hello katalog veritabanından başlatılır.</span><span class="sxs-lookup"><span data-stu-id="80865-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="80865-182">$shardMap nesne hello başlatılmış *tenantcatalog* hello katalog veritabanındaki parça eşleme.</span><span class="sxs-lookup"><span data-stu-id="80865-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="80865-183">Bir katalog nesnesi oluşur ve döndürülen ve hello üst düzey komut dosyasında kullanılan.</span><span class="sxs-lookup"><span data-stu-id="80865-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="80865-184">**Merhaba yeni bir kiracı anahtarı hesaplamak**.</span><span class="sxs-lookup"><span data-stu-id="80865-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="80865-185">Kullanılan toocreate hello Kiracı anahtarı hello Kiracı adı bir karma işlevdir.</span><span class="sxs-lookup"><span data-stu-id="80865-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="80865-186">**Merhaba Kiracı anahtarı olup olmadığını denetle**.</span><span class="sxs-lookup"><span data-stu-id="80865-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="80865-187">başlangıç kataloğu tooensure hello anahtar kullanılabilir denetlenir.</span><span class="sxs-lookup"><span data-stu-id="80865-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="80865-188">**Merhaba Kiracı veritabanı ile yeni TenantDatabase sağlanır.**</span><span class="sxs-lookup"><span data-stu-id="80865-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="80865-189">Kullanım **F11** içinde toostep ve nasıl hello veritabanı olup kullanılarak sağlanan bir [Azure Resource Manager şablonu](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="80865-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="80865-190">Merhaba veritabanı adı toowhich Kiracı hangi parça ait işaretini hello Kiracı adı toomake oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="80865-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="80865-191">(Veritabanı adlandırma diğer stratejileri kolayca kullanılabilir.) + Bir Resource Manager şablonu hello katalog sunucusunda altın veritabanı (baseTenantDB) kopyalayarak kullanılan toocreate Kiracı veritabanı değil.</span><span class="sxs-lookup"><span data-stu-id="80865-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="80865-192">Alternatif bir yaklaşım, boş bir veritabanı toocreate olmalı ve ardından bunu bir bacpac veya tooexecute içeri aktararak başlatma betiği iyi bilinen bir konumdan başlatılamıyor.</span><span class="sxs-lookup"><span data-stu-id="80865-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="80865-193">Merhaba Resource Manager şablonu hello ...\Learning Modules\Common\ bulunan klasördür: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="80865-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="80865-194">Merhaba Kiracı veritabanı oluşturulduktan sonra daha sonra başka **hello salonundan (Kiracı) adı ve hello salonundan türü ile başlatılmış**.</span><span class="sxs-lookup"><span data-stu-id="80865-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="80865-195">Burada, diğer başlatma işlemleri de yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="80865-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="80865-196">Merhaba **hello Kataloğu'nda kayıtlı Kiracı veritabanı** ile *Ekle TenantDatabaseToCatalog* hello Kiracı anahtarı kullanarak.</span><span class="sxs-lookup"><span data-stu-id="80865-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="80865-197">Kullanım **F11** toostep hello ayrıntıları içine:</span><span class="sxs-lookup"><span data-stu-id="80865-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="80865-198">Merhaba Katalog veritabanı toohello parça eşleme (bilinen veritabanlarının listesini hello) eklenir.</span><span class="sxs-lookup"><span data-stu-id="80865-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="80865-199">Bu bağlantılar hello anahtar değeri toohello parça eşleştirmeyi hello oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="80865-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="80865-200">Merhaba Kiracı hakkında ek meta veriler (Merhaba salonundan'ın adı) toohello kiracılar tablo hello kataloğunda eklenir.</span><span class="sxs-lookup"><span data-stu-id="80865-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="80865-201">Merhaba kiracılar tablo hello ShardManagement şema parçası olmayan ve EDCL hello tarafından yüklü değil.</span><span class="sxs-lookup"><span data-stu-id="80865-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="80865-202">Bu tabloda hello Katalog veritabanı toosupport ek uygulamaya özgü verileri nasıl Genişletilebilir gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="80865-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="80865-203">Sağlama tamamlandıktan sonra yürütme toohello özgün döndürür *Demo ProvisionAndCatalog* hello açar betik **olayları** sayfa hello tarayıcıda hello yeni Kiracı için:</span><span class="sxs-lookup"><span data-stu-id="80865-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![etkinlikler](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="80865-205">Kiracılar toplu sağlama</span><span class="sxs-lookup"><span data-stu-id="80865-205">Provision a batch of tenants</span></span>

<span data-ttu-id="80865-206">Bu alıştırmada 17 kiracılar toplu sağlar.</span><span class="sxs-lookup"><span data-stu-id="80865-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="80865-207">Böylece birden fazla birkaç veritabanları toowork ile diğer Wingtip SaaS öğreticileri başlatmadan önce bu toplu kiracıların sağlamak önerilir.</span><span class="sxs-lookup"><span data-stu-id="80865-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="80865-208">Aç... \\Öğrenme modülleri\\ProvisionAndCatalog\\*Demo ProvisionAndCatalog.ps1* hello içinde *PowerShell ISE* hello değiştirip *$ DemoScenario* parametresi too3:</span><span class="sxs-lookup"><span data-stu-id="80865-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="80865-209">**$DemoScenario** = **3**, çok değiştirme**3** çok*kiracılar toplu sağlama*.</span><span class="sxs-lookup"><span data-stu-id="80865-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="80865-210">Tuşuna **F5** ve hello komut dosyasını çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="80865-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="80865-211">Merhaba betik ek kiracılar toplu dağıtır.</span><span class="sxs-lookup"><span data-stu-id="80865-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="80865-212">Kullandığı bir [Azure Resource Manager şablonu](../azure-resource-manager/resource-manager-template-walkthrough.md) hello toplu denetler ve her veritabanı tooa bağlantılı şablonunu sağlama atar.</span><span class="sxs-lookup"><span data-stu-id="80865-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="80865-213">Bu şekilde şablonları kullanarak Azure Resource Manager toobroker hello sağlama işlemi betiğiniz sağlar.</span><span class="sxs-lookup"><span data-stu-id="80865-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="80865-214">Şablonları sağlamak veritabanları burada olabilir ve gerekirse, yeniden deneme işler paralel hello genel işlem en iyi duruma getirme.</span><span class="sxs-lookup"><span data-stu-id="80865-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="80865-215">Merhaba komut dosyası başarısız olduğunda veya herhangi bir nedenle durdurur ise ıdempotent bu nedenle onu yeniden çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="80865-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="80865-216">Kiracıların başarıyla dağıtılan Hello toplu doğrulayın</span><span class="sxs-lookup"><span data-stu-id="80865-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="80865-217">Açık hello *tenants1* tooyour hello sunucularının listesini giderek sunucu [Azure portal](https://portal.azure.com), tıklatın **SQL veritabanları**ve 17 ek veritabanlarının hello toplu şimdi doğrulayın Merhaba listesinde:</span><span class="sxs-lookup"><span data-stu-id="80865-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![veritabanı listesi öğesine tıklayın](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="80865-219">Diğer sağlama düzenleri</span><span class="sxs-lookup"><span data-stu-id="80865-219">Other provisioning patterns</span></span>

<span data-ttu-id="80865-220">Bu öğreticide yer almayan diğer sağlama düzenleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="80865-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="80865-221">**Veritabanlarını önceden hazırlama.**</span><span class="sxs-lookup"><span data-stu-id="80865-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="80865-222">Desen önceden sağlama hello ek bir maliyeti esnek havuzdaki veritabanları eklemeyin hello olgu yararlanan.</span><span class="sxs-lookup"><span data-stu-id="80865-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="80865-223">Merhaba esnek havuz için faturalama olduğunda, veritabanları hello değil ve boşta veritabanları hiçbir kaynaklarını tüketebilir.</span><span class="sxs-lookup"><span data-stu-id="80865-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="80865-224">Bir havuzdaki veritabanları önceden sağlama ve bunları gerektiğinde ayırma Kiracı ekleme zamanı önemli ölçüde azaltılabilir.</span><span class="sxs-lookup"><span data-stu-id="80865-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="80865-225">oranı sağlama gerekli tookeep hello için uygun bir arabellek beklenen şekilde önceden sağlanan veritabanı hello sayısı ayarlanmış.</span><span class="sxs-lookup"><span data-stu-id="80865-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="80865-226">**Otomatik sağlama.**</span><span class="sxs-lookup"><span data-stu-id="80865-226">**Auto-provisioning.**</span></span> <span data-ttu-id="80865-227">Otomatik sağlama Hello desende bir adanmış sağlama kullanılan tooprovision sunucular, havuzları ve veritabanları otomatik olarak – önceden sağlama veritabanları esnek havuzları, isterseniz de dahil olmak üzere gerektiğinde hizmetidir.</span><span class="sxs-lookup"><span data-stu-id="80865-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="80865-228">Ve istediğiniz gibi hizmet sağlama hello tarafından veritabanları XML'deki yaptırılan ve silinmiş, esnek havuzlar boşlukları doldurulabilir.</span><span class="sxs-lookup"><span data-stu-id="80865-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="80865-229">Bu tür bir hizmet Örneğin, birden çok farklı coğrafyalara, sağlama işleme basit veya karmaşık – olabilir ve bu strateji olağanüstü durum kurtarma için kullanılırsa coğrafi çoğaltma otomatik olarak ayarlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80865-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="80865-230">Hello otomatik sağlama düzendeki bir istemci uygulama veya betik hizmet sağlama hello tarafından işlenen bir sağlama isteği tooa sıra toobe göndermek ve ardından hello hizmet toodetermine tamamlama yoklaması.</span><span class="sxs-lookup"><span data-stu-id="80865-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="80865-231">Önceden hazırlama kullanılırsa, istekleri hızlı bir şekilde hello arka planda çalışan değiştirme veritabanı sağlama yönetme hello hizmeti ile ele alınması.</span><span class="sxs-lookup"><span data-stu-id="80865-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="80865-232">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="80865-232">Next steps</span></span>

<span data-ttu-id="80865-233">Bu öğreticide, şunları öğrendiniz:</span><span class="sxs-lookup"><span data-stu-id="80865-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="80865-234">Tek bir yeni kiracı sağlama</span><span class="sxs-lookup"><span data-stu-id="80865-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="80865-235">Ek kiracı grubu sağlama</span><span class="sxs-lookup"><span data-stu-id="80865-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="80865-236">Kiracılar sağlama ve hello kataloğuna kaydetme hello ayrıntılarını girme</span><span class="sxs-lookup"><span data-stu-id="80865-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="80865-237">Merhaba deneyin [performans izleme Öğreticisi](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="80865-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="80865-238">Ek Kaynaklar</span><span class="sxs-lookup"><span data-stu-id="80865-238">Additional Resources</span></span>

* <span data-ttu-id="80865-239">Ek [hello Wingtip SaaS uygulamasına yapı öğreticileri](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="80865-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="80865-240">Elastik veritabanı istemci kitaplığı</span><span class="sxs-lookup"><span data-stu-id="80865-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="80865-241">Windows PowerShell ISE tooDebug nasıl komutlar</span><span class="sxs-lookup"><span data-stu-id="80865-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
