---
title: "Esnek veritabanı istemci kitaplığı ile Dapper kullanılarak | Microsoft Docs"
description: "Esnek veritabanı istemci kitaplığı ile Dapper kullanıyor."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f0efd37a39c1a60eee7b47304483c27727ca8833
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="d1b63-103">Esnek veritabanı istemci kitaplığı Dapper ile kullanma</span><span class="sxs-lookup"><span data-stu-id="d1b63-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="d1b63-104">Uygulamaları derleme Dapper kullanır, ancak aynı zamanda kag'yi geliştiriciler için bu belgedir [esnek veritabanı araçları](sql-database-elastic-scale-introduction.md) kendi veri katmanı genişletmek için bu uygulama parçalama uygulamaları oluşturmak için.</span><span class="sxs-lookup"><span data-stu-id="d1b63-104">This document is for developers that rely on Dapper to build applications, but also want to embrace [elastic database tooling](sql-database-elastic-scale-introduction.md) to create applications that implement sharding to scale-out their data tier.</span></span>  <span data-ttu-id="d1b63-105">Bu belge Dapper tabanlı uygulamalar, esnek veritabanı araçları ile tümleştirmek için gerekli olan değişiklikleri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-105">This document illustrates the changes in Dapper-based applications that are necessary to integrate with elastic database tools.</span></span> <span data-ttu-id="d1b63-106">Bizim odak esnek veritabanı parça yönetimi ve veri bağımlı oluşturma üzerinde Dapper ile gönderiyor.</span><span class="sxs-lookup"><span data-stu-id="d1b63-106">Our focus is on composing the elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="d1b63-107">**Örnek kod**: [Azure SQL veritabanı - Dapper tümleştirme için esnek veritabanı araçlarını](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="d1b63-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="d1b63-108">Tümleştirme **Dapper** ve **DapperExtensions** esnek veritabanı ile Azure SQL veritabanı için istemci kitaplığı kolaydır.</span><span class="sxs-lookup"><span data-stu-id="d1b63-108">Integrating **Dapper** and **DapperExtensions** with the elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="d1b63-109">Uygulamalarınızı verileri oluşturma değiştirme ve, yeni açarak yönlendirme bağımlı kullanabileceğiniz [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) kullanılacak nesneleri [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) çağırmanıza [istemci Kitaplığı](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="d1b63-109">Your applications can use data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from the [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="d1b63-110">Yeni bağlantı oluşturulur ve açık olduğunda bu değişiklikler yalnızca, uygulamanızda sınırlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-110">This limits changes in your application to only where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="d1b63-111">Dapper genel bakış</span><span class="sxs-lookup"><span data-stu-id="d1b63-111">Dapper overview</span></span>
<span data-ttu-id="d1b63-112">**Dapper** bir nesne ilişkisel Eşleyici olduğu.</span><span class="sxs-lookup"><span data-stu-id="d1b63-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="d1b63-113">.NET nesneleri uygulamanızdan bir ilişkisel veritabanı (ve tersi) eşler.</span><span class="sxs-lookup"><span data-stu-id="d1b63-113">It maps .NET objects from your application to a relational database (and vice versa).</span></span> <span data-ttu-id="d1b63-114">Esnek veritabanı istemci kitaplığı Dapper tabanlı uygulamalarla nasıl tümleştirebilir örnek kod ilk bölümü gösterir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-114">The first part of the sample code illustrates how you can integrate the elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="d1b63-115">Örnek kod ikinci bölümü, Dapper ve DapperExtensions kullanırken tümleştirmek göstermektedir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-115">The second part of the sample code illustrates how to integrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="d1b63-116">Dapper Eşleyici işlevindeki yürütme veya veritabanını sorgulamak için gönderen T-SQL deyimlerini basitleştirmek veritabanı bağlantılarını genişletme yöntemleri sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-116">The mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying the database.</span></span> <span data-ttu-id="d1b63-117">Örneğin, Dapper .NET nesneleri ve SQL deyimleri için parametreleri arasında eşleme kolaylaştırır **yürütme** çağrıları, ya da SQL sorgularınızı sonuçlarını kullanarak .NET nesnelerini kullanmak için **sorgu** Dapper gelen çağrıları.</span><span class="sxs-lookup"><span data-stu-id="d1b63-117">For instance, Dapper makes it easy to map between your .NET objects and the parameters of SQL statements for **Execute** calls, or to consume the results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="d1b63-118">DapperExtensions kullanırken, artık SQL deyimlerini sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-118">When using DapperExtensions, you no longer need to provide the SQL statements.</span></span> <span data-ttu-id="d1b63-119">Genişletme yöntemleri gibi **GetList** veya **Ekle** veritabanı bağlantısı üzerinden SQL deyimlerini arka planda oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d1b63-119">Extensions methods such as **GetList** or **Insert** over the database connection create the SQL statements behind the scenes.</span></span>

<span data-ttu-id="d1b63-120">Dapper ve ayrıca DapperExtensions başka bir avantajı, uygulama veritabanı bağlantısı oluşturulmasını denetler ' dir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-120">Another benefit of Dapper and also DapperExtensions is that the application controls the creation of the database connection.</span></span> <span data-ttu-id="d1b63-121">Bu aracıların veritabanlarına shardlets eşleme bağlantıları veritabanı esnek veritabanı istemci kitaplığı ile etkileşim yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="d1b63-121">This helps interact with the elastic database client library which brokers database connections based on the mapping of shardlets to databases.</span></span>

<span data-ttu-id="d1b63-122">Dapper derlemeler almak için bkz: [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="d1b63-122">To get the Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="d1b63-123">Dapper uzantıları için bkz: [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="d1b63-123">For the Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-the-elastic-database-client-library"></a><span data-ttu-id="d1b63-124">Esnek veritabanı istemci kitaplığı hızlı bir bakış</span><span class="sxs-lookup"><span data-stu-id="d1b63-124">A quick Look at the elastic database client library</span></span>
<span data-ttu-id="d1b63-125">Adlı uygulama verilerinizi bölümlerini tanımladığınız esnek veritabanı istemci kitaplığı ile *shardlets* veritabanlarına harita ve onlar tarafından tanımlamak *parçalama anahtarları*.</span><span class="sxs-lookup"><span data-stu-id="d1b63-125">With the elastic database client library, you define partitions of your application data called *shardlets* , map them to databases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="d1b63-126">Gerekir ve bu veritabanları arasında shardlets dağıtmak sayıda veritabanı olabilir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="d1b63-127">Parçalama anahtar değerlerin veritabanlarına kitaplığın API'leri tarafından sağlanan bir parça eşleme tarafından depolanır.</span><span class="sxs-lookup"><span data-stu-id="d1b63-127">The mapping of sharding key values to the databases is stored by a shard map provided by the library’s APIs.</span></span> <span data-ttu-id="d1b63-128">Bu özellik adında **parça eşleme Yönetim**.</span><span class="sxs-lookup"><span data-stu-id="d1b63-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="d1b63-129">Parça eşleme, ayrıca bir parçalama anahtar taşımak istekleri için veritabanı bağlantılarını aracısı olarak görev yapar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-129">The shard map also serves as the broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="d1b63-130">Bu özellik olarak adlandırılır **veri bağımlı yönlendirme**.</span><span class="sxs-lookup"><span data-stu-id="d1b63-130">This capability is referred to as **data dependent routing**.</span></span>

![Parça eşlemeleri ve veri bağımlı yönlendirme][1]

<span data-ttu-id="d1b63-132">Parça eşleme Yöneticisi eşzamanlı shardlet yönetim işlemlerini veritabanlarına gerçekleştiği yüklendiğinde oluşabilecek shardlet veri tutarsız görünümleri kullanıcıları korur.</span><span class="sxs-lookup"><span data-stu-id="d1b63-132">The shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on the databases.</span></span> <span data-ttu-id="d1b63-133">Bunu yapmak için veritabanı bağlantılarını kitaplığı ile oluşturulmuş bir uygulama için parça eşlemeleri Aracısı.</span><span class="sxs-lookup"><span data-stu-id="d1b63-133">To do so, the shard maps broker the database connections for an application built with the library.</span></span> <span data-ttu-id="d1b63-134">Parça yönetim işlemlerini shardlet etkileyebilir, bu otomatik olarak bir veritabanı bağlantısı sonlandırılamadı parça eşleme işlevselliği sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-134">When shard management operations could impact the shardlet, this allows the shard map functionality to automatically kill a database connection.</span></span> 

<span data-ttu-id="d1b63-135">Dapper bağlantılarında oluşturmak için geleneksel yol kullanmak yerine, kullanılacak ihtiyacımız [OpenConnectionForKey yöntemi](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="d1b63-135">Instead of using the traditional way to create connections for Dapper, we need to use the [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="d1b63-136">Bu, tüm doğrulama gerçekleşir ve herhangi bir veri parça arasında taşındığında bağlantıları düzgün yönetilen sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-136">This ensures that all the validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="d1b63-137">Dapper tümleştirme gereksinimleri</span><span class="sxs-lookup"><span data-stu-id="d1b63-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="d1b63-138">Esnek veritabanı istemci kitaplığı ve Dapper API'leri ile çalışırken, aşağıdaki özellikleri korumak istiyor:</span><span class="sxs-lookup"><span data-stu-id="d1b63-138">When working with both the elastic database client library and the Dapper APIs, we want to retain the following properties:</span></span>

* <span data-ttu-id="d1b63-139">**Genişletme**: veritabanları kapasite gereksinimlerini karşılamak için gerekli olarak parçalı uygulama uygulamasının veri katmanı ekleyip istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="d1b63-139">**Scaleout**: We want to add or remove databases from the data tier of the sharded application as necessary for the capacity demands of the application.</span></span> 
* <span data-ttu-id="d1b63-140">**Tutarlılık**: uygulamamız parçalama kullanılarak ölçeklenir olduğundan, biz veri bağımlı yönlendirme gerçekleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-140">**Consistency**: Since our application is scaled out using sharding, we need to perform data dependent routing.</span></span> <span data-ttu-id="d1b63-141">Bunu yapmak için veri bağımlı yönlendirme özellikleri kitaplığının kullanmak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="d1b63-141">We want to use the Data dependent routing capabilities of the library to do so.</span></span> <span data-ttu-id="d1b63-142">Özellikle, biz doğrulama korumak istediğiniz ve parça eşleme Yöneticisi aracılığıyla bozulma veya yanlış sorgu sonuçları önlemek için aracılı bağlantılar tarafından sağlanan tutarlılığı garanti altına alır.</span><span class="sxs-lookup"><span data-stu-id="d1b63-142">In particular, we want to retain the validation and consistency guarantees provided by connections that are brokered through the shard map manager in order to avoid corruption or wrong query results.</span></span> <span data-ttu-id="d1b63-143">Bu, belirli bir shardlet bağlantı reddedildi veya (örneğin) shardlet bölünmüş/Merge API'lerini kullanarak farklı bir parça şu anda taşınırsa durduruldu sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-143">This ensures that connections to a given shardlet are rejected or stopped if (for instance) the shardlet is currently moved to a different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="d1b63-144">**Nesne eşleme**: uygulama sınıfları ve temel veritabanı yapılarını arasında çeviri yapmak Dapper tarafından sağlanan eşlemeleri kolaylık korumak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="d1b63-144">**Object Mapping**: We want to retain the convenience of the mappings provided by Dapper to translate between classes in the application and the underlying database structures.</span></span> 

<span data-ttu-id="d1b63-145">Aşağıdaki bölümde temel uygulamalar için bu gereksinimleri için yönergeler sağlanmaktadır **Dapper** ve **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="d1b63-145">The following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="d1b63-146">Teknik Kılavuzu</span><span class="sxs-lookup"><span data-stu-id="d1b63-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="d1b63-147">Veri Dapper ile yönlendirme bağımlı</span><span class="sxs-lookup"><span data-stu-id="d1b63-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="d1b63-148">Dapper ile uygulama oluşturma ve temel veritabanı bağlantılarını açma genellikle sorumludur.</span><span class="sxs-lookup"><span data-stu-id="d1b63-148">With Dapper, the application is typically responsible for creating and opening the connections to the underlying database.</span></span> <span data-ttu-id="d1b63-149">T-SQL sonuç satırları t türü nesnelere eşleme türü T. Dapper .NET koleksiyonları gerçekleştirir gibi T türü uygulama tarafından verilen, Dapper sorgu sonuçlarını döndürür Benzer şekilde, Dapper SQL değerleri veya veri işleme dili (DML) deyimleri parametrelerini .NET nesneleri eşler.</span><span class="sxs-lookup"><span data-stu-id="d1b63-149">Given a type T by the application, Dapper returns query results as .NET collections of type T. Dapper performs the mapping from the T-SQL result rows to the objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="d1b63-150">Dapper normal üzerinde genişletme yöntemleri aracılığıyla bu işlevselliği sunar [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) ADO .NET SQL istemci kitaplıklarından nesnesi.</span><span class="sxs-lookup"><span data-stu-id="d1b63-150">Dapper offers this functionality via extension methods on the regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from the ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="d1b63-151">DDR için esnek ölçeklendirme API'leri tarafından döndürülen SQL bağlantısı normal de [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) nesneleri.</span><span class="sxs-lookup"><span data-stu-id="d1b63-151">The SQL connection returned by the Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="d1b63-152">Bu bize Ayrıca basit SQL istemci bağlantısı olarak doğrudan Dapper uzantılar istemci kitaplığının DDR API tarafından döndürülen tür üzerinden kullanmayı sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-152">This allows us to directly use Dapper extensions over the type returned by the client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="d1b63-153">Bu gözlemleri Dapper için esnek veritabanı istemci kitaplığı tarafından aracılı bağlantılar kullanmak basit olun.</span><span class="sxs-lookup"><span data-stu-id="d1b63-153">These observations make it straightforward to use connections brokered by the elastic database client library for Dapper.</span></span>

<span data-ttu-id="d1b63-154">Bu kod örneği (eşlik eden örnekten) burada parçalama anahtar sağ parça Bağlantı Aracısı uygulamaya kitaplığına sağladığı yaklaşımı açıklar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-154">This code example (from the accompanying sample) illustrates the approach where the sharding key is provided by the application to the library to broker the connection to the right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="d1b63-155">Çağrı [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API varsayılan oluşturulması ve SQL istemci bağlantısı açılırken yerini alır.</span><span class="sxs-lookup"><span data-stu-id="d1b63-155">The call to the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces the default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="d1b63-156">[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) çağrısı veri bağımlı yönlendirme için gerekli olan bağımsız değişkenler alır:</span><span class="sxs-lookup"><span data-stu-id="d1b63-156">The [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes the arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="d1b63-157">Veri bağımlı yönlendirme arabirimlerini erişmek için parça eşleme</span><span class="sxs-lookup"><span data-stu-id="d1b63-157">The shard map to access the data dependent routing interfaces</span></span>
* <span data-ttu-id="d1b63-158">Shardlet tanımlamak için parçalama anahtarı</span><span class="sxs-lookup"><span data-stu-id="d1b63-158">The sharding key to identify the shardlet</span></span>
* <span data-ttu-id="d1b63-159">(Kullanıcı adı ve parola) parça bağlanmak için kimlik bilgileri</span><span class="sxs-lookup"><span data-stu-id="d1b63-159">The credentials (user name and password) to connect to the shard</span></span>

<span data-ttu-id="d1b63-160">Parça harita nesnesi belirtilen parçalama anahtar shardlet tutan parça bir bağlantı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d1b63-160">The shard map object creates a connection to the shard that holds the shardlet for the given sharding key.</span></span> <span data-ttu-id="d1b63-161">Esnek veritabanı istemci API Ayrıca kendi tutarlılığı garanti uygulamak için bağlantı etiketi.</span><span class="sxs-lookup"><span data-stu-id="d1b63-161">The elastic database client APIs also tag the connection to implement its consistency guarantees.</span></span> <span data-ttu-id="d1b63-162">Çağrısından sonra [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) normal SQL istemci bağlantısı nesnesi, sonraki çağrı döndürür **yürütme** Dapper uzantısı yönteminden standart Dapper uygulama izler.</span><span class="sxs-lookup"><span data-stu-id="d1b63-162">Since the call to [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, the subsequent call to the **Execute** extension method from Dapper follows the standard Dapper practice.</span></span>

<span data-ttu-id="d1b63-163">İş çok benzer şekilde sorguları - ilk bağlantıyı kullanarak açmak [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API istemciden.</span><span class="sxs-lookup"><span data-stu-id="d1b63-163">Queries work very much the same way - you first open the connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from the client API.</span></span> <span data-ttu-id="d1b63-164">Ardından SQL Sorgunuzun sonuçlarını .NET nesneleri eşleştirmek için normal Dapper genişletme yöntemleri kullanın:</span><span class="sxs-lookup"><span data-stu-id="d1b63-164">Then you use the regular Dapper extension methods to map the results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="d1b63-165">Unutmayın **kullanarak** tenantId1 nerede tutulur bir parça bloğuna içindeki tüm veritabanı işlemleri DDR bağlantı kapsamlarla engelleyin.</span><span class="sxs-lookup"><span data-stu-id="d1b63-165">Note that the **using** block with the DDR connection scopes all database operations within the block to the one shard where tenantId1 is kept.</span></span> <span data-ttu-id="d1b63-166">Sorgu, geçerli parça üzerinde depolanan bloglar, ancak başka bir parça üzerinde depolanan olanları değil yalnızca döndürür.</span><span class="sxs-lookup"><span data-stu-id="d1b63-166">The query only returns blogs stored on the current shard, but not the ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="d1b63-167">Veri Dapper ve DapperExtensions yönlendirme bağımlı</span><span class="sxs-lookup"><span data-stu-id="d1b63-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="d1b63-168">Dapper bir daha kullanışlı ve soyutlama veritabanından veritabanı uygulamaları geliştirirken sağlayabilir ek uzantıları ekosistemi ile birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from the database when developing database applications.</span></span> <span data-ttu-id="d1b63-169">DapperExtensions bir örnektir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="d1b63-170">Uygulamanızda DapperExtensions kullanarak veritabanı bağlantılarını nasıl oluşturulduğunu ve yönetilen değiştirmez.</span><span class="sxs-lookup"><span data-stu-id="d1b63-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="d1b63-171">Bunu hala Bağlantıları'nı açmak için uygulamanın sorumluluğundadır ve normal SQL istemci bağlantısı nesneleri genişletme yöntemleri tarafından beklenir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-171">It is still the application’s responsibility to open connections, and regular SQL Client connection objects are expected by the extension methods.</span></span> <span data-ttu-id="d1b63-172">Üzerinde güvenebilirsiniz [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) yukarıda açıklandığı şekilde.</span><span class="sxs-lookup"><span data-stu-id="d1b63-172">We can rely on the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="d1b63-173">Aşağıdaki kod örnekleri gösterdiği gibi tek değişiklik biz artık T-SQL deyimleri yazmanıza sahip olabilir:</span><span class="sxs-lookup"><span data-stu-id="d1b63-173">As the following code samples show, the only change is that we do no longer have to write the T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="d1b63-174">Ve sorgu için kod örneği aşağıdadır:</span><span class="sxs-lookup"><span data-stu-id="d1b63-174">And here is the code sample for the query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="d1b63-175">Geçici hata işleme</span><span class="sxs-lookup"><span data-stu-id="d1b63-175">Handling transient faults</span></span>
<span data-ttu-id="d1b63-176">Microsoft Patterns & yöntemler takım yayımlanan [geçici hata işleme uygulama bloğu](http://msdn.microsoft.com/library/hh680934.aspx) uygulama geliştiricileri bulutta çalışırken karşılaşılan yaygın geçici hata koşulları azaltmaya yardımcı olmak için.</span><span class="sxs-lookup"><span data-stu-id="d1b63-176">The Microsoft Patterns & Practices team published the [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) to help application developers mitigate common transient fault conditions encountered when running in the cloud.</span></span> <span data-ttu-id="d1b63-177">Daha fazla bilgi için bkz: [Perseverance, tüm Triumphs gizliliği: geçici hata işleme uygulama bloğu kullanarak](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="d1b63-177">For more information, see [Perseverance, Secret of All Triumphs: Using the Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="d1b63-178">Kod örneği geçici hataları karşı korumak için geçici hata kitaplığı kullanır.</span><span class="sxs-lookup"><span data-stu-id="d1b63-178">The code sample relies on the transient fault library to protect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="d1b63-179">**SqlDatabaseUtils.SqlRetryPolicy** Yukarıdaki kod olarak tanımlanan bir **SqlDatabaseTransientErrorDetectionStrategy** bir yeniden deneme sayısı 10 ve 5 saniye ile yeniden denemeler arasındaki süre bekleyin.</span><span class="sxs-lookup"><span data-stu-id="d1b63-179">**SqlDatabaseUtils.SqlRetryPolicy** in the code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="d1b63-180">İşlemler kullanıyorsanız, yeniden deneme kapsamınızı geri geçici bir hata durumunda işlem başına kalacağı emin olun.</span><span class="sxs-lookup"><span data-stu-id="d1b63-180">If you are using transactions, make sure that your retry scope goes back to the beginning of the transaction in the case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="d1b63-181">Sınırlamalar</span><span class="sxs-lookup"><span data-stu-id="d1b63-181">Limitations</span></span>
<span data-ttu-id="d1b63-182">Bu belgede özetlenen yaklaşımlar birkaç sınırlama oluşturulmasını gerektirir:</span><span class="sxs-lookup"><span data-stu-id="d1b63-182">The approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="d1b63-183">Bu belge için örnek kod, şema parça yönetme gösterilmemiştir.</span><span class="sxs-lookup"><span data-stu-id="d1b63-183">The sample code for this document does not demonstrate how to manage schema across shards.</span></span>
* <span data-ttu-id="d1b63-184">Bir istek göz önüne alındığında, tüm veritabanı işleme istek tarafından sağlanan parçalama anahtarı tarafından tanımlandığı gibi tek bir parça içinde bulunur varsayıyoruz.</span><span class="sxs-lookup"><span data-stu-id="d1b63-184">Given a request, we assume that all its database processing is contained within a single shard as identified by the sharding key provided by the request.</span></span> <span data-ttu-id="d1b63-185">Bir parçalama anahtarı kullanılabilir hale mümkün değilse, ancak bu varsayım her zaman, örneğin, tutmaz.</span><span class="sxs-lookup"><span data-stu-id="d1b63-185">However, this assumption does not always hold, for example, when it is not possible to make a sharding key available.</span></span> <span data-ttu-id="d1b63-186">Bu sorunu çözmek için esnek veritabanı istemci kitaplığı içerir [MultiShardQuery sınıfı](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="d1b63-186">To address this, the elastic database client library includes the [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="d1b63-187">Sınıf birkaç parça sorgulama için bir bağlantı Özet uygular.</span><span class="sxs-lookup"><span data-stu-id="d1b63-187">The class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="d1b63-188">MultiShardQuery Dapper ile birlikte bu belgenin kapsamı dışındadır kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="d1b63-188">Using MultiShardQuery in combination with Dapper is beyond the scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="d1b63-189">Sonuç</span><span class="sxs-lookup"><span data-stu-id="d1b63-189">Conclusion</span></span>
<span data-ttu-id="d1b63-190">Dapper ve DapperExtensions kullanarak uygulamaları kolayca Azure SQL veritabanı için esnek Veritabanı Araçları'ndan yararlanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d1b63-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="d1b63-191">Bu belgede özetlenen adımları, oluşturma değiştirme ve, yeni açarak yönlendirme bağımlı veriler için aracın yeteneği bu uygulamaları kullanabilir [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) kullanılacak nesneleri [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) esnek veritabanı istemci kitaplığı çağrısı.</span><span class="sxs-lookup"><span data-stu-id="d1b63-191">Through the steps outlined in this document, those applications can use the tool's capability for data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of the elastic database client library.</span></span> <span data-ttu-id="d1b63-192">Bu yeni bağlantı burada oluşturulan ve açılan bu yerlerin gerekli uygulama değişiklikleri sınırlar.</span><span class="sxs-lookup"><span data-stu-id="d1b63-192">This limits the application changes required to those places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
