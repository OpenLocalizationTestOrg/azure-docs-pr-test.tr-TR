---
title: "Dapper aaaUsing esnek veritabanı istemci kitaplığı | Microsoft Docs"
description: "Esnek veritabanı istemci kitaplığı ile Dapper kullanıyor."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="752a4-103">Esnek veritabanı istemci kitaplığı Dapper ile kullanma</span><span class="sxs-lookup"><span data-stu-id="752a4-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="752a4-104">Bu belge, Dapper toobuild uygulamaları kullanan ancak aynı zamanda tooembrace isteyen geliştiriciler için değil [esnek veritabanı araçları](sql-database-elastic-scale-introduction.md) parçalama tooscale kullanıma kendi veri katmanı uygulama toocreate uygulamalar.</span><span class="sxs-lookup"><span data-stu-id="752a4-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="752a4-105">Bu belge esnek veritabanı araçları ile gerekli toointegrate olan Dapper tabanlı uygulamalarda hello değişiklikleri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="752a4-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="752a4-106">Bizim odak hello esnek veritabanı parça yönetimi ve veri bağımlı oluşturma üzerinde Dapper ile gönderiyor.</span><span class="sxs-lookup"><span data-stu-id="752a4-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="752a4-107">**Örnek kod**: [Azure SQL veritabanı - Dapper tümleştirme için esnek veritabanı araçlarını](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="752a4-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="752a4-108">Tümleştirme **Dapper** ve **DapperExtensions** hello ile Azure SQL veritabanı için esnek veritabanı istemci kitaplığı kolaydır.</span><span class="sxs-lookup"><span data-stu-id="752a4-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="752a4-109">Uygulamalarınızın veri hello oluşturma değiştirme ve, yeni açarak yönlendirme bağımlı kullanabilirsiniz [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) nesneleri toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) çağrısı hello [istemci Kitaplık](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="752a4-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="752a4-110">Bu yeni bağlantı burada oluşturulan ve açılan, uygulama tooonly değişiklikleri sınırlar.</span><span class="sxs-lookup"><span data-stu-id="752a4-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="752a4-111">Dapper genel bakış</span><span class="sxs-lookup"><span data-stu-id="752a4-111">Dapper overview</span></span>
<span data-ttu-id="752a4-112">**Dapper** bir nesne ilişkisel Eşleyici olduğu.</span><span class="sxs-lookup"><span data-stu-id="752a4-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="752a4-113">.NET nesneleri uygulama tooa ilişkisel veritabanı (ve tersi) eşler.</span><span class="sxs-lookup"><span data-stu-id="752a4-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="752a4-114">Merhaba ilk hello örnek kod parçası, nasıl Dapper tabanlı uygulamalarla hello esnek veritabanı istemci kitaplığı tümleştirebilir gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="752a4-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="752a4-115">Merhaba ikinci hello örnek kod parçası gösterilmektedir nasıl Dapper ve DapperExtensions kullanırken toointegrate.</span><span class="sxs-lookup"><span data-stu-id="752a4-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="752a4-116">Merhaba Eşleyici Dapper işlevindeki yürütme veya sorgulanırken hello veritabanı gönderiliyor T-SQL deyimlerini basitleştirmek veritabanı bağlantılarını genişletme yöntemleri sağlar.</span><span class="sxs-lookup"><span data-stu-id="752a4-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="752a4-117">Örneğin, Dapper .NET nesneleri ve SQL deyimlerini hello parametrelerinin arasındaki kolay toomap kolaylaştırır **yürütme** çağrıları ya da tooconsume hello sorgularınızın sonuçlarıyla ilgili SQL kullanarak .NET nesneleri içine **sorgu**Dapper gelen çağrıları.</span><span class="sxs-lookup"><span data-stu-id="752a4-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="752a4-118">DapperExtensions kullanırken, artık tooprovide hello SQL deyimlerini gerekmez.</span><span class="sxs-lookup"><span data-stu-id="752a4-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="752a4-119">Genişletme yöntemleri gibi **GetList** veya **Ekle** hello veritabanı bağlantısı üzerinden hello hello perde arkasında SQL deyimleri oluşturma.</span><span class="sxs-lookup"><span data-stu-id="752a4-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="752a4-120">Başka bir avantaj Dapper ve ayrıca DapperExtensions hello uygulama denetimleri hello veritabanı bağlantısı oluşturulmasını hello olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="752a4-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="752a4-121">Bu, hangi Aracıların shardlets toodatabases hello eşleşmeye göre bağlantıları veritabanı hello esnek veritabanı istemci kitaplığı ile etkileşim yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="752a4-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="752a4-122">tooget hello Dapper derlemeler, bkz: [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="752a4-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="752a4-123">Merhaba Dapper uzantıları için bkz: [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="752a4-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="752a4-124">Merhaba esnek veritabanı istemci kitaplığı hızlı bir bakış</span><span class="sxs-lookup"><span data-stu-id="752a4-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="752a4-125">Adlı uygulama verilerinizi bölümlerini tanımladığınız Hello esnek veritabanı istemci kitaplığı ile *shardlets* toodatabases harita ve onlar tarafından tanımlamak *parçalama anahtarları*.</span><span class="sxs-lookup"><span data-stu-id="752a4-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="752a4-126">Gerekir ve bu veritabanları arasında shardlets dağıtmak sayıda veritabanı olabilir.</span><span class="sxs-lookup"><span data-stu-id="752a4-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="752a4-127">Merhaba eşleme parçalama anahtar değerleri toohello veritabanlarının hello kitaplığın API'leri tarafından sağlanan bir parça eşleme tarafından depolanır.</span><span class="sxs-lookup"><span data-stu-id="752a4-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="752a4-128">Bu özellik adında **parça eşleme Yönetim**.</span><span class="sxs-lookup"><span data-stu-id="752a4-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="752a4-129">Merhaba parça eşleme hello Aracısı parçalama anahtar taşımak istekleri için veritabanı bağlantılarının de görür.</span><span class="sxs-lookup"><span data-stu-id="752a4-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="752a4-130">Bu özellik, başvurulan tooas yöneliktir **veri bağımlı yönlendirme**.</span><span class="sxs-lookup"><span data-stu-id="752a4-130">This capability is referred tooas **data dependent routing**.</span></span>

![Parça eşlemeleri ve veri bağımlı yönlendirme][1]

<span data-ttu-id="752a4-132">Merhaba parça eşleme Yöneticisi eşzamanlı shardlet yönetim işlemlerini hello veritabanlarında gerçekleştiği yüklendiğinde oluşabilecek shardlet veri tutarsız görünümleri kullanıcıları korur.</span><span class="sxs-lookup"><span data-stu-id="752a4-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="752a4-133">toodo, bu nedenle, parça eşlemeleri Aracısı hello veritabanı bağlantılarını hello kitaplığı ile oluşturulmuş bir uygulama için hello.</span><span class="sxs-lookup"><span data-stu-id="752a4-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="752a4-134">Parça yönetim işlemlerini hello shardlet etkileyebilir olduğunda bu bir veritabanı bağlantısı hello parça eşleme işlevselliği tooautomatically KILL izin verir.</span><span class="sxs-lookup"><span data-stu-id="752a4-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="752a4-135">Merhaba geleneksel bir şekilde toocreate bağlantıları için Dapper kullanmak yerine, toouse hello ihtiyacımız [OpenConnectionForKey yöntemi](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="752a4-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="752a4-136">Bu, tüm hello doğrulama gerçekleşir ve herhangi bir veri parça arasında taşındığında bağlantıları düzgün yönetilen sağlar.</span><span class="sxs-lookup"><span data-stu-id="752a4-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="752a4-137">Dapper tümleştirme gereksinimleri</span><span class="sxs-lookup"><span data-stu-id="752a4-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="752a4-138">Merhaba esnek veritabanı istemci kitaplığı ve hello Dapper API'leri ile çalışırken, aşağıdaki özelliklere tooretain hello istiyoruz:</span><span class="sxs-lookup"><span data-stu-id="752a4-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="752a4-139">**Genişletme**: tooadd istediğiniz veya veritabanlarını uygulamasının hello parçalı hello kapasite talebi için gerektikçe hello uygulamasının veri katmanı hello kaldırın.</span><span class="sxs-lookup"><span data-stu-id="752a4-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="752a4-140">**Tutarlılık**: uygulamamız parçalama kullanılarak ölçeklenir olduğundan, veri tooperform bağımlı yönlendirme gerekir.</span><span class="sxs-lookup"><span data-stu-id="752a4-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="752a4-141">Toouse hello veri bağımlı yönlendirme yeteneklerine hello kitaplığı toodo şekilde istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="752a4-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="752a4-142">Özellikle, tooretain hello doğrulama istiyoruz ve sipariş tooavoid Bozulması veya yanlış sorgu sonuçları hello parça eşleme Yöneticisi aracılığıyla aracılı bağlantılar tarafından sağlanan tutarlılığı garanti altına alır.</span><span class="sxs-lookup"><span data-stu-id="752a4-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="752a4-143">Bu, bu bağlantıları tooa shardlet verilen reddedildi veya (örneğin) hello shardlet bölünmüş/Merge API'lerini kullanarak şu anda taşınan tooa farklı parça ise durduruldu sağlar.</span><span class="sxs-lookup"><span data-stu-id="752a4-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="752a4-144">**Nesne eşleme**: hello uygulamada sınıfları ve temel veritabanı yapılarını hello arasında Dapper tootranslate tarafından sağlanan hello eşlemeleri tooretain hello kolaylık istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="752a4-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="752a4-145">Hello aşağıdaki bölümde yönelik yönergeler dayalı uygulamalar için bu gereksinimleri sağlanmaktadır **Dapper** ve **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="752a4-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="752a4-146">Teknik Kılavuzu</span><span class="sxs-lookup"><span data-stu-id="752a4-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="752a4-147">Veri Dapper ile yönlendirme bağımlı</span><span class="sxs-lookup"><span data-stu-id="752a4-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="752a4-148">Dapper ile Merhaba uygulaması oluşturmak ve veritabanı arka plandaki hello bağlantıları toohello açmak için genellikle sorumludur.</span><span class="sxs-lookup"><span data-stu-id="752a4-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="752a4-149">.NET koleksiyonları türü T. Dapper gerçekleştirirken hello eşleme hello T-SQL sonuç satırları toohello nesnelerden t türü T türü hello uygulama tarafından verilen, Dapper sorgu sonuçlarını döndürür Benzer şekilde, Dapper SQL değerleri veya veri işleme dili (DML) deyimleri parametrelerini .NET nesneleri eşler.</span><span class="sxs-lookup"><span data-stu-id="752a4-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="752a4-150">Dapper hello normal üzerinde genişletme yöntemleri aracılığıyla bu işlevselliği sunar [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello ADO .NET SQL istemci kitaplıklarından nesnesi.</span><span class="sxs-lookup"><span data-stu-id="752a4-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="752a4-151">Merhaba DDR için esnek ölçeklendirme API'leri hello tarafından döndürülen SQL bağlantısı normal de [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) nesneleri.</span><span class="sxs-lookup"><span data-stu-id="752a4-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="752a4-152">Ayrıca basit SQL istemci bağlantısı olarak bu bize toodirectly kullanım Dapper uzantıları hello istemci kitaplığının DDR API tarafından döndürülen hello türü üzerinden sağlar.</span><span class="sxs-lookup"><span data-stu-id="752a4-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="752a4-153">Bu gözlemleri hello esnek veritabanı istemci kitaplığı tarafından Dapper için aracılı basit toouse bağlantıları kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="752a4-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="752a4-154">Bu kod örneğindeki (Merhaba) örnek eşlik hello uygulama toohello kitaplığı toobroker hello bağlantı toohello sağ parça tarafından sağlanan hello parçalama anahtar burada hello yaklaşımı açıklar.</span><span class="sxs-lookup"><span data-stu-id="752a4-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="752a4-155">Merhaba çağrısı toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API hello varsayılan oluşturma ve SQL istemci bağlantısı açılırken yerini alır.</span><span class="sxs-lookup"><span data-stu-id="752a4-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="752a4-156">Merhaba [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) çağrısı veri bağımlı yönlendirme için gerekli olan hello bağımsız değişkenleri alır:</span><span class="sxs-lookup"><span data-stu-id="752a4-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="752a4-157">veri bağımlı yönlendirme arabirimlerini Hello parça eşleme tooaccess hello</span><span class="sxs-lookup"><span data-stu-id="752a4-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="752a4-158">Merhaba parçalama anahtar tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="752a4-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="752a4-159">Merhaba kimlik (kullanıcı adı ve parola) tooconnect toohello parça</span><span class="sxs-lookup"><span data-stu-id="752a4-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="752a4-160">Merhaba shardlet parçalama anahtarı verilen hello için tutan bir bağlantı toohello parça Hello parça eşleme nesnesi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="752a4-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="752a4-161">Merhaba esnek veritabanı istemci API de etiket hello bağlantı tooimplement kendi tutarlılığı garanti altına alır.</span><span class="sxs-lookup"><span data-stu-id="752a4-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="752a4-162">Bu yana Hello çağrı çok[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) normal SQL istemci bağlantısı nesnesi, hello sonraki çağrı toohello verir **yürütme** Dapper aşağıdaki uzantısı yönteminden hello standart Dapper yöntem.</span><span class="sxs-lookup"><span data-stu-id="752a4-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="752a4-163">Sorguları iş çok hello aynı şekilde - ilk hello bağlantıyla açtığınız [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hello istemciden API.</span><span class="sxs-lookup"><span data-stu-id="752a4-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="752a4-164">Ardından .NET nesnelerini hello normal Dapper uzantı yöntemleri toomap hello SQL Sorgunuzun sonuçlarını kullanın:</span><span class="sxs-lookup"><span data-stu-id="752a4-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="752a4-165">Bu hello Not **kullanarak** hello DDR bağlantı kapsamlarla hello blok toohello bir parça tenantId1 nerede tutulur içindeki tüm veritabanı işlemleri engelleyin.</span><span class="sxs-lookup"><span data-stu-id="752a4-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="752a4-166">Merhaba sorgu yalnızca hello geçerli parça ancak hello başka bir parça üzerinde depolanan olanları depolanan bloglar döndürür.</span><span class="sxs-lookup"><span data-stu-id="752a4-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="752a4-167">Veri Dapper ve DapperExtensions yönlendirme bağımlı</span><span class="sxs-lookup"><span data-stu-id="752a4-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="752a4-168">Dapper bir daha kullanışlı ve soyutlama hello veritabanından veritabanı uygulamaları geliştirirken sağlayabilir ek uzantıları ekosistemi ile birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="752a4-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="752a4-169">DapperExtensions bir örnektir.</span><span class="sxs-lookup"><span data-stu-id="752a4-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="752a4-170">Uygulamanızda DapperExtensions kullanarak veritabanı bağlantılarını nasıl oluşturulduğunu ve yönetilen değiştirmez.</span><span class="sxs-lookup"><span data-stu-id="752a4-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="752a4-171">Merhaba uygulamanın sorumluluk tooopen bağlantılar hala olduğunu ve normal SQL istemci bağlantısı nesneleri hello genişletme yöntemleri tarafından beklenir.</span><span class="sxs-lookup"><span data-stu-id="752a4-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="752a4-172">Biz üzerinde hello güvenebilirsiniz [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) yukarıda açıklandığı şekilde.</span><span class="sxs-lookup"><span data-stu-id="752a4-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="752a4-173">Aşağıdaki kod örnekleri tarafından Göster Hello hello tek değişiklik biz artık toowrite hello T-SQL deyimleri sahip olabilir:</span><span class="sxs-lookup"><span data-stu-id="752a4-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="752a4-174">Ve hello sorgu için hello kod örneği aşağıdadır:</span><span class="sxs-lookup"><span data-stu-id="752a4-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="752a4-175">Geçici hata işleme</span><span class="sxs-lookup"><span data-stu-id="752a4-175">Handling transient faults</span></span>
<span data-ttu-id="752a4-176">Merhaba Microsoft Patterns & yöntemler yayımlanan hello ekip [geçici hata işleme uygulama bloğu](http://msdn.microsoft.com/library/hh680934.aspx) toohelp uygulama geliştiricileri hello bulutta çalışan karşılaşılan yaygın geçici hata koşulları etkisini azaltır.</span><span class="sxs-lookup"><span data-stu-id="752a4-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="752a4-177">Daha fazla bilgi için bkz: [Perseverance, tüm Triumphs gizliliği: hello geçici hata işleme uygulama bloğu kullanarak](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="752a4-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="752a4-178">Merhaba geçici hata kitaplığı tooprotect geçici hataları karşı Hello kod örneği kullanır.</span><span class="sxs-lookup"><span data-stu-id="752a4-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="752a4-179">**SqlDatabaseUtils.SqlRetryPolicy** hello Yukarıdaki kod olarak tanımlanan bir **SqlDatabaseTransientErrorDetectionStrategy** bir yeniden deneme sayısı 10 ve 5 saniye ile yeniden denemeler arasındaki süre bekleyin.</span><span class="sxs-lookup"><span data-stu-id="752a4-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="752a4-180">İşlemler kullanıyorsanız, yeniden deneme kapsamınızı geri toohello gider emin olun geçici bir hata hello durumda hello işlem başlangıcı.</span><span class="sxs-lookup"><span data-stu-id="752a4-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="752a4-181">Sınırlamalar</span><span class="sxs-lookup"><span data-stu-id="752a4-181">Limitations</span></span>
<span data-ttu-id="752a4-182">Bu belgede özetlenen hello yaklaşımlar birkaç sınırlama oluşturulmasını gerektirir:</span><span class="sxs-lookup"><span data-stu-id="752a4-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="752a4-183">Bu belge için örnek kod Hello göstermek değil nasıl toomanage şema parça genelinde.</span><span class="sxs-lookup"><span data-stu-id="752a4-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="752a4-184">Bir istek göz önüne alındığında, tüm veritabanı işleme hello isteğiyle sağlanan hello parçalama anahtarı tarafından tanımlandığı gibi tek bir parça içinde bulunur varsayıyoruz.</span><span class="sxs-lookup"><span data-stu-id="752a4-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="752a4-185">Olası toomake parçalama anahtar kullanılabilir olmadığında ancak, bu varsayım her zaman, örneğin, tutmaz.</span><span class="sxs-lookup"><span data-stu-id="752a4-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="752a4-186">tooaddress Bu, hello esnek veritabanı istemci kitaplığı içerir hello [MultiShardQuery sınıfı](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="752a4-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="752a4-187">Merhaba sınıfı birkaç parça sorgulama için bir bağlantı Özet uygular.</span><span class="sxs-lookup"><span data-stu-id="752a4-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="752a4-188">MultiShardQuery Dapper birlikte kullanılması hello bu belgenin kapsamında değildir.</span><span class="sxs-lookup"><span data-stu-id="752a4-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="752a4-189">Sonuç</span><span class="sxs-lookup"><span data-stu-id="752a4-189">Conclusion</span></span>
<span data-ttu-id="752a4-190">Dapper ve DapperExtensions kullanarak uygulamaları kolayca Azure SQL veritabanı için esnek Veritabanı Araçları'ndan yararlanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="752a4-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="752a4-191">Bu belgede özetlenen hello adımları, hello oluşturma değiştirme ve, yeni açarak yönlendirme bağımlı veriler için hello aracın yeteneği bu uygulamaları kullanabilirsiniz [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) nesneleri toouse hello [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hello esnek veritabanı istemci kitaplığı çağrısı.</span><span class="sxs-lookup"><span data-stu-id="752a4-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="752a4-192">Bu yeni bağlantı burada oluşturulan ve açılan hello uygulama değişiklikleri gerekli toothose yerler sınırlar.</span><span class="sxs-lookup"><span data-stu-id="752a4-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
