---
title: "Azure SQL veritabanı çalışırken uygulama yükseltme - | Microsoft Docs"
description: "Azure SQL Database coğrafi çoğaltma bulut uygulamanızın çevrimiçi yükseltmeler desteklemek için nasıl kullanılacağını öğrenin."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 4b59c8aa3dea3e8fba692ab66420295a09210d3b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="b01dd-103">SQL veritabanı etkin coğrafi çoğaltma'yı kullanarak bulut uygulamalarının yükseltmelerini yönetme</span><span class="sxs-lookup"><span data-stu-id="b01dd-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="b01dd-104">[Aktif coğrafi çoğaltma](sql-database-geo-replication-overview.md) tüm katmanlar tüm veritabanları için kullanıma sunulmuştur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="b01dd-105">Nasıl kullanacağınızı öğrenin [coğrafi çoğaltma](sql-database-geo-replication-overview.md) yükseltmelerini bulut uygulamanızın etkinleştirmek için SQL veritabanında.</span><span class="sxs-lookup"><span data-stu-id="b01dd-105">Learn how to use [geo-replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="b01dd-106">Yükseltme benzer bir işlem olduğundan, iş sürekliliği planlama ve tasarım parçası olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="b01dd-107">Bu makalede biz yükseltme işlemini yönetme iki farklı yöntem bakın ve avantajları ve dengelemeler her seçenekle tartışın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="b01dd-108">Bu makalede amaçları doğrultusunda, veri katmanı olarak tek bir veritabanına bağlı bir web sitesi oluşan basit bir uygulama kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="b01dd-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span></span> <span data-ttu-id="b01dd-109">Amacımız sürüm 1, sürüm 2 son kullanıcı deneyimi üzerinde önemli bir etkisi olmadan uygulamanın yükseltmektir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end-user experience.</span></span> 

<span data-ttu-id="b01dd-110">Yükseltme seçenekleri değerlendirirken, aşağıdaki etmenleri dikkate alın:</span><span class="sxs-lookup"><span data-stu-id="b01dd-110">When evaluating the upgrade options you should consider the following factors:</span></span>

* <span data-ttu-id="b01dd-111">Yükseltme sırasında uygulama kullanılabilirliği üzerindeki etkisini.</span><span class="sxs-lookup"><span data-stu-id="b01dd-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="b01dd-112">Ne kadar süreyle uygulama işlevi sınırlı düşürülmüş veya olabilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-112">How long the application function may be limited or degraded.</span></span>
* <span data-ttu-id="b01dd-113">Yükseltmenin başarısız olması durumunda geri yeteneği.</span><span class="sxs-lookup"><span data-stu-id="b01dd-113">Ability to roll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="b01dd-114">Yükseltme sırasında ilgisiz geri dönülemez bir hata oluşursa, uygulamanın bir güvenlik açığı.</span><span class="sxs-lookup"><span data-stu-id="b01dd-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span></span>
* <span data-ttu-id="b01dd-115">Maliyet toplam dolar.</span><span class="sxs-lookup"><span data-stu-id="b01dd-115">Total dollar cost.</span></span>  <span data-ttu-id="b01dd-116">Bu ek artıklık ve yükseltme işlemi tarafından kullanılan geçici bileşenlerinin artımlı maliyetlerini içerir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="b01dd-117">Olağanüstü durum kurtarma için veritabanı yedeklemeleri kullanan uygulamalar yükseltme</span><span class="sxs-lookup"><span data-stu-id="b01dd-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="b01dd-118">Uygulamanızın üzerinde otomatik veritabanı yedeklemeyi kullanır ve olağanüstü durum kurtarma için coğrafi geri yükleme kullanıyorsa, genellikle tek bir Azure bölgesine dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span></span> <span data-ttu-id="b01dd-119">Bu durumda yükseltme işlemi, tüm uygulama bileşenleri yedekleme dağıtımını yükseltme katılan oluşturma içerir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span></span> <span data-ttu-id="b01dd-120">Son kullanıcı kesintiyi en aza indirmek için yük devretme profiliyle Azure trafik Yöneticisi (WATM) özelliğinden yararlanır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span></span>  <span data-ttu-id="b01dd-121">Aşağıdaki diyagramda, yükseltme işlemi önce işletimsel ortamı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-121">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="b01dd-122">Uç nokta <i>contoso 1.azurewebsites.net</i> yükseltilmesi gereken uygulamanın üretim yuvasını temsil eder.</span><span class="sxs-lookup"><span data-stu-id="b01dd-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span></span> <span data-ttu-id="b01dd-123">Geri alma olanağı sağlamak için yükseltme aşaması yuvası tam olarak eşitlenen bir kopyasını uygulama ile oluşturduğunuz.</span><span class="sxs-lookup"><span data-stu-id="b01dd-123">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="b01dd-124">Aşağıdaki adımları uygulama yükseltme için hazırlamak üzere gereklidir:</span><span class="sxs-lookup"><span data-stu-id="b01dd-124">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="b01dd-125">Yükseltme için hazırlamak yuva oluşturun.</span><span class="sxs-lookup"><span data-stu-id="b01dd-125">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="b01dd-126">İçin ikincil bir veritabanı (1) oluşturmak ve aynı Azure bölgesinde özdeş bir web sitesi dağıtımı yapın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-126">To do that create a secondary database (1) and deploy an identical web site in the same Azure region.</span></span> <span data-ttu-id="b01dd-127">Dengeli dağıtım işlemi tamamladığını görmek için ikincil izleyin.</span><span class="sxs-lookup"><span data-stu-id="b01dd-127">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="b01dd-128">WATM'ye ile bir yük devretme profili <i>contoso 1.azurewebsites.net</i> çevrimiçi uç noktası olarak ve <i>contoso 2.azurewebsites.net</i> çevrimdışı olarak.</span><span class="sxs-lookup"><span data-stu-id="b01dd-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="b01dd-129">Hazırlık adımları üretim yuvasına uygulamada etkilemez ve tam erişim modunda çalışabilen unutmayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
>  

![SQL veritabanı Git çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="b01dd-132">Hazırlık adımları tamamladıktan sonra gerçek yükseltme için hazır bir uygulamadır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span></span> <span data-ttu-id="b01dd-133">Aşağıdaki diyagram yükseltme işleminde adımlarını gösterir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-133">The following diagram illustrates the steps involved in the upgrade process.</span></span> 

1. <span data-ttu-id="b01dd-134">Birincil veritabanı salt okunur modda (3) üretim yuvasına ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-134">Set the primary database in the production slot to read-only mode (3).</span></span> <span data-ttu-id="b01dd-135">Bu uygulama (V1) üretim örneği, salt okunur böylece farklılıklara V1 ve V2 veritabanı örnekleri arasında önleme yükseltme sırasında kalacağına garanti.</span><span class="sxs-lookup"><span data-stu-id="b01dd-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="b01dd-136">Planlanan sonlandırma modu (4) kullanılarak ikincil veritabanı bağlantısını kesin.</span><span class="sxs-lookup"><span data-stu-id="b01dd-136">Disconnect the secondary database using the planned termination mode (4).</span></span> <span data-ttu-id="b01dd-137">Birincil veritabanı tam olarak eşitlenen bağımsız bir kopyasını oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-137">It will create a fully synchronized independent copy of the primary database.</span></span> <span data-ttu-id="b01dd-138">Bu veritabanı yükseltilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="b01dd-139">Birincil veritabanına okuma-yazma modunda açın ve hazırlama yuvası (5) yükseltme komut dosyası çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span></span>     

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="b01dd-142">Yükseltme başarıyla tamamlandı, artık son kullanıcıların aşamalı kopyalama uygulama geçiş yapmak hazırsınız.</span><span class="sxs-lookup"><span data-stu-id="b01dd-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span></span> <span data-ttu-id="b01dd-143">Şimdi uygulamayı üretim yuvasına haline gelir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-143">It will now become the production slot of the application.</span></span>  <span data-ttu-id="b01dd-144">Bu, aşağıdaki diyagramda gösterildiği gibi birkaç adım içerir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-144">This involves a few more steps as illustrated on the following diagram.</span></span>

1. <span data-ttu-id="b01dd-145">WATM'ye profilde çevrimiçi endpoint geçiş <i>contoso 2.azurewebsites.net</i>, web sitesi (6) V2 sürümüne işaret eder.</span><span class="sxs-lookup"><span data-stu-id="b01dd-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span></span> <span data-ttu-id="b01dd-146">Şimdi V2 uygulama üretim yuvasıyla olur ve son kullanıcı trafiği için yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-146">It now becomes the production slot with the V2 application and the end-user traffic is directed to it.</span></span>  
2. <span data-ttu-id="b01dd-147">Güvenli bir şekilde şekilde V1 uygulama bileşenleri artık ihtiyacınız varsa bunları (7) kaldırın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-147">If you no longer need the V1 application components so you can safely remove them (7).</span></span>   

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="b01dd-150">Yükseltme işlemi başarısız olursa, örneğin yükseltme komut dosyası bir hata nedeniyle aşama yuvası sayılacağı tehlikeye.</span><span class="sxs-lookup"><span data-stu-id="b01dd-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="b01dd-151">Uygulama yükseltme öncesi durumuna geri almak için yalnızca tam erişim üretim yuvasına uygulamaya geri dönün.</span><span class="sxs-lookup"><span data-stu-id="b01dd-151">To roll back the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span></span> <span data-ttu-id="b01dd-152">Sonraki diyagramı adımlar gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-152">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="b01dd-153">Veritabanı kopyasını okuma-yazma modunda (8) ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-153">Set the database copy to read-write mode (8).</span></span> <span data-ttu-id="b01dd-154">Bu, üretim yuvasında işlevsel olarak tam V1 geri yükler.</span><span class="sxs-lookup"><span data-stu-id="b01dd-154">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="b01dd-155">Kök neden analizi yapmak ve hazırlama yuvası (9) güvenliği aşılmış bileşenleri kaldırın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span></span> 

<span data-ttu-id="b01dd-156">Bu noktada tam olarak işlevsel bir uygulamasıdır ve yükseltme adımlarının yinelenebilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-156">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="b01dd-157">Geri alma zaten işaret gibi WATM profilinde değişiklik gerektirmez <i>contoso 1.azurewebsites.net</i> etkin uç noktası olarak.</span><span class="sxs-lookup"><span data-stu-id="b01dd-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="b01dd-160">Anahtar **avantajı** bu uygulamanın basit adımları kümesini kullanarak tek bir bölgedeki yükseltebilirsiniz seçeneğidir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-160">The key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="b01dd-161">Yükseltme dolar maliyeti oldukça düşüktür.</span><span class="sxs-lookup"><span data-stu-id="b01dd-161">The dollar cost of the upgrade is relatively low.</span></span> <span data-ttu-id="b01dd-162">Ana **kolaylığını** yükseltme sırasında yıkıcı bir hata oluşursa, kurtarma için yükseltme öncesi durumu uygulamanın farklı bir bölgeye ve Yedekleme'yi kullanarak veritabanını geri yeniden dağıtımı gerektireceğini olduğu coğrafi geri yükleme.</span><span class="sxs-lookup"><span data-stu-id="b01dd-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span></span> <span data-ttu-id="b01dd-163">Bu işlem, önemli kapalı kalma sürelerine neden olur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="b01dd-164">Olağanüstü durum kurtarma için veritabanı coğrafi çoğaltma kullanan uygulamalar yükseltme</span><span class="sxs-lookup"><span data-stu-id="b01dd-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="b01dd-165">Uygulamanızı coğrafi çoğaltma iş sürekliliği için kullanırsa, etkin bir birincil bölge dağıtım ve yedekleme bölge bekleme bir dağıtımda sahip en az iki farklı bölgelere dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-165">If your application leverages geo-replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="b01dd-166">Daha önce bahsedilen Etkenler ek olarak, yükseltme işlemi, etmeleri gerekir:</span><span class="sxs-lookup"><span data-stu-id="b01dd-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span></span>

* <span data-ttu-id="b01dd-167">Uygulama, yükseltme işlemi sırasında her zaman geri dönülemez hatalarından korumalı kalır</span><span class="sxs-lookup"><span data-stu-id="b01dd-167">The application remains protected from catastrophic failures at all times during the upgrade process</span></span>
* <span data-ttu-id="b01dd-168">Coğrafi olarak yedekli bileşenleri uygulamanın paralel etkin bileşenlerle yükseltilir</span><span class="sxs-lookup"><span data-stu-id="b01dd-168">The geo-redundant components of the application are upgraded in parallel with the active components</span></span>

<span data-ttu-id="b01dd-169">Bu hedefleri başarmanın tane aktif, üç yedekleme uç noktaları ile yük devretme profilini kullanarak Azure trafik Yöneticisi (WATM) özelliğinden yararlanır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="b01dd-170">Aşağıdaki diyagramda, yükseltme işlemi önce işletimsel ortamı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-170">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="b01dd-171">Web siteleri <i>contoso 1.azurewebsites.net</i> ve <i>contoso dr.azurewebsites.net</i> üretim yuvasına uygulamasının tam coğrafi artıklık ile temsil eder.</span><span class="sxs-lookup"><span data-stu-id="b01dd-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span></span> <span data-ttu-id="b01dd-172">Geri alma olanağı sağlamak için yükseltme aşaması yuvası tam olarak eşitlenen bir kopyasını uygulama ile oluşturduğunuz.</span><span class="sxs-lookup"><span data-stu-id="b01dd-172">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="b01dd-173">Yükseltme işlemi sırasında yıkıcı bir hata oluşması durumunda uygulama hızlıca kurtarılabileceğinden emin olmak gerektiğinden, aşama yuvası da coğrafi olarak yedekli olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-173">Because you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process, the stage slot needs to be geo-redundant as well.</span></span> <span data-ttu-id="b01dd-174">Aşağıdaki adımları uygulama yükseltme için hazırlamak üzere gereklidir:</span><span class="sxs-lookup"><span data-stu-id="b01dd-174">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="b01dd-175">Yükseltme için hazırlamak yuva oluşturun.</span><span class="sxs-lookup"><span data-stu-id="b01dd-175">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="b01dd-176">İçin ikincil bir veritabanı (1) oluşturmak ve web sitesi aynı Azure bölgesinde özdeş bir kopyasını dağıtan yapın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-176">To do that create a secondary database (1) and deploy an identical copy of the web site in the same Azure region.</span></span> <span data-ttu-id="b01dd-177">Dengeli dağıtım işlemi tamamladığını görmek için ikincil izleyin.</span><span class="sxs-lookup"><span data-stu-id="b01dd-177">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="b01dd-178">Coğrafi olarak yedekli ikincil bir veritabanı aşama yuvasında tarafından coğrafi çoğaltma (Buna "coğrafi çoğaltma zincirleme" adı verilir) yedekleme bölgeye ikincil veritabanı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="b01dd-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="b01dd-179">Dengeli dağıtım işlemi tamamlanmış (3) olup olmadığını görmek için ikincil yedekleme izleyin.</span><span class="sxs-lookup"><span data-stu-id="b01dd-179">Monitor the backup secondary to see if the seeding process is completed (3).</span></span>
3. <span data-ttu-id="b01dd-180">Yedekleme bölgede web sitesi yedek bir kopyasını oluşturun ve coğrafi olarak yedekli ikincil (4) bağlayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="b01dd-181">Ek uç noktaları ekleme <i>contoso 2.azurewebsites.net</i> ve <i>contoso 3.azurewebsites.net</i> WATM çevrimdışı uç noktalar (5) olarak yük devretme profiline.</span><span class="sxs-lookup"><span data-stu-id="b01dd-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="b01dd-182">Hazırlık adımları üretim yuvasına uygulamada etkilemez ve tam erişim modunda çalışabilen unutmayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="b01dd-185">Hazırlık adımları tamamlandığında, aşama yuvası yükseltme için hazır olur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span></span> <span data-ttu-id="b01dd-186">Aşağıdaki diyagram, yükseltme adımlarını gösterir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-186">The following diagram illustrates the upgrade steps.</span></span>

1. <span data-ttu-id="b01dd-187">Birincil veritabanı salt okunur modda (6) üretim yuvasına ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-187">Set the primary database in the production slot to read-only mode (6).</span></span> <span data-ttu-id="b01dd-188">Bu uygulama (V1) üretim örneği, salt okunur böylece farklılıklara V1 ve V2 veritabanı örnekleri arasında önleme yükseltme sırasında kalacağına garanti.</span><span class="sxs-lookup"><span data-stu-id="b01dd-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="b01dd-189">Planlanan sonlandırma modunu (7) kullanarak aynı bölgede ikincil veritabanı bağlantısını kesin.</span><span class="sxs-lookup"><span data-stu-id="b01dd-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span></span> <span data-ttu-id="b01dd-190">Birincil sonlanmasından sonra otomatik olarak olacak birincil veritabanı tam olarak eşitlenen bağımsız bir kopyasını oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span></span> <span data-ttu-id="b01dd-191">Bu veritabanı yükseltilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="b01dd-192">Birincil veritabanını okuma-yazma moduna aşama yuvadaki açın ve yükseltme komut dosyası (8) çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span></span>    

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="b01dd-195">Yükseltme başarıyla tamamlandı, şimdi son kullanıcılar uygulamayı V2 sürümüne geçiş hazır olduğunuzda.</span><span class="sxs-lookup"><span data-stu-id="b01dd-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span></span> <span data-ttu-id="b01dd-196">Aşağıdaki diyagram adımlarını gösterir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-196">The following diagram illustrates the steps involved.</span></span>

1. <span data-ttu-id="b01dd-197">WATM'ye profilde etkin uç nokta geçiş <i>contoso 2.azurewebsites.net</i>, şimdi web sitesi (9) V2 sürümüne işaret eder.</span><span class="sxs-lookup"><span data-stu-id="b01dd-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span></span> <span data-ttu-id="b01dd-198">Şimdi V2 uygulama üretim yuvasıyla olur ve son kullanıcı trafiği için yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-198">It now becomes a production slot with the V2 application and end-user traffic is directed to it.</span></span> 
2. <span data-ttu-id="b01dd-199">Güvenli bir şekilde şekilde V1 uygulama artık ihtiyacınız varsa onu (10 ve 11) kaldırın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span></span>  

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="b01dd-202">Yükseltme işlemi başarısız olursa, örneğin yükseltme komut dosyası bir hata nedeniyle aşama yuvası sayılacağı tehlikeye.</span><span class="sxs-lookup"><span data-stu-id="b01dd-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="b01dd-203">Uygulama yükseltme öncesi durumuna geri almak için yalnızca tam erişimi olan üretim yuvasındaki uygulamayı kullanmaya geri dönün.</span><span class="sxs-lookup"><span data-stu-id="b01dd-203">To roll back the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span></span> <span data-ttu-id="b01dd-204">Sonraki diyagramı adımlar gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-204">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="b01dd-205">Birincil veritabanı kopyasını okuma-yazma modunda (12) üretim yuvasına ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-205">Set the primary database copy in the production slot to read-write mode (12).</span></span> <span data-ttu-id="b01dd-206">Bu, üretim yuvasında işlevsel olarak tam V1 geri yükler.</span><span class="sxs-lookup"><span data-stu-id="b01dd-206">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="b01dd-207">Kök neden analizi yapmak ve güvenliği aşılan bileşenleri aşama yuvada (13 ve 14) kaldırın.</span><span class="sxs-lookup"><span data-stu-id="b01dd-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span></span> 

<span data-ttu-id="b01dd-208">Bu noktada tam olarak işlevsel bir uygulamasıdır ve yükseltme adımlarının yinelenebilir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-208">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="b01dd-209">Geri alma zaten işaret gibi WATM profilinde değişiklik gerektirmez <i>contoso 1.azurewebsites.net</i> etkin uç noktası olarak.</span><span class="sxs-lookup"><span data-stu-id="b01dd-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![SQL Database coğrafi çoğaltma yapılandırması.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="b01dd-212">Anahtar **avantajı** bu uygulama ve onun coğrafi olarak yedekli kopyalama paralel yükseltme sırasında iş sürekliliği ödün vermeden yükseltebilirsiniz, seçeneğidir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span></span> <span data-ttu-id="b01dd-213">Ana **kolaylığını** her uygulama bileşeninin çift artıklığı gerektirir ve bu nedenle daha yüksek dolar maliyet oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="b01dd-214">Ayrıca, daha karmaşık bir iş akışı içerir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="b01dd-215">Özet</span><span class="sxs-lookup"><span data-stu-id="b01dd-215">Summary</span></span>
<span data-ttu-id="b01dd-216">Makalede açıklanan iki yükseltme yöntemlerini karmaşıklığı farklıdır ve son kullanıcı salt okunur işlemler için sınırlı olduğunda süresini en aza indirerek üzerinde maliyet dolar ancak her iki odaklanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="b01dd-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span></span> <span data-ttu-id="b01dd-217">Bu süre doğrudan yükseltme komut dosyası süreye göre tanımlanır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-217">That time is directly defined by the duration of the upgrade script.</span></span> <span data-ttu-id="b01dd-218">Veritabanı boyutu, seçtiğiniz hizmet katmanı, web sitesi yapılandırması ve kolayca denetleyemezsiniz diğer etkenlere bağlı değildir.</span><span class="sxs-lookup"><span data-stu-id="b01dd-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="b01dd-219">Tüm hazırlık adımları yükseltme yer alan adımları ayrılmış ve üretim uygulama etkilemeden yapılabilir olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="b01dd-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span></span> <span data-ttu-id="b01dd-220">Yükseltme komut dosyası verimliliğini yükseltmeler sırasında son kullanıcı deneyimini belirleyen önemli bir faktördür.</span><span class="sxs-lookup"><span data-stu-id="b01dd-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span></span> <span data-ttu-id="b01dd-221">Bu nedenle geliştirmek en iyi yükseltme komut dosyası olarak verimli hale çabalarınız odaklanan yoludur.</span><span class="sxs-lookup"><span data-stu-id="b01dd-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="b01dd-222">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="b01dd-222">Next steps</span></span>
* <span data-ttu-id="b01dd-223">İş sürekliliğine genel bakış ve senaryolar için bkz: [iş sürekliliğine genel bakış](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="b01dd-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="b01dd-224">Veritabanı Yedeklemeleri otomatik Azure SQL hakkında bilgi edinmek için bkz: [SQL veritabanı yedeklemeleri otomatik](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="b01dd-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="b01dd-225">Kurtarma için otomatik yedeklemeler kullanma hakkında bilgi edinmek için bkz: [bir veritabanını otomatik yedeklerden geri](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="b01dd-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="b01dd-226">Daha hızlı kurtarma seçenekleri hakkında bilgi edinmek için [aktif coğrafi çoğaltma](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b01dd-226">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


