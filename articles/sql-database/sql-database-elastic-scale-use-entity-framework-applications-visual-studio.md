---
title: "Entity Framework aaaUsing esnek veritabanı istemci kitaplığı | Microsoft Docs"
description: "Esnek veritabanı istemci kitaplığı ve Entity Framework veritabanları kodlama için kullanın"
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
editor: 
ms.assetid: b9c3065b-cb92-41be-aa7f-deba23e7e159
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/06/2017
ms.author: torsteng
ms.openlocfilehash: 917f6d28d9855c0b42afe2c008613a9bbb3ec6b6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="elastic-database-client-library-with-entity-framework"></a><span data-ttu-id="75ee3-103">Entity Framework ile esnek veritabanı istemci kitaplığı</span><span class="sxs-lookup"><span data-stu-id="75ee3-103">Elastic Database client library with Entity Framework</span></span>
<span data-ttu-id="75ee3-104">Bu belge, uygulamada hello ile gerekli toointegrate olan Entity Framework hello değişiklikleri gösterir. [esnek veritabanı araçlarını](sql-database-elastic-scale-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="75ee3-104">This document shows hello changes in an Entity Framework application that are needed toointegrate with hello [Elastic Database tools](sql-database-elastic-scale-introduction.md).</span></span> <span data-ttu-id="75ee3-105">Merhaba odak noktasıdır oluşturma üzerinde [parça eşleme Yönetim](sql-database-elastic-scale-shard-map-management.md) ve [veri bağımlı yönlendirme](sql-database-elastic-scale-data-dependent-routing.md) hello Entity Framework ile **Code First** yaklaşım.</span><span class="sxs-lookup"><span data-stu-id="75ee3-105">hello focus is on composing [shard map management](sql-database-elastic-scale-shard-map-management.md) and [data-dependent routing](sql-database-elastic-scale-data-dependent-routing.md) with hello Entity Framework **Code First** approach.</span></span> <span data-ttu-id="75ee3-106">Merhaba [ilk - yeni veritabanı kod](http://msdn.microsoft.com/data/jj193542.aspx) öğretici EF için bu belge boyunca çalışan bizim örnek olarak hizmet verir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-106">hello [Code First - New Database](http://msdn.microsoft.com/data/jj193542.aspx) tutorial for EF serves as our running example throughout this document.</span></span> <span data-ttu-id="75ee3-107">Bu belge eşlik hello örnek kod, esnek veritabanı araçlarını hello Visual Studio kod örnekleri örnekleri kümesi parçasıdır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-107">hello sample code accompanying this document is part of elastic database tools' set of samples in hello Visual Studio Code Samples.</span></span>

## <a name="downloading-and-running-hello-sample-code"></a><span data-ttu-id="75ee3-108">Yükleme ve başlangıç örnek kodu çalıştırma</span><span class="sxs-lookup"><span data-stu-id="75ee3-108">Downloading and Running hello Sample Code</span></span>
<span data-ttu-id="75ee3-109">Bu makale için toodownload hello kodu:</span><span class="sxs-lookup"><span data-stu-id="75ee3-109">toodownload hello code for this article:</span></span>

* <span data-ttu-id="75ee3-110">Visual Studio 2012 veya üzeri gereklidir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-110">Visual Studio 2012 or later is required.</span></span> 
* <span data-ttu-id="75ee3-111">Merhaba karşıdan [Azure SQL - Entity Framework tümleştirme örneği için esnek DB Araçları](https://code.msdn.microsoft.com/windowsapps/Elastic-Scale-with-Azure-bae904ba) MSDN'den.</span><span class="sxs-lookup"><span data-stu-id="75ee3-111">Download hello [Elastic DB Tools for Azure SQL - Entity Framework Integration sample](https://code.msdn.microsoft.com/windowsapps/Elastic-Scale-with-Azure-bae904ba) from MSDN.</span></span> <span data-ttu-id="75ee3-112">Seçtiğiniz hello örnek tooa konumu sıkıştırmasını açın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-112">Unzip hello sample tooa location of your choosing.</span></span>
* <span data-ttu-id="75ee3-113">Visual Studio’yu çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-113">Start Visual Studio.</span></span> 
* <span data-ttu-id="75ee3-114">Visual Studio'da Aç proje/çözüm dosyasını seçin ->.</span><span class="sxs-lookup"><span data-stu-id="75ee3-114">In Visual Studio, select File -> Open Project/Solution.</span></span> 
* <span data-ttu-id="75ee3-115">Merhaba, **Proje Aç** iletişim kutusunda, indirdiğiniz toohello örnek gidin ve seçin **EntityFrameworkCodeFirst.sln** tooopen hello örnek.</span><span class="sxs-lookup"><span data-stu-id="75ee3-115">In hello **Open Project** dialog, navigate toohello sample you downloaded and select **EntityFrameworkCodeFirst.sln** tooopen hello sample.</span></span> 

<span data-ttu-id="75ee3-116">toorun hello örnek toocreate üç boş veritabanları, Azure SQL veritabanında gerekir:</span><span class="sxs-lookup"><span data-stu-id="75ee3-116">toorun hello sample, you need toocreate three empty databases in Azure SQL Database:</span></span>

* <span data-ttu-id="75ee3-117">Parça eşleme Manager veritabanı</span><span class="sxs-lookup"><span data-stu-id="75ee3-117">Shard Map Manager database</span></span>
* <span data-ttu-id="75ee3-118">Parça 1 veritabanı</span><span class="sxs-lookup"><span data-stu-id="75ee3-118">Shard 1 database</span></span>
* <span data-ttu-id="75ee3-119">Parça 2 veritabanı</span><span class="sxs-lookup"><span data-stu-id="75ee3-119">Shard 2 database</span></span>

<span data-ttu-id="75ee3-120">Bu veritabanları oluşturduktan sonra hello yer tutucu doldurun **Program.cs** Azure SQL veritabanı sunucunuzun adını, hello veritabanı adları ve kimlik bilgilerini tooconnect toohello veritabanlarınızı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-120">Once you have created these databases, fill in hello place holders in **Program.cs** with your Azure SQL DB server name, hello database names and your credentials tooconnect toohello databases.</span></span> <span data-ttu-id="75ee3-121">Visual Studio'da Hello çözümü oluşturun.</span><span class="sxs-lookup"><span data-stu-id="75ee3-121">Build hello solution in Visual Studio.</span></span> <span data-ttu-id="75ee3-122">Visual Studio hello esnek veritabanı istemci kitaplığı, Entity Framework ve geçici hello derleme işleminin bir parçası işleme hata için gerekli hello NuGet paketlerini indirir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-122">Visual Studio will download hello required NuGet packages for hello elastic database client library, Entity Framework, and Transient Fault handling as part of hello build process.</span></span> <span data-ttu-id="75ee3-123">NuGet paketleri geri çözümünüz için etkinleştirildiğinden emin olun.</span><span class="sxs-lookup"><span data-stu-id="75ee3-123">Make sure that restoring NuGet packages is enabled for your solution.</span></span> <span data-ttu-id="75ee3-124">Visual Studio Çözüm Gezgini hello hello çözüm dosyasında sağ tıklayarak bu ayarı etkinleştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-124">You can enable this setting by right-clicking on hello solution file in hello Visual Studio Solution Explorer.</span></span> 

## <a name="entity-framework-workflows"></a><span data-ttu-id="75ee3-125">Entity Framework iş akışları</span><span class="sxs-lookup"><span data-stu-id="75ee3-125">Entity Framework workflows</span></span>
<span data-ttu-id="75ee3-126">Entity Framework geliştiriciler dört iş akışları toobuild uygulamalar ve uygulama nesneleri tooensure kalıcılığını aşağıdaki hello birini kullanır:</span><span class="sxs-lookup"><span data-stu-id="75ee3-126">Entity Framework developers rely on one of hello following four workflows toobuild applications and tooensure persistence for application objects:</span></span> 

* <span data-ttu-id="75ee3-127">**(Yeni veritabanı) ilk kod**: hello EF Geliştirici hello uygulama kodunda hello modeli oluşturur ve ardından EF hello veritabanı ondan oluşturur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-127">**Code First (New Database)**: hello EF developer creates hello model in hello application code and then EF generates hello database from it.</span></span> 
* <span data-ttu-id="75ee3-128">**İlk (var olan veritabanı) kod**: hello Geliştirici hello uygulama kodu hello modeli için varolan bir veritabanından oluşturmak EF olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-128">**Code First (Existing Database)**: hello developer lets EF generate hello application code for hello model from an existing database.</span></span>
* <span data-ttu-id="75ee3-129">**Model ilk**: hello Geliştirici hello modeli hello EF Designer'da ve ardından EF hello veritabanı hello modelden oluşturur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-129">**Model First**: hello developer creates hello model in hello EF designer and then EF creates hello database from hello model.</span></span>
* <span data-ttu-id="75ee3-130">**Veritabanı ilk**: hello Geliştirici tooinfer hello varolan bir veritabanını modelden tooling EF kullanır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-130">**Database First**: hello developer uses EF tooling tooinfer hello model from an existing database.</span></span> 

<span data-ttu-id="75ee3-131">Veritabanı bağlantılarını ve veritabanı şeması bir uygulama için tüm bu yaklaşımlar hello DbContext sınıfı tootransparently üzerinde kullanan yönetin.</span><span class="sxs-lookup"><span data-stu-id="75ee3-131">All these approaches rely on hello DbContext class tootransparently manage database connections and database schema for an application.</span></span> <span data-ttu-id="75ee3-132">Merhaba belgenin ilerleyen bölümlerinde daha ayrıntılı bağlantı oluşturma üzerinde denetim farklı düzeylerde hello DbContext temel sınıf farklı oluşturucularda izin aşağıdakiler ele alınacaktır olarak önyükleme ve şema oluşturma veritabanı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-132">As we will discuss in more detail later in hello document, different constructors on hello DbContext base class allow for different levels of control over connection creation, database bootstrapping and schema creation.</span></span> <span data-ttu-id="75ee3-133">Öncelikle Itanium tabanlı sistemler için hello bağlantı yönetim özellikleri, sağlanan hello veri bağımlı yönlendirme arabirimleri ile Merhaba veritabanı bağlantısı yönetimini EF tarafından sağlanan kesiştiğinden hello olgu zorluklar hello esnek veritabanı istemci kitaplığı tarafından kaynaklanır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-133">Challenges arise primarily from hello fact that hello database connection management provided by EF intersects with hello connection management capabilities of hello data dependent routing interfaces provided by hello elastic database client library.</span></span> 

## <a name="elastic-database-tools-assumptions"></a><span data-ttu-id="75ee3-134">Varsayımlar esnek veritabanı araçları</span><span class="sxs-lookup"><span data-stu-id="75ee3-134">Elastic database tools assumptions</span></span>
<span data-ttu-id="75ee3-135">Terim tanımları için bkz: [esnek veritabanı araçlarını sözlüğü](sql-database-elastic-scale-glossary.md).</span><span class="sxs-lookup"><span data-stu-id="75ee3-135">For term definitions, see [Elastic Database tools glossary](sql-database-elastic-scale-glossary.md).</span></span>

<span data-ttu-id="75ee3-136">Esnek veritabanı istemci kitaplığı ile uygulama verilerinizi shardlets adlı Bölüm tanımlayın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-136">With elastic database client library, you define partitions of your application data called shardlets.</span></span> <span data-ttu-id="75ee3-137">Shardlets bir parçalama anahtar tarafından tanımlanır ve eşlenen toospecific veritabanlarıdır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-137">Shardlets are identified by a sharding key and are mapped toospecific databases.</span></span> <span data-ttu-id="75ee3-138">Bir uygulama gerekli tüm veritabanı ve yeterli kapasitesi veya geçerli iş gereksinimlerini verilen performans hello shardlets tooprovide dağıtmak olabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-138">An application may have as many databases as needed and distribute hello shardlets tooprovide enough capacity or performance given current business requirements.</span></span> <span data-ttu-id="75ee3-139">Merhaba eşleme parçalama anahtar değerleri toohello veritabanlarının hello esnek veritabanı istemci API tarafından sağlanan bir parça eşleme tarafından depolanır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-139">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello elastic database client APIs.</span></span> <span data-ttu-id="75ee3-140">Bu özellik diyoruz **parça eşleme Yönetim**, veya kısaca SMM.</span><span class="sxs-lookup"><span data-stu-id="75ee3-140">We call this capability **Shard Map Management**, or SMM for short.</span></span> <span data-ttu-id="75ee3-141">Merhaba parça eşleme hello Aracısı parçalama anahtar taşımak istekleri için veritabanı bağlantılarının de görür.</span><span class="sxs-lookup"><span data-stu-id="75ee3-141">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="75ee3-142">Biz toothis özelliği olarak başvuran **veri bağımlı yönlendirme**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-142">We refer toothis capability as **data-dependent routing**.</span></span> 

<span data-ttu-id="75ee3-143">Merhaba parça eşleme Yöneticisi kullanıcıları tutarsız görünümleri eşzamanlı shardlet yönetim işlemlerini (örneğin, bir parça tooanother verileri yeniden konumlandırma) gerçekleştiği yüklendiğinde oluşabilecek shardlet verilerini korur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-143">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations (such as relocating data from one shard tooanother) are happening.</span></span> <span data-ttu-id="75ee3-144">toodo, bu nedenle, parça eşlemeleri hello istemci Kitaplığı Aracısı hello veritabanı bağlantıları için bir uygulama tarafından yönetilen hello.</span><span class="sxs-lookup"><span data-stu-id="75ee3-144">toodo so, hello shard maps managed by hello client library broker hello database connections for an application.</span></span> <span data-ttu-id="75ee3-145">Parça yönetim işlemlerini hello bağlantı için oluşturulan hello shardlet etkileyebilir olduğunda bu bir veritabanı bağlantısı hello parça eşleme işlevselliği tooautomatically KILL izin verir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-145">This allows hello shard map functionality tooautomatically kill a database connection when shard management operations could impact hello shardlet that hello connection has been created for.</span></span> <span data-ttu-id="75ee3-146">Bu yaklaşım, bazı veritabanı varlığı için varolan bir tek toocheck yeni bağlantı oluşturma gibi EF'ın işlevlerini toointegrate gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-146">This approach needs toointegrate with some of EF’s functionality, such as creating new connections from an existing one toocheck for database existence.</span></span> <span data-ttu-id="75ee3-147">Genel olarak, bizim gözlem hello standart DbContext oluşturucular yalnızca güvenilir bir şekilde güvenli bir şekilde kopyalanıp kapalı veritabanı bağlantıları için çalıştığını bırakıldı EF iş için.</span><span class="sxs-lookup"><span data-stu-id="75ee3-147">In general, our observation has been that hello standard DbContext constructors only work reliably for closed database connections that can safely be cloned for EF work.</span></span> <span data-ttu-id="75ee3-148">Merhaba tasarım esnek veritabanı yerine tooonly açılan Aracısı bağlantıları ilkesidir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-148">hello design principle of elastic database instead is tooonly broker opened connections.</span></span> <span data-ttu-id="75ee3-149">Bir hello istemci kitaplığı tarafından EF DbContext toohello teslim etmeden önce aracılı bağlantı kesiliyor bu sorunu çözebilir düşünebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-149">One might think that closing a connection brokered by hello client library before handing it over toohello EF DbContext may solve this issue.</span></span> <span data-ttu-id="75ee3-150">Ancak, hello bağlantı kesiliyor ve EF toore-Aç bağlı olan bir hello kitaplığı tarafından gerçekleştirilen hello doğrulama ve tutarlılık denetimleri sağlamlığın gerisinde kalır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-150">However, by closing hello connection and relying on EF toore-open it, one foregoes hello validation and consistency checks performed by hello library.</span></span> <span data-ttu-id="75ee3-151">EF, Hello geçişler işlevi ancak, bu bağlantıları toomanage hello saydam toohello uygulama şekilde veritabanı şemasını temel kullanır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-151">hello migrations functionality in EF, however, uses these connections toomanage hello underlying database schema in a way that is transparent toohello application.</span></span> <span data-ttu-id="75ee3-152">İdeal olarak, biz gibi tooretain ve tüm bu özelliklere hello esnek veritabanı istemci kitaplığı ve EF hello birleştirmek aynı uygulama.</span><span class="sxs-lookup"><span data-stu-id="75ee3-152">Ideally, we would like tooretain and combine all these capabilities from both hello elastic database client library and EF in hello same application.</span></span> <span data-ttu-id="75ee3-153">Merhaba aşağıdaki bölümde bu özellikleri ve gereksinimleri daha ayrıntılı açıklanmıştır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-153">hello following section discusses these properties and requirements in more detail.</span></span> 

## <a name="requirements"></a><span data-ttu-id="75ee3-154">Gereksinimler</span><span class="sxs-lookup"><span data-stu-id="75ee3-154">Requirements</span></span>
<span data-ttu-id="75ee3-155">Merhaba esnek veritabanı istemci kitaplığı ve Entity Framework API'leri ile çalışırken, aşağıdaki özelliklere tooretain hello istiyoruz:</span><span class="sxs-lookup"><span data-stu-id="75ee3-155">When working with both hello elastic database client library and Entity Framework APIs, we want tooretain hello following properties:</span></span> 

* <span data-ttu-id="75ee3-156">**Genişleme**: hello veri katmanı uygulamasının hello parçalı hello kapasite talebi için gerektikçe hello uygulamasının tooadd veya kaldırma veritabanlarından.</span><span class="sxs-lookup"><span data-stu-id="75ee3-156">**Scale-out**: tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> <span data-ttu-id="75ee3-157">Bu hello hello oluşturulması ve veritabanları ve hello esnek veritabanı parça eşleme manager API'leri toomanage veritabanları ve shardlets eşlemelerini kullanma silinmesini üzerinde denetim anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-157">This means control over hello hello creation and deletion of databases and using hello elastic database shard map manager APIs toomanage databases, and mappings of shardlets.</span></span> 
* <span data-ttu-id="75ee3-158">**Tutarlılık**: Merhaba uygulaması parçalama kullanır ve kullandığı veri bağımlı yönlendirme özellikleri hello istemci kitaplığının hello.</span><span class="sxs-lookup"><span data-stu-id="75ee3-158">**Consistency**: hello application employs sharding, and uses hello data dependent routing capabilities of hello client library.</span></span> <span data-ttu-id="75ee3-159">bağlantıları aracılı tooavoid bozulma veya yanlış sorgu sonuçları, aracılığıyla hello parça eşleme Yöneticisi.</span><span class="sxs-lookup"><span data-stu-id="75ee3-159">tooavoid corruption or wrong query results, connections are brokered through hello shard map manager.</span></span> <span data-ttu-id="75ee3-160">Bu ayrıca doğrulama ve tutarlılık korur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-160">This also retains validation and consistency.</span></span>
* <span data-ttu-id="75ee3-161">**İlk kod**: tooretain hello EF'ın kod ilk kip kolaylığı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-161">**Code First**: tooretain hello convenience of EF’s code first paradigm.</span></span> <span data-ttu-id="75ee3-162">Code First içinde Merhaba uygulaması sınıflarda saydam eşlenen veritabanı yapılarını temel toohello.</span><span class="sxs-lookup"><span data-stu-id="75ee3-162">In Code First, classes in hello application are mapped transparently toohello underlying database structures.</span></span> <span data-ttu-id="75ee3-163">Merhaba uygulama kodu birçok yönüyle veritabanı işleme temel hello söz konusu maske DbSets ile etkileşim kurar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-163">hello application code interacts with DbSets that mask most aspects involved in hello underlying database processing.</span></span>
* <span data-ttu-id="75ee3-164">**Şema**: Entity Framework ilk veritabanı şeması oluşturma ve sonraki şema evrimi geçişleri üzerinden işler.</span><span class="sxs-lookup"><span data-stu-id="75ee3-164">**Schema**: Entity Framework handles initial database schema creation and subsequent schema evolution through migrations.</span></span> <span data-ttu-id="75ee3-165">Bu özellikler koruyarak uygulamanızı uyarlama veri dönüşmesi hello kolaydır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-165">By retaining these capabilities, adapting your app is easy as hello data evolves.</span></span> 

<span data-ttu-id="75ee3-166">Merhaba aşağıdaki kılavuz kaldırmasını nasıl toosatisfy esnek veritabanı araçlarını kullanarak Code First uygulamalar için bu gereksinimleri.</span><span class="sxs-lookup"><span data-stu-id="75ee3-166">hello following guidance instructs how toosatisfy these requirements for Code First applications using elastic database tools.</span></span> 

## <a name="data-dependent-routing-using-ef-dbcontext"></a><span data-ttu-id="75ee3-167">Veri bağımlı yönlendirme EF DbContext kullanma</span><span class="sxs-lookup"><span data-stu-id="75ee3-167">Data dependent routing using EF DbContext</span></span>
<span data-ttu-id="75ee3-168">Entity Framework veritabanı bağlantılarıyla genellikle alt sınıflarının yönetilen **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-168">Database connections with Entity Framework are typically managed through subclasses of **DbContext**.</span></span> <span data-ttu-id="75ee3-169">Bu alt sınıflarından türetme tarafından oluşturma **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-169">Create these subclasses by deriving from **DbContext**.</span></span> <span data-ttu-id="75ee3-170">Burada, tanımlarsınız, **DbSets** uygulamanız için CLR nesnesi hello veritabanı yedeği koleksiyonları uygulayın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-170">This is where you define your **DbSets** that implement hello database-backed collections of CLR objects for your application.</span></span> <span data-ttu-id="75ee3-171">Veri bağımlı yönlendirme hello bağlamında, biz diğer EF kodu ilk uygulama senaryoları için mutlaka tutmayın çeşitli yararlı özelliklerini tanımlayabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="75ee3-171">In hello context of data dependent routing, we can identify several helpful properties that do not necessarily hold for other EF code first application scenarios:</span></span> 

* <span data-ttu-id="75ee3-172">Merhaba veritabanı zaten var ve hello esnek veritabanı parça eşlemesinde kaydedildi.</span><span class="sxs-lookup"><span data-stu-id="75ee3-172">hello database already exists and has been registered in hello elastic database shard map.</span></span> 
* <span data-ttu-id="75ee3-173">Merhaba uygulaması Hello şeması (aşağıda açıklanmıştır) dağıtılan toohello veritabanı zaten etkinleştirilmiş.</span><span class="sxs-lookup"><span data-stu-id="75ee3-173">hello schema of hello application has already been deployed toohello database (explained below).</span></span> 
* <span data-ttu-id="75ee3-174">Veri bağımlı yönlendirme bağlantıları toohello veritabanı hello parça eşleme tarafından aracılı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-174">Data-dependent routing connections toohello database are brokered by hello shard map.</span></span> 

<span data-ttu-id="75ee3-175">toointegrate **DbContexts** veri bağımlı genişleme için Yönlendirme:</span><span class="sxs-lookup"><span data-stu-id="75ee3-175">toointegrate **DbContexts** with data-dependent routing for scale-out:</span></span>

1. <span data-ttu-id="75ee3-176">Merhaba parça eşleme Yöneticisi'nin hello esnek veritabanı istemci arabirimleri aracılığıyla fiziksel veritabanı bağlantıları oluşturma,</span><span class="sxs-lookup"><span data-stu-id="75ee3-176">Create physical database connections through hello elastic database client interfaces of hello shard map manager,</span></span> 
2. <span data-ttu-id="75ee3-177">Merhaba Hello bağlantıyla kaydırma **DbContext** alt sınıfı</span><span class="sxs-lookup"><span data-stu-id="75ee3-177">Wrap hello connection with hello **DbContext** subclass</span></span>
3. <span data-ttu-id="75ee3-178">Merhaba bağlantı hello geçirmek **DbContext** temel sınıfları tooensure tüm hello işleme hello EF tarafında gerçekleşir de.</span><span class="sxs-lookup"><span data-stu-id="75ee3-178">Pass hello connection down into hello **DbContext** base classes tooensure all hello processing on hello EF side happens as well.</span></span> 

<span data-ttu-id="75ee3-179">Aşağıdaki kod örneğine hello bu yaklaşımı açıklar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-179">hello following code example illustrates this approach.</span></span> <span data-ttu-id="75ee3-180">(Bu da Visual Studio projesi eşlik hello kodudur)</span><span class="sxs-lookup"><span data-stu-id="75ee3-180">(This code is also in hello accompanying Visual Studio project)</span></span>

    public class ElasticScaleContext<T> : DbContext
    {
    public DbSet<Blog> Blogs { get; set; }
    …

        // C'tor for data dependent routing. This call will open a validated connection 
        // routed toohello proper shard by hello shard map manager. 
        // Note that hello base class c'tor call will fail for an open connection
        // if migrations need toobe done and SQL credentials are used. This is hello reason for hello 
        // separation of c'tors into hello data-dependent routing case (this c'tor) and hello internal c'tor for new shards.
        public ElasticScaleContext(ShardMap shardMap, T shardingKey, string connectionStr)
            : base(CreateDDRConnection(shardMap, shardingKey, connectionStr), 
            true /* contextOwnsConnection */)
        {
        }

        // Only static methods are allowed in calls into base class c'tors.
        private static DbConnection CreateDDRConnection(
        ShardMap shardMap, 
        T shardingKey, 
        string connectionStr)
        {
            // No initialization
            Database.SetInitializer<ElasticScaleContext<T>>(null);

            // Ask shard map toobroker a validated connection for hello given key
            SqlConnection conn = shardMap.OpenConnectionForKey<T>
                                (shardingKey, connectionStr, ConnectionOptions.Validate);
            return conn;
        }    

## <a name="main-points"></a><span data-ttu-id="75ee3-181">Ana noktaları</span><span class="sxs-lookup"><span data-stu-id="75ee3-181">Main points</span></span>
* <span data-ttu-id="75ee3-182">Yeni bir oluşturucu hello varsayılan oluşturucu hello DbContext alt sınıfta değiştirir</span><span class="sxs-lookup"><span data-stu-id="75ee3-182">A new constructor replaces hello default constructor in hello DbContext subclass</span></span> 
* <span data-ttu-id="75ee3-183">Merhaba yeni Oluşturucusu veri bağımlı esnek veritabanı istemci kitaplığı yönlendirme için gerekli olan hello bağımsız değişkenleri alır:</span><span class="sxs-lookup"><span data-stu-id="75ee3-183">hello new constructor takes hello arguments that are required for data dependent routing through elastic database client library:</span></span>
  
  * <span data-ttu-id="75ee3-184">veri bağımlı yönlendirme arabirimlerini Hello parça eşleme tooaccess hello</span><span class="sxs-lookup"><span data-stu-id="75ee3-184">hello shard map tooaccess hello data-dependent routing interfaces,</span></span>
  * <span data-ttu-id="75ee3-185">Merhaba parçalama anahtar tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="75ee3-185">hello sharding key tooidentify hello shardlet,</span></span>
  * <span data-ttu-id="75ee3-186">Merhaba veri bağımlı yönlendirme bağlantısı toohello parça hello kimlik bilgileri ile bir bağlantı dizesi.</span><span class="sxs-lookup"><span data-stu-id="75ee3-186">a connection string with hello credentials for hello data-dependent routing connection toohello shard.</span></span> 
* <span data-ttu-id="75ee3-187">Merhaba çağrısı toohello temel sınıf oluşturucu tüm hello adımları gerçekleştirir statik bir yönteme bir detour veri bağımlı yönlendirme için gerekli alır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-187">hello call toohello base class constructor takes a detour into a static method that performs all hello steps necessary for data-dependent routing.</span></span> 
  
  * <span data-ttu-id="75ee3-188">Merhaba parça eşleme tooestablish açık bir bağlantı hello OpenConnectionForKey çağrısı hello esnek veritabanı istemci arabirimlerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-188">It uses hello OpenConnectionForKey call of hello elastic database client interfaces on hello shard map tooestablish an open connection.</span></span>
  * <span data-ttu-id="75ee3-189">Merhaba parça eşlemesi parçalama anahtarı verilen hello hello shardlet tutan hello açık bağlantı toohello parça oluşturur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-189">hello shard map creates hello open connection toohello shard that holds hello shardlet for hello given sharding key.</span></span>
  * <span data-ttu-id="75ee3-190">Bu açık bağlantı geri toohello temel sınıf bu bağlantının otomatik olarak yeni bir bağlantı oluşturmak EF yapmasına izin vermek yerine EF tarafından kullanılan toobe olduğunu DbContext tooindicate oluşturucusunun geçirilir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-190">This open connection is passed back toohello base class constructor of DbContext tooindicate that this connection is toobe used by EF instead of letting EF create a new connection automatically.</span></span> <span data-ttu-id="75ee3-191">Böylece parça eşleme yönetim işlemleri altında tutarlılığı garanti edebilir bu şekilde hello bağlantı hello esnek veritabanı istemci API tarafından etiketlendiği.</span><span class="sxs-lookup"><span data-stu-id="75ee3-191">This way hello connection has been tagged by hello elastic database client API so that it can guarantee consistency under shard map management operations.</span></span>

<span data-ttu-id="75ee3-192">Merhaba varsayılan oluşturucu, kodunuzda yerine, bir DbContext alt için Hello yeni Oluşturucu kullanın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-192">Use hello new constructor for your DbContext subclass instead of hello default constructor in your code.</span></span> <span data-ttu-id="75ee3-193">Örnek aşağıda verilmiştir:</span><span class="sxs-lookup"><span data-stu-id="75ee3-193">Here is an example:</span></span> 

    // Create and save a new blog.

    Console.Write("Enter a name for a new blog: "); 
    var name = Console.ReadLine(); 

    using (var db = new ElasticScaleContext<int>( 
                            sharding.ShardMap,  
                            tenantId1,  
                            connStrBldr.ConnectionString)) 
    { 
        var blog = new Blog { Name = name }; 
        db.Blogs.Add(blog); 
        db.SaveChanges(); 

        // Display all Blogs for tenant 1 
        var query = from b in db.Blogs 
                    orderby b.Name 
                    select b; 
     … 
    }

<span data-ttu-id="75ee3-194">Merhaba yeni Oluşturucusu açar hello değeri tarafından tanımlanan hello shardlet hello verilerini tutan hello bağlantı toohello parça **tenantid1**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-194">hello new constructor opens hello connection toohello shard that holds hello data for hello shardlet identified by hello value of **tenantid1**.</span></span> <span data-ttu-id="75ee3-195">Merhaba hello kodda **kullanarak** blok kalır değişmeden tooaccess hello **DbSet** EF hello parça kullanarak Web günlükleri için **tenantid1**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-195">hello code in hello **using** block stays unchanged tooaccess hello **DbSet** for blogs using EF on hello shard for **tenantid1**.</span></span> <span data-ttu-id="75ee3-196">Tüm veritabanı işlemleri sunulmuştur gibi blok kullanarak hello Hello kodda toohello bir parça kapsamlı için bu semantiğini değiştirir nerede **tenantid1** tutulur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-196">This changes semantics for hello code in hello using block such that all database operations are now scoped toohello one shard where **tenantid1** is kept.</span></span> <span data-ttu-id="75ee3-197">Örneğin, bir LINQ sorgusu hello bloglar üzerinden **DbSet** yalnızca hello geçerli parça üzerinde depolanan bloglar dönün, ancak olanları diğer parça üzerinde depolanan hello değil.</span><span class="sxs-lookup"><span data-stu-id="75ee3-197">For instance, a LINQ query over hello blogs **DbSet** would only return blogs stored on hello current shard, but not hello ones stored on other shards.</span></span>  

#### <a name="transient-faults-handling"></a><span data-ttu-id="75ee3-198">Geçici hataları işleme</span><span class="sxs-lookup"><span data-stu-id="75ee3-198">Transient faults handling</span></span>
<span data-ttu-id="75ee3-199">Merhaba Microsoft Patterns & yöntemler yayımlanan hello ekip [hello geçici hata işleme uygulama blok](https://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="75ee3-199">hello Microsoft Patterns & Practices team published hello [hello Transient Fault Handling Application Block](https://msdn.microsoft.com/library/dn440719.aspx).</span></span> <span data-ttu-id="75ee3-200">Merhaba kitaplığı esnek ölçek istemci kitaplığı EF ile birlikte kullanılır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-200">hello library is used with elastic scale client library in combination with EF.</span></span> <span data-ttu-id="75ee3-201">Ancak, geçici bir özel durumla burada biz böylece biz tweaked hello oluşturucuları kullanarak herhangi bir yeni bağlantı denemesi yapıldıktan sonra geçici bir hata bu hello yeni oluşturucusunun kullanıldığından emin olabilirsiniz tooa yer döndürdüğünden emin olun.</span><span class="sxs-lookup"><span data-stu-id="75ee3-201">However, ensure that any transient exception returns tooa place where we can ensure that hello new constructor is being used after a transient fault so that any new connection attempt is made using hello constructors we have tweaked.</span></span> <span data-ttu-id="75ee3-202">Aksi takdirde, parça garanti edilmez ve hello bağlantı hiçbir garanti vermediğini olan doğru bir bağlantı toohello toohello parça eşleme oluşacak değişiklikler korunur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-202">Otherwise, a connection toohello correct shard is not guaranteed, and there are no assurances hello connection is maintained as changes toohello shard map occur.</span></span> 

<span data-ttu-id="75ee3-203">Merhaba aşağıdaki kod örneği nasıl bir SQL yeniden deneme ilkesi hello yeni kullanılabileceğini gösterir **DbContext** alt sınıf oluşturucular:</span><span class="sxs-lookup"><span data-stu-id="75ee3-203">hello following code sample illustrates how a SQL retry policy can be used around hello new **DbContext** subclass constructors:</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() => 
    { 
        using (var db = new ElasticScaleContext<int>( 
                                sharding.ShardMap,  
                                tenantId1,  
                                connStrBldr.ConnectionString)) 
            { 
                    var blog = new Blog { Name = name }; 
                    db.Blogs.Add(blog); 
                    db.SaveChanges(); 
            … 
            } 
        }); 

<span data-ttu-id="75ee3-204">**SqlDatabaseUtils.SqlRetryPolicy** hello Yukarıdaki kod olarak tanımlanan bir **SqlDatabaseTransientErrorDetectionStrategy** bir yeniden deneme sayısı 10 ve 5 saniye ile yeniden denemeler arasındaki süre bekleyin.</span><span class="sxs-lookup"><span data-stu-id="75ee3-204">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="75ee3-205">Bu yaklaşım EF ve kullanıcı tarafından başlatılan işlemleri için benzer toohello kılavuzunu olur (bkz [yeniden deneniyor yürütme stratejileri (veya sonraki sürümleri EF6) kısıtlamalarla](http://msdn.microsoft.com/data/dn307226).</span><span class="sxs-lookup"><span data-stu-id="75ee3-205">This approach is similar toohello guidance for EF and user-initiated transactions (see [Limitations with Retrying Execution Strategies (EF6 onwards)](http://msdn.microsoft.com/data/dn307226).</span></span> <span data-ttu-id="75ee3-206">Her iki durumlarda bu hello uygulama programı denetimleri hello kapsam toowhich hello geçici özel durum döndürür gerektirir: tooeither hello işlem yeniden veya (gösterildiği gibi) kullanımları esnek veritabanı hello hello uygun Oluşturucusu hello bağlamından yeniden İstemci Kitaplığı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-206">Both situations require that hello application program controls hello scope toowhich hello transient exception returns: tooeither reopen hello transaction, or (as shown) recreate hello context from hello proper constructor that uses hello elastic database client library.</span></span>

<span data-ttu-id="75ee3-207">Merhaba burada geçici özel durumlar ele bize geri kapsamda gerek toocontrol de hello yerleşik hello kullanımını önleyen **SqlAzureExecutionStrategy** EF ile birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-207">hello need toocontrol where transient exceptions take us back in scope also precludes hello use of hello built-in **SqlAzureExecutionStrategy** that comes with EF.</span></span> <span data-ttu-id="75ee3-208">**SqlAzureExecutionStrategy** bir bağlantıyı yeniden, ancak kullanmaz **OpenConnectionForKey** ve bu nedenle hello bir parçası olarak gerçekleştirilen tüm hello Doğrulamayı atla **OpenConnectionForKey** çağırın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-208">**SqlAzureExecutionStrategy** would reopen a connection but not use **OpenConnectionForKey** and therefore bypass all hello validation that is performed as part of hello **OpenConnectionForKey** call.</span></span> <span data-ttu-id="75ee3-209">Bunun yerine, hello yerleşik hello kod örneği kullanan **DefaultExecutionStrategy** EF ile de gelir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-209">Instead, hello code sample uses hello built-in **DefaultExecutionStrategy** that also comes with EF.</span></span> <span data-ttu-id="75ee3-210">Çok aygıtlardır**SqlAzureExecutionStrategy**, doğru geçici hata işleme hello yeniden deneme ilkesi ile birlikte çalışır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-210">As opposed too**SqlAzureExecutionStrategy**, it works correctly in combination with hello retry policy from Transient Fault Handling.</span></span> <span data-ttu-id="75ee3-211">Merhaba yürütme İlkesi hello ayarlanmış **ElasticScaleDbConfiguration** sınıfı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-211">hello execution policy is set in hello **ElasticScaleDbConfiguration** class.</span></span> <span data-ttu-id="75ee3-212">Biz değil toouse karar Not **DefaultSqlExecutionStrategy** toouse öneren beri **SqlAzureExecutionStrategy** geçici özel durumlar oluşursa - hangi neden toowrong davranışı açıklandığı gibi.</span><span class="sxs-lookup"><span data-stu-id="75ee3-212">Note that we decided not toouse **DefaultSqlExecutionStrategy** since it suggests toouse **SqlAzureExecutionStrategy** if transient exceptions occur - which would lead toowrong behavior as discussed.</span></span> <span data-ttu-id="75ee3-213">Merhaba farklı yeniden deneme ilkelerini ve EF ile ilgili daha fazla bilgi için bkz: [EF bağlantı dayanıklılığı](http://msdn.microsoft.com/data/dn456835.aspx).</span><span class="sxs-lookup"><span data-stu-id="75ee3-213">For more information on hello different retry policies and EF, see [Connection Resiliency in EF](http://msdn.microsoft.com/data/dn456835.aspx).</span></span>     

#### <a name="constructor-rewrites"></a><span data-ttu-id="75ee3-214">Oluşturucu yeniden yazmalar</span><span class="sxs-lookup"><span data-stu-id="75ee3-214">Constructor rewrites</span></span>
<span data-ttu-id="75ee3-215">Merhaba Yukarıdaki kod örnekleri göstermeye hello varsayılan sipariş toouse veri hello Entity Framework ile yönlendirme bağımlı, uygulamanız için gerekli Oluşturucusu yeniden yazar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-215">hello code examples above illustrate hello default constructor re-writes required for your application in order toouse  data dependent routing with hello Entity Framework.</span></span> <span data-ttu-id="75ee3-216">Aşağıdaki tablonun hello bu yaklaşım tooother oluşturucular genelleştirir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-216">hello following table generalizes this approach tooother constructors.</span></span> 

| <span data-ttu-id="75ee3-217">Geçerli Oluşturucusu</span><span class="sxs-lookup"><span data-stu-id="75ee3-217">Current Constructor</span></span> | <span data-ttu-id="75ee3-218">Verileri yeniden Oluşturucusu</span><span class="sxs-lookup"><span data-stu-id="75ee3-218">Rewritten Constructor for data</span></span> | <span data-ttu-id="75ee3-219">Temel Oluşturucusu</span><span class="sxs-lookup"><span data-stu-id="75ee3-219">Base Constructor</span></span> | <span data-ttu-id="75ee3-220">Notlar</span><span class="sxs-lookup"><span data-stu-id="75ee3-220">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="75ee3-221">MyContext()</span><span class="sxs-lookup"><span data-stu-id="75ee3-221">MyContext()</span></span> |<span data-ttu-id="75ee3-222">ElasticScaleContext (ShardMap, TKey)</span><span class="sxs-lookup"><span data-stu-id="75ee3-222">ElasticScaleContext(ShardMap, TKey)</span></span> |<span data-ttu-id="75ee3-223">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-223">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="75ee3-224">Merhaba bağlantı toobe işlevi hello parça eşleme ve hello veri bağımlı yönlendirme anahtarı gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="75ee3-224">hello connection needs toobe a function of hello shard map and hello data-dependent routing key.</span></span> <span data-ttu-id="75ee3-225">Bunun yerine hello parça eşleme toobroker hello bağlantı kullanın ve EF tooby geçişi otomatik bağlantı oluşturması gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-225">You need tooby-pass automatic connection creation by EF and instead use hello shard map toobroker hello connection.</span></span> |
| <span data-ttu-id="75ee3-226">MyContext(string)</span><span class="sxs-lookup"><span data-stu-id="75ee3-226">MyContext(string)</span></span> |<span data-ttu-id="75ee3-227">ElasticScaleContext (ShardMap, TKey)</span><span class="sxs-lookup"><span data-stu-id="75ee3-227">ElasticScaleContext(ShardMap, TKey)</span></span> |<span data-ttu-id="75ee3-228">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-228">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="75ee3-229">Merhaba bağlantı hello parça eşleme ve hello veri bağımlı yönlendirme anahtarı bir işlevdir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-229">hello connection is a function of hello shard map and hello data-dependent routing key.</span></span> <span data-ttu-id="75ee3-230">Sabit veritabanı adı veya bağlantı dizesi çalışmazlar hello parça eşleme tarafından atlama doğrulama.</span><span class="sxs-lookup"><span data-stu-id="75ee3-230">A fixed database name or connection string will not work as they by-pass validation by hello shard map.</span></span> |
| <span data-ttu-id="75ee3-231">MyContext(DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="75ee3-231">MyContext(DbCompiledModel)</span></span> |<span data-ttu-id="75ee3-232">ElasticScaleContext (ShardMap, TKey, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="75ee3-232">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</span></span> |<span data-ttu-id="75ee3-233">DbContext (DbConnection, DbCompiledModel, Boole)</span><span class="sxs-lookup"><span data-stu-id="75ee3-233">DbContext(DbConnection, DbCompiledModel, bool)</span></span> |<span data-ttu-id="75ee3-234">Merhaba bağlantısı için sağlanan hello modeliyle parça eşleme ve parçalama anahtarı verilen hello oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-234">hello connection will get created for hello given shard map and sharding key with hello model provided.</span></span> <span data-ttu-id="75ee3-235">Merhaba derlenmiş model üzerinde temel c'tor toohello geçirilir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-235">hello compiled model will be passed on toohello base c’tor.</span></span> |
| <span data-ttu-id="75ee3-236">MyContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-236">MyContext(DbConnection, bool)</span></span> |<span data-ttu-id="75ee3-237">ElasticScaleContext (ShardMap, TKey, Boole)</span><span class="sxs-lookup"><span data-stu-id="75ee3-237">ElasticScaleContext(ShardMap, TKey, bool)</span></span> |<span data-ttu-id="75ee3-238">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-238">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="75ee3-239">Merhaba bağlantı hello parça eşleme ve başlangıç anahtarı çıkarımı yapılan toobe gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-239">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="75ee3-240">(Bu girişi zaten hello parça eşleme ve başlangıç anahtarı kullanmadığı sürece) bir giriş olarak sağlanamaz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-240">It cannot be provided as an input (unless that input was already using hello shard map and hello key).</span></span> <span data-ttu-id="75ee3-241">Merhaba Boolean geçirilir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-241">hello Boolean will be passed on.</span></span> |
| <span data-ttu-id="75ee3-242">MyContext (dize, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="75ee3-242">MyContext(string, DbCompiledModel)</span></span> |<span data-ttu-id="75ee3-243">ElasticScaleContext (ShardMap, TKey, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="75ee3-243">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</span></span> |<span data-ttu-id="75ee3-244">DbContext (DbConnection, DbCompiledModel, Boole)</span><span class="sxs-lookup"><span data-stu-id="75ee3-244">DbContext(DbConnection, DbCompiledModel, bool)</span></span> |<span data-ttu-id="75ee3-245">Merhaba bağlantı hello parça eşleme ve başlangıç anahtarı çıkarımı yapılan toobe gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-245">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="75ee3-246">(Bu giriş hello parça eşleme ve başlangıç anahtarı kullanmadığı sürece) bir giriş olarak sağlanamaz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-246">It cannot be provided as an input (unless that input was using hello shard map and hello key).</span></span> <span data-ttu-id="75ee3-247">Merhaba derlenmiş modeli geçirilir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-247">hello compiled model will be passed on.</span></span> |
| <span data-ttu-id="75ee3-248">MyContext (ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-248">MyContext(ObjectContext, bool)</span></span> |<span data-ttu-id="75ee3-249">ElasticScaleContext (ShardMap, TKey, ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-249">ElasticScaleContext(ShardMap, TKey, ObjectContext, bool)</span></span> |<span data-ttu-id="75ee3-250">DbContext (ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-250">DbContext(ObjectContext, bool)</span></span> |<span data-ttu-id="75ee3-251">Merhaba yeni Oluşturucusu herhangi bir giriş olarak ObjectContext geçirilen hello bağlantısında esnek ölçek tarafından yönetilen yeniden yönlendirilmiş tooa bağlantıdır tooensure gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-251">hello new constructor needs tooensure that any connection in hello ObjectContext passed as an input is re-routed tooa connection managed by Elastic Scale.</span></span> <span data-ttu-id="75ee3-252">ObjectContexts hakkında ayrıntılı bilgi hello bu belgenin kapsamında değildir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-252">A detailed discussion of ObjectContexts is beyond hello scope of this document.</span></span> |
| <span data-ttu-id="75ee3-253">MyContext (DbConnection, DbCompiledModel, Boole)</span><span class="sxs-lookup"><span data-stu-id="75ee3-253">MyContext(DbConnection, DbCompiledModel,bool)</span></span> |<span data-ttu-id="75ee3-254">ElasticScaleContext (ShardMap, TKey, DbCompiledModel, bool)</span><span class="sxs-lookup"><span data-stu-id="75ee3-254">ElasticScaleContext(ShardMap, TKey, DbCompiledModel, bool)</span></span> |<span data-ttu-id="75ee3-255">DbContext (DbConnection, DbCompiledModel, bool);</span><span class="sxs-lookup"><span data-stu-id="75ee3-255">DbContext(DbConnection, DbCompiledModel, bool);</span></span> |<span data-ttu-id="75ee3-256">Merhaba bağlantı hello parça eşleme ve başlangıç anahtarı çıkarımı yapılan toobe gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-256">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="75ee3-257">(Bu girişi zaten hello parça eşleme ve başlangıç anahtarı kullanmadığı sürece) bir giriş olarak hello bağlantı sağlanamaz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-257">hello connection cannot be provided as an input (unless that input was already using hello shard map and hello key).</span></span> <span data-ttu-id="75ee3-258">Model ve Boolean toohello temel sınıf oluşturucu geçirilir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-258">Model and Boolean are passed on toohello base class constructor.</span></span> |

## <a name="shard-schema-deployment-through-ef-migrations"></a><span data-ttu-id="75ee3-259">EF geçişler aracılığıyla parça şema dağıtımı</span><span class="sxs-lookup"><span data-stu-id="75ee3-259">Shard schema deployment through EF migrations</span></span>
<span data-ttu-id="75ee3-260">Otomatik şema, hello Entity Framework tarafından sağlanan bir kolaylık yönetimidir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-260">Automatic schema management is a convenience provided by hello Entity Framework.</span></span> <span data-ttu-id="75ee3-261">Veritabanlarını toohello parçalı uygulama eklendiğinde esnek veritabanı araçlarını kullanarak uygulamaları hello bağlamda tooretain Bu yetenek tooautomatically sağlama hello şema oluşturulan toonewly parça istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-261">In hello context of applications using elastic database tools, we want tooretain this capability tooautomatically provision hello schema toonewly created shards when databases are added toohello sharded application.</span></span> <span data-ttu-id="75ee3-262">Merhaba birincil kullanım hello veri katmanı tooincrease kapasitede EF kullanan parçalı uygulamalar için bir durumdur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-262">hello primary use case is tooincrease capacity at hello data tier for sharded applications using EF.</span></span> <span data-ttu-id="75ee3-263">Şema Yönetimi için EF'in özellikleri güvenmek EF üzerinde oluşturulmuş parçalı bir uygulama ile Merhaba veritabanı yönetim çaba azaltır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-263">Relying on EF’s capabilities for schema management reduces hello database administration effort with a sharded application built on EF.</span></span> 

<span data-ttu-id="75ee3-264">Şema dağıtımı EF geçişler aracılığıyla en iyi şekilde çalışır **açılmamış bağlantıları**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-264">Schema deployment through EF migrations works best on **unopened connections**.</span></span> <span data-ttu-id="75ee3-265">Buna karşılık hello esnek veritabanı istemci API'si tarafından sağlanan açılan hello bağlantı dayanan veri bağımlı yönlendirme için toohello senaryo budur.</span><span class="sxs-lookup"><span data-stu-id="75ee3-265">This is in contrast toohello scenario for data dependent routing that relies on hello opened connection provided by hello elastic database client API.</span></span> <span data-ttu-id="75ee3-266">Başka bir fark hello tutarlılık gereksinimdir: tüm veri bağımlı yönlendirme bağlantıları tooprotect karşı eş zamanlı parça eşleme işleme sırasında tutarlılık arzu tooensure, bu ilk şema dağıtım tooa yeni veritabanı ile ilgili bir sorun değildir Merhaba parça eşlemesinde kayıtlı değil henüz ve toohold shardlets ayrılmamış henüz sahip.</span><span class="sxs-lookup"><span data-stu-id="75ee3-266">Another difference is hello consistency requirement: While desirable tooensure consistency for all data-dependent routing connections tooprotect against concurrent shard map manipulation, it is not a concern with initial schema deployment tooa new database that has not yet been registered in hello shard map, and not yet been allocated toohold shardlets.</span></span> <span data-ttu-id="75ee3-267">Biz, bu nedenle normal veritabanı bağlantısı karşılıklı yönlendirme toodata bağlı olarak bu senaryoları için güvenebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-267">We can therefore rely on regular database connections for this scenarios, as opposed toodata-dependent routing.</span></span>  

<span data-ttu-id="75ee3-268">Bu, tooan yaklaşım nerede EF geçişler aracılığıyla şema dağıtımın sıkı şekilde hello yeni veritabanının hello kaydı hello uygulamanın parça eşlemesindeki bir parça olarak bağlı yol açar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-268">This leads tooan approach where schema deployment through EF migrations is tightly coupled with hello registration of hello new database as a shard in hello application’s shard map.</span></span> <span data-ttu-id="75ee3-269">Bu Önkoşullar aşağıdaki hello üzerinde dayanır:</span><span class="sxs-lookup"><span data-stu-id="75ee3-269">This relies on hello following prerequisites:</span></span> 

* <span data-ttu-id="75ee3-270">Merhaba veritabanı zaten oluşturuldu.</span><span class="sxs-lookup"><span data-stu-id="75ee3-270">hello database has already been created.</span></span> 
* <span data-ttu-id="75ee3-271">Merhaba veritabanı boş - kullanıcı şeması yok ve hiçbir kullanıcı verileri tutar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-271">hello database is empty - it holds no user schema and no user data.</span></span>
* <span data-ttu-id="75ee3-272">Merhaba veritabanı henüz veri bağımlı yönlendirme için hello esnek veritabanı istemci API erişilemiyor.</span><span class="sxs-lookup"><span data-stu-id="75ee3-272">hello database cannot yet be accessed through hello elastic database client APIs for data-dependent routing.</span></span> 

<span data-ttu-id="75ee3-273">Bu önkoşulları yerine getirilince, bir normal oluşturabilir açılmamış **SqlConnection** tookick EF geçişler şema dağıtımı için devre dışı.</span><span class="sxs-lookup"><span data-stu-id="75ee3-273">With these prerequisites in place, we can create a regular un-opened **SqlConnection** tookick off EF migrations for schema deployment.</span></span> <span data-ttu-id="75ee3-274">Aşağıdaki kod örneği hello bu yaklaşım gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-274">hello following code sample illustrates this approach.</span></span> 

        // Enter a new shard - i.e. an empty database - toohello shard map, allocate a first tenant tooit  
        // and kick off EF intialization of hello database toodeploy schema 

        public void RegisterNewShard(string server, string database, string connStr, int key) 
        { 

            Shard shard = this.ShardMap.CreateShard(new ShardLocation(server, database)); 

            SqlConnectionStringBuilder connStrBldr = new SqlConnectionStringBuilder(connStr); 
            connStrBldr.DataSource = server; 
            connStrBldr.InitialCatalog = database; 

            // Go into a DbContext tootrigger migrations and schema deployment for hello new shard. 
            // This requires an un-opened connection. 
            using (var db = new ElasticScaleContext<int>(connStrBldr.ConnectionString)) 
            { 
                // Run a query tooengage EF migrations 
                (from b in db.Blogs 
                    select b).Count(); 
            } 

            // Register hello mapping of hello tenant toohello shard in hello shard map. 
            // After this step, data-dependent routing on hello shard map can be used 

            this.ShardMap.CreatePointMapping(key, shard); 
        } 


<span data-ttu-id="75ee3-275">Bu örnek hello yöntemi gösterilir **RegisterNewShard** yazmaçlar hello parça eşlemesindeki parça hello hello şema EF geçişler aracılığıyla dağıtır ve parçalama anahtar toohello parça eşlemesi depolar.</span><span class="sxs-lookup"><span data-stu-id="75ee3-275">This sample shows hello method **RegisterNewShard** that registers hello shard in hello shard map, deploys hello schema through EF migrations, and stores a mapping of a sharding key toohello shard.</span></span> <span data-ttu-id="75ee3-276">Merhaba, bir oluşturucusuna dayanır **DbContext** alt (**ElasticScaleContext** hello örnekteki), bir SQL bağlantı dizesi giriş olarak alır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-276">It relies on a constructor of hello **DbContext** subclass (**ElasticScaleContext** in hello sample) that takes a SQL connection string as input.</span></span> <span data-ttu-id="75ee3-277">Bu oluşturucu Hello kodunu düz iletme örnekte gösterildiği aşağıdaki hello, şöyledir:</span><span class="sxs-lookup"><span data-stu-id="75ee3-277">hello code of this constructor is straight-forward, as hello following example shows:</span></span> 

        // C'tor toodeploy schema and migrations tooa new shard 
        protected internal ElasticScaleContext(string connectionString) 
            : base(SetInitializerForConnection(connectionString)) 
        { 
        } 

        // Only static methods are allowed in calls into base class c'tors 
        private static string SetInitializerForConnection(string connnectionString) 
        { 
            // We want existence checks so that hello schema can get deployed 
            Database.SetInitializer<ElasticScaleContext<T>>( 
        new CreateDatabaseIfNotExists<ElasticScaleContext<T>>()); 

            return connnectionString; 
        } 

<span data-ttu-id="75ee3-278">Bir hello taban sınıfından devralınan hello Oluşturucusu hello sürümünü kullanmış olabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-278">One might have used hello version of hello constructor inherited from hello base class.</span></span> <span data-ttu-id="75ee3-279">Ancak EF varsayılan Başlatıcısı hello hello Kod gereksinimlerini tooensure bağlanırken kullanılır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-279">But hello code needs tooensure that hello default initializer for EF is used when connecting.</span></span> <span data-ttu-id="75ee3-280">Bu nedenle hello statik yöntemiyle hello temel sınıf oluşturucu hello bağlantı dizesiyle içine çağırmadan önce kısa detour hello.</span><span class="sxs-lookup"><span data-stu-id="75ee3-280">Hence hello short detour into hello static method before calling into hello base class constructor with hello connection string.</span></span> <span data-ttu-id="75ee3-281">Parça Hello kaydı EF hello Başlatıcı ayarlarını değil çakışan bir farklı uygulama etki alanı ya da işlem tooensure içinde çalışması gerektiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="75ee3-281">Note that hello registration of shards should run in a different app domain or process tooensure that hello initializer settings for EF do not conflict.</span></span> 

## <a name="limitations"></a><span data-ttu-id="75ee3-282">Sınırlamalar</span><span class="sxs-lookup"><span data-stu-id="75ee3-282">Limitations</span></span>
<span data-ttu-id="75ee3-283">Bu belgede özetlenen hello yaklaşımlar birkaç sınırlama oluşturulmasını gerektirir:</span><span class="sxs-lookup"><span data-stu-id="75ee3-283">hello approaches outlined in this document entail a couple of limitations:</span></span> 

* <span data-ttu-id="75ee3-284">Kullanan EF uygulamaları **LocalDb** ilk gereksinim toomigrate tooa normal SQL Server veritabanının esnek veritabanı istemci kitaplığı kullanmadan önce.</span><span class="sxs-lookup"><span data-stu-id="75ee3-284">EF applications that use **LocalDb** first need toomigrate tooa regular SQL Server database before using elastic database client library.</span></span> <span data-ttu-id="75ee3-285">Esnek ölçeklendirme ile parçalama aracılığıyla bir uygulama ölçeğini mümkün değil **LocalDb**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-285">Scaling out an application through sharding with Elastic Scale is not possible with **LocalDb**.</span></span> <span data-ttu-id="75ee3-286">Geliştirme hala kullanabileceğinizi unutmayın **LocalDb**.</span><span class="sxs-lookup"><span data-stu-id="75ee3-286">Note that development can still use **LocalDb**.</span></span> 
* <span data-ttu-id="75ee3-287">Veritabanı şema değişiklikleri kapsıyor herhangi bir değişiklik toohello uygulama tüm parça EF geçişleri üzerinden toogo gerekir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-287">Any changes toohello application that imply database schema changes need toogo through EF migrations on all shards.</span></span> <span data-ttu-id="75ee3-288">Bu belge için örnek kod Hello göstermek değil nasıl toodo bu.</span><span class="sxs-lookup"><span data-stu-id="75ee3-288">hello sample code for this document does not demonstrate how toodo this.</span></span> <span data-ttu-id="75ee3-289">Update-Database tüm parça ConnectionString parametresi tooiterate ile kullanmayı düşünün; veya hello - komut dosyası seçeneği ve hello T-SQL komut dosyası tooyour parça uygulamak extract hello T-SQL komut dosyası için Update-Database kullanarak geçiş bekleyen hello.</span><span class="sxs-lookup"><span data-stu-id="75ee3-289">Consider using Update-Database with a ConnectionString parameter tooiterate over all shards; or extract hello T-SQL script for hello pending migration using Update-Database with hello -Script option and apply hello T-SQL script tooyour shards.</span></span>  
* <span data-ttu-id="75ee3-290">Bir istek göz önüne alındığında, tüm veritabanı işleme içinde yer alır, tek bir parça içinde hello isteğiyle sağlanan hello parçalama anahtarı tarafından tanımlandığı gibi varsayılır.</span><span class="sxs-lookup"><span data-stu-id="75ee3-290">Given a request, it is assumed that all of its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="75ee3-291">Ancak, bu varsayım her zaman true tutmaz.</span><span class="sxs-lookup"><span data-stu-id="75ee3-291">However, this assumption does not always hold true.</span></span> <span data-ttu-id="75ee3-292">Örneğin, ne zaman olası toomake parçalama anahtarına sahip değil.</span><span class="sxs-lookup"><span data-stu-id="75ee3-292">For example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="75ee3-293">tooaddress Bu, hello istemci kitaplığı sağlayan hello **MultiShardQuery** birkaç parça sorgulama için bir bağlantı Özet uygulayan sınıf.</span><span class="sxs-lookup"><span data-stu-id="75ee3-293">tooaddress this, hello client library provides hello **MultiShardQuery** class that implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="75ee3-294">Toouse hello öğrenme **MultiShardQuery** EF ile birlikte hello bu belgenin kapsamında değildir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-294">Learning toouse hello **MultiShardQuery** in combination with EF is beyond hello scope of this document</span></span>

## <a name="conclusion"></a><span data-ttu-id="75ee3-295">Sonuç</span><span class="sxs-lookup"><span data-stu-id="75ee3-295">Conclusion</span></span>
<span data-ttu-id="75ee3-296">Bu belgede özetlenen hello adımlara EF uygulamaları hello esnek veritabanı istemci kitaplığının yetenek hello oluşturucular yeniden düzenleme yönlendirme bağımlı veri kullanabilirsiniz **DbContext** hello EF kullanılan alt sınıflar uygulama.</span><span class="sxs-lookup"><span data-stu-id="75ee3-296">Through hello steps outlined in this document, EF applications can use hello elastic database client library's capability for data dependent routing by refactoring constructors of hello **DbContext** subclasses used in hello EF application.</span></span> <span data-ttu-id="75ee3-297">Bu sınırları hello değişiklik gerekli toothose yerleştirir nerede **DbContext** sınıflar zaten mevcut.</span><span class="sxs-lookup"><span data-stu-id="75ee3-297">This limits hello  changes required toothose places where **DbContext** classes already exist.</span></span> <span data-ttu-id="75ee3-298">Ayrıca, EF uygulamaları hello gerekli EF geçirilmesi hello kayıt ile yeni parça ve eşlemelerini hello parça eşlemesindeki çağırma hello adımları birleştirerek otomatik şema dağıtımından toobenefit devam edebilir.</span><span class="sxs-lookup"><span data-stu-id="75ee3-298">In addition, EF applications can continue toobenefit from automatic schema deployment by combining hello steps that invoke hello necessary EF migrations with hello registration of new shards and mappings in hello shard map.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-use-entity-framework-applications-visual-studio/sample.png
