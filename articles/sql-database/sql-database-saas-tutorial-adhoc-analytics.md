---
title: "birden çok Azure SQL veritabanları arasında aaaRun geçici analitik sorguları | Microsoft Docs"
description: "Merhaba Wingtip SaaS çok kiracılı uygulama içinde birden çok SQL veritabanları arasında geçici analitik sorguları çalıştırın."
keywords: "sql veritabanı öğreticisi"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="3376b-104">Geçici tüm Wingtip SaaS kiracılar arasında analitik sorguları çalıştırma</span><span class="sxs-lookup"><span data-stu-id="3376b-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="3376b-105">Bu öğreticide, dağıtılmış sorgular tooenable geçici analytics hello kümesinin tamamını Kiracı veritabanları üzerinde çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="3376b-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="3376b-106">Esnek sorgu gerektiren bir ek analiz veritabanı dağıtıldığı kullanılan tooenable dağıtılmış sorgular olan (toohello katalog sunucusu).</span><span class="sxs-lookup"><span data-stu-id="3376b-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="3376b-107">Bu sorguları hello günlük işletimsel verileri hello Wingtip SaaS uygulamasının kaçınma Öngörüler ayıklayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="3376b-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="3376b-108">Bu öğreticide şunları öğrenirsiniz:</span><span class="sxs-lookup"><span data-stu-id="3376b-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="3376b-109">Merhaba genel görünümler hakkında her veritabanında, kiracılar arasında verimli sorgulama etkinleştirin.</span><span class="sxs-lookup"><span data-stu-id="3376b-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="3376b-110">Nasıl toodeploy geçici Analizi veritabanı</span><span class="sxs-lookup"><span data-stu-id="3376b-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="3376b-111">Toorun sorguları tüm Kiracı veritabanları arasında nasıl dağıtılmış</span><span class="sxs-lookup"><span data-stu-id="3376b-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="3376b-112">Bu öğretici, Önkoşullar aşağıdaki yapma emin hello tamamlanır toocomplete:</span><span class="sxs-lookup"><span data-stu-id="3376b-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="3376b-113">Merhaba Wingtip SaaS uygulaması dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="3376b-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="3376b-114">beş dakikadan kısa toodeploy bakın [dağıtma ve Merhaba Wingtip SaaS uygulaması keşfedin.](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="3376b-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="3376b-115">Azure PowerShell’in yüklendiğinden.</span><span class="sxs-lookup"><span data-stu-id="3376b-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="3376b-116">Ayrıntılar için bkz. [Azure PowerShell’i kullanmaya başlama](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="3376b-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="3376b-117">SQL Server Management Studio (SSMS) yüklenir.</span><span class="sxs-lookup"><span data-stu-id="3376b-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="3376b-118">bkz: toodownload ve yükleme SSMS, [karşıdan SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="3376b-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="3376b-119">Geçici analytics düzeni</span><span class="sxs-lookup"><span data-stu-id="3376b-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="3376b-120">SaaS uygulamaları ile Merhaba harika fırsatları toouse hello çok büyük miktarda Kiracı verilerini merkezi olarak hello bulutta depolanan biridir.</span><span class="sxs-lookup"><span data-stu-id="3376b-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="3376b-121">Bu veri toogain fikir hello işlemi ve uygulamanız, kiracılarınıza, kendi kullanıcılar, tercihleri, davranışlar vb. kullanımını kullanın. Bu Öngörüler özelliği development, kullanılabilirlik yenilikleri ve diğer uygulamalar ve hizmetler yatırım yönlendirebilir.</span><span class="sxs-lookup"><span data-stu-id="3376b-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="3376b-122">Bu verilere tek bir çok kiracılı veritabanında erişim kolaydır, ancak binlerce veritabanına ölçekli olarak dağıtıldığında çok kolay değildir.</span><span class="sxs-lookup"><span data-stu-id="3376b-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="3376b-123">Bir yaklaşım ise toouse [esnek sorgu](sql-database-elastic-query-overview.md), sağlayan veritabanları ortak bir şema ile dağıtılmış bir dizi arasında sorgulama.</span><span class="sxs-lookup"><span data-stu-id="3376b-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="3376b-124">Esnek sorgusu kullanan tek bir *head* , dış tablolara tanımlanır (Kiracı) veritabanı yansıtma tabloları ve görünümleri hello dağıtılmış veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="3376b-125">Sorguları gönderilen toothis head Veritabanı derlenmiş tooproduce gerektiği gibi toohello Kiracı veritabanları gönderilen hello sorgu bölümünü içeren bir dağıtılmış sorgu planı şunlardır.</span><span class="sxs-lookup"><span data-stu-id="3376b-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="3376b-126">Esnek sorgu hello parça eşleme hello Katalog veritabanı tooprovide hello konumundaki hello Kiracı veritabanlarını kullanır.</span><span class="sxs-lookup"><span data-stu-id="3376b-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="3376b-127">Kurulum ve sorgu standardını kullanarak basit [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference)ve Power BI ve Excel gibi Araçları'ndan geçici sorgulama destekler.</span><span class="sxs-lookup"><span data-stu-id="3376b-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="3376b-128">Sorguları hello Kiracı veritabanları arasında dağıtarak, esnek sorgu Canlı üretim verileri daha iyi sağlar.</span><span class="sxs-lookup"><span data-stu-id="3376b-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="3376b-129">Ancak, esnek sorgu potansiyel olarak birçok veritabanı veri çeker gibi gecikme süresi bazen eşdeğer sorgular için daha yüksek olabilir sorgu tooa tek çok Kiracı veritabanı gönderildi.</span><span class="sxs-lookup"><span data-stu-id="3376b-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="3376b-130">Tasarlama döndürülen toominimize hello veri sorguladığında dikkatli olunmalıdır.</span><span class="sxs-lookup"><span data-stu-id="3376b-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="3376b-131">Esnek sorgu genellikle en sık kullanılan karşılıklı toobuilding veya karmaşık analitik sorguları veya rapor küçük miktarda gerçek zamanlı veri sorgulama için uygundur.</span><span class="sxs-lookup"><span data-stu-id="3376b-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="3376b-132">Sorguları da gerçekleştirme hello arayın [yürütme planı](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) hello sorgu hangi kısmının gönderilen toohello Uzak veritabanı ve ne kadar veri döndürülmüyor aşağı toosee.</span><span class="sxs-lookup"><span data-stu-id="3376b-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="3376b-133">Karmaşık analitik işleme daha iyi gerektiren sorguları bazı durumlarda bir adanmış veritabanı veya veri ambarı analitik sorguları için en iyi duruma getirilmiş içine Kiracı verileri çıkartarak sundu.</span><span class="sxs-lookup"><span data-stu-id="3376b-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="3376b-134">Bu desen hello anlatılmıştır [Kiracı analytics Öğreticisi](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="3376b-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="3376b-135">Merhaba Wingtip uygulama komut dosyaları alma</span><span class="sxs-lookup"><span data-stu-id="3376b-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="3376b-136">Merhaba Wingtip SaaS komut dosyaları ve uygulama kaynak koduna hello kullanılabilir [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github depo.</span><span class="sxs-lookup"><span data-stu-id="3376b-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="3376b-137">[Adımları toodownload hello Wingtip SaaS betikleri](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="3376b-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="3376b-138">Bilet satış verileri oluşturma</span><span class="sxs-lookup"><span data-stu-id="3376b-138">Create ticket sales data</span></span>

<span data-ttu-id="3376b-139">toorun karşı daha ilginç bir veri kümesi, sorgular bilet satış verileri hello bilet-Oluşturucu çalıştırarak oluşturun.</span><span class="sxs-lookup"><span data-stu-id="3376b-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="3376b-140">Merhaba, *PowerShell ISE*açın hello... \\Öğrenme modülleri\\işletimsel Analytics\\geçici Analytics\\*Demo AdhocAnalytics.ps1* komut dosyası ve değerleri aşağıdaki hello ayarlayın:</span><span class="sxs-lookup"><span data-stu-id="3376b-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="3376b-141">**$DemoScenario** = 1, **satın tüm görebildikleri etkinliklerine biletlerini**.</span><span class="sxs-lookup"><span data-stu-id="3376b-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="3376b-142">Tuşuna **F5** hello komut dosyasını çalıştırın ve bilet satış oluşturmak için.</span><span class="sxs-lookup"><span data-stu-id="3376b-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="3376b-143">Merhaba komut dosyası çalıştırılırken, bu öğreticide hello adımlara devam edin.</span><span class="sxs-lookup"><span data-stu-id="3376b-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="3376b-144">Merhaba bilet verileri hello sorgulanan *dağıtılmış geçici sorguları çalıştırmak* bölümünde, toothat alıştırma aldığınızda hala çalışıyorsa, bu nedenle hello bilet Oluşturucu toocomplete için bekleyin.</span><span class="sxs-lookup"><span data-stu-id="3376b-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="3376b-145">Merhaba genel görünümler keşfedin</span><span class="sxs-lookup"><span data-stu-id="3376b-145">Explore hello global views</span></span>

<span data-ttu-id="3376b-146">Merhaba Wingtip SaaS uygulamasına hello Kiracı veritabanı şeması tek Kiracı açısından tanımlanan şekilde bir kiracı başına veritabanı modeli kullanılarak oluşturulmuştur.</span><span class="sxs-lookup"><span data-stu-id="3376b-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="3376b-147">Kiracı özgü bilgiler mevcut bir tabloda *Salonundan*, her zaman tek bir satır var ve birincil anahtarı olmayan bir yığın olarak uygulanır.</span><span class="sxs-lookup"><span data-stu-id="3376b-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="3376b-148">Merhaba şema diğer tablolarla ilişkili toobe gerekmeyen toohello *Salonundan* normal kullanımda hiçbir zaman olduğundan Kiracı hello veri ait olduğu için şüpheli tablo.</span><span class="sxs-lookup"><span data-stu-id="3376b-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="3376b-149">Ancak, tüm veritabanları arasında sorgularken, tek bir mantıksal veritabanı parçalı Kiracı tarafından parçası ise gibi esnek sorgu hello veri davranabilirsiniz önemlidir.</span><span class="sxs-lookup"><span data-stu-id="3376b-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="3376b-150">tooachieve Bu, bir dizi 'global' görünümleri olan bir kiracı kimliği her genel sorgulanır hello tabloları proje eklenen toohello Kiracı veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="3376b-151">Örneğin, hello *VenueEvents* görünüm ekler bir hesaplanan *VenueId* toohello sütunları öngörülen hello *olayları* tablo.</span><span class="sxs-lookup"><span data-stu-id="3376b-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="3376b-152">Üzerinden hello dış hello merkez veritabanı tablosunda tanımlayarak *VenueEvents* (Merhaba temel yerine *olayları* tablo), esnek sorgudur göre birleştirmeler aşağı mümkün toopush *VenueId* paralel her bir uzak veritabanına (yerine hello merkez veritabanı) yürütülebilecek şekilde.</span><span class="sxs-lookup"><span data-stu-id="3376b-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="3376b-153">Bu çok sayıda sorgu performansını önemli bir artış sonuçlanır döndürülecek veri miktarı hello önemli ölçüde azaltır.</span><span class="sxs-lookup"><span data-stu-id="3376b-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="3376b-154">Bu genel görünümler tüm Kiracı veritabanları önceden oluşturulmuştur (ve *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="3376b-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="3376b-155">SSMS açın ve [toohello tenants1 - bağlanmak&lt;kullanıcı&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="3376b-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="3376b-156">Genişletme **veritabanları**, sağ **contosoconcerthall**seçip **yeni sorgu**.</span><span class="sxs-lookup"><span data-stu-id="3376b-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="3376b-157">Sorguları tooexplore hello birbirinden hello tek Kiracı tablolar ve hello genel görünümler aşağıdaki hello çalıştırın:</span><span class="sxs-lookup"><span data-stu-id="3376b-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="3376b-158">Bu görünümlerde hello *VenueId* hello Salonundan adı, ancak herhangi bir yaklaşım karmasını kullanılan toointroduce benzersiz bir değer olabilir olarak hesaplanır.</span><span class="sxs-lookup"><span data-stu-id="3376b-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="3376b-159">Bu yaklaşım hello Kiracı anahtarı hello katalog kullanmak için hesaplanan benzer toohello yoludur.</span><span class="sxs-lookup"><span data-stu-id="3376b-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="3376b-160">Merhaba tooexamine hello tanımı *görebildikleri* görünümü:</span><span class="sxs-lookup"><span data-stu-id="3376b-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="3376b-161">İçinde **Object Explorer**, genişletin **contosoconcethall** > **görünümleri**:</span><span class="sxs-lookup"><span data-stu-id="3376b-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![Görünümler](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="3376b-163">Sağ **dbo. Görebildikleri**.</span><span class="sxs-lookup"><span data-stu-id="3376b-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="3376b-164">Seçin **komut görünüm olarak** > **için oluşturun** > **yeni sorgu Düzenleyicisi penceresini**</span><span class="sxs-lookup"><span data-stu-id="3376b-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="3376b-165">Herhangi bir hello diğer komut dosyası *Salonundan* toosee görünümleri hello nasıl ekledikleri *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="3376b-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="3376b-166">Dağıtılmış geçici sorgular için kullanılan hello veritabanı dağıtma</span><span class="sxs-lookup"><span data-stu-id="3376b-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="3376b-167">Bu alıştırmada hello dağıtır *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="3376b-168">Bu tüm Kiracı veritabanları arasında sorgulamak için kullanılan hello şema içerecek hello baş veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="3376b-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="3376b-169">Merhaba, dağıtılan toohello hello sunucu hello örnek uygulama yönetimiyle ilgili tüm veritabanları için kullanılan katalog sunucusu varolan veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="3376b-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="3376b-170">Aç... \\Öğrenme modülleri\\işletimsel Analytics\\geçici Analytics\\*Demo AdhocAnalytics.ps1* hello içinde *PowerShell ISE* ve kümesi hello Aşağıdaki değerler:</span><span class="sxs-lookup"><span data-stu-id="3376b-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="3376b-171">**$DemoScenario** = 2, **Geçici analiz veritabanı dağıtma**.</span><span class="sxs-lookup"><span data-stu-id="3376b-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="3376b-172">Tuşuna **F5** toorun hello komut dosyası ve hello oluşturma *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="3376b-173">Kullanılan toorun dağıtılmış sorgular olabilir hello sonraki bölümde, şema toohello veritabanını ekleyin.</span><span class="sxs-lookup"><span data-stu-id="3376b-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="3376b-174">Dağıtılmış sorgular çalıştırmak için hello veritabanını Yapılandır</span><span class="sxs-lookup"><span data-stu-id="3376b-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="3376b-175">Bu alıştırmada, tüm Kiracı veritabanları arasında sorgulama sağlar (Merhaba dış veri kaynağına ve dış tablo tanımları) şema toohello geçici Analizi veritabanı ekler.</span><span class="sxs-lookup"><span data-stu-id="3376b-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="3376b-176">SQL Server Management Studio'yu açın ve toohello hello önceki adımda oluşturduğunuz geçici Analizi veritabanı bağlanın.</span><span class="sxs-lookup"><span data-stu-id="3376b-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="3376b-177">Merhaba veritabanının Hello adı adhocanalytics olacaktır.</span><span class="sxs-lookup"><span data-stu-id="3376b-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="3376b-178">Açık ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* SSMS içinde.</span><span class="sxs-lookup"><span data-stu-id="3376b-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="3376b-179">Merhaba SQL komut dosyasını gözden geçirin ve hello aşağıdakileri göz önünde bulundurun:</span><span class="sxs-lookup"><span data-stu-id="3376b-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="3376b-180">Bir veritabanı kapsamlı bir kimlik bilgisi tooaccess her hello Kiracı veritabanlarının esnek sorgusu kullanır.</span><span class="sxs-lookup"><span data-stu-id="3376b-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="3376b-181">Bu kimlik bilgisi toobe tüm hello veritabanlarında kullanılabilir gerekir ve normal olarak bu geçici sorgular tooenable hello en düşük hakları gerekli verilmelidir.</span><span class="sxs-lookup"><span data-stu-id="3376b-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![kimlik bilgisi oluşturma](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="3376b-183">Merhaba, dış veri kaynağına toouse hello Kiracı parça eşleme hello katalog veritabanında tanımlı.</span><span class="sxs-lookup"><span data-stu-id="3376b-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="3376b-184">Bu hello dış veri kaynağı olarak kullanarak, sorguları hello sorgu çalıştığında hello kataloğa kayıtlı dağıtılmış tooall veritabanlarıdır.</span><span class="sxs-lookup"><span data-stu-id="3376b-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="3376b-185">Sunucu adları için her bir dağıtım farklı olduğundan, bu başlatma betiği hello Katalog veritabanı hello konumunu hello geçerli sunucu alarak alır (@@servername) hello betik yürütüldüğü.</span><span class="sxs-lookup"><span data-stu-id="3376b-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![Dış veri kaynağı oluşturun](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="3376b-187">ile tanımlanan ve hello önceki bölümde açıklanan hello genel görünümlere başvuru dış tablolara hello **dağıtım SHARDED(VenueId) =**.</span><span class="sxs-lookup"><span data-stu-id="3376b-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="3376b-188">Çünkü her *VenueId* tooa tek veritabanı eşlemeleri bu hello sonraki bölümde gösterildiği gibi birçok senaryo için performansı geliştirir.</span><span class="sxs-lookup"><span data-stu-id="3376b-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![Dış tabloları oluşturma](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="3376b-190">Merhaba yerel tablo *VenueTypes* oluşturulur ve doldurulur.</span><span class="sxs-lookup"><span data-stu-id="3376b-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="3376b-191">Bu başvuru veri tablosu tüm Kiracı veritabanları ortak olduğundan burada yerel tablo olarak ve hello ortak verilerle doldurulan gösterilebilir.</span><span class="sxs-lookup"><span data-stu-id="3376b-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="3376b-192">Bu hello azaltmak bazı sorgular için veri miktarını taşınmış hello hello Kiracı veritabanları arasında *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![Tablo oluşturma](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="3376b-194">Bu şekilde başvuru tabloları eklerseniz, hello Kiracı veritabanları güncelleştirdiğinizde emin tooupdate hello tablo şemasını ve verileri olabilir.</span><span class="sxs-lookup"><span data-stu-id="3376b-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="3376b-195">Tuşuna **F5** toorun hello komut dosyası ve hello başlatma *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="3376b-196">Şimdi dağıtılmış sorgular çalıştırın ve tüm kiracılar arasında görüşleri toplamak!</span><span class="sxs-lookup"><span data-stu-id="3376b-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="3376b-197">Dağıtılmış geçici sorguları çalıştırma</span><span class="sxs-lookup"><span data-stu-id="3376b-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="3376b-198">Şimdi bu hello *adhocanalytics* veritabanı ayarlama, devam edin ve bazı dağıtılmış sorgular çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="3376b-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="3376b-199">Daha iyi hello sorgu işleme nerede gerçekleştiği anlamak için hello yürütme planı içerir.</span><span class="sxs-lookup"><span data-stu-id="3376b-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="3376b-200">Merhaba yürütme planı incelerken, Ayrıntılar için hello planı simgeler üzerine gelerek.</span><span class="sxs-lookup"><span data-stu-id="3376b-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="3376b-201">Önemli toonote olduğundan, ayar **dağıtım SHARDED(VenueId) =** biz hello dış veri kaynağına tanımlandığında, çok sayıda senaryoları için performansı geliştirir.</span><span class="sxs-lookup"><span data-stu-id="3376b-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="3376b-202">Çünkü her *VenueId* tooa eşlemeleri tek veritabanı kolayca Bitti'yi uzaktan, döndürmeyi yalnızca hello veri ihtiyacımız olan filtreleme.</span><span class="sxs-lookup"><span data-stu-id="3376b-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="3376b-203">SSMS’te ...\\Öğrenme Modülleri\\İşlem Analizi\\Geçici Analiz\\*Demo-AdhocAnalyticsQueries.sql* dosyasını açın.</span><span class="sxs-lookup"><span data-stu-id="3376b-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="3376b-204">Bağlı toohello olduğundan emin olun **adhocanalytics** veritabanı.</span><span class="sxs-lookup"><span data-stu-id="3376b-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="3376b-205">Select hello **sorgu** menüsüne ve ardından **gerçek Execution Plan Ekle**</span><span class="sxs-lookup"><span data-stu-id="3376b-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="3376b-206">Merhaba vurgulayın *hangi görebildikleri şu anda kayıtlı olan?* sorgu ve tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="3376b-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="3376b-207">Merhaba sorgu nasıl hızlı gösteren hello tüm salonundan listesini döndürür ve onu tooquery tüm kiracılar ve her bir kiracı dönüş verileri arasında kolaydır.</span><span class="sxs-lookup"><span data-stu-id="3376b-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="3376b-208">Merhaba planı inceleyebilir ve sadece giderek tooeach Kiracı veritabanı ve hello salonundan bilgi seçme ki çünkü hello tüm maliyetini hello uzak sorgu olduğunu görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="3376b-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![SEÇİN * dbo gelen. Görebildikleri](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="3376b-210">Select hello sonraki sorgu ve tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="3376b-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="3376b-211">Bu sorgu hello Kiracı veritabanları ve hello yerel verileri birleştirir *VenueTypes* tablosu (Merhaba tabloda olarak yerel *adhocanalytics* veritabanı).</span><span class="sxs-lookup"><span data-stu-id="3376b-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="3376b-212">Merhaba planı inceleyebilir ve o hello bkz maliyet çoğunluğu olduğundan hello uzak sorgu biz her bir kiracının salonundan bilgisi (dbo. sorgu Görebildikleri), ve ardından Hızlı yerel bir birleşme hello yerel yapın *VenueTypes* tablo toodisplay hello kolay adı.</span><span class="sxs-lookup"><span data-stu-id="3376b-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Uzak ve yerel verileri birleştirme](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="3376b-214">Şimdi hello seçin *satılan çoğu biletleri hello hangi gününde olan?* sorgu ve tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="3376b-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="3376b-215">Bu sorgu, biraz daha karmaşık birleştirme ve toplama işlemlerini gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="3376b-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="3376b-216">Önemli toonote nedir hello işleme çoğunu uzaktan yapılır ve yine de geri getirmek biz yalnızca hello satır, her salonundan 's toplama bilet satış sayısı her gün için yalnızca tek bir satır döndürme ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="3376b-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![sorgu](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="3376b-218">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="3376b-218">Next steps</span></span>

<span data-ttu-id="3376b-219">Bu öğreticide, şunların nasıl yapıldığını öğrendiniz:</span><span class="sxs-lookup"><span data-stu-id="3376b-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="3376b-220">Tüm kiracı veritabanlarında dağıtılmış sorguları çalıştırma</span><span class="sxs-lookup"><span data-stu-id="3376b-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="3376b-221">Bir geçici analytics veritabanı dağıtmak ve şema tooit dağıtılmış toorun sorguları ekleyin.</span><span class="sxs-lookup"><span data-stu-id="3376b-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="3376b-222">Şimdi hello deneyin [Kiracı Analytics öğretici](sql-database-saas-tutorial-tenant-analytics.md) tooexplore daha karmaşık analitik işleme için veri tooa ayrı analytics veritabanı ayıklanıyor...</span><span class="sxs-lookup"><span data-stu-id="3376b-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="3376b-223">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="3376b-223">Additional resources</span></span>

* <span data-ttu-id="3376b-224">Ek [hello Wingtip SaaS uygulamasına yapı öğreticileri](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="3376b-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="3376b-225">Esnek Sorgu</span><span class="sxs-lookup"><span data-stu-id="3376b-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
