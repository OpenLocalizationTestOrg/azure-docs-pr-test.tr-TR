---
title: "Birden çok Azure SQL veritabanında geçici analiz sorguları çalıştırma | Microsoft Docs"
description: "Geçici analitik sorguları Wingtip SaaS çok kiracılı uygulama içinde birden çok SQL veritabanları üzerinde çalıştırın."
keywords: "sql veritabanı öğreticisi"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: c287fe5d6b333c749b0580b5253e7e46ac27232b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="f47a1-104">Geçici tüm Wingtip SaaS kiracılar arasında analitik sorguları çalıştırma</span><span class="sxs-lookup"><span data-stu-id="f47a1-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="f47a1-105">Bu öğreticide, dağıtılmış sorgular geçici analytics etkinleştirmek için veritabanlarını Kiracı kümesinin tamamını çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="f47a1-105">In this tutorial, you run distributed queries across the entire set of tenant databases to enable ad-hoc analytics.</span></span> <span data-ttu-id="f47a1-106">Esnek sorgu dağıtılmış sorgular etkinleştirmek için ek analiz veritabanı (katalog sunucusuna) dağıtılan gerektiren kullanılır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-106">Elastic Query is used to enable distributed queries, which requires an additional analytics database is deployed (to the catalog server).</span></span> <span data-ttu-id="f47a1-107">Bu sorguları Wingtip SaaS uygulamasının işlemsel günlük veri kaçınma Öngörüler ayıklayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f47a1-107">These queries can extract insights buried in the day-to-day operational data of the Wingtip SaaS app.</span></span>


<span data-ttu-id="f47a1-108">Bu öğreticide şunları öğrenirsiniz:</span><span class="sxs-lookup"><span data-stu-id="f47a1-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="f47a1-109">Her veritabanında genel görünümler hakkında kiracılar arasında verimli sorgulama etkinleştirin.</span><span class="sxs-lookup"><span data-stu-id="f47a1-109">About the global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="f47a1-110">Bir geçici Analizi veritabanı dağıtma</span><span class="sxs-lookup"><span data-stu-id="f47a1-110">How to deploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="f47a1-111">Tüm Kiracı veritabanları arasında dağıtılmış sorgular gerçekleştirme</span><span class="sxs-lookup"><span data-stu-id="f47a1-111">How to run distributed queries across all tenant databases</span></span>



<span data-ttu-id="f47a1-112">Bu öğreticiyi tamamlamak için aşağıdaki ön koşulların karşılandığından emin olun:</span><span class="sxs-lookup"><span data-stu-id="f47a1-112">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="f47a1-113">Wingtip SaaS uygulaması dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-113">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="f47a1-114">Beş dakikadan daha kısa bir süre içinde dağıtmak için bkz: [dağıtma ve Wingtip SaaS uygulamasına keşfedin.](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="f47a1-114">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="f47a1-115">Azure PowerShell’in yüklendiğinden.</span><span class="sxs-lookup"><span data-stu-id="f47a1-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="f47a1-116">Ayrıntılar için bkz. [Azure PowerShell’i kullanmaya başlama](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="f47a1-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="f47a1-117">SQL Server Management Studio (SSMS) yüklenir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="f47a1-118">SSMS yükleyip için bkz: [karşıdan SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="f47a1-118">To download and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="f47a1-119">Geçici analytics düzeni</span><span class="sxs-lookup"><span data-stu-id="f47a1-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="f47a1-120">SaaS uygulamaları ile harika fırsatların merkezi olarak bulutta depolanan Kiracı veri çok büyük miktarda kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-120">One of the great opportunities with SaaS applications is to use the vast amount of tenant data stored centrally in the cloud.</span></span> <span data-ttu-id="f47a1-121">İşlem ve uygulamanız, kiracılarınıza, kendi kullanıcılar, tercihleri, davranışlar vb. kullanımını sağlamak için bu verileri kullanın. Bu Öngörüler özelliği development, kullanılabilirlik yenilikleri ve diğer uygulamalar ve hizmetler yatırım yönlendirebilir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-121">Use this data to gain insights into the operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="f47a1-122">Bu verilere tek bir çok kiracılı veritabanında erişim kolaydır, ancak binlerce veritabanına ölçekli olarak dağıtıldığında çok kolay değildir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="f47a1-123">Bir yaklaşım ise kullanılacak [esnek sorgu](sql-database-elastic-query-overview.md), sağlayan veritabanları ortak bir şema ile dağıtılmış bir dizi arasında sorgulama.</span><span class="sxs-lookup"><span data-stu-id="f47a1-123">One approach is to use [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="f47a1-124">Esnek sorgusu kullanan tek bir *head* dış tablolara tanımlanmış veritabanı tabloları ve görünümleri dağıtılmış (Kiracı) veritabanı yansıtma.</span><span class="sxs-lookup"><span data-stu-id="f47a1-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in the distributed (tenant) databases.</span></span> <span data-ttu-id="f47a1-125">Bu baş veritabanına gönderilen sorgular, gerektiğinde kiracı veritabanlarına gönderilen sorgu kısımlarıyla birlikte dağıtılmış bir sorgu planı oluşturmak üzere derlenir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-125">Queries submitted to this head database are compiled to produce a distributed query plan, with portions of the query pushed down to the tenant databases as needed.</span></span> <span data-ttu-id="f47a1-126">Esnek Sorgu, kiracı veritabanlarının konumunu sağlamak üzere katalog veritabanındaki parça eşlemesini kullanır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-126">Elastic Query uses the shard map in the catalog database to provide the location of the tenant databases.</span></span> <span data-ttu-id="f47a1-127">Kurulum ve sorgu standardını kullanarak basit [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference)ve Power BI ve Excel gibi Araçları'ndan geçici sorgulama destekler.</span><span class="sxs-lookup"><span data-stu-id="f47a1-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="f47a1-128">Kiracı veritabanları arasında sorguları dağıtarak, esnek sorgu Canlı üretim verileri daha iyi sağlar.</span><span class="sxs-lookup"><span data-stu-id="f47a1-128">By distributing queries across the tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="f47a1-129">Esnek sorgu potansiyel olarak birçok veritabanı veri çeker, ancak sorgu gecikmesi bazen tek bir çok kiracılı veritabanına gönderilen eşdeğer sorgular için daha yüksek olabilir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted to a single multi-tenant database.</span></span> <span data-ttu-id="f47a1-130">Döndürülen veri en aza indirmek için tasarlama sorguladığında dikkatli olunmalıdır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-130">Care should be taken when designing queries to minimize the data that is returned.</span></span> <span data-ttu-id="f47a1-131">Esnek sorgu genellikle en küçük miktarda sık kullanılan yapı veya karmaşık analitik sorguları ya da raporları aksine gerçek zamanlı veri sorgulama için uygundur.</span><span class="sxs-lookup"><span data-stu-id="f47a1-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed to building frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="f47a1-132">Sorguları da gerçekleştirme, bakmak [yürütme planı](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) sorgu hangi kısmının uzak veritabanına gönderilen ve ne kadar veri döndürülmüyor.</span><span class="sxs-lookup"><span data-stu-id="f47a1-132">If queries don't perform well, look at the [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) to see what part of the query has been pushed down to the remote database and how much data is being returned.</span></span> <span data-ttu-id="f47a1-133">Karmaşık analitik işleme daha iyi gerektiren sorguları bazı durumlarda bir adanmış veritabanı veya veri ambarı analitik sorguları için en iyi duruma getirilmiş içine Kiracı verileri çıkartarak sundu.</span><span class="sxs-lookup"><span data-stu-id="f47a1-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="f47a1-134">Bu desen açıklandığı [Kiracı analytics Öğreticisi](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="f47a1-134">This pattern is explained in the [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="f47a1-135">Wingtip uygulama betiklerini alma</span><span class="sxs-lookup"><span data-stu-id="f47a1-135">Get the Wingtip application scripts</span></span>

<span data-ttu-id="f47a1-136">Wingtip SaaS komut dosyalarını ve uygulama kaynak koduna kullanılabilir olan [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github depo.</span><span class="sxs-lookup"><span data-stu-id="f47a1-136">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="f47a1-137">[Wingtip SaaS komut dosyalarını karşıdan yüklemek için adımları](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="f47a1-137">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="f47a1-138">Bilet satış verileri oluşturma</span><span class="sxs-lookup"><span data-stu-id="f47a1-138">Create ticket sales data</span></span>

<span data-ttu-id="f47a1-139">Daha ilginç bir veri kümesi karşı sorguları çalıştırmak için bilet Oluşturucu çalıştırarak bilet satış verileri oluşturun.</span><span class="sxs-lookup"><span data-stu-id="f47a1-139">To run queries against a more interesting data set, create ticket sales data by running the ticket-generator.</span></span>

1. <span data-ttu-id="f47a1-140">İçinde *PowerShell ISE*açın... \\Öğrenme modülleri\\işletimsel Analytics\\geçici Analytics\\*Demo AdhocAnalytics.ps1* komut dosyası ve aşağıdaki değerleri ayarlayın:</span><span class="sxs-lookup"><span data-stu-id="f47a1-140">In the *PowerShell ISE*, open the ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set the following values:</span></span>
   * <span data-ttu-id="f47a1-141">**$DemoScenario** = 1, **satın tüm görebildikleri etkinliklerine biletlerini**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="f47a1-142">Tuşuna **F5** komut dosyasını çalıştırın ve bilet satış oluşturmak için.</span><span class="sxs-lookup"><span data-stu-id="f47a1-142">Press **F5** to run the script and generate ticket sales.</span></span> <span data-ttu-id="f47a1-143">Komut dosyası çalıştırılırken, bu öğreticide adımlara devam edin.</span><span class="sxs-lookup"><span data-stu-id="f47a1-143">While the script is running, continue the steps in this tutorial.</span></span> <span data-ttu-id="f47a1-144">Bilet verileri içinde sorgulanan *dağıtılmış geçici sorguları çalıştırmak* bölümünde, bu nedenle bu alıştırma için aldığınızda hala çalışıyorsa tamamlamak için bilet oluşturucunun bekleyin.</span><span class="sxs-lookup"><span data-stu-id="f47a1-144">The ticket data is queried in the *Run ad-hoc distributed queries* section, so wait for the ticket generator to complete if it's still running when you get to that exercise.</span></span>

## <a name="explore-the-global-views"></a><span data-ttu-id="f47a1-145">Genel görünümler keşfedin</span><span class="sxs-lookup"><span data-stu-id="f47a1-145">Explore the global views</span></span>

<span data-ttu-id="f47a1-146">Wingtip SaaS uygulamasına Kiracı veritabanı şeması tek Kiracı açısından tanımlandığı şekilde bir kiracı başına veritabanı modeli kullanılarak oluşturulmuştur.</span><span class="sxs-lookup"><span data-stu-id="f47a1-146">The Wingtip SaaS application is built using a tenant-per-database model, so the tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="f47a1-147">Kiracı özgü bilgiler mevcut bir tabloda *Salonundan*, her zaman tek bir satır var ve birincil anahtarı olmayan bir yığın olarak uygulanır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="f47a1-148">Şema diğer tablolarla ilişkili gerekmez *Salonundan* normal kullanımda hiçbir zaman olduğundan, Kiracı veri ait şüpheli tablo.</span><span class="sxs-lookup"><span data-stu-id="f47a1-148">Other tables in the schema don't need to be related to the *Venue* table, because in normal use, there is never any doubt which tenant the data belongs to.</span></span>

<span data-ttu-id="f47a1-149">Ancak, tüm veritabanları arasında sorgularken, tek bir mantıksal veritabanı parçalı Kiracı tarafından parçası ise gibi esnek sorgu verileri davranabilirsiniz önemlidir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-149">However, when querying across all databases, it's important that Elastic Query can treat the data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="f47a1-150">Bunun için 'global' görünüm kümesi eklenir Kiracı veritabanı proje Kiracı kimliği her genel sorgulanır tablolar.</span><span class="sxs-lookup"><span data-stu-id="f47a1-150">To achieve this, a set of 'global' views are added to the tenant database that project a tenant id into each of the tables that are queried globally.</span></span> <span data-ttu-id="f47a1-151">Örneğin, *VenueEvents* görünüm ekler bir hesaplanan *VenueId* gelen öngörülen sütunlara *olayları* tablo.</span><span class="sxs-lookup"><span data-stu-id="f47a1-151">For example, the *VenueEvents* view adds a computed *VenueId* to the columns projected from the *Events* table.</span></span> <span data-ttu-id="f47a1-152">Dış tablo baş veritabanındaki üzerinden tanımlayarak *VenueEvents* (arka plandaki yerine *olayları* tablo), esnek sorgu göre birleştirmeler aşağı itme mümkün *VenueId*paralel her bir uzak veritabanına (yerine merkez veritabanı) yürütülebilecek şekilde.</span><span class="sxs-lookup"><span data-stu-id="f47a1-152">By defining the external table in the head database over *VenueEvents* (rather than the underlying *Events* table), Elastic Query is able to push down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on the head database).</span></span> <span data-ttu-id="f47a1-153">Bu, çok sayıda sorgu performansını önemli bir artış sonuçlanır döndürülür, veri miktarını önemli ölçüde azaltır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-153">This dramatically reduces the amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="f47a1-154">Bu genel görünümler tüm Kiracı veritabanları önceden oluşturulmuştur (ve *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="f47a1-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="f47a1-155">SSMS açın ve [tenants1 için bağlantı&lt;kullanıcı&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="f47a1-155">Open SSMS and [connect to the tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="f47a1-156">Genişletme **veritabanları**, sağ **contosoconcerthall**seçip **yeni sorgu**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="f47a1-157">Tek Kiracı tablolar ve genel görünümler arasındaki farkı keşfetmek için aşağıdaki sorgular çalıştırın:</span><span class="sxs-lookup"><span data-stu-id="f47a1-157">Run the following queries to explore the difference between the single-tenant tables and the global views:</span></span>

   ```T-SQL
   -- The base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice the plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- The base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects the VenueId retrieved from the Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="f47a1-158">Bu görünümlerdeki *VenueId* Salonundan adı, ancak herhangi bir yaklaşım karmasını benzersiz bir değer tanıtmak için kullanılabilir olarak hesaplanır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-158">In these views, the *VenueId* is computed as a hash of the Venue name, but any approach could be used to introduce a unique value.</span></span> <span data-ttu-id="f47a1-159">Bu yaklaşımı, katalog kullanmak için Kiracı anahtarınızı hesaplanan şekilde benzerdir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-159">This approach is similar to the way the tenant key is computed for use in the catalog.</span></span>

<span data-ttu-id="f47a1-160">Tanımını incelemek için *görebildikleri* görünümü:</span><span class="sxs-lookup"><span data-stu-id="f47a1-160">To examine the definition of the *Venues* view:</span></span>

1. <span data-ttu-id="f47a1-161">İçinde **Object Explorer**, genişletin **contosoconcethall** > **görünümleri**:</span><span class="sxs-lookup"><span data-stu-id="f47a1-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![Görünümler](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="f47a1-163">Sağ **dbo. Görebildikleri**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="f47a1-164">Seçin **komut görünüm olarak** > **için oluşturun** > **yeni sorgu Düzenleyicisi penceresini**</span><span class="sxs-lookup"><span data-stu-id="f47a1-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="f47a1-165">Herhangi diğer bir komut dosyası *Salonundan* nasıl ekledikleri görmek için görünümleri *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="f47a1-165">Script any of the other *Venue* views to see how they add the *VenueId*.</span></span>

## <a name="deploy-the-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="f47a1-166">Dağıtılmış geçici sorgular için kullanılan veritabanı dağıtma</span><span class="sxs-lookup"><span data-stu-id="f47a1-166">Deploy the database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="f47a1-167">Bu alıştırmada dağıtır *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="f47a1-167">This exercise deploys the *adhocanalytics* database.</span></span> <span data-ttu-id="f47a1-168">Tüm Kiracı veritabanları arasında sorgulamak için kullanılan şema içerecek baş veritabanıdır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-168">This is the head database that will contain the schema used for querying across all tenant databases.</span></span> <span data-ttu-id="f47a1-169">Veritabanı için örnek uygulama yönetimiyle ilgili tüm veritabanları için kullanılan sunucu varolan katalog sunucusuna dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-169">The database is deployed to the existing catalog server, which is the server used for all management-related databases in the sample app.</span></span>

1. <span data-ttu-id="f47a1-170">*PowerShell ISE*’de ...\\Öğrenme Modülleri\\İşlem Analizi\\Geçici Analiz\\*Demo-AdhocAnalytics.ps1* dosyasını açıp aşağıdaki değerleri ayarlayın:</span><span class="sxs-lookup"><span data-stu-id="f47a1-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in the *PowerShell ISE* and set the following values:</span></span>
   * <span data-ttu-id="f47a1-171">**$DemoScenario** = 2, **Geçici analiz veritabanı dağıtma**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="f47a1-172">Tuşuna **F5** komut dosyasını çalıştırmak ve oluşturmak için *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="f47a1-172">Press **F5** to run the script and create the *adhocanalytics* database.</span></span>

<span data-ttu-id="f47a1-173">Dağıtılmış sorgular çalıştırmak için kullanılabilmesi için sonraki bölümde, şema veritabanına ekleyin.</span><span class="sxs-lookup"><span data-stu-id="f47a1-173">In the next section, you add schema to the database so it can be used to run distributed queries.</span></span>

## <a name="configure-the-database-for-running-distributed-queries"></a><span data-ttu-id="f47a1-174">Dağıtılmış sorgular çalıştırmak için veritabanını Yapılandır</span><span class="sxs-lookup"><span data-stu-id="f47a1-174">Configure the database for running distributed queries</span></span>

<span data-ttu-id="f47a1-175">Bu alıştırmada tüm Kiracı veritabanları arasında sorgulama sağlayan geçici Analizi veritabanı şeması (dış veri kaynağına ve dış tablo tanımları) ekler.</span><span class="sxs-lookup"><span data-stu-id="f47a1-175">This exercise adds schema (the external data source and external table definitions) to the ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="f47a1-176">SQL Server Management Studio'yu açın ve önceki adımda oluşturduğunuz geçici Analytics veritabanına bağlanın.</span><span class="sxs-lookup"><span data-stu-id="f47a1-176">Open SQL Server Management Studio, and connect to the Adhoc Analytics database you created in the previous step.</span></span> <span data-ttu-id="f47a1-177">Veritabanının adını adhocanalytics olacaktır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-177">The name of the database will be adhocanalytics.</span></span>
2. <span data-ttu-id="f47a1-178">Açık ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* SSMS içinde.</span><span class="sxs-lookup"><span data-stu-id="f47a1-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="f47a1-179">SQL komut dosyasını gözden geçirin ve aşağıdakilere dikkat edin:</span><span class="sxs-lookup"><span data-stu-id="f47a1-179">Review the SQL script and note the following:</span></span>

   <span data-ttu-id="f47a1-180">Esnek sorgu veritabanı kapsamlı bir kimlik bilgisi her bir kiracı veritabanı erişmek için kullanır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-180">Elastic Query uses a database-scoped credential to access each of the tenant databases.</span></span> <span data-ttu-id="f47a1-181">Bu kimlik bilgileri tüm veritabanlarında kullanılabilir olması ve genellikle verilen en düşük hakları bu geçici sorgular etkinleştirmek için gerekli olması.</span><span class="sxs-lookup"><span data-stu-id="f47a1-181">This credential needs to be available in all the databases and should normally be granted the minimum rights required to enable these ad-hoc queries.</span></span>

    ![kimlik bilgisi oluşturma](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="f47a1-183">Kiracı parça eşleme katalog veritabanında kullanmak için tanımlanan dış veri kaynağı.</span><span class="sxs-lookup"><span data-stu-id="f47a1-183">The external data source, that is defined to use the tenant shard map in the catalog database.</span></span> <span data-ttu-id="f47a1-184">Bu dış veri kaynağı olarak kullanarak, sorguları sorgu çalıştığında ve kataloğa kayıtlı tüm veritabanları için dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-184">By using this as the external data source, queries are distributed to all databases registered in the catalog when the query is run.</span></span> <span data-ttu-id="f47a1-185">Sunucu adları için her bir dağıtım farklı olduğundan, bu başlatma betiği Katalog veritabanı konumunu geçerli sunucu alarak alır (@@servername) komut dosyası yürütüldüğü.</span><span class="sxs-lookup"><span data-stu-id="f47a1-185">Because server names are different for each deployment, this initialization script gets the location of the catalog database by retrieving the current server (@@servername) where the script is executed.</span></span>

    ![Dış veri kaynağı oluşturun](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="f47a1-187">Genel görünümler başvuru dış tablolara önceki bölümde açıklanan ve tanımlanmış **dağıtım SHARDED(VenueId) =**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-187">The external tables that reference the global views described in the previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="f47a1-188">Çünkü her *VenueId* haritalar tek bir veritabanı için bu performansını artırır sonraki bölümde gösterildiği gibi pek çok senaryoyla.</span><span class="sxs-lookup"><span data-stu-id="f47a1-188">Because each *VenueId* maps to a single database, this improves performance for many scenarios as shown in the next section.</span></span>

    ![Dış tabloları oluşturma](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="f47a1-190">Yerel tablo *VenueTypes* oluşturulur ve doldurulur.</span><span class="sxs-lookup"><span data-stu-id="f47a1-190">The local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="f47a1-191">Bu başvuru veri tablosu tüm Kiracı veritabanları ortak olduğundan burada yerel tablo olarak ve ortak verilerle doldurulan gösterilebilir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with the common data.</span></span> <span data-ttu-id="f47a1-192">Bu Kiracı veritabanları arasında taşınması veri miktarını azaltmak bazı sorgular için ve *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="f47a1-192">For some queries this may reduce the amount of data moved between the tenant databases and the *adhocanalytics* database.</span></span>

    ![Tablo oluşturma](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="f47a1-194">Bu şekilde başvuru tabloları eklerseniz, Kiracı veritabanları güncelleştirdiğinizde tablo şemasını ve verileri güncelleştirdiğinizden emin olun.</span><span class="sxs-lookup"><span data-stu-id="f47a1-194">If you include reference tables in this manner, be sure to update the table schema and data whenever you update the tenant databases.</span></span>

4. <span data-ttu-id="f47a1-195">Tuşuna **F5** komut dosyasını çalıştırın ve başlatmak için *adhocanalytics* veritabanı.</span><span class="sxs-lookup"><span data-stu-id="f47a1-195">Press **F5** to run the script and initialize the *adhocanalytics* database.</span></span> 

<span data-ttu-id="f47a1-196">Şimdi dağıtılmış sorgular çalıştırın ve tüm kiracılar arasında görüşleri toplamak!</span><span class="sxs-lookup"><span data-stu-id="f47a1-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="f47a1-197">Dağıtılmış geçici sorguları çalıştırma</span><span class="sxs-lookup"><span data-stu-id="f47a1-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="f47a1-198">Şimdi *adhocanalytics* veritabanı ayarlama, devam edin ve bazı dağıtılmış sorgular çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="f47a1-198">Now that the *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="f47a1-199">Daha iyi sorgu işleme nerede gerçekleştiği anlamak için yürütme planı içerir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-199">Include the execution plan for a better understanding of where the query processing is happening.</span></span> 

<span data-ttu-id="f47a1-200">Yürütme planı incelerken, Ayrıntılar için plan simgeleri üzerine gelerek.</span><span class="sxs-lookup"><span data-stu-id="f47a1-200">When inspecting the execution plan, hover over the plan icons for details.</span></span> 

<span data-ttu-id="f47a1-201">Dikkat edilecek önemli olduğundan, ayar **dağıtım SHARDED(VenueId) =** biz dış veri kaynağına tanımlandığında, çok sayıda senaryoları için performansı geliştirir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-201">Important to note, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined the external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="f47a1-202">Çünkü her *VenueId* eşlemeleri tek bir veritabanı için filtreleme kolayca yapılır uzaktan ihtiyacımız yalnızca veriyor.</span><span class="sxs-lookup"><span data-stu-id="f47a1-202">Because each *VenueId* maps to a single database, filtering is easily done remotely, returning only the data we need.</span></span>

1. <span data-ttu-id="f47a1-203">SSMS’te ...\\Öğrenme Modülleri\\İşlem Analizi\\Geçici Analiz\\*Demo-AdhocAnalyticsQueries.sql* dosyasını açın.</span><span class="sxs-lookup"><span data-stu-id="f47a1-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="f47a1-204">Bağlı olduğunuzdan emin olun **adhocanalytics** veritabanı.</span><span class="sxs-lookup"><span data-stu-id="f47a1-204">Ensure you are connected to the **adhocanalytics** database.</span></span>
3. <span data-ttu-id="f47a1-205">Seçin **sorgu** menüsüne ve ardından **gerçek Execution Plan Ekle**</span><span class="sxs-lookup"><span data-stu-id="f47a1-205">Select the **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="f47a1-206">Vurgula *hangi görebildikleri şu anda kayıtlı olan?* sorgu ve tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-206">Highlight the *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="f47a1-207">Sorgu nasıl hızlı gösteren tüm salonundan listesini döndürür ve onu tüm kiracılar arasında sorgulamak ve her bir kiracı verileri döndürmek için kolaydır.</span><span class="sxs-lookup"><span data-stu-id="f47a1-207">The query returns the entire venue list, illustrating how quick and easy it is to query across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="f47a1-208">Plan inceleyebilir ve geçerli yalnızca her bir kiracı veritabanı için giderek, salonundan bilgi seçme çünkü tüm maliyetini uzak sorgu olduğunu görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="f47a1-208">Inspect the plan and see that the entire cost is the remote query because we're simply going to each tenant database and selecting the venue information.</span></span>

   ![SEÇİN * dbo gelen. Görebildikleri](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="f47a1-210">İleri'yi seçin sorgu ve tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-210">Select the next query, and press **F5**.</span></span>

   <span data-ttu-id="f47a1-211">Bu sorgu Kiracı veritabanları ve yerel verileri birleştirir *VenueTypes* tablosu (olarak yerel bir tablo *adhocanalytics* veritabanı).</span><span class="sxs-lookup"><span data-stu-id="f47a1-211">This query joins data from the tenant databases and the local *VenueTypes* table (local, as its a table in the *adhocanalytics* database).</span></span>

   <span data-ttu-id="f47a1-212">Plan inceleyin ve her bir kiracının salonundan bilgisi (dbo. Biz sorgulamak için maliyet çoğunluğu uzak sorgu olmadığını bakın Görebildikleri) ve yerel ile hızlı yerel bir birleşme yapın *VenueTypes* kolay adını görüntülemek için tablo.</span><span class="sxs-lookup"><span data-stu-id="f47a1-212">Inspect the plan and see that the majority of cost is the remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with the local *VenueTypes* table to display the friendly name.</span></span>

   ![Uzak ve yerel verileri birleştirme](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="f47a1-214">Şimdi seçin *hangi gününde en bilet satış yapıldığını?* sorgu ve tuşuna **F5**.</span><span class="sxs-lookup"><span data-stu-id="f47a1-214">Now select the *On which day were the most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="f47a1-215">Bu sorgu, biraz daha karmaşık birleştirme ve toplama işlemlerini gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="f47a1-216">Dikkat edilecek önemli işlemlerin çoğunu uzaktan yapılır ve yine de geri getirmek biz yalnızca, her salonundan 's toplama bilet satış sayısı her gün için yalnızca tek bir satır döndürme ihtiyacımız satırları ' dir.</span><span class="sxs-lookup"><span data-stu-id="f47a1-216">What's important to note is that most of the processing is done remotely, and once again, we bring back only the rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![sorgu](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="f47a1-218">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="f47a1-218">Next steps</span></span>

<span data-ttu-id="f47a1-219">Bu öğreticide, şunların nasıl yapıldığını öğrendiniz:</span><span class="sxs-lookup"><span data-stu-id="f47a1-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="f47a1-220">Tüm kiracı veritabanlarında dağıtılmış sorguları çalıştırma</span><span class="sxs-lookup"><span data-stu-id="f47a1-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="f47a1-221">Bir geçici analytics veritabanı dağıtmak ve dağıtılmış sorgular çalıştırmak için şema ekleyin.</span><span class="sxs-lookup"><span data-stu-id="f47a1-221">Deploy an ad-hoc analytics database and add schema to it to run distributed queries.</span></span>


<span data-ttu-id="f47a1-222">Şimdi deneyin [Kiracı Analytics öğretici](sql-database-saas-tutorial-tenant-analytics.md) daha karmaşık analitik işleme için ayrı analytics veritabanı ayıklanan verileri araştırmak için...</span><span class="sxs-lookup"><span data-stu-id="f47a1-222">Now try the [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) to explore extracting data to a separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="f47a1-223">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="f47a1-223">Additional resources</span></span>

* <span data-ttu-id="f47a1-224">Ek [Wingtip SaaS uygulamasına yapı öğreticileri](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="f47a1-224">Additional [tutorials that build upon the Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="f47a1-225">Esnek Sorgu</span><span class="sxs-lookup"><span data-stu-id="f47a1-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
