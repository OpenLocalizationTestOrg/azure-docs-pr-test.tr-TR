---
title: "bir Azure Otomasyonu Runbook'tan bir günlük analizi uyarısı aaaCalling | Microsoft Docs"
description: "Bu makalede hakkında genel bakış sağlanmaktadır tooinvoke bir Otomasyon runbook'u Microsoft OMS günlük analizi uyarıdan."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="ec631-103">Bir OMS Log Analytics uyarısından Azure Otomasyonu runbook’u çağırma</span><span class="sxs-lookup"><span data-stu-id="ec631-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="ec631-104">Bir uyarı günlük analizi toocreate yapılandırıldığında sonuçları işlemci kullanımı ya da bir iş uygulaması belirli bir uygulama işlemi kritik toohello işlevselliğini uzun süren bir ani gibi bir belirli ölçütlere uyan varsa bir uyarı kaydı başarısız ve bu uyarı bir Otomasyon runbook'u bir girişim tooauto çalışma otomatik olarak ilgili bir olayın hello Windows olay günlüğüne yazar-hello sorunu düzeltin.</span><span class="sxs-lookup"><span data-stu-id="ec631-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="ec631-105">İki seçenek toocall bir runbook hello uyarı yapılandırma, vardır.</span><span class="sxs-lookup"><span data-stu-id="ec631-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="ec631-106">Daha ayrıntılı belirtmek gerekirse:</span><span class="sxs-lookup"><span data-stu-id="ec631-106">Specifically,</span></span>

1. <span data-ttu-id="ec631-107">Web kancası kullanma.</span><span class="sxs-lookup"><span data-stu-id="ec631-107">Using a Webhook.</span></span>
   * <span data-ttu-id="ec631-108">OMS çalışma alanınızı bağlantılı tooan Otomasyon hesabı değilse hello kullanılabilir tek seçenek budur.</span><span class="sxs-lookup"><span data-stu-id="ec631-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="ec631-109">Bir Otomasyon hesabı bağlı tooan OMS çalışma zaten varsa, bu seçenek kullanılabilir durumda kalır.</span><span class="sxs-lookup"><span data-stu-id="ec631-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="ec631-110">Doğrudan bir runbook seçme.</span><span class="sxs-lookup"><span data-stu-id="ec631-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="ec631-111">Bu seçenek, yalnızca hello OMS çalışma bağlantılı tooan Otomasyon hesabı olduğunda kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="ec631-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="ec631-112">Web kancası kullanarak bir runbook çağırma</span><span class="sxs-lookup"><span data-stu-id="ec631-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="ec631-113">Bir Web kancası toostart belirli bir runbook tek bir HTTP isteği aracılığıyla Azure Otomasyonu'nda sağlar.</span><span class="sxs-lookup"><span data-stu-id="ec631-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="ec631-114">Merhaba yapılandırmadan önce [günlük analizi uyarı](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook bir uyarı eylem, bir Web kancası kullanarak ihtiyacınız olacak toofirst bu yöntemi kullanarak çağrılacağı hello runbook için bir Web kancası oluşturun.</span><span class="sxs-lookup"><span data-stu-id="ec631-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="ec631-115">Gözden geçirin ve hello hello adımları [bir Web kancası oluşturma](automation-webhooks.md#creating-a-webhook) makalesi ve hello uyarı kuralı yapılandırılırken başvurabilmek toorecord hello Web kancası URL'si unutmayın.</span><span class="sxs-lookup"><span data-stu-id="ec631-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="ec631-116">Doğrudan bir runbook çağırma</span><span class="sxs-lookup"><span data-stu-id="ec631-116">Calling a runbook directly</span></span>

<span data-ttu-id="ec631-117">Merhaba Otomasyon sahip & Denetim sunumu yüklü ve hello Runbook eylemleri seçeneği hello uyarı için yapılandırırken, OMS çalışma yapılandırılmış varsa, tüm runbook'lardan hello görüntüleyebilirsiniz **bir runbook seçin** aşağı açılan liste ve yanıt toohello uyarısında toorun istediğiniz hello belirli runbook'u seçin.</span><span class="sxs-lookup"><span data-stu-id="ec631-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="ec631-118">Seçili hello runbook hello Azure Bulut veya karma runbook çalışanı bir çalışma alanında çalışabilir.</span><span class="sxs-lookup"><span data-stu-id="ec631-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="ec631-119">Hello uyarı oluşturulduğunda hello runbook seçeneği kullanılarak, bir Web kancası hello runbook için oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="ec631-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="ec631-120">Toohello Otomasyon hesabı gidin ve seçilen hello runbook'un toohello Web kancası dikey gidin hello Web kancası görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ec631-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="ec631-121">Merhaba uyarı silerseniz, hello Web kancası silinmez, ancak hello kullanıcı hello Web kancası el ile silebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ec631-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="ec631-122">Merhaba Web kancası silinmez, onu bir sorun değildir, yalnızca bir toobe sonunda gerekir yalnız bırakılmış öğesi sipariş toomaintain düzenli bir Otomasyon hesabı silindi.</span><span class="sxs-lookup"><span data-stu-id="ec631-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="ec631-123">Bir runbook’un özellikleri (her iki seçenek için)</span><span class="sxs-lookup"><span data-stu-id="ec631-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="ec631-124">Merhaba günlük analizi uyarıdan hello runbook'u çağırmak için iki yöntem uyarı kurallarını yapılandırmadan önce anladım toobe gereken farklı bir davranış özelliklerine sahiptir.</span><span class="sxs-lookup"><span data-stu-id="ec631-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="ec631-125">**Object** türünde **WebhookData** adlı bir runbook girdi parametreniz olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="ec631-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="ec631-126">Zorunlu veya isteğe bağlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="ec631-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="ec631-127">Bu giriş parametresinin kullanarak hello arama sonuçları toohello runbook'u Hello uyarı geçirir.</span><span class="sxs-lookup"><span data-stu-id="ec631-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="ec631-128">Kod tooconvert hello WebhookData tooa PowerShell nesnesi olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="ec631-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="ec631-129">*$SearchResults* nesnelerinin bir dizisi olacaktır; her nesne bir arama sonucu değerlerle hello alanları içerir</span><span class="sxs-lookup"><span data-stu-id="ec631-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="ec631-130">Merhaba Web kancası seçeneği ve runbook seçeneği arasındaki WebhookData tutarsızlıklar</span><span class="sxs-lookup"><span data-stu-id="ec631-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="ec631-131">Bir uyarı toocall bir Web kancası yapılandırırken, bir runbook için oluşturduğunuz Web kancası URL'si girin ve hello tıklayın **Test Web kancası** düğmesi.</span><span class="sxs-lookup"><span data-stu-id="ec631-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="ec631-132">Merhaba elde edilen WebhookData toohello runbook ya da içermiyor gönderilen *. SearchResult* veya *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="ec631-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="ec631-133">Merhaba uyarı tetikler ve hello Web kancası çağırır olduğunda bu uyarı kaydederseniz, WebhookData gönderilen toohello runbook hello içeren *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="ec631-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="ec631-134">Bir uyarı oluşturmak ve toocall (aynı zamanda bir Web kancası oluşturur) bir runbook yapılandırmak, ne zaman uyarı tetikleyicileri, gönderdiği içeren WebhookData toohello runbook hello *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="ec631-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="ec631-135">Bu nedenle hello kodu yukarıdaki örnekte, tooget ihtiyacınız olacak *. SearchResult* hello uyarı bir Web kancası çağırır ve tooget gerekir *. SearchResults* hello uyarı bir runbook doğrudan çağırırsa.</span><span class="sxs-lookup"><span data-stu-id="ec631-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="ec631-136">Örnek kılavuz</span><span class="sxs-lookup"><span data-stu-id="ec631-136">Example walkthrough</span></span>

<span data-ttu-id="ec631-137">Biz bu bir Windows hizmetini başlatır örnek grafik runbook aşağıdaki hello kullanarak nasıl çalıştığı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="ec631-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Windows Hizmeti Grafiksel Runbook’unu Başlatma](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="ec631-139">Merhaba runbook'da türünde bir giriş parametresi **nesne** çağrılan **WebhookData** ve uyarı hello içeren geçirilen hello Web kancası veriler içeriyorsa *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="ec631-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="ec631-140">![Runbook girdi parametreleri](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="ec631-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="ec631-141">Bu örnek için günlük analizi iki özel alanlar, oluşturduğumuz *SvcDisplayName_CF* ve *SvcState_CF*, tooextract hello hizmet görünen adı ve hello hello hizmetin durumunu (yani çalışıyor veya durdurulmuştur) Merhaba olayından toohello sistem olay günlüğüne yazılır.</span><span class="sxs-lookup"><span data-stu-id="ec631-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="ec631-142">Daha sonra bir uyarı kuralı ile arama sorgusu aşağıdaki hello oluşturuyoruz: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` hello Windows sistem üzerinde hello Yazdırma Biriktiricisi hizmeti durdurulduğunda biz algılayabilmesi.</span><span class="sxs-lookup"><span data-stu-id="ec631-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="ec631-143">İlgilendiğiniz herhangi bir hizmeti olabilir, ancak bu örnek için biz Windows işletim sistemi hello ile birlikte hello önceden varolan hizmetlerden biri başvuruda bulunuyor.</span><span class="sxs-lookup"><span data-stu-id="ec631-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="ec631-144">Merhaba uyarı eylemi yapılandırılmış tooexecute Bu örnekte kullanılan runbook uygulamamız ve hello hedef sistemlerde etkinleştirildiği hello karma Runbook çalışanı üzerinde çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="ec631-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="ec631-145">Merhaba runbook kodunu aktivite **hizmet adından alma LA** hello JSON biçimli dize bir nesne türü ve filtre hello öğesinin içine dönüştürecek *SvcDisplayName_CF* hello tooextract hello görünen adı Windows hizmet ve bunu hangi hello hizmet toorestart denemeden önce durduruldu doğrular hello sonraki etkinliği üzerine geçirmek.</span><span class="sxs-lookup"><span data-stu-id="ec631-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="ec631-146">*SvcDisplayName_CF* olan bir [özel alan](../log-analytics/log-analytics-custom-fields.md) Bu örnek günlük analizi toodemonstrate oluşturulmuş.</span><span class="sxs-lookup"><span data-stu-id="ec631-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="ec631-147">Hello hizmet durduğunda, günlük analizi hello uyarı kuralında bir eşleşme algılar hello runbook tetiklenemedi ve hello uyarı bağlamı toohello runbook gönderin.</span><span class="sxs-lookup"><span data-stu-id="ec631-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="ec631-148">Merhaba runbook eylemini alır ve bu nedenle girişimi toorestart hello hizmeti doğrulamak, kullanmaya doğru ve çıktı hello sonuçları tooverify hello hizmet durduruldu.</span><span class="sxs-lookup"><span data-stu-id="ec631-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="ec631-149">Alternatif olarak Otomasyon hesabı bağlı tooyour OMS çalışma alanınız yoksa, bir Web kancası eylem tootrigger hello runbook'la hello uyarı kuralı yapılandırmak ve hello runbook tooconvert hello JSON biçimli dize ve filtresiniyapılandırmak*. SearchResult* daha önce bahsedilen hello yönergeleri izleyerek.</span><span class="sxs-lookup"><span data-stu-id="ec631-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="ec631-150">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="ec631-150">Next steps</span></span>

* <span data-ttu-id="ec631-151">Günlük analizi uyarılar hakkında daha fazla toolearn ve nasıl toocreate, bkz: [günlük analizi uyarılarını](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="ec631-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="ec631-152">bir Web kancası kullanarak tootrigger runbook'ları nasıl görürüm toounderstand [Azure Otomasyonu Web kancası](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="ec631-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
