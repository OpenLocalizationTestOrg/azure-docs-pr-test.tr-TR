---
title: "Azure uygulama hizmetinde API uygulamaları için hizmet asıl kimlik doğrulaması | Microsoft Docs"
description: "Azure App Service'te API uygulaması hizmet senaryoları için korumayı öğrenin."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 95653287546bbe358111ed16af0c30a53caff2b5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="c9c58-103">Azure uygulama hizmetinde API uygulamaları için hizmet asıl kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="c9c58-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="c9c58-104">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="c9c58-104">Overview</span></span>
<span data-ttu-id="c9c58-105">Bu makalede, App Service kimlik doğrulaması için kullanılacak açıklanmaktadır *iç* API uygulamalara erişim.</span><span class="sxs-lookup"><span data-stu-id="c9c58-105">This article explains how to use App Service authentication for *internal* access to API apps.</span></span> <span data-ttu-id="c9c58-106">Bir iç yalnızca kendi uygulama kodu tarafından tüketilebilir olmasını istediğiniz bir API uygulamasına sahip olduğu bir senaryodur.</span><span class="sxs-lookup"><span data-stu-id="c9c58-106">An internal scenario is where you have an API app that you want to be consumable only by your own application code.</span></span> <span data-ttu-id="c9c58-107">Bu senaryo App Service'te uygulamak için önerilen yol, çağrılan API uygulaması korumak için Azure AD kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-107">The recommended way to implement this scenario in App Service is to use Azure AD to protect the called API app.</span></span> <span data-ttu-id="c9c58-108">Uygulama Kimliği (hizmet sorumlusu) kimlik bilgilerini sağlayarak Azure AD'den alma bir taşıyıcı belirteci ile korumalı API uygulaması çağırın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-108">You call the protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="c9c58-109">Azure AD kullanarak alternatifleri için bkz: **hizmeti için kimlik doğrulama** bölümünü [Azure App Service kimlik doğrulamasına genel bakış](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="c9c58-109">For alternatives to using Azure AD, see the **Service-to-service authentication** section of the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="c9c58-110">Bu makalede, şunları öğreneceksiniz:</span><span class="sxs-lookup"><span data-stu-id="c9c58-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="c9c58-111">Azure Active Directory (Azure AD) bir API uygulamasını kimliği doğrulanmamış erişimden korumak için nasıl kullanılacağını.</span><span class="sxs-lookup"><span data-stu-id="c9c58-111">How to use Azure Active Directory (Azure AD) to protect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="c9c58-112">Azure AD hizmet sorumlusu (uygulama kimliği) kimlik bilgilerini kullanarak JavaScript'ten bir API uygulaması, web uygulaması veya mobil uygulama korumalı bir API uygulaması kullanma yapma.</span><span class="sxs-lookup"><span data-stu-id="c9c58-112">How to consume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="c9c58-113">JavaScript'ten bir mantık uygulaması kullanma hakkında daha fazla bilgi için bkz: [Logic apps ile App Service üzerinde barındırılan özel API'nizi kullanma](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="c9c58-113">For information about how to consume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="c9c58-114">Korumalı API uygulaması oturum açan kullanıcılar tarafından bir tarayıcıdan çağrılamaz emin olmak nasıl.</span><span class="sxs-lookup"><span data-stu-id="c9c58-114">How to make sure that the protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="c9c58-115">Korumalı API uygulaması yalnızca belirli bir Azure tarafından çağrılabilir emin olmak için AD hizmeti nasıl sorumlu.</span><span class="sxs-lookup"><span data-stu-id="c9c58-115">How to make sure that the protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="c9c58-116">Makale iki bölüm içerir:</span><span class="sxs-lookup"><span data-stu-id="c9c58-116">The article contains two sections:</span></span>

* <span data-ttu-id="c9c58-117">[Azure App Service'te hizmet asıl kimlik doğrulaması yapılandırma konusunda](#authconfig) bölümde açıklanmıştır Genel API uygulaması için kimlik doğrulaması yapılandırma ve korumalı API uygulaması kullanma.</span><span class="sxs-lookup"><span data-stu-id="c9c58-117">The [How to configure service principal authentication in Azure App Service](#authconfig) section explains in general how to configure authentication for any API app, and how to consume the protected API app.</span></span> <span data-ttu-id="c9c58-118">Bu bölümde, .NET, Node.js ve Java dahil App Service tarafından desteklenen tüm çerçeveler için eşit oranda geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-118">This section applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="c9c58-119">İle başlayarak [.NET kullanmaya Başlarken öğreticilerine devam etme](#tutorialstart) bölümünde, öğreticiyi kılavuzları, App Service içinde çalışan .NET örnek uygulaması için bir "iç erişim" senaryosu yapılandırılırken aracılığıyla.</span><span class="sxs-lookup"><span data-stu-id="c9c58-119">Starting with the [Continuing the .NET getting-started tutorials](#tutorialstart) section, the tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="c9c58-120"><a id="authconfig"></a>Azure App Service'te hizmet asıl kimlik doğrulamasını yapılandırma</span><span class="sxs-lookup"><span data-stu-id="c9c58-120"><a id="authconfig"></a> How to configure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="c9c58-121">Bu bölümde, tüm API uygulamaları için geçerli olan genel yönergeleri sağlar.</span><span class="sxs-lookup"><span data-stu-id="c9c58-121">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="c9c58-122">Adımları belirli yapmak listesi .NET örnek uygulaması, Git [.NET API uygulamaları öğretici serisi etmeden](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="c9c58-122">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="c9c58-123">İçinde [Azure portal](https://portal.azure.com/), gitmek **ayarları** korumak ve ardından bulmak istediğiniz API uygulaması dikey **özellikleri** 'ye tıklayın  **Kimlik doğrulama / yetkilendirme**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-123">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, and then find the **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme Azure portalında](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="c9c58-125">İçinde **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **üzerinde**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-125">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="c9c58-126">İçinde **isteğin kimliği doğrulanmamış olduğunda gerçekleştirilecek eylem** aşağı açılan listesinden, **Azure Active Directory ile oturum aç** .</span><span class="sxs-lookup"><span data-stu-id="c9c58-126">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="c9c58-127">Altında **kimlik doğrulama sağlayıcıları**seçin **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme dikey Azure portalında](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="c9c58-129">Yapılandırma **Azure Active Directory ayarları** dikey yeni bir Azure AD uygulaması veya kullanmak istediğiniz bir zaten varsa, bir var olan bir Azure AD uygulaması kullanın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-129">Configure the **Azure Active Directory Settings** blade to create a new Azure AD application, or use an existing Azure AD application if you already have one that you want to use.</span></span>
   
    <span data-ttu-id="c9c58-130">İç senaryoları genellikle bir API uygulamasını çağıran bir API uygulaması içerir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="c9c58-131">Ayrı Azure kullanabileceğiniz her API uygulaması için AD uygulamaları ya da tek bir Azure AD uygulaması.</span><span class="sxs-lookup"><span data-stu-id="c9c58-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="c9c58-132">Bu dikey hakkında ayrıntılı yönergeler için bkz: [uygulama hizmeti uygulamanızı Azure Active Directory oturum açma kullanacak şekilde yapılandırmak nasıl](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="c9c58-132">For detailed instructions on this blade, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="c9c58-133">Kimlik doğrulama sağlayıcısı yapılandırma dikey bittiğinde, tıklatın **Tamam**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-133">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="c9c58-134">İçinde **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-134">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="c9c58-136">Bu yapıldığında, uygulama hizmeti yalnızca istekleri Gelen yapılandırılmış içinde arayanlara izin veren Azure AD kiracısı.</span><span class="sxs-lookup"><span data-stu-id="c9c58-136">When this is done, App Service only allows requests from callers in the configured Azure AD tenant.</span></span> <span data-ttu-id="c9c58-137">Hiçbir kimlik doğrulama veya yetkilendirme kodu korumalı bir API uygulaması gereklidir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-137">No authentication or authorization code is required in the protected API app.</span></span> <span data-ttu-id="c9c58-138">Taşıyıcı belirteci genellikle birlikte API uygulaması için kullanılan HTTP üstbilgilerinin Taleplerde geçirilir ve bir hizmet sorumlusu gibi belirli bir çağıran gelen istekleri olduğunu doğrulamak için kodu, bu bilgileri okuyabilir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-138">The bearer token is passed to the API app along with commonly used claims in HTTP headers, and you can read that information in code to validate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="c9c58-139">Bu kimlik doğrulama işlev .NET, Node.js ve Java dahil olmak üzere uygulama hizmetini destekleyen tüm diller için aynı şekilde çalışır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-139">This authentication functionality works the same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-to-consume-the-protected-api-app"></a><span data-ttu-id="c9c58-140">Korumalı API uygulaması kullanma</span><span class="sxs-lookup"><span data-stu-id="c9c58-140">How to consume the protected API app</span></span>
<span data-ttu-id="c9c58-141">Çağıran bir Azure AD taşıyıcı belirteci ile API çağrıları sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-141">The caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="c9c58-142">Hizmet asıl kimlik bilgilerini kullanarak bir taşıyıcı belirteci almak için Active Directory kimlik doğrulama kitaplığı çağıran kullanır (için ADAL [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), veya [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="c9c58-142">To get a bearer token using service principal credentials, the caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="c9c58-143">Bir belirteç almak üzere ADAL çağıran kodu ADAL için aşağıdaki bilgileri sağlar:</span><span class="sxs-lookup"><span data-stu-id="c9c58-143">To get a token, the code that calls ADAL provides to ADAL the following information:</span></span>

* <span data-ttu-id="c9c58-144">Azure AD kiracınızın adıdır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-144">The name of your Azure AD tenant.</span></span>
* <span data-ttu-id="c9c58-145">İstemci kimliği ve arayanla ilişkili Azure AD uygulamasının istemci parolası (uygulama anahtarı).</span><span class="sxs-lookup"><span data-stu-id="c9c58-145">The client ID and client secret (app key) of the Azure AD app associated with the caller.</span></span>
* <span data-ttu-id="c9c58-146">Korumalı API uygulaması ile ilişkili Azure AD uygulamasının istemci kimliği.</span><span class="sxs-lookup"><span data-stu-id="c9c58-146">The client ID of the Azure AD application associated with the protected API app.</span></span> <span data-ttu-id="c9c58-147">(Yalnızca bir Azure AD uygulaması kullandıysanız, çağıran için aynı istemci Kimliğine budur.)</span><span class="sxs-lookup"><span data-stu-id="c9c58-147">(If just one Azure AD application is used, this is the same client ID as the one for the caller.)</span></span>

<span data-ttu-id="c9c58-148">Bu değerler Azure AD sayfalarını kullanılabilir [Klasik Azure portalı](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="c9c58-148">These values are available in the Azure AD pages of the [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="c9c58-149">Belirteci aldıktan sonra çağrıyı yapan, HTTP isteklerini yetkilendirme üst içerir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-149">Once the token has been acquired, the caller includes it with HTTP requests in the Authorization header.</span></span>  <span data-ttu-id="c9c58-150">Uygulama hizmeti, belirteci doğrular ve korumalı API uygulamasına erişmek isteklere izin verir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-150">App Service validates the token and allows the requests to reach the protected API app.</span></span>

#### <a name="how-to-protect-the-api-app-from-access-by-users-in-the-same-tenant"></a><span data-ttu-id="c9c58-151">API uygulaması aynı Kiracı kullanıcılar tarafından erişimden korumak nasıl</span><span class="sxs-lookup"><span data-stu-id="c9c58-151">How to protect the API app from access by users in the same tenant</span></span>
<span data-ttu-id="c9c58-152">Taşıyıcı belirteçlerini aynı Kiracı kullanıcılar için korumalı API uygulaması için geçerli olarak kabul edilir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-152">Bearer tokens for users in the same tenant are considered valid for the protected API app.</span></span>  <span data-ttu-id="c9c58-153">Yalnızca bir hizmet sorumlusu korumalı API uygulaması çağırabilirsiniz emin olmak istiyorsanız, aşağıdaki talepleri belirteci doğrulamak için korumalı API uygulamasında kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="c9c58-153">If you want to ensure that only a service principal can call the protected API app, add code in the protected API app to validate the following claims from the token:</span></span>

* <span data-ttu-id="c9c58-154">`appid`arayanla ilişkili Azure AD uygulamasının istemci kimliği olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-154">`appid` should be the client ID of the Azure AD application that is associated with the caller.</span></span> 
* <span data-ttu-id="c9c58-155">`oid`(`objectidentifier`) arayan hizmet asıl kimliği olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-155">`oid` (`objectidentifier`) should be the service principal ID of the caller.</span></span> 

<span data-ttu-id="c9c58-156">Uygulama hizmeti de sağlar `objectidentifier` X-MS-CLIENT-PRINCIPAL-ID üstbilgisinde talep.</span><span class="sxs-lookup"><span data-stu-id="c9c58-156">App Service also provides the `objectidentifier` claim in the X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-to-protect-the-api-app-from-browser-access"></a><span data-ttu-id="c9c58-157">API uygulaması tarayıcı erişime karşı korumak nasıl</span><span class="sxs-lookup"><span data-stu-id="c9c58-157">How to protect the API app from browser access</span></span>
<span data-ttu-id="c9c58-158">Korumalı API uygulama kodunda Taleplerde doğrulamaz ve ayrı bir kullanırsanız, korumalı API uygulaması için Azure AD uygulaması Azure AD uygulama yanıt URL'si API uygulamasının temel URL'si ile aynı olmadığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="c9c58-158">If you don't validate claims in code in the protected API app, and if you use a separate Azure AD application for the protected API app, make sure that the Azure AD application's Reply URL is not the same as the API app's base URL.</span></span> <span data-ttu-id="c9c58-159">Yanıt URL'si korumalı API uygulamasına doğrudan işaret ediyorsa, bir kullanıcı aynı Azure AD kiracısı, API uygulamasına göz atın, oturum açın ve başarıyla API çağrısı.</span><span class="sxs-lookup"><span data-stu-id="c9c58-159">If the Reply URL points directly to the protected API app, a user in the same Azure AD tenant could browse to the API app, log on, and successfully call the API.</span></span>

## <span data-ttu-id="c9c58-160"><a id="tutorialstart"></a>.NET API uygulamaları öğretici serisi etmeden</span><span class="sxs-lookup"><span data-stu-id="c9c58-160"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorial series</span></span>
<span data-ttu-id="c9c58-161">API uygulamaları için Node.js ve Java öğretici serisi izliyorsanız, geçin [sonraki adımlar](#next-steps) bölümü.</span><span class="sxs-lookup"><span data-stu-id="c9c58-161">If you are following the Node.js or Java tutorial series for API apps, skip to the [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="c9c58-162">Bu makalenin sonraki bölümlerinde .NET API uygulamaları öğretici serisi devam eder ve, tamamladığınızı varsaymaktadır [kullanıcı kimlik doğrulaması öğretici](app-service-api-dotnet-user-principal-auth.md) ve kullanıcı kimlik doğrulaması etkin Azure'da çalışan örnek uygulama.</span><span class="sxs-lookup"><span data-stu-id="c9c58-162">The remainder of this article continues the .NET API Apps tutorial series and assumes that you have completed the [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have the sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="c9c58-163">Azure kimlik doğrulaması ayarlama</span><span class="sxs-lookup"><span data-stu-id="c9c58-163">Set up authentication in Azure</span></span>
<span data-ttu-id="c9c58-164">Bu bölümde sağlayan veri katmanı API uygulaması ulaşmak için yalnızca HTTP isteklerini geçerli Azure sahip olanları; böylece uygulama hizmeti yapılandırma AD taşıyıcı belirteçlerini.</span><span class="sxs-lookup"><span data-stu-id="c9c58-164">In this section you configure App Service so that the only HTTP requests it allows to reach the data tier API app are the ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="c9c58-165">Aşağıdaki bölümde, orta katman API uygulaması için Azure AD uygulama kimlik bilgilerini göndermek, bir taşıyıcı belirteç geri almak ve veri katmanı API uygulaması taşıyıcı belirteci göndermek için yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-165">In the following section, you configure the middle tier API app to send application credentials to Azure AD, get back a bearer token, and send the bearer token to the data tier API app.</span></span> <span data-ttu-id="c9c58-166">Bu işlem aşağıdaki çizimde gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-166">This process is illustrated in the diagram.</span></span>

![Hizmet kimlik doğrulama diyagramı](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="c9c58-168">Öğretici yönergeleri izleyerek çalışırken sorunlarla karşılaşırsanız, bkz: [sorun giderme](#troubleshooting) öğreticinin sonunda bölüm.</span><span class="sxs-lookup"><span data-stu-id="c9c58-168">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

1. <span data-ttu-id="c9c58-169">İçinde [Azure portal](https://portal.azure.com/), gitmek **ayarları** Todolistdataapı (veri katman) API uygulaması için oluşturduğunuz ve ardından API uygulaması dikey **ayarları**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-169">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="c9c58-170">İçinde **ayarları** dikey penceresinde Bul **özellikleri** bölümünde ve ardından **kimlik doğrulama / yetkilendirme**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-170">In the **Settings** blade, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme Azure portalında](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="c9c58-172">İçinde **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **üzerinde**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-172">In the **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="c9c58-173">İçinde **isteğin kimliği doğrulanmamış olduğunda gerçekleştirilecek eylem** aşağı açılan listesinden, **Azure Active Directory ile oturum aç**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-173">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="c9c58-174">Uygulama emin olmak, yalnızca istekleri ulaşma API uygulamasını kimliği doğrulanmış hizmeti neden olan ayar budur.</span><span class="sxs-lookup"><span data-stu-id="c9c58-174">This is the setting that causes App Service to ensure that only authenticated requests reach the API app.</span></span> <span data-ttu-id="c9c58-175">Geçerli taşıyıcı belirteçlerini olan istekler için uygulama hizmeti boyunca belirteçleri API uygulamasına aktarır ve HTTP üstbilgileri bu bilgileri kodunuzu daha kolay kullanılabilir hale getirmek için yaygın olarak kullanılan talepleri ile doldurur.</span><span class="sxs-lookup"><span data-stu-id="c9c58-175">For requests that have valid bearer tokens, App Service passes the tokens along to the API app and populates HTTP headers with commonly used claims to make that information more easily available to your code.</span></span>
5. <span data-ttu-id="c9c58-176">Altında **kimlik doğrulama sağlayıcıları**, tıklatın **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme dikey Azure portalında](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="c9c58-178">İçinde **Azure Active Directory ayarları** dikey penceresinde tıklatın **Express**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-178">In the **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="c9c58-179">İle **Express** seçeneği Azure otomatik olarak Azure AD içinde bir AAD uygulaması oluşturabilir [Kiracı](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="c9c58-179">With the **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="c9c58-180">Her Azure hesabı otomatik olarak bir tane var olduğundan, Kiracı oluşturmanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="c9c58-180">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="c9c58-181">Altında **yönetim modu**, tıklatın **yeni AD uygulaması oluştur** zaten seçili değilse.</span><span class="sxs-lookup"><span data-stu-id="c9c58-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="c9c58-182">Portal takılan **oluşturma uygulama** giriş kutusuna bir varsayılan değere sahip.</span><span class="sxs-lookup"><span data-stu-id="c9c58-182">The portal plugs the **Create App** input box with a default value.</span></span> <span data-ttu-id="c9c58-183">Varsayılan olarak, Azure AD uygulaması aynı API uygulaması olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-183">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="c9c58-184">İsterseniz, farklı bir ad girebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c9c58-184">If you prefer, you can enter a different name.</span></span>
   
    ![Azure AD ayarları](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="c9c58-186">**Not**: alternatif olarak, tek bir Azure AD kullanabilir arama API uygulaması hem de korumalı API uygulaması için uygulama.</span><span class="sxs-lookup"><span data-stu-id="c9c58-186">**Note**: As an alternative, you could use a single Azure AD application for both the calling API app and the protected API app.</span></span> <span data-ttu-id="c9c58-187">Bu alternatif seçerseniz, ihtiyacınız olmayan **yeni AD uygulaması oluştur** Azure AD uygulaması kullanıcı kimlik doğrulaması öğreticide daha önce zaten oluşturulduğundan burada seçeneği.</span><span class="sxs-lookup"><span data-stu-id="c9c58-187">If you chose that alternative, you would not need the **Create New AD App** option here because you already created an Azure AD application earlier in the user authentication tutorial.</span></span> <span data-ttu-id="c9c58-188">Bu öğretici için kullanacağınız arama API uygulaması ve korumalı API uygulaması için Azure AD uygulamaları ayırın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-188">For this tutorial, you'll use separate Azure AD applications for the calling API app and the protected API app.</span></span>
8. <span data-ttu-id="c9c58-189">İçinde değeri Not **oluşturma uygulama** giriş kutusu; bu AAD uygulamasını Klasik Azure portalındaki daha sonra göreceğiz.</span><span class="sxs-lookup"><span data-stu-id="c9c58-189">Make a note of the value that is in the **Create App** input box; you'll look up this AAD application in the Azure classic portal later.</span></span>
9. <span data-ttu-id="c9c58-190">**Tamam** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-190">Click **OK**.</span></span>
10. <span data-ttu-id="c9c58-191">İçinde **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-191">In the **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="c9c58-193">Uygulama hizmeti ile bir Azure Active Directory uygulaması oluşturur **oturum açma URL'si** ve **yanıt URL'si** otomatik olarak API uygulamanızın URL'sine ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set to the URL of your API app.</span></span> <span data-ttu-id="c9c58-194">İkinci değer, kullanıcıların oturum açma ve API uygulamasına erişmek için AAD kiracınızda sağlar.</span><span class="sxs-lookup"><span data-stu-id="c9c58-194">The latter value enables users in your AAD tenant to log in and access the API app.</span></span>

### <a name="verify-that-the-api-app-is-protected"></a><span data-ttu-id="c9c58-195">API uygulaması korunduğunu doğrulayın</span><span class="sxs-lookup"><span data-stu-id="c9c58-195">Verify that the API app is protected</span></span>
1. <span data-ttu-id="c9c58-196">Bir tarayıcıda API uygulamasının URL'sine gidin: içinde **API uygulaması** dikey Azure portalında tıklayın altındaki bağlantı **URL**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-196">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span> 
   
    <span data-ttu-id="c9c58-197">Kimliği doğrulanmamış istekler API uygulamasına erişmesine izin verilmediği için oturum açma ekranına yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-197">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span> 
   
    <span data-ttu-id="c9c58-198">Tarayıcınız Swagger kullanıcı arabirimini giderseniz, tarayıcınızı zaten oturum açmış olabilirsiniz--bu durumda, bir InPrivate veya Incognito penceresi açın ve Swagger kullanıcı Arabirimi URL'sine gidin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-198">If your browser does go to the Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the Swagger UI URL.</span></span>
2. <span data-ttu-id="c9c58-199">AAD kiracınızda bir kullanıcının kimlik bilgileriyle oturum açın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="c9c58-200">Oturum açtınız, tarayıcıda "başarıyla oluşturuldu" sayfası görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-200">When you're logged on, the "successfully created" page appears in the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="c9c58-201">Todolistapı projesi edinmeli ve Azure AD belirteci göndermek için yapılandırma</span><span class="sxs-lookup"><span data-stu-id="c9c58-201">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="c9c58-202">Bu bölümde aşağıdaki görevleri yapın:</span><span class="sxs-lookup"><span data-stu-id="c9c58-202">In this section you do the following tasks:</span></span>

* <span data-ttu-id="c9c58-203">Bir belirteç almak ve veri katmanı API uygulaması ile HTTP istekleri göndermek için Azure AD uygulama kimlik bilgilerini kullanan Orta katman API uygulamasında kodu ekleyin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-203">Add code in the middle tier API app that uses Azure AD application credentials to acquire a token and send it with HTTP requests to the data tier API app.</span></span>
* <span data-ttu-id="c9c58-204">Gereksinim duyduğunuz kimlik bilgileri, Azure AD'den alın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-204">Get the credentials you need from Azure AD.</span></span>
* <span data-ttu-id="c9c58-205">Azure uygulama hizmeti çalışma zamanı ortamı orta katman API uygulaması ayarlarında içine kimlik bilgilerini girin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-205">Enter the credentials into Azure App Service runtime environment settings in the middle tier API app.</span></span> 

### <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="c9c58-206">Todolistapı projesi edinmeli ve Azure AD belirteci göndermek için yapılandırma</span><span class="sxs-lookup"><span data-stu-id="c9c58-206">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="c9c58-207">Visual Studio Todolistapı projesinde aşağıdaki değişiklikleri yapın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-207">Make the following changes in the ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="c9c58-208">Tüm kod açıklamadan çıkarın *ServicePrincipal.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="c9c58-208">Uncomment all of the code in the *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="c9c58-209">Bu Azure AD taşıyıcı belirtecini almak için .NET için ADAL kullanan koddur.</span><span class="sxs-lookup"><span data-stu-id="c9c58-209">This is the code that uses ADAL for .NET to acquire the Azure AD bearer token.</span></span>  <span data-ttu-id="c9c58-210">Daha sonra Azure çalışma zamanı ortamında ayarlarız birkaç yapılandırma değerlerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-210">It uses several configuration values that you'll set in the Azure runtime environment later.</span></span> <span data-ttu-id="c9c58-211">Kod aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="c9c58-211">Here's the code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="c9c58-212">**Not:** hangi projede zaten yüklüyse, .NET NuGet paketi (Microsoft.IdentityModel.Clients.activedirectory tarafından) için ADAL bu kodu gerektirir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-212">**Note:** This code requires the ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in the project.</span></span> <span data-ttu-id="c9c58-213">Bu proje sıfırdan oluşturuyorsanız, bu paketi yüklemek gerekir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-213">If you were creating this project from scratch, you would have to install this package.</span></span> <span data-ttu-id="c9c58-214">Bu paket API uygulaması yeni proje şablonu tarafından otomatik olarak yüklenmez.</span><span class="sxs-lookup"><span data-stu-id="c9c58-214">This package is not automatically installed by the API app new-project template.</span></span>
2. <span data-ttu-id="c9c58-215">İçinde *denetleyicileri/ToDoListController*, kodda açıklamadan çıkarın `NewDataAPIClient` HTTP belirteç ekler yöntemi yetkilendirme üst bilgi ister.</span><span class="sxs-lookup"><span data-stu-id="c9c58-215">In *Controllers/ToDoListController*, uncomment the code in the `NewDataAPIClient` method that adds the token to HTTP requests in the authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="c9c58-216">Todolistapı projesine dağıtın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-216">Deploy the ToDoListAPI project.</span></span> <span data-ttu-id="c9c58-217">(Projeye sağ tıklayın ve ardından **Publish > Publish**.)</span><span class="sxs-lookup"><span data-stu-id="c9c58-217">(Right-click the project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="c9c58-218">Visual Studio projesini dağıtır ve web uygulamanızın temel URL'sini bir tarayıcı penceresinde açar.</span><span class="sxs-lookup"><span data-stu-id="c9c58-218">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="c9c58-219">Bu bir Web API temel URL'yi bir tarayıcı üzerinden Git girişimi için normal bir 403 hata sayfası gösterilir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-219">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
4. <span data-ttu-id="c9c58-220">Tarayıcıyı kapatın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-220">Close the browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="c9c58-221">Azure AD yapılandırma değerlerini alma</span><span class="sxs-lookup"><span data-stu-id="c9c58-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="c9c58-222">İçinde [Klasik Azure portalı](https://manage.windowsazure.com/)gidin **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-222">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
2. <span data-ttu-id="c9c58-223">Üzerinde **Directory** sekmesinde, AAD kiracınızın tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-223">On the **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="c9c58-224">Tıklatın **uygulamaları > Şirketimin sahip olduğu uygulamalar**ve ardından onay işaretine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-224">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
4. <span data-ttu-id="c9c58-225">Uygulamalar listesinde Todolistdataapı (veri katman) API uygulaması için kimlik doğrulaması etkinleştirildiğinde, Azure oluşturduğunuz birinin adına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-225">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for the ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="c9c58-226">**Configure (Yapılandır)** sekmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-226">Click the **Configure** tab.</span></span>
6. <span data-ttu-id="c9c58-227">Kopya **istemci kimliği** değer ve nedenini bildirmeden bir yerde alabilirsiniz ondan daha sonra kaydedin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-227">Copy the **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="c9c58-228">Azure Klasik portalı Git geri listesini **Şirketimin sahip olduğu uygulamalar**ve (önceki öğreticide oluşturduğunuz, bir değil, oluşturduğunuz bir orta katman Todolistapı API uygulaması için oluşturduğunuz AAD uygulama'yı tıklatın Bu öğreticide).</span><span class="sxs-lookup"><span data-stu-id="c9c58-228">In the Azure classic portal go back to the list of **Applications my company owns**, and click the AAD application that you created for the middle tier ToDoListAPI API app (the one you created in the previous tutorial, not the one you created in this tutorial).</span></span>
8. <span data-ttu-id="c9c58-229">**Configure (Yapılandır)** sekmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-229">Click the **Configure** tab.</span></span>
9. <span data-ttu-id="c9c58-230">Kopya **istemci kimliği** değer ve nedenini bildirmeden bir yerde alabilirsiniz ondan daha sonra kaydedin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-230">Copy the **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="c9c58-231">Altında **anahtarları**seçin **1 yıl** gelen **seçin süresi** aşağı açılan liste.</span><span class="sxs-lookup"><span data-stu-id="c9c58-231">Under **keys**, select **1 year** from the **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="c9c58-232">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-232">Click **Save**.</span></span>
    
     ![Uygulama anahtarı oluştur](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="c9c58-234">Anahtar değerini kopyalayın ve nedenini bildirmeden bir yerde ondan daha sonra alabilirsiniz kaydedin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-234">Copy the key value and save it someplace you can get it from later.</span></span>
    
     ![Yeni uygulama anahtarı kopyalayın](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-the-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="c9c58-236">Orta katman API uygulamanın çalışma zamanı ortamında Azure AD ayarları yapılandırma</span><span class="sxs-lookup"><span data-stu-id="c9c58-236">Configure Azure AD settings in the middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="c9c58-237">Git [Azure portal](https://portal.azure.com/)ve ardından gidin **API uygulaması** dikey penceresinde Todolistapı (orta katman) projesini barındıran API uygulaması için.</span><span class="sxs-lookup"><span data-stu-id="c9c58-237">Go to the [Azure portal](https://portal.azure.com/), and then navigate to the **API App** blade for the API app that hosts the TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="c9c58-238">**Ayarlar > Uygulama Ayarları**’na tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="c9c58-239">İçinde **uygulama ayarları** bölümünde, aşağıdaki anahtarları ve değerleri ekleyin:</span><span class="sxs-lookup"><span data-stu-id="c9c58-239">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="c9c58-240">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="c9c58-240">**Key**</span></span> | <span data-ttu-id="c9c58-241">IDA: yetkilisi</span><span class="sxs-lookup"><span data-stu-id="c9c58-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="c9c58-242">**Değer**</span><span class="sxs-lookup"><span data-stu-id="c9c58-242">**Value**</span></span> |<span data-ttu-id="c9c58-243">https://Login.microsoftonline.com/ {Azure AD Kiracı adınızı}</span><span class="sxs-lookup"><span data-stu-id="c9c58-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="c9c58-244">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="c9c58-244">**Example**</span></span> |<span data-ttu-id="c9c58-245">https://Login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="c9c58-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="c9c58-246">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="c9c58-246">**Key**</span></span> | <span data-ttu-id="c9c58-247">IDA: ClientID</span><span class="sxs-lookup"><span data-stu-id="c9c58-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="c9c58-248">**Değer**</span><span class="sxs-lookup"><span data-stu-id="c9c58-248">**Value**</span></span> |<span data-ttu-id="c9c58-249">Arama (orta katman - Todolistapı) uygulamasının istemci kimliği</span><span class="sxs-lookup"><span data-stu-id="c9c58-249">Client ID of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="c9c58-250">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="c9c58-250">**Example**</span></span> |<span data-ttu-id="c9c58-251">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="c9c58-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="c9c58-252">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="c9c58-252">**Key**</span></span> | <span data-ttu-id="c9c58-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="c9c58-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="c9c58-254">**Değer**</span><span class="sxs-lookup"><span data-stu-id="c9c58-254">**Value**</span></span> |<span data-ttu-id="c9c58-255">Uygulama anahtarı çağıran uygulamanın (orta katman - Todolistapı)</span><span class="sxs-lookup"><span data-stu-id="c9c58-255">App key of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="c9c58-256">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="c9c58-256">**Example**</span></span> |<span data-ttu-id="c9c58-257">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="c9c58-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="c9c58-258">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="c9c58-258">**Key**</span></span> | <span data-ttu-id="c9c58-259">IDA: kaynak</span><span class="sxs-lookup"><span data-stu-id="c9c58-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="c9c58-260">**Değer**</span><span class="sxs-lookup"><span data-stu-id="c9c58-260">**Value**</span></span> |<span data-ttu-id="c9c58-261">Çağrılan uygulamasının istemci kimliği (veri katmanı - Todolistdataapı)</span><span class="sxs-lookup"><span data-stu-id="c9c58-261">Client ID of the called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="c9c58-262">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="c9c58-262">**Example**</span></span> |<span data-ttu-id="c9c58-263">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="c9c58-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="c9c58-264">**Not**: için `ida:Resource`, çağrılan uygulamanın kullandığınızdan emin olun **istemci kimliği** ve kendi **uygulama kimliği URI'si**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-264">**Note**: For `ida:Resource`, make sure you use the called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="c9c58-265">`ida:ClientId`ve `ida:Resource` farklı değerleri Bu öğretici için kullandığınız olduğundan veri katmanı ve orta katman için Azure AD applicaations ayırın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for the middle tier and data tier.</span></span> <span data-ttu-id="c9c58-266">Tek bir kullanıyorsanız Azure AD uygulaması arama API uygulaması ve korumalı API uygulaması için aynı değere hem de kullanacağınız `ida:ClientId` ve `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="c9c58-266">If you were using a single Azure AD application for the calling API app and the protected API app, you would use the same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="c9c58-267">Kod ConfigurationManager projenin Web.config dosyasında veya Azure çalışma zamanı ortamı depolanabilir şekilde bu değerleri almak için kullanır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-267">The code uses ConfigurationManager to get these values, so they could be stored in the project's Web.config file or in the Azure runtime environment.</span></span> <span data-ttu-id="c9c58-268">Azure App Service'te bir ASP.NET uygulaması çalışırken, ortam ayarları otomatik olarak Web.config ayarları geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="c9c58-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config.</span></span> <span data-ttu-id="c9c58-269">Ortam ayarları olan genellikle bir [Web.config dosyasına karşılaştırıldığında hassas bilgileri depolamak için yol'daha güvenli](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="c9c58-269">Environment settings are generally a [more secure way to store sensitive information compared to a Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="c9c58-270">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-270">Click **Save**.</span></span>
   
    ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-the-application"></a><span data-ttu-id="c9c58-272">Uygulamayı test etme</span><span class="sxs-lookup"><span data-stu-id="c9c58-272">Test the application</span></span>
1. <span data-ttu-id="c9c58-273">AngularJS ön uç web uygulamasının HTTPS URL'sini bir tarayıcıda gidin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-273">In a browser go to the HTTPS URL of the AngularJS front end web app.</span></span>
2. <span data-ttu-id="c9c58-274">Tıklatın **Yapılacaklar listesi** sekmesi ve Azure AD kiracınızda bir kullanıcının kimlik bilgilerini oturum.</span><span class="sxs-lookup"><span data-stu-id="c9c58-274">Click the **To Do List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="c9c58-275">Uygulamanın çalıştığını doğrulamak için yapılacaklar öğelerini ekleyin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-275">Add to-do items to verify that the application is working.</span></span>
   
    ![Sayfa, yapılacaklar listesi](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="c9c58-277">Uygulamanın beklendiği gibi çalışmazsa, Azure portalında girdiğiniz tüm ayarları denetleyin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-277">If the application doesn't work as expected, double-check all of the settings you entered in the Azure portal.</span></span> <span data-ttu-id="c9c58-278">Tüm ayarlar doğru görünüyorsa, bkz: [sorun giderme](#troubleshooting) Bu öğreticinin ilerleyen bölümlerinde.</span><span class="sxs-lookup"><span data-stu-id="c9c58-278">If all of the settings appear to be correct, see the [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-the-api-app-from-browser-access"></a><span data-ttu-id="c9c58-279">API uygulaması tarayıcı erişime karşı koruyun</span><span class="sxs-lookup"><span data-stu-id="c9c58-279">Protect the API app from browser access</span></span>
<span data-ttu-id="c9c58-280">Bu öğretici için oluşturduğunuz ayrı bir Todolistdataapı (veri katman) API uygulaması için Azure AD uygulaması.</span><span class="sxs-lookup"><span data-stu-id="c9c58-280">For this tutorial you created a separate Azure AD application for the ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="c9c58-281">Uygulama hizmeti bir AAD uygulaması oluşturduğunda, gördüğünüz gibi AAD uygulaması bir tarayıcıda API uygulamasının URL'sine gidin ve oturum açmak kullanıcının sağlayan bir şekilde yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-281">As you've seen, when App Service creates an AAD application, it configures the AAD application in a way that enables a user to go to the API app's URL in a browser and log on.</span></span> <span data-ttu-id="c9c58-282">Bir son kullanıcı, API erişmek için Azure AD kiracınız, yalnızca bir hizmet sorumlusu, mümkündür anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-282">That means it's possible for an end user in your Azure AD tenant, not just a service principal, to access the API.</span></span> 

<span data-ttu-id="c9c58-283">Korumalı bir API uygulaması hiçbir kod yazmadan tarayıcı erişimi engellemek isterseniz değiştirebileceğiniz **yanıt URL'si** AAD uygulamada ana URL böylece API uygulamasının farklı.</span><span class="sxs-lookup"><span data-stu-id="c9c58-283">If you want to prevent browser access without writing any code in the protected API app, you can change the **Reply URL** in the AAD application so that it's different from the API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="c9c58-284">Tarayıcı erişimini devre dışı bırakma</span><span class="sxs-lookup"><span data-stu-id="c9c58-284">Disable browser access</span></span>
1. <span data-ttu-id="c9c58-285">Klasik portalın içinde **yapılandırma** sekmesinde TodoListService için oluşturulmuş AAD uygulama için değeri değiştirin **yanıt URL'si** böylece geçerli bir URL ancak API uygulamasının URL değil olan alan.</span><span class="sxs-lookup"><span data-stu-id="c9c58-285">In the classic portal's **Configure** tab for the AAD application that was created for the TodoListService, change the value in the **Reply URL** field so that it is a valid URL but not the API app's URL.</span></span>
2. <span data-ttu-id="c9c58-286">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-286">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="c9c58-287">Tarayıcı erişimi artık çalıştığını doğrulayın</span><span class="sxs-lookup"><span data-stu-id="c9c58-287">Verify browser access no longer works</span></span>
<span data-ttu-id="c9c58-288">Daha önce API uygulaması URL'sini bir tarayıcı üzerinden tek bir kullanıcının kimlik bilgileriyle oturum açarak gidebileceği doğrulandı.</span><span class="sxs-lookup"><span data-stu-id="c9c58-288">Earlier you verified that you can go to the API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="c9c58-289">Bu bölümde, bu artık mümkün olduğunu doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-289">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="c9c58-290">Yeni bir tarayıcı penceresinde tekrar API uygulamasının URL'sine gidin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-290">In a new browser window, go to the URL of the API app again.</span></span>
2. <span data-ttu-id="c9c58-291">Bunu yapmak isteyip istemediğiniz sorulduğunda oturum açın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-291">Log in when prompted to do so.</span></span>
3. <span data-ttu-id="c9c58-292">Oturum açma başarılı olur, ancak bir hata sayfası için yol açar.</span><span class="sxs-lookup"><span data-stu-id="c9c58-292">Login succeeds but leads to an error page.</span></span>
   
    <span data-ttu-id="c9c58-293">AAD uygulama yapılandırılmış kullanıcılar AAD kiracısında oturum açın ve bir tarayıcıdan API'sine erişim.</span><span class="sxs-lookup"><span data-stu-id="c9c58-293">You've configured the AAD app so that users in the AAD tenant cannot log in and access the API from a browser.</span></span> <span data-ttu-id="c9c58-294">Web uygulamanızın URL'sine giderek ve daha fazla yapılacak iş öğeleri ekleme doğrulayabilir bir hizmet asıl belirteci kullanarak API uygulamasına erişmeye devam edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c9c58-294">You can still access the API app by using a service principal token, which you can verify by going to the web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-to-a-particular-service-principal"></a><span data-ttu-id="c9c58-295">Belirli hizmet sorumlusuna erişimi kısıtlama</span><span class="sxs-lookup"><span data-stu-id="c9c58-295">Restrict access to a particular service principal</span></span>
<span data-ttu-id="c9c58-296">Şimdi, bir kullanıcı için bir belirteç elde edebilirsiniz herhangi bir çağırıcı sağ veya Azure AD kiracınızda hizmet sorumlusu Todolistdataapı (veri katman) API uygulaması arayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c9c58-296">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call the TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="c9c58-297">Veri katmanı API uygulaması yalnızca Todolistapı (orta katman) API uygulaması'ndan ve yalnızca belirli bir hizmet asıl gelen çağrıları kabul emin olmak isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c9c58-297">You might want to make sure that the data tier API app only accepts calls from the TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="c9c58-298">Doğrulanacak kodu ekleyerek bu kısıtlamaları ekleyebilirsiniz `appid` ve `objectidentifier` gelen çağrıları talep.</span><span class="sxs-lookup"><span data-stu-id="c9c58-298">You can add these restrictions by adding code to validate the `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="c9c58-299">Bu öğretici için uygulama kimliği ve denetleyici eylemleri de doğrudan hizmet asıl kimlik doğrulama kodu koyun.</span><span class="sxs-lookup"><span data-stu-id="c9c58-299">For this tutorial you put the code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="c9c58-300">Alternatifleri olan özel bir kullanmak için `Authorize` özniteliği ya da bu doğrulamanın yapılacağı (örneğin OWIN ara yazılımı), başlangıç serileri.</span><span class="sxs-lookup"><span data-stu-id="c9c58-300">Alternatives are to use a custom `Authorize` attribute or to do this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="c9c58-301">İkincisi, bir örnek için bkz [Bu örnek uygulama](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="c9c58-301">For an example of the latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="c9c58-302">Todolistdataapı projesine aşağıdaki değişiklikleri yapın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-302">Make the following changes to the TodoListDataAPI project.</span></span>

1. <span data-ttu-id="c9c58-303">Açık *Controllers/TodoListController.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="c9c58-303">Open the *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="c9c58-304">Ayarlama satırlardaki açıklamayı Kaldır `trustedCallerClientId` ve `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="c9c58-304">Uncomment the lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="c9c58-305">CheckCallerId yöntemi kodda açıklamadan çıkarın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-305">Uncomment the code in the CheckCallerId method.</span></span> <span data-ttu-id="c9c58-306">Bu yöntem, her eylem yöntemi denetleyicideki başlangıcında çağrılır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-306">This method is called at the start of every action method in the controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "The appID or service principal ID is not the expected value." });
            }
        }
4. <span data-ttu-id="c9c58-307">Azure App Service'e Todolistdataapı projesini yeniden dağıtın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-307">Redeploy the ToDoListDataAPI project to Azure App Service.</span></span>
5. <span data-ttu-id="c9c58-308">Tarayıcınızda, AngularJS ön uç web uygulamanızın HTTPS URL'si ve giriş sayfasına git tıklatın **Yapılacaklar listesi** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="c9c58-308">In your browser, go to the AngularJS front end web app's HTTPS URL, and in the home page click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="c9c58-309">Arka uç çağrılar başarısız olduğundan uygulama çalışmıyor.</span><span class="sxs-lookup"><span data-stu-id="c9c58-309">The application doesn't work because calls to the back end are failing.</span></span> <span data-ttu-id="c9c58-310">Yeni kod gerçek AppID ve objectıdentifier denetliyor, ancak bunlara karşı denetlemek için doğru değerleri henüz yok.</span><span class="sxs-lookup"><span data-stu-id="c9c58-310">The new code is checking actual appid and objectidentifier but it doesn't yet have the correct values to check them against.</span></span> <span data-ttu-id="c9c58-311">Tarayıcının geliştirici araçları konsolunu, sunucunun bir HTTP 401 hata döndürmektir bildirir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-311">The browser Developer Tools Console reports that the server is returning an HTTP 401 error.</span></span>
   
    ![Geliştirici hatası Konsolu araçları](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="c9c58-313">Aşağıdaki adımlarda beklenen değerleri yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-313">In the following steps you configure the expected values.</span></span>
6. <span data-ttu-id="c9c58-314">Azure AD PowerShell kullanarak, TodoListWebApp projesi için oluşturduğunuz Azure AD uygulaması için hizmet sorumlusu değerini alın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-314">Using Azure AD PowerShell, get the value of the service principal for the Azure AD application that you created for the TodoListWebApp project.</span></span>
   
    <span data-ttu-id="c9c58-315">a.</span><span class="sxs-lookup"><span data-stu-id="c9c58-315">a.</span></span> <span data-ttu-id="c9c58-316">Azure PowerShell'i yükleyin ve aboneliğinize bağlanma hakkında daha fazla yönerge için bkz: [Azure PowerShell kullanarak Azure Resource Manager ile](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="c9c58-316">For instructions on how to install Azure PowerShell and connect to your subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="c9c58-317">b.</span><span class="sxs-lookup"><span data-stu-id="c9c58-317">b.</span></span> <span data-ttu-id="c9c58-318">Hizmet sorumluları listesini almak için yürütme `Login-AzureRmAccount` komutu ardından `Get-AzureRmADServicePrincipal` komutu.</span><span class="sxs-lookup"><span data-stu-id="c9c58-318">To get a list of service principals, execute the `Login-AzureRmAccount` command and then the `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="c9c58-319">c.</span><span class="sxs-lookup"><span data-stu-id="c9c58-319">c.</span></span> <span data-ttu-id="c9c58-320">Todolistapı uygulama hizmet sorumlusu için objectID bulun ve, daha sonra kopyalayabilirsiniz bir konuma kaydedin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-320">Find the objectid for the service principal of the TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="c9c58-321">Azure portalında Todolistdataapı projesine dağıtılan API uygulaması için API uygulaması dikey penceresine gidin.</span><span class="sxs-lookup"><span data-stu-id="c9c58-321">In the Azure portal, navigate to the API app blade for the API app that you deployed the ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="c9c58-322">Tıklatın **ayarlar > Uygulama ayarları**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-322">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="c9c58-323">İçinde **uygulama ayarları** bölümünde, aşağıdaki anahtarları ve değerleri ekleyin:</span><span class="sxs-lookup"><span data-stu-id="c9c58-323">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="c9c58-324">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="c9c58-324">**Key**</span></span> | <span data-ttu-id="c9c58-325">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="c9c58-325">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="c9c58-326">**Değer**</span><span class="sxs-lookup"><span data-stu-id="c9c58-326">**Value**</span></span> |<span data-ttu-id="c9c58-327">Uygulama arama hizmetini asıl kimliği</span><span class="sxs-lookup"><span data-stu-id="c9c58-327">Service principal id of calling application</span></span> |
   | <span data-ttu-id="c9c58-328">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="c9c58-328">**Example**</span></span> |<span data-ttu-id="c9c58-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="c9c58-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="c9c58-330">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="c9c58-330">**Key**</span></span> | <span data-ttu-id="c9c58-331">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="c9c58-331">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="c9c58-332">**Değer**</span><span class="sxs-lookup"><span data-stu-id="c9c58-332">**Value**</span></span> |<span data-ttu-id="c9c58-333">Todolistapı Azure AD uygulamadan kopyalanan uygulama - çağırma, istemci kimliği</span><span class="sxs-lookup"><span data-stu-id="c9c58-333">Client ID of calling application - copied from the TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="c9c58-334">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="c9c58-334">**Example**</span></span> |<span data-ttu-id="c9c58-335">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="c9c58-335">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="c9c58-336">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-336">Click **Save**.</span></span>
    
     ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="c9c58-338">Tarayıcınız, web uygulamanızın URL'sine dönüş ve giriş sayfasını tıklatın **Yapılacaklar listesi** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="c9c58-338">In your browser, return to the web app's URL, and in the home page click the **To Do List** tab.</span></span>
    
     <span data-ttu-id="c9c58-339">Bu sefer uygulama güvenilen arayan uygulama kimliği ve hizmet asıl kimliği beklenen değer olduğundan beklendiği gibi çalışır.</span><span class="sxs-lookup"><span data-stu-id="c9c58-339">This time the application works as expected because the trusted caller app ID and service principal ID are the expected values.</span></span>
    
     ![Sayfa, yapılacaklar listesi](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="c9c58-341">Sıfırdan projeler derleme</span><span class="sxs-lookup"><span data-stu-id="c9c58-341">Building the projects from scratch</span></span>
<span data-ttu-id="c9c58-342">İki Web API projeleri kullanılarak oluşturulan **Azure API uygulaması** proje şablonu ve varsayılan değerleri denetleyicisi ToDoList denetleyicisiyle değiştirme.</span><span class="sxs-lookup"><span data-stu-id="c9c58-342">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="c9c58-343">Azure AD hizmet sorumlusu belirteçleri Todolistapı projesinde alınırken için [Active Directory Authentication Library (ADAL) .NET için](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet paketi yüklendi.</span><span class="sxs-lookup"><span data-stu-id="c9c58-343">For acquiring Azure AD service principal tokens in the ToDoListAPI project, the [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="c9c58-344">ToDoListAngular gibi bir Web API'si arka ucuna sahip bir AngularJS tek sayfalı uygulama oluşturma hakkında daha fazla bilgi için bkz: [ellere üzerindeki Laboratuvar: tek sayfa uygulama (SPA) ASP.NET Web API ve Angular.js yapı](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="c9c58-344">For information about how to  create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="c9c58-345">Azure AD kimlik doğrulama kodu ekleme hakkında daha fazla bilgi için bkz: [güvenli hale getirme AngularJS tek sayfa uygulamaları Azure AD ile](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="c9c58-345">For information about how to add Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="c9c58-346">Sorun giderme</span><span class="sxs-lookup"><span data-stu-id="c9c58-346">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="c9c58-347">Todolistapı (orta katman) ve Todolistdataapı (veri katmanı) karıştırmayın emin olun.</span><span class="sxs-lookup"><span data-stu-id="c9c58-347">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="c9c58-348">Örneğin, bu öğreticide, kimlik doğrulaması veri katmanı API uygulaması için ekleme **ancak uygulama anahtarı orta katman API uygulaması için oluşturduğunuz Azure AD uygulaması gelmelidir**.</span><span class="sxs-lookup"><span data-stu-id="c9c58-348">For example, in this tutorial you add authentication to the data tier API app, **but the app key must come from the Azure AD application that you created for the middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c9c58-349">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="c9c58-349">Next steps</span></span>
<span data-ttu-id="c9c58-350">Bu API uygulamaları serideki son öğreticidir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-350">This is the last tutorial in the API Apps series.</span></span> 

<span data-ttu-id="c9c58-351">Azure Active Directory hakkında daha fazla bilgi için aşağıdaki kaynaklara bakın.</span><span class="sxs-lookup"><span data-stu-id="c9c58-351">For more information about Azure Active Directory, see the following resources.</span></span>

* [<span data-ttu-id="c9c58-352">Azure AD Geliştirici Kılavuzu</span><span class="sxs-lookup"><span data-stu-id="c9c58-352">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="c9c58-353">Azure AD senaryoları</span><span class="sxs-lookup"><span data-stu-id="c9c58-353">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="c9c58-354">Azure AD örnekleri</span><span class="sxs-lookup"><span data-stu-id="c9c58-354">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="c9c58-355">[WebApp-Webapı-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) ne Bu öğreticide, ancak App Service kimlik doğrulama kullanmadan gösterilen için örnek benzerdir.</span><span class="sxs-lookup"><span data-stu-id="c9c58-355">The [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar to what is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="c9c58-356">Visual Studio kullanarak veya API uygulamaları için Visual Studio projeleri dağıtmanın farklı yöntemleri hakkında bilgi için [dağıtımı otomatikleştirme](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) gelen bir [kaynak denetimi sisteminden](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), bkz: [Azure dağıtma App Service uygulaması](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="c9c58-356">For information about other ways to deploy Visual Studio projects to API apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How to deploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

