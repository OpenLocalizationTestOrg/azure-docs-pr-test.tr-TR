---
title: "Azure uygulama hizmetinde API uygulamaları için aaaService asıl kimlik doğrulaması | Microsoft Docs"
description: "Bilgi nasıl hizmet senaryoları için Azure App Service'te tooprotect bir API uygulaması."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="ab572-103">Azure uygulama hizmetinde API uygulamaları için hizmet asıl kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="ab572-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="ab572-104">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="ab572-104">Overview</span></span>
<span data-ttu-id="ab572-105">Bu makalede açıklanır nasıl toouse App Service kimlik doğrulaması için *iç* tooAPI uygulamalara erişim.</span><span class="sxs-lookup"><span data-stu-id="ab572-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="ab572-106">Bir iç toobe kaynaklarda yalnızca kendi uygulama kodu tarafından istediğiniz bir API uygulamasına sahip olduğu bir senaryodur.</span><span class="sxs-lookup"><span data-stu-id="ab572-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="ab572-107">Bu senaryo Hello önerilen yolu tooimplement App Service'te toouse Azure AD tooprotect hello API uygulaması adı verilir.</span><span class="sxs-lookup"><span data-stu-id="ab572-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="ab572-108">Uygulama Kimliği (hizmet sorumlusu) kimlik bilgilerini sağlayarak Azure AD'den alma bir taşıyıcı belirteci ile korunan hello API uygulaması çağırın.</span><span class="sxs-lookup"><span data-stu-id="ab572-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="ab572-109">Merhaba alternatifleri toousing Azure AD için bkz: **hizmeti için kimlik doğrulama** hello bölümünü [Azure App Service kimlik doğrulamasına genel bakış](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="ab572-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="ab572-110">Bu makalede, şunları öğreneceksiniz:</span><span class="sxs-lookup"><span data-stu-id="ab572-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="ab572-111">Nasıl toouse Azure Active Directory (Azure AD) tooprotect bir API uygulamasını kimliği doğrulanmamış erişim.</span><span class="sxs-lookup"><span data-stu-id="ab572-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="ab572-112">Nasıl bir API uygulaması, web uygulaması ya da Azure AD hizmet sorumlusu (uygulama kimliği) kimlik bilgilerini kullanarak mobil uygulama tooconsume korumalı bir API uygulaması.</span><span class="sxs-lookup"><span data-stu-id="ab572-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="ab572-113">Hakkında bilgi için bir mantık uygulamasından tooconsume bkz [Logic apps ile App Service üzerinde barındırılan özel API'nizi kullanma](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="ab572-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="ab572-114">Oturum açmış kullanıcılarda tarafından bir tarayıcıdan toomake API uygulaması bu hello korumalı emin nasıl çağrılamaz.</span><span class="sxs-lookup"><span data-stu-id="ab572-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="ab572-115">Nasıl toomake bu hello korumalı API uygulaması emin yalnızca çağrılabilir tarafından belirli bir Azure AD hizmet sorumlusu.</span><span class="sxs-lookup"><span data-stu-id="ab572-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="ab572-116">Merhaba makale iki bölüm içerir:</span><span class="sxs-lookup"><span data-stu-id="ab572-116">hello article contains two sections:</span></span>

* <span data-ttu-id="ab572-117">Merhaba [nasıl tooconfigure hizmet asıl kimlik doğrulaması Azure App Service'te](#authconfig) bölümde açıklanmıştır genel nasıl tooconfigure kimlik doğrulaması herhangi bir API uygulama ve API uygulaması tooconsume hello nasıl korumalı.</span><span class="sxs-lookup"><span data-stu-id="ab572-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="ab572-118">Bu bölümde, .NET, Node.js ve Java dahil App Service tarafından desteklenen tooall çerçeveleri eşit oranda geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="ab572-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="ab572-119">Merhaba ile başlayan [hello .NET kullanmaya Başlarken öğreticilerine devam etme](#tutorialstart) bölümünde, hello öğretici kılavuzları, App Service içinde çalışan .NET örnek uygulaması için bir "iç erişim" senaryosu yapılandırılırken aracılığıyla.</span><span class="sxs-lookup"><span data-stu-id="ab572-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="ab572-120"><a id="authconfig"></a>Nasıl tooconfigure hizmet Azure App Service'te asıl kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="ab572-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="ab572-121">Bu bölümde tooany API uygulaması geçerli olan genel yönergeleri sağlar.</span><span class="sxs-lookup"><span data-stu-id="ab572-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="ab572-122">Adımları belirli toohello tooDo listesi .NET örnek uygulaması için çok Git[hello .NET API uygulamaları öğretici serisi etmeden](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="ab572-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="ab572-123">Merhaba, [Azure portal](https://portal.azure.com/), toohello gidin **ayarları** tooprotect istediğiniz ve hello bulur hello API uygulaması dikey **özellikleri** 'yetıklayın**Kimlik doğrulama / yetkilendirme**.</span><span class="sxs-lookup"><span data-stu-id="ab572-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme Azure portalında](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="ab572-125">Merhaba, **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **üzerinde**.</span><span class="sxs-lookup"><span data-stu-id="ab572-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="ab572-126">Merhaba, **istek kimliği doğrulanmamış olduğunda eylem tootake** aşağı açılan listesinden, **Azure Active Directory ile oturum aç** .</span><span class="sxs-lookup"><span data-stu-id="ab572-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="ab572-127">Altında **kimlik doğrulama sağlayıcıları**seçin **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ab572-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme dikey Azure portalında](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="ab572-129">Merhaba yapılandırma **Azure Active Directory ayarları** dikey toocreate yeni bir Azure AD uygulaması ya da kullanım zaten varsa var olan Azure AD uygulaması toouse istiyor.</span><span class="sxs-lookup"><span data-stu-id="ab572-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="ab572-130">İç senaryoları genellikle bir API uygulamasını çağıran bir API uygulaması içerir.</span><span class="sxs-lookup"><span data-stu-id="ab572-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="ab572-131">Ayrı Azure kullanabileceğiniz her API uygulaması için AD uygulamaları ya da tek bir Azure AD uygulaması.</span><span class="sxs-lookup"><span data-stu-id="ab572-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="ab572-132">Bu dikey hakkında ayrıntılı yönergeler için bkz: [nasıl tooconfigure App Service uygulama toouse Azure Active Directory oturum açma](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="ab572-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="ab572-133">Merhaba kimlik doğrulama sağlayıcısı yapılandırma dikey bittiğinde, tıklatın **Tamam**.</span><span class="sxs-lookup"><span data-stu-id="ab572-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="ab572-134">Merhaba, **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="ab572-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="ab572-136">Bu yapıldığında, uygulama hizmeti yalnızca istekleri yapılandırılmış hello Azure AD kiracısında arayanlara izin verir.</span><span class="sxs-lookup"><span data-stu-id="ab572-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="ab572-137">Hiçbir kimlik doğrulama veya yetkilendirme kodu hello korumalı bir API uygulaması gereklidir.</span><span class="sxs-lookup"><span data-stu-id="ab572-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="ab572-138">Merhaba taşıyıcı belirteci toohello API uygulaması yaygın olarak kullanılan talep birlikte HTTP üstbilgilerinde geçirilir ve bir hizmet sorumlusu gibi belirli bir çağıran istekleri arasındadır kod toovalidate, bu bilgileri okuyabilir.</span><span class="sxs-lookup"><span data-stu-id="ab572-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="ab572-139">Bu kimlik doğrulama işlev hello çalışır tüm diller için aynı şekilde bu uygulama hizmeti destekler, .NET, Node.js ve Java dahil olmak üzere.</span><span class="sxs-lookup"><span data-stu-id="ab572-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="ab572-140">API uygulaması tooconsume hello nasıl korumalı</span><span class="sxs-lookup"><span data-stu-id="ab572-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="ab572-141">Merhaba çağıran bir Azure AD taşıyıcı belirteci ile API çağrıları sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="ab572-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="ab572-142">tooget hizmet asıl kimlik bilgilerini kullanarak bir taşıyıcı belirteci hello çağıran kullanır Active Directory Authentication Library (ADAL için [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), veya [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="ab572-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="ab572-143">bir belirteç tooget, ADAL çağrıları hello kodu bilgisinden tooADAL hello sağlar:</span><span class="sxs-lookup"><span data-stu-id="ab572-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="ab572-144">Azure AD kiracınıza Hello adı.</span><span class="sxs-lookup"><span data-stu-id="ab572-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="ab572-145">Merhaba istemci kimliği ve istemci gizli anahtarı (uygulama anahtarı) hello arayanla ilişkili hello Azure AD uygulaması.</span><span class="sxs-lookup"><span data-stu-id="ab572-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="ab572-146">Merhaba hello ile ilişkili Azure AD uygulaması Hello istemci kimliği API uygulaması korumalı.</span><span class="sxs-lookup"><span data-stu-id="ab572-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="ab572-147">(Yalnızca bir Azure AD uygulaması kullandıysanız, bu olduğu hello aynı istemci kimliği hello arayan için bir tane hello gibi.)</span><span class="sxs-lookup"><span data-stu-id="ab572-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="ab572-148">Bu değerler hello hello Azure AD sayfalarında kullanılabilir [Klasik Azure portalı](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="ab572-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="ab572-149">Hello belirteci aldıktan sonra hello arayan, HTTP isteklerini hello yetkilendirme üst bilgisinde içerir.</span><span class="sxs-lookup"><span data-stu-id="ab572-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="ab572-150">Uygulama hizmeti hello belirteci doğrular ve API uygulaması hello istekleri tooreach hello korumalı sağlar.</span><span class="sxs-lookup"><span data-stu-id="ab572-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="ab572-151">Nasıl hello bulunan kullanıcılar tarafından erişim tooprotect hello API uygulamasını aynı Kiracı</span><span class="sxs-lookup"><span data-stu-id="ab572-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="ab572-152">Taşıyıcı belirteçlerini aynı Kiracı Merhaba geçerli değerlendirilir hello kullanıcılar için API uygulaması korumalı.</span><span class="sxs-lookup"><span data-stu-id="ab572-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="ab572-153">Yalnızca bir hizmet sorumlusu çağırabilirsiniz tooensure istiyorsanız, korumalı API uygulaması Merhaba, API uygulaması toovalidate hello hello belirteci talepleri aşağıdaki hello kodda korumalı ekleyin:</span><span class="sxs-lookup"><span data-stu-id="ab572-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="ab572-154">`appid`Merhaba arayanla ilişkili hello Azure AD uygulama Hello istemci kimliği olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="ab572-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="ab572-155">`oid`(`objectidentifier`) hello arayanın hello hizmet asıl kimliği olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="ab572-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="ab572-156">App Service ayrıca hello sağlar `objectidentifier` hello X-MS-CLIENT-PRINCIPAL-ID üstbilgisinde talep.</span><span class="sxs-lookup"><span data-stu-id="ab572-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="ab572-157">Nasıl tooprotect hello tarayıcı erişimi API uygulaması</span><span class="sxs-lookup"><span data-stu-id="ab572-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="ab572-158">Korumalı hello API uygulaması kodda Taleplerde doğrulamaz ve ayrı bir kullanırsanız, Azure AD uygulaması hello API uygulaması, korumalı için Azure AD uygulama yanıt URL'si bu hello değil hello API uygulamasının temel URL'si hello aynı olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="ab572-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="ab572-159">Merhaba yanıt URL'si doğrudan korumalı toohello API uygulaması işaret ediyorsa, hello aynı Azure AD kiracısında bir kullanıcı, toohello API uygulamasına göz atın, oturum açın ve başarıyla hello API çağrısı.</span><span class="sxs-lookup"><span data-stu-id="ab572-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="ab572-160"><a id="tutorialstart"></a>Merhaba .NET API uygulamaları öğretici serisi etmeden</span><span class="sxs-lookup"><span data-stu-id="ab572-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="ab572-161">Merhaba Node.js ve Java öğretici seri için API uygulamaları izliyorsanız, toohello atla [sonraki adımlar](#next-steps) bölümü.</span><span class="sxs-lookup"><span data-stu-id="ab572-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="ab572-162">Bu makalenin sonraki bölümlerinde Hello hello .NET API uygulamaları öğretici serisi devam eder ve hello tamamladığınızı varsaymaktadır [kullanıcı kimlik doğrulaması öğretici](app-service-api-dotnet-user-principal-auth.md) ve kullanıcı kimlik doğrulaması ile Azure'da çalışan Merhaba örnek uygulaması etkin.</span><span class="sxs-lookup"><span data-stu-id="ab572-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="ab572-163">Azure kimlik doğrulaması ayarlama</span><span class="sxs-lookup"><span data-stu-id="ab572-163">Set up authentication in Azure</span></span>
<span data-ttu-id="ab572-164">Bu bölümde bu hello yalnızca HTTP istekleri tooreach hello veri katmanı API uygulaması verir; bu nedenle hello geçerli Azure sahip olanları uygulama hizmeti yapılandırma AD taşıyıcı belirteçlerini.</span><span class="sxs-lookup"><span data-stu-id="ab572-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="ab572-165">Bölümden hello içinde hello orta katman API uygulamasını toosend uygulama kimlik bilgilerini tooAzure AD yapılandırmak, bir taşıyıcı belirteci ulaşırsınız ve hello taşıyıcı belirteci toohello veri katmanı API uygulaması Gönder.</span><span class="sxs-lookup"><span data-stu-id="ab572-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="ab572-166">Bu işlem hello şemada gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="ab572-166">This process is illustrated in hello diagram.</span></span>

![Hizmet kimlik doğrulama diyagramı](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="ab572-168">Aşağıdaki hello öğretici yönergeleri sırasında sorunları alıyorsanız hello bkz [sorun giderme](#troubleshooting) hello öğretici hello sonunda bölüm.</span><span class="sxs-lookup"><span data-stu-id="ab572-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="ab572-169">Merhaba, [Azure portal](https://portal.azure.com/), toohello gidin **ayarları** hello Todolistdataapı (veri katman) API uygulaması için oluşturduğunuz ve ardından hello API uygulaması dikey **ayarları**.</span><span class="sxs-lookup"><span data-stu-id="ab572-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="ab572-170">Merhaba, **ayarları** dikey penceresinde, Bul hello **özellikleri** bölümünde ve ardından **kimlik doğrulama / yetkilendirme**.</span><span class="sxs-lookup"><span data-stu-id="ab572-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme Azure portalında](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="ab572-172">Merhaba, **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **üzerinde**.</span><span class="sxs-lookup"><span data-stu-id="ab572-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="ab572-173">Merhaba, **istek kimliği doğrulanmamış olduğunda eylem tootake** aşağı açılan listesinden, **Azure Active Directory ile oturum aç**.</span><span class="sxs-lookup"><span data-stu-id="ab572-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="ab572-174">Yalnızca istekleri ulaşma hello API uygulamasını kimliği doğrulanmış uygulama hizmeti tooensure neden hello ayar budur.</span><span class="sxs-lookup"><span data-stu-id="ab572-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="ab572-175">Geçerli taşıyıcı belirteçlerini olan istekler için uygulama hizmeti hello belirteçleri toohello API uygulama boyunca aktarır ve bu bilgileri HTTP üstbilgileri yaygın olarak kullanılan talep toomake ile doldurur daha kolay kullanılabilir tooyour kodu.</span><span class="sxs-lookup"><span data-stu-id="ab572-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="ab572-176">Altında **kimlik doğrulama sağlayıcıları**, tıklatın **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ab572-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Kimlik doğrulama/yetkilendirme dikey Azure portalında](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="ab572-178">Merhaba, **Azure Active Directory ayarları** dikey penceresinde tıklatın **Express**.</span><span class="sxs-lookup"><span data-stu-id="ab572-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="ab572-179">Merhaba ile **Express** seçeneği Azure otomatik olarak Azure AD içinde bir AAD uygulaması oluşturabilir [Kiracı](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="ab572-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="ab572-180">Her Azure hesabı otomatik olarak bir tane var olduğundan, Kiracı toocreate yok.</span><span class="sxs-lookup"><span data-stu-id="ab572-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="ab572-181">Altında **yönetim modu**, tıklatın **yeni AD uygulaması oluştur** zaten seçili değilse.</span><span class="sxs-lookup"><span data-stu-id="ab572-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="ab572-182">Hello portal takılan hello **oluşturma uygulama** giriş kutusuna bir varsayılan değere sahip.</span><span class="sxs-lookup"><span data-stu-id="ab572-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="ab572-183">Varsayılan olarak, Azure AD uygulaması hello adlı aynı hello API uygulaması gibi hello.</span><span class="sxs-lookup"><span data-stu-id="ab572-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="ab572-184">İsterseniz, farklı bir ad girebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ab572-184">If you prefer, you can enter a different name.</span></span>
   
    ![Azure AD ayarları](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="ab572-186">**Not**: alternatif olarak, tek bir Azure AD kullanabilir her ikisi de arama API uygulaması hello ve hello korumalı API uygulaması için uygulama.</span><span class="sxs-lookup"><span data-stu-id="ab572-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="ab572-187">Bu alternatif seçerseniz, hello ihtiyaç duymaz **yeni AD uygulaması oluştur** Azure AD uygulaması öğreticide daha önce hello kullanıcı kimlik doğrulaması zaten oluşturulduğundan burada seçeneği.</span><span class="sxs-lookup"><span data-stu-id="ab572-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="ab572-188">Bu öğretici için kullanacağınız API uygulaması ve hello çağırma hello korumalı API uygulaması için Azure AD uygulamaları ayırın.</span><span class="sxs-lookup"><span data-stu-id="ab572-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="ab572-189">Hello hello değeri Not **oluşturma uygulama** giriş kutusu; bu AAD uygulamasını hello Klasik Azure portalı daha sonra göreceğiz.</span><span class="sxs-lookup"><span data-stu-id="ab572-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="ab572-190">**Tamam** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-190">Click **OK**.</span></span>
10. <span data-ttu-id="ab572-191">Merhaba, **kimlik doğrulama / yetkilendirme** dikey penceresinde tıklatın **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="ab572-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="ab572-193">Uygulama hizmeti ile bir Azure Active Directory uygulaması oluşturur **oturum açma URL'si** ve **yanıt URL'si** toohello URL API uygulamanızın'otomatik olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="ab572-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="ab572-194">Merhaba ikinci değer, AAD Kiracı toolog kullanıcılar ve erişim hello API uygulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="ab572-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="ab572-195">Bu hello API uygulama korunan doğrulayın</span><span class="sxs-lookup"><span data-stu-id="ab572-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="ab572-196">Toohello hello API uygulaması URL'sini bir tarayıcıda gidin: hello içinde **API uygulaması** dikey penceresinde hello Azure portal altında hello bağlantısını tıklatın **URL**.</span><span class="sxs-lookup"><span data-stu-id="ab572-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="ab572-197">Kimliği doğrulanmamış istekler tooreach hello API uygulaması izin verilmediğinden, yeniden yönlendirilen tooa oturum açma ekranı demektir.</span><span class="sxs-lookup"><span data-stu-id="ab572-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="ab572-198">Tarayıcınız toohello Swagger kullanıcı arabirimini gidin, tarayıcınızı zaten oturum açmış--bu durumda, bir InPrivate veya Incognito penceresi açın ve toohello Swagger kullanıcı Arabirimi URL gidin.</span><span class="sxs-lookup"><span data-stu-id="ab572-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="ab572-199">AAD kiracınızda bir kullanıcının kimlik bilgileriyle oturum açın.</span><span class="sxs-lookup"><span data-stu-id="ab572-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="ab572-200">Oturum açarken hello tarayıcıda hello "başarıyla oluşturuldu" sayfası görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="ab572-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="ab572-201">Merhaba Todolistapı projesi tooacquire yapılandırmak ve hello Azure AD belirteci Gönder</span><span class="sxs-lookup"><span data-stu-id="ab572-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="ab572-202">Bu bölümde görevleri hello:</span><span class="sxs-lookup"><span data-stu-id="ab572-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="ab572-203">Azure AD uygulama kimlik bilgilerini tooacquire bir belirteç kullanan hello orta katman API uygulamasında kodu ekleyin ve toohello veri katmanı API uygulaması ile HTTP istekleri göndermek.</span><span class="sxs-lookup"><span data-stu-id="ab572-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="ab572-204">Gereksinim duyduğunuz hello kimlik bilgileri, Azure AD'den alın.</span><span class="sxs-lookup"><span data-stu-id="ab572-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="ab572-205">Azure uygulama hizmeti çalışma zamanı ortamı hello orta katman API uygulaması ayarlarında içine Hello kimlik bilgilerini girin.</span><span class="sxs-lookup"><span data-stu-id="ab572-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="ab572-206">Merhaba Todolistapı projesi tooacquire yapılandırmak ve hello Azure AD belirteci Gönder</span><span class="sxs-lookup"><span data-stu-id="ab572-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="ab572-207">Aşağıdaki değişiklikler Visual Studio'da hello Todolistapı projesinde hello olun.</span><span class="sxs-lookup"><span data-stu-id="ab572-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="ab572-208">Tüm hello hello kod açıklamadan çıkarın *ServicePrincipal.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="ab572-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="ab572-209">Bu, .NET tooacquire hello Azure AD taşıyıcı belirteci için ADAL kullanır hello koddur.</span><span class="sxs-lookup"><span data-stu-id="ab572-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="ab572-210">Daha sonra hello Azure çalışma zamanı ortamında ayarlarız birkaç yapılandırma değerlerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="ab572-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="ab572-211">Merhaba kod aşağıdadır:</span><span class="sxs-lookup"><span data-stu-id="ab572-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="ab572-212">**Not:** bu kodunu hello ADAL hello projede yüklü .NET NuGet paket (Microsoft.IdentityModel.Clients.activedirectory tarafından) gerektirir.</span><span class="sxs-lookup"><span data-stu-id="ab572-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="ab572-213">Bu proje sıfırdan oluşturuyorsanız, bu paket tooinstall gerekir.</span><span class="sxs-lookup"><span data-stu-id="ab572-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="ab572-214">Bu paket hello API uygulaması proje yeni şablon tarafından otomatik olarak yüklenmez.</span><span class="sxs-lookup"><span data-stu-id="ab572-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="ab572-215">İçinde *denetleyicileri/ToDoListController*, hello hello kodda açıklamadan çıkarın `NewDataAPIClient` hello yetkilendirme üstbilgisinde hello belirteci tooHTTP isteklerini ekler yöntemi.</span><span class="sxs-lookup"><span data-stu-id="ab572-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="ab572-216">Merhaba Todolistapı projesini dağıtma.</span><span class="sxs-lookup"><span data-stu-id="ab572-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="ab572-217">(Merhaba projesine sağ tıklayın ve ardından **Publish > Publish**.)</span><span class="sxs-lookup"><span data-stu-id="ab572-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="ab572-218">Visual Studio Başlangıç projesini dağıtır ve bir tarayıcı toohello web uygulamanızın temel URL'yi açar.</span><span class="sxs-lookup"><span data-stu-id="ab572-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="ab572-219">Bu bir tarayıcıdan girişimi toogo tooa Web API'sini temel URL için normal bir 403 hata sayfası gösterilir.</span><span class="sxs-lookup"><span data-stu-id="ab572-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="ab572-220">Kapat hello tarayıcı.</span><span class="sxs-lookup"><span data-stu-id="ab572-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="ab572-221">Azure AD yapılandırma değerlerini alma</span><span class="sxs-lookup"><span data-stu-id="ab572-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="ab572-222">Merhaba, [Klasik Azure portalı](https://manage.windowsazure.com/), çok Git**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ab572-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="ab572-223">Merhaba üzerinde **Directory** sekmesinde, AAD kiracınızın tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="ab572-224">Tıklatın **uygulamaları > Şirketimin sahip olduğu uygulamalar**ve ardından hello onay işaretine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="ab572-225">Uygulamaları Hello listesinde hello hello Todolistdataapı (veri katman) API uygulaması için kimlik doğrulaması etkinleştirildiğinde Azure sizin için oluşturulmuş bir hello adına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="ab572-226">Merhaba tıklatın **yapılandırma** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="ab572-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="ab572-227">Kopya hello **istemci kimliği** değer ve nedenini bildirmeden bir yerde alabilirsiniz ondan daha sonra kaydedin.</span><span class="sxs-lookup"><span data-stu-id="ab572-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="ab572-228">Merhaba Klasik Azure portalına geri dönün toohello listesi **Şirketimin sahip olduğu uygulamalar**ve hello orta katman Todolistapı API uygulaması (Merhaba, oluşturulan hello önceki öğreticide değil için oluşturduğunuz hello AAD uygulama'yı tıklatın Bu öğreticide oluşturulan hello).</span><span class="sxs-lookup"><span data-stu-id="ab572-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="ab572-229">Merhaba tıklatın **yapılandırma** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="ab572-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="ab572-230">Kopya hello **istemci kimliği** değer ve nedenini bildirmeden bir yerde alabilirsiniz ondan daha sonra kaydedin.</span><span class="sxs-lookup"><span data-stu-id="ab572-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="ab572-231">Altında **anahtarları**seçin **1 yıl** hello gelen **seçin süresi** aşağı açılan liste.</span><span class="sxs-lookup"><span data-stu-id="ab572-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="ab572-232">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-232">Click **Save**.</span></span>
    
     ![Uygulama anahtarı oluştur](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="ab572-234">Merhaba anahtar değerini kopyalayın ve nedenini bildirmeden bir yerde ondan daha sonra alabilirsiniz kaydedin.</span><span class="sxs-lookup"><span data-stu-id="ab572-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Yeni uygulama anahtarı kopyalayın](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="ab572-236">Merhaba orta katman API uygulamanın çalışma zamanı ortamında Azure AD ayarları yapılandırma</span><span class="sxs-lookup"><span data-stu-id="ab572-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="ab572-237">Toohello Git [Azure portal](https://portal.azure.com/)ve ardından toohello gidin **API uygulaması** dikey penceresinde hello Todolistapı (orta katman) projesini barındıran hello API uygulaması için.</span><span class="sxs-lookup"><span data-stu-id="ab572-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="ab572-238">**Ayarlar > Uygulama Ayarları**’na tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="ab572-239">Merhaba, **uygulama ayarları** bölümünde, aşağıdaki hello anahtarları ve değerleri ekleyin:</span><span class="sxs-lookup"><span data-stu-id="ab572-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="ab572-240">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="ab572-240">**Key**</span></span> | <span data-ttu-id="ab572-241">IDA: yetkilisi</span><span class="sxs-lookup"><span data-stu-id="ab572-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="ab572-242">**Değer**</span><span class="sxs-lookup"><span data-stu-id="ab572-242">**Value**</span></span> |<span data-ttu-id="ab572-243">https://Login.microsoftonline.com/ {Azure AD Kiracı adınızı}</span><span class="sxs-lookup"><span data-stu-id="ab572-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="ab572-244">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="ab572-244">**Example**</span></span> |<span data-ttu-id="ab572-245">https://Login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="ab572-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="ab572-246">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="ab572-246">**Key**</span></span> | <span data-ttu-id="ab572-247">IDA: ClientID</span><span class="sxs-lookup"><span data-stu-id="ab572-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ab572-248">**Değer**</span><span class="sxs-lookup"><span data-stu-id="ab572-248">**Value**</span></span> |<span data-ttu-id="ab572-249">Uygulama (orta katman - Todolistapı) çağırma hello istemci kimliği</span><span class="sxs-lookup"><span data-stu-id="ab572-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="ab572-250">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="ab572-250">**Example**</span></span> |<span data-ttu-id="ab572-251">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="ab572-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="ab572-252">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="ab572-252">**Key**</span></span> | <span data-ttu-id="ab572-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="ab572-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="ab572-254">**Değer**</span><span class="sxs-lookup"><span data-stu-id="ab572-254">**Value**</span></span> |<span data-ttu-id="ab572-255">Uygulama (orta katman - Todolistapı) çağırma hello uygulama anahtarı</span><span class="sxs-lookup"><span data-stu-id="ab572-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="ab572-256">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="ab572-256">**Example**</span></span> |<span data-ttu-id="ab572-257">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="ab572-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="ab572-258">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="ab572-258">**Key**</span></span> | <span data-ttu-id="ab572-259">IDA: kaynak</span><span class="sxs-lookup"><span data-stu-id="ab572-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="ab572-260">**Değer**</span><span class="sxs-lookup"><span data-stu-id="ab572-260">**Value**</span></span> |<span data-ttu-id="ab572-261">Uygulama adında hello istemci kimliği (veri katmanı - Todolistdataapı)</span><span class="sxs-lookup"><span data-stu-id="ab572-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="ab572-262">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="ab572-262">**Example**</span></span> |<span data-ttu-id="ab572-263">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="ab572-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="ab572-264">**Not**: için `ida:Resource`, uygulamanın adlı hello kullandığınızdan emin olun **istemci kimliği** ve kendi **uygulama kimliği URI'si**.</span><span class="sxs-lookup"><span data-stu-id="ab572-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="ab572-265">`ida:ClientId`ve `ida:Resource` farklı değerleri Bu öğretici için kullandığınız olduğundan hello orta katman ve veri katmanı için Azure AD applicaations ayırın.</span><span class="sxs-lookup"><span data-stu-id="ab572-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="ab572-266">Tek bir kullanıyorsanız API uygulaması ve hello çağırma hello için Azure AD uygulaması korumalı API uygulaması, aynı değeri hem de hello kullanırsınız `ida:ClientId` ve `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="ab572-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="ab572-267">hello projenin Web.config dosyasında veya hello Azure çalışma zamanı ortamı depolanabilir şekilde hello kod ConfigurationManager tooget bu değerleri kullanır.</span><span class="sxs-lookup"><span data-stu-id="ab572-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="ab572-268">Azure App Service'te bir ASP.NET uygulaması çalışırken, ortam ayarları otomatik olarak Web.config ayarları geçersiz kılar. Ortam ayarları olan genellikle bir [daha güvenli şekilde toostore hassas bilgileri karşılaştırıldığında tooa Web.config dosyasında](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="ab572-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="ab572-269">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-269">Click **Save**.</span></span>
   
    ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="ab572-271">Merhaba uygulamayı test etme</span><span class="sxs-lookup"><span data-stu-id="ab572-271">Test hello application</span></span>
1. <span data-ttu-id="ab572-272">Bir tarayıcıda toohello hello AngularJS ön uç web uygulamasının HTTPS URL'sini gidin.</span><span class="sxs-lookup"><span data-stu-id="ab572-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="ab572-273">Merhaba tıklatın **tooDo listesi** sekmesi ve Azure AD kiracınızda bir kullanıcının kimlik bilgilerini oturum.</span><span class="sxs-lookup"><span data-stu-id="ab572-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="ab572-274">Merhaba uygulaması çalışma Yapılacaklar öğelerini tooverify ekleyin.</span><span class="sxs-lookup"><span data-stu-id="ab572-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![tooDo Listesi Sayfası](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="ab572-276">Merhaba uygulaması beklendiği gibi çalışmazsa, tüm hello Azure portal girdiğiniz hello ayarlarını denetleyin.</span><span class="sxs-lookup"><span data-stu-id="ab572-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="ab572-277">Hello ayarlarının tümünü toobe doğru görünüyorsa, hello bkz [sorun giderme](#troubleshooting) Bu öğreticinin ilerleyen bölümlerinde.</span><span class="sxs-lookup"><span data-stu-id="ab572-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="ab572-278">Merhaba API uygulaması tarayıcı erişime karşı koruyun</span><span class="sxs-lookup"><span data-stu-id="ab572-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="ab572-279">Bu öğretici için oluşturduğunuz ayrı bir hello Todolistdataapı (veri katman) API uygulaması için Azure AD uygulaması.</span><span class="sxs-lookup"><span data-stu-id="ab572-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="ab572-280">Uygulama hizmeti bir AAD uygulaması oluşturduğunda, gördüğünüz gibi bir kullanıcı toogo toohello API uygulamasının URL'sini bir tarayıcı ve günlük etkinleştirir şekilde hello AAD uygulamayı yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="ab572-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="ab572-281">Bu bir son kullanıcı, Azure AD kiracınız, yalnızca bir hizmet sorumlusu mümkündür, API tooaccess hello gösterir.</span><span class="sxs-lookup"><span data-stu-id="ab572-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="ab572-282">API uygulaması korumalı hello herhangi bir kod yazmadan olmadan tooprevent tarayıcı erişimi isterseniz hello değiştirebilirsiniz **yanıt URL'si** hello AAD uygulaması ana URL böylece hello API uygulamanın farklı.</span><span class="sxs-lookup"><span data-stu-id="ab572-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="ab572-283">Tarayıcı erişimini devre dışı bırakma</span><span class="sxs-lookup"><span data-stu-id="ab572-283">Disable browser access</span></span>
1. <span data-ttu-id="ab572-284">Merhaba Klasik portalın içinde **yapılandırma** sekmesinde Merhaba TodoListService oluşturulduğu Merhaba AAD uygulaması için hello hello değeri değiştirin **yanıt URL'si** böylece geçerli URL ancak değil hello API uygulamanızın olan alan URL.</span><span class="sxs-lookup"><span data-stu-id="ab572-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="ab572-285">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="ab572-286">Tarayıcı erişimi artık çalıştığını doğrulayın</span><span class="sxs-lookup"><span data-stu-id="ab572-286">Verify browser access no longer works</span></span>
<span data-ttu-id="ab572-287">Daha önce toohello API uygulaması URL'sini bir tarayıcı üzerinden tek bir kullanıcının kimlik bilgileriyle oturum açarak gidebileceği doğrulandı.</span><span class="sxs-lookup"><span data-stu-id="ab572-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="ab572-288">Bu bölümde, bu artık mümkün olduğunu doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="ab572-289">Yeni bir tarayıcı penceresinde hello API uygulaması URL'sini toohello tekrar gidin.</span><span class="sxs-lookup"><span data-stu-id="ab572-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="ab572-290">Ne zaman günlüğüne toodo şekilde istenir.</span><span class="sxs-lookup"><span data-stu-id="ab572-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="ab572-291">Oturum açma başarılı olur, ancak tooan hata sayfasının yol açar.</span><span class="sxs-lookup"><span data-stu-id="ab572-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="ab572-292">Merhaba AAD uygulama yapılandırılmış hello AAD Kiracı kullanıcılar oturum açın ve bir tarayıcıdan hello API'sine erişim.</span><span class="sxs-lookup"><span data-stu-id="ab572-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="ab572-293">Toohello web uygulamanızın URL'sine giderek ve daha fazla yapılacak iş öğeleri ekleme doğrulayabilir bir hizmet asıl belirteci kullanarak hello API uygulaması erişmeye devam edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ab572-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="ab572-294">Erişim tooa belirli bir hizmet asıl kısıtla</span><span class="sxs-lookup"><span data-stu-id="ab572-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="ab572-295">Şimdi, bir kullanıcı için bir belirteç elde edebilirsiniz herhangi bir çağırıcı sağ veya Azure AD kiracınızda hizmet sorumlusu hello Todolistdataapı (veri katman) API uygulaması arayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ab572-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="ab572-296">Bu hello veri katmanı API uygulaması yalnızca hello Todolistapı (orta katman) API uygulaması'ndan ve yalnızca belirli bir hizmet asıl gelen çağrıları kabul emin toomake isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ab572-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="ab572-297">Kod toovalidate hello ekleyerek bu kısıtlamaları ekleyebilirsiniz `appid` ve `objectidentifier` gelen çağrıları talep.</span><span class="sxs-lookup"><span data-stu-id="ab572-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="ab572-298">Bu öğretici için uygulama kimliği ve hizmet asıl kimliği doğrudan denetleyici eylemleri doğrular hello kodu koyun.</span><span class="sxs-lookup"><span data-stu-id="ab572-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="ab572-299">Alternatifleri olan toouse özel `Authorize` özniteliği ya da toodo bu doğrulama başlangıç dizileriniz (örneğin OWIN ara yazılımı).</span><span class="sxs-lookup"><span data-stu-id="ab572-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="ab572-300">Merhaba ikinci bir örnek için bkz: [Bu örnek uygulama](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="ab572-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="ab572-301">Değişiklikleri toohello Todolistdataapı projesini aşağıdaki hello olun.</span><span class="sxs-lookup"><span data-stu-id="ab572-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="ab572-302">Açık hello *Controllers/TodoListController.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="ab572-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="ab572-303">Ayarlama hello satırlardaki açıklamayı Kaldır `trustedCallerClientId` ve `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="ab572-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="ab572-304">Merhaba CheckCallerId yöntemi Hello kodda açıklamadan çıkarın.</span><span class="sxs-lookup"><span data-stu-id="ab572-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="ab572-305">Bu yöntem, her eylem yönteminin hello denetleyicideki hello başlangıç çağrılır.</span><span class="sxs-lookup"><span data-stu-id="ab572-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="ab572-306">Merhaba Todolistdataapı projesi tooAzure uygulama hizmeti yeniden dağıtın.</span><span class="sxs-lookup"><span data-stu-id="ab572-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="ab572-307">Tarayıcınızda, toohello AngularJS ön uç web uygulamanızın HTTPS URL'sine gidin ve hello giriş sayfası hello tıklayın **tooDo listesi** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="ab572-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="ab572-308">geri toohello bitiş çağrıları başarısız olduğundan Merhaba uygulaması işe yaramaz.</span><span class="sxs-lookup"><span data-stu-id="ab572-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="ab572-309">Gerçek AppID ve objectıdentifier Hello yeni kodu denetimi ancak henüz hello doğru değerlerin toocheck yok karşı bunları.</span><span class="sxs-lookup"><span data-stu-id="ab572-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="ab572-310">Merhaba tarayıcı geliştirici araçları konsolunu hello sunucu bir HTTP 401 hata döndürüyor bildirir.</span><span class="sxs-lookup"><span data-stu-id="ab572-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Geliştirici hatası Konsolu araçları](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="ab572-312">Aşağıdaki adımları hello hello beklenen değerleri yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="ab572-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="ab572-313">Azure AD PowerShell kullanarak, hello değerini hello hizmet asıl hello hello TodoListWebApp projesi için oluşturduğunuz Azure AD uygulaması için alın.</span><span class="sxs-lookup"><span data-stu-id="ab572-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="ab572-314">a.</span><span class="sxs-lookup"><span data-stu-id="ab572-314">a.</span></span> <span data-ttu-id="ab572-315">Yönergeler için Azure PowerShell tooinstall ve tooyour abonelik bağlanmak, bkz: [Azure PowerShell kullanarak Azure Resource Manager ile](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="ab572-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="ab572-316">b.</span><span class="sxs-lookup"><span data-stu-id="ab572-316">b.</span></span> <span data-ttu-id="ab572-317">tooget hizmet asıl adı listesi yürütme hello `Login-AzureRmAccount` komutunu ve ardından hello `Get-AzureRmADServicePrincipal` komutu.</span><span class="sxs-lookup"><span data-stu-id="ab572-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="ab572-318">c.</span><span class="sxs-lookup"><span data-stu-id="ab572-318">c.</span></span> <span data-ttu-id="ab572-319">Merhaba objectID hello için hizmet sorumlusu hello Todolistapı uygulamasının bulmak ve, daha sonra kopyalayabilirsiniz bir konuma kaydedin.</span><span class="sxs-lookup"><span data-stu-id="ab572-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="ab572-320">Hello Azure portal, toohello API uygulaması dikey hello Todolistdataapı projesine dağıtılan hello API uygulaması için gidin.</span><span class="sxs-lookup"><span data-stu-id="ab572-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="ab572-321">Tıklatın **ayarlar > Uygulama ayarları**.</span><span class="sxs-lookup"><span data-stu-id="ab572-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="ab572-322">Merhaba, **uygulama ayarları** bölümünde, aşağıdaki hello anahtarları ve değerleri ekleyin:</span><span class="sxs-lookup"><span data-stu-id="ab572-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="ab572-323">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="ab572-323">**Key**</span></span> | <span data-ttu-id="ab572-324">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="ab572-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ab572-325">**Değer**</span><span class="sxs-lookup"><span data-stu-id="ab572-325">**Value**</span></span> |<span data-ttu-id="ab572-326">Uygulama arama hizmetini asıl kimliği</span><span class="sxs-lookup"><span data-stu-id="ab572-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="ab572-327">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="ab572-327">**Example**</span></span> |<span data-ttu-id="ab572-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="ab572-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="ab572-329">**Anahtar**</span><span class="sxs-lookup"><span data-stu-id="ab572-329">**Key**</span></span> | <span data-ttu-id="ab572-330">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="ab572-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ab572-331">**Değer**</span><span class="sxs-lookup"><span data-stu-id="ab572-331">**Value**</span></span> |<span data-ttu-id="ab572-332">Uygulama - hello Todolistapı Azure AD uygulamadan kopyalanan çağırma, istemci kimliği</span><span class="sxs-lookup"><span data-stu-id="ab572-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="ab572-333">**Örnek**</span><span class="sxs-lookup"><span data-stu-id="ab572-333">**Example**</span></span> |<span data-ttu-id="ab572-334">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="ab572-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="ab572-335">**Kaydet** düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="ab572-335">Click **Save**.</span></span>
    
     ![Kaydet’e tıklayın.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="ab572-337">Tarayıcınızda, toohello web uygulamanızın URL'sine dönün ve hello giriş sayfası hello tıklatın **tooDo listesi** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="ab572-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="ab572-338">Bu zaman Merhaba uygulaması hello güvenilen arayan uygulama kimliği ve hizmet asıl kimliği hello beklenen değer olduğundan beklendiği gibi çalışır.</span><span class="sxs-lookup"><span data-stu-id="ab572-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![tooDo Listesi Sayfası](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="ab572-340">Sıfırdan Hello projeler derleme</span><span class="sxs-lookup"><span data-stu-id="ab572-340">Building hello projects from scratch</span></span>
<span data-ttu-id="ab572-341">Merhaba iki Web API projeleri hello kullanarak oluşturulmuş **Azure API uygulaması** proje şablonu ve bir Yapılacaklar listesi denetleyicisiyle değiştirerek hello varsayılan değerleri denetleyicisi.</span><span class="sxs-lookup"><span data-stu-id="ab572-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="ab572-342">Azure AD hizmet sorumlusu belirteçleri hello Todolistapı projesinde alınırken için hello [Active Directory Authentication Library (ADAL) .NET için](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet paketi yüklendi.</span><span class="sxs-lookup"><span data-stu-id="ab572-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="ab572-343">Hakkında bilgi çok oluşturmak için bir AngularJS tek sayfalı uygulama ToDoListAngular gibi bir Web API arka uç ile bkz [ellere üzerindeki Laboratuvar: tek sayfa uygulama (SPA) ASP.NET Web API ve Angular.js yapı](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="ab572-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="ab572-344">Hakkında bilgi için bkz tooadd Azure AD kimlik doğrulama kodu [güvenli hale getirme AngularJS tek sayfa uygulamaları Azure AD ile](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="ab572-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="ab572-345">Sorun giderme</span><span class="sxs-lookup"><span data-stu-id="ab572-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="ab572-346">Todolistapı (orta katman) ve Todolistdataapı (veri katmanı) karıştırmayın emin olun.</span><span class="sxs-lookup"><span data-stu-id="ab572-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="ab572-347">Örneğin, bu öğreticide, kimlik doğrulama toohello veri katmanı API uygulaması eklemek **ancak hello uygulama anahtarı hello hello orta katman API uygulaması için oluşturduğunuz Azure AD uygulaması gelen gerekir**.</span><span class="sxs-lookup"><span data-stu-id="ab572-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ab572-348">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="ab572-348">Next steps</span></span>
<span data-ttu-id="ab572-349">Merhaba son hello API uygulamaları serisi öğreticide budur.</span><span class="sxs-lookup"><span data-stu-id="ab572-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="ab572-350">Azure Active Directory hakkında daha fazla bilgi için kaynakları aşağıdaki hello bakın.</span><span class="sxs-lookup"><span data-stu-id="ab572-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="ab572-351">Azure AD Geliştirici Kılavuzu</span><span class="sxs-lookup"><span data-stu-id="ab572-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="ab572-352">Azure AD senaryoları</span><span class="sxs-lookup"><span data-stu-id="ab572-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="ab572-353">Azure AD örnekleri</span><span class="sxs-lookup"><span data-stu-id="ab572-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="ab572-354">Merhaba [WebApp-Webapı-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) örnek benzer toowhat, bu öğreticide, ancak App Service kimlik doğrulama kullanmadan gösterilir.</span><span class="sxs-lookup"><span data-stu-id="ab572-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="ab572-355">Diğer yolları hakkında bilgi toodeploy Visual Studio tooAPI uygulamalar, Visual Studio kullanarak veya projeler için [dağıtımı otomatikleştirme](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) gelen bir [kaynak denetimi sisteminden](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), bkz: [nasıl toodeploy bir Azure App Service uygulaması](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="ab572-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

