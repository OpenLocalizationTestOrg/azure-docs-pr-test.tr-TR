---
title: "ExpressRoute yönlendirmesini en iyi duruma getirme: Azure | Microsoft Docs"
description: "Bu sayfa, Microsoft ve şirket ağınız arasında bağlanan birden fazla ExpressRoute devresine sahip olduğunda yönlendirmenin nasıl iyileştirileceği hakkında ayrıntılı bilgi sağlar."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: c3a85b9445d69330c3f6c7d298169efddb6ecca0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="5a3a6-103">ExpressRoute Yönlendirmeyi En iyi Duruma Getirme</span><span class="sxs-lookup"><span data-stu-id="5a3a6-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="5a3a6-104">Birden çok ExpressRoute bağlantı hattına sahip olduğunuzda, Microsoft'a bağlanmak için birden fazla yolunuz vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-104">When you have multiple ExpressRoute circuits, you have more than one path to connect to Microsoft.</span></span> <span data-ttu-id="5a3a6-105">Sonuç olarak, yetersiz yönlendirme olabilir, diğer bir deyişle, trafiğinizin Microsoft’a ulaşması ve Microsoft’un ağınıza ulaşması daha uzun bir yol alabilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path to reach Microsoft, and Microsoft to your network.</span></span> <span data-ttu-id="5a3a6-106">Ne kadar uzun ağ yolu, o kadar yüksek gecikme.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-106">The longer the network path, the higher the latency.</span></span> <span data-ttu-id="5a3a6-107">Gecikmenin uygulama performansı ve kullanıcı deneyimi üzerinde doğrudan etkisi vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="5a3a6-108">Bu makale, bu sorunu gösterir ve standart yönlendirme teknolojilerini kullanarak yönlendirmenin nasıl iyileştirileceğini açıklar.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-108">This article will illustrate this problem and explain how to optimize routing using the standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-to-microsoft"></a><span data-ttu-id="5a3a6-109">Müşteriden Microsoft’a yetersiz yönlendirme</span><span class="sxs-lookup"><span data-stu-id="5a3a6-109">Suboptimal routing from customer to Microsoft</span></span>
<span data-ttu-id="5a3a6-110">Bir örnekle yönlendirme problemine daha yakından bir bakalım.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-110">Let's take a close look at the routing problem by an example.</span></span> <span data-ttu-id="5a3a6-111">Biri Los Angeles ve diğeri New York’ta olmak üzere ABD’de iki ofisiniz olduğunu düşünün.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-111">Imagine you have two offices in the US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="5a3a6-112">Ofisleriniz, kendi omurga ağınız veya hizmet sağlayıcınızın IP VPN’i olabilen bir Geniş Alan Ağı (WAN) üzerine bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="5a3a6-113">Ayrıca, WAN’da bağlı biri ABD Batı ve diğeri ABD Doğu’da olmak üzere iki ExpressRoute bağlantı hattınız vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on the WAN.</span></span> <span data-ttu-id="5a3a6-114">Belli ki, Microsoft ağına bağlanmak için iki yolunuz vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-114">Obviously, you have two paths to connect to the Microsoft network.</span></span> <span data-ttu-id="5a3a6-115">Şimdi, hem ABD Batı hem de ABD Doğu’da Azure dağıtımına (örneğin, Azure Uygulama Hizmeti) sahip olduğunuzu düşünün.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="5a3a6-116">Hizmet yöneticiniz en iyi deneyimler için her ofisteki kullanıcıların yakınlardaki Azure hizmetlerine erişimini tanıttığından, amacınız Los Angeles’taki kullanıcılarınızı Azure ABD Batı’ya ve New York’taki kullanıcılarınızı Azure ABD Doğu’ya bağlamaktır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-116">Your intention is to connect your users in Los Angeles to Azure US West and your users in New York to Azure US East because your service admin advertises that users in each office access the nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="5a3a6-117">Ne yazık ki, doğu yakası kullanıcıları için plan yolunda giderken batı yakası kullanıcıları için yolunda değildir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-117">Unfortunately, the plan works out well for the east coast users but not for the west coast users.</span></span> <span data-ttu-id="5a3a6-118">Sorunun nedeni aşağıda verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-118">The cause of the problem is the following.</span></span> <span data-ttu-id="5a3a6-119">Her bir ExpressRoute bağlantı hattında, hem Azure ABD Doğu (23.100.0.0/16) hem de Azure ABD Batı’daki (13.100.0.0/16) önekini size tanıtırız.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-119">On each ExpressRoute circuit, we advertise to you both the prefix in Azure US East (23.100.0.0/16) and the prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="5a3a6-120">Hangi önekin hangi bölgeden olduğunu bilmiyorsanız, farklı şekilde ele almanız mümkün değildir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-120">If you don't know which prefix is from which region, you are not able to treat it differently.</span></span> <span data-ttu-id="5a3a6-121">WAN ağınız her iki önekin de ABD Batı’dan daha çok ABD Doğu’ya yakın olduğunu düşünebilir ve bu nedenle, iki ofis kullanıcılarını da ABD Doğu’daki ExpressRoute bağlantı hattına yönlendirebilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-121">Your WAN network may think both of the prefixes are closer to US East than US West and therefore route both office users to the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="5a3a6-122">Sonunda, Los Angeles ofisinde birçok mutsuz kullanıcınız olacaktır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-122">In the end, you will have many unhappy users in the Los Angeles office.</span></span>

![ExpressRoute Vaka 1 sorunu: Müşteriden Microsoft’a yetersiz yönlendirme](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="5a3a6-124">Çözüm: BGP Toplulukları’nı kullanın</span><span class="sxs-lookup"><span data-stu-id="5a3a6-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="5a3a6-125">Her iki ofis kullanıcıları için yönlendirmeyi en iyi hale getirmek için, hangi önekin Azure Batı ABD ve Azure Doğu ABD olduğunu bilmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-125">To optimize routing for both office users, you need to know which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="5a3a6-126">Bu bilgileri [BGP Topluluğu değerlerini](expressroute-routing.md) kullanarak kodlarız.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="5a3a6-127">Her bir Azure bölgesine benzersiz bir BGP Topluluğu değeri atadık, örneğin Doğu ABD için "12076:51004", Batı ABD için "12076:51006".</span><span class="sxs-lookup"><span data-stu-id="5a3a6-127">We've assigned a unique BGP Community value to each Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="5a3a6-128">Artık hangi önekin hangi Azure bölgesinden olduğunu bildiğinize göre, tercih edilmesi gereken ExpressRoute bağlantı hattını yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="5a3a6-129">Yönlendirme bilgilerinin değişimi için BGP kullandığımızdan, yönlendirmeyi etkilemek için BGP'nin Yerel Tercihini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-129">Because we use the BGP to exchange routing info, you can use BGP's Local Preference to influence routing.</span></span> <span data-ttu-id="5a3a6-130">Bizim örneğimizde, ABD Batı’daki 13.100.0.0/16 için ABD Doğu’dan daha yüksek bir yerel tercih değeri atayabilir ve benzer şekilde, ABD Doğu’daki 23.100.0.0/16 için ABD Batı’dan daha yüksek bir yerel tercih değeri atayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-130">In our example, you can assign a higher local preference value to 13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value to 23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="5a3a6-131">Bu yapılandırma her iki Microsoft yolunun da kullanılabilir olduğunda, New York’taki kullanıcılarınız ABD Doğu’dan Azure ABD Doğu’ya ExpressRoute bağlantı hattını kullanırken Los Angeles’taki kullanıcılarınızın Azure ABD Batı’ya bağlanması için ABD Batı’daki ExpressRoute bağlantı hattının kullanıldığından emin olacaktır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-131">This configuration will make sure that, when both paths to Microsoft are available, your users in Los Angeles will take the ExpressRoute circuit in US West to connect to Azure US West whereas your users in New York take the ExpressRoute in US East to Azure US East.</span></span> <span data-ttu-id="5a3a6-132">Her iki tarafta da yönlendirme en iyi duruma getirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-132">Routing is optimized on both sides.</span></span> 

![ExpressRoute Vaka 1 çözümü: BGP Toplulukları’nı kullanın](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="5a3a6-134">Yerel Tercih kullanılarak aynı teknik müşteriden Azure Sanal Ağına yönlendirme için uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-134">The same technique, using Local Preference, can be applied to routing from customer to Azure Virtual Network.</span></span> <span data-ttu-id="5a3a6-135">BGP Topluluğu değeri, Azure’dan ağınıza tanıtılan ön eklere etiketlenmez.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-135">We don't tag BGP Community value to the prefixes advertised from Azure to your network.</span></span> <span data-ttu-id="5a3a6-136">Ancak, ofisinize en yakın Sanal Ağ dağıtımını siz bildiğiniz için, bir ExpressRoute devresini diğerine tercih etmek üzere yönlendiricilerinizi yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-136">However, since you know which of your Virtual Network deployment is close to which of your office, you can configure your routers accordingly to prefer one ExpressRoute circuit to another.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-to-customer"></a><span data-ttu-id="5a3a6-137">Microsoft'tan müşteriye yetersiz yönlendirme</span><span class="sxs-lookup"><span data-stu-id="5a3a6-137">Suboptimal routing from Microsoft to customer</span></span>
<span data-ttu-id="5a3a6-138">Burada Microsoft bağlantılarının ağınıza ulaşmasına için daha uzun bir yol aldığı başka bir örnek gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-138">Here is another example where connections from Microsoft take a longer path to reach your network.</span></span> <span data-ttu-id="5a3a6-139">Bu durumda, [karma bir ortamda](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx) şirket içi Exchange sunucularını ve Exchange Online kullanın.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="5a3a6-140">Ofisleriniz bir WAN’a bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-140">Your offices are connected to a WAN.</span></span> <span data-ttu-id="5a3a6-141">İki ExpressRoute bağlantı hattı aracılığıyla her iki ofisinizdeki şirket için sunucuların öneklerini Microsoft’a tanıtırsınız.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-141">You advertise the prefixes of your on-premises servers in both of your offices to Microsoft through the two ExpressRoute circuits.</span></span> <span data-ttu-id="5a3a6-142">Exchange Online, posta kutusu geçişi gibi durumlarda şirket içi sunuculara bağlantılar başlatır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-142">Exchange Online will initiate connections to the on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="5a3a6-143">Ne yazık ki, Los Angeles ofisinizin bağlantısı batı yakasına dönerken tüm kıtadan geçmeden önce ABD Doğu’daki ExpressRoute bağlantı hattına yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-143">Unfortunately, the connection to your Los Angeles office is routed to the ExpressRoute circuit in US East before traversing the entire continent back to the west coast.</span></span> <span data-ttu-id="5a3a6-144">Sorunun nedeni birinciye benzemektedir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-144">The cause of the problem is similar to the first one.</span></span> <span data-ttu-id="5a3a6-145">Herhangi bir ipucu olmadan, Microsoft ağı hangi müşteri önekinin ABD Doğu'ya veya ABD Batı’ya yakın olduğunu bildiremez.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-145">Without any hint, the Microsoft network can't tell which customer prefix is close to US East and which one is close to US West.</span></span> <span data-ttu-id="5a3a6-146">Los Angeles’taki ofisiniz için yanlış yolu seçmiş olabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-146">It happens to pick the wrong path to your office in Los Angeles.</span></span>

![ExpressRoute Vaka 2: Microsoft'tan müşteriye yetersiz yönlendirme](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="5a3a6-148">Çözüm: AS YOLU eklenmesini kullanın</span><span class="sxs-lookup"><span data-stu-id="5a3a6-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="5a3a6-149">Bu sorunun iki çözümü vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-149">There are two solutions to the problem.</span></span> <span data-ttu-id="5a3a6-150">Birinci yol Los Angeles ofisiniz için ABD Batı’daki ExpressRoute bağlantı hattındaki 177.2.0.0/31 şirket içi öneki ve New York ofisiniz için ABD Doğu’daki ExpressRoute bağlantı hattındaki 177.2.0.2/31 şirket içi önekini tanıtmanızdır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-150">The first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on the ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="5a3a6-151">Sonuç olarak, Microsoft’un ofislerinizin her birine bağlanması için yalnızca bir yol vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-151">As a result, there is only one path for Microsoft to connect to each of your offices.</span></span> <span data-ttu-id="5a3a6-152">Belirsizlik olmaz ve yönlendirme en iyi duruma getirilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="5a3a6-153">Bu tasarımla, yük devretme stratejinizi düşünmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-153">With this design, you need to think about your failover strategy.</span></span> <span data-ttu-id="5a3a6-154">ExpressRoute aracılığıyla Microsoft yolunun bozuk olması durumunda, Exchange Online’ın yine de şirket içi sunucularına bağlandığından emin olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-154">In the event that the path to Microsoft via ExpressRoute is broken, you need to make sure that Exchange Online can still connect to your on-premises servers.</span></span> 

<span data-ttu-id="5a3a6-155">İkinci çözüm, her iki ExpressRoute bağlantı hattında iki öneki de tanıtmaya devam etmeniz ve buna ek olarak, hangi önekin hangi ofisinize daha yakın olduğu ile ilgili bize ipucu vermenizdir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-155">The second solution is that you continue to advertise both of the prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close to which one of your offices.</span></span> <span data-ttu-id="5a3a6-156">BGP AS Yolu eklenmesini desteklediğimizden, yönlendirmeyi etkilemek için önekiniz için AS Yolu’nu yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-156">Because we support BGP AS Path prepending, you can configure the AS Path for your prefix to influence routing.</span></span> <span data-ttu-id="5a3a6-157">Bu örnekte, bu önek (ağımız bu önek yolunun batıdan daha kısa olacağını düşüneceğinden) için hedeflenen trafikte ABD Batı’daki ExpressRoute bağlantı hattını tercih edeceğimizden, ABD Doğu’daki 172.2.0.0/31 AS YOLU’nu uzatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-157">In this example, you can lengthen the AS PATH for 172.2.0.0/31 in US East so that we will prefer the ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think the path to this prefix is shorter in the west).</span></span> <span data-ttu-id="5a3a6-158">Benzer şekilde, ABD Doğu ExpressRoute bağlantı hattını tercih edeceğimiz için, ABD Batı’daki 172.2.0.2/31 için AS YOLU’nu uzatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-158">Similarly you can lengthen the AS PATH for 172.2.0.2/31 in US West so that we'll prefer the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="5a3a6-159">Her iki ofis için de yönlendirme en iyi duruma getirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="5a3a6-160">Bu tasarımla, bir ExpressRoute bağlantı hattı bozuk ise, Exchange Online başka bir ExpressRoute bağlantı hattı ve WAN’ınız aracılığıyla yine de size ulaşabilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="5a3a6-161">Microsoft Eşlemesi’nde alınan önekler için AS YOLU’ndaki özel AS numaralarını kaldırırız.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-161">We remove private AS numbers in the AS PATH for the prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="5a3a6-162">Microsoft Eşlemesi için yönlendirmeyi etkilemek amacıyla AS YOLU’nda ortak AS numaraları eklemeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-162">You need to append public AS numbers in the AS PATH to influence routing for Microsoft Peering.</span></span>
> 
> 

![ExpressRoute Vaka 2 çözümü: AS YOLU eklenmesini kullanın](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="5a3a6-164">Burada verilen örnekler Microsoft ve Ortak eşlemelere yöneliktir, ancak Özel eşleme için de aynı özellikleri destekleriz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-164">While the examples given here are for Microsoft and Public peerings, we do support the same capabilities for the Private peering.</span></span> <span data-ttu-id="5a3a6-165">Ayrıca AS Yolu ekleme, birincil ve ikincil yolların seçimini etkilemek için tek bir ExpressRoute devresi içinde çalışır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-165">Also, the AS Path prepending works within one single ExpressRoute circuit, to influence the selection of the primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="5a3a6-166">Sanal ağlar arasında yetersiz yönlendirme</span><span class="sxs-lookup"><span data-stu-id="5a3a6-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="5a3a6-167">ExpressRoute ile Sanal Ağdan Sanal Ağa (aynı zamanda "VNet" olarak bilinir) iletişimi bir ExpressRoute devresine bağlayarak etkinleştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-167">With ExpressRoute, you can enable Virtual Network to Virtual Network (which is also known as "VNet") communication by linking them to an ExpressRoute circuit.</span></span> <span data-ttu-id="5a3a6-168">Birden fazla ExpressRoute devresine bağladığınızda, sanal ağlar arasında yetersiz yönlendirme gerçekleşebilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-168">When you link them to multiple ExpressRoute circuits, suboptimal routing can happen between the VNets.</span></span> <span data-ttu-id="5a3a6-169">Bir örnek düşünelim.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-169">Let's consider an example.</span></span> <span data-ttu-id="5a3a6-170">Biri ABD Batı ve diğeri ABD Doğu’da olmak üzere iki ExpressRoute devreniz vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="5a3a6-171">Her bölgede, iki sanal ağınız vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-171">In each region, you have two VNets.</span></span> <span data-ttu-id="5a3a6-172">Web sunucularınız bir sanal ağa, uygulama sunucularınız diğerine dağıtılmaktadır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-172">Your web servers are deployed in one VNet and application servers in the other.</span></span> <span data-ttu-id="5a3a6-173">Artıklık için her bölgedeki iki sanal ağı hem yerel ExpressRoute devresine hem de uzak ExpressRoute devresine bağlarsınız.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-173">For redundancy, you link the two VNets in each region to both the local ExpressRoute circuit and the remote ExpressRoute circuit.</span></span> <span data-ttu-id="5a3a6-174">Aşağıda görülebileceği gibi, her sanal ağdan diğer sanal ağa iki yol vardır.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-174">As can be seen below, from each VNet there are two paths to the other VNet.</span></span> <span data-ttu-id="5a3a6-175">Sanal ağlar, hangi ExpressRoute devresinin yerel, hangisinin uzak olduğunu bilmez.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-175">The VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="5a3a6-176">Sonuç olarak, sanal ağlar arası yük dengelemesi için Eşit Maliyetli Çoklu Yol (ECMP) yönlendirmesi yaptıkları için, bazı trafik akışları daha uzun yoldan gider ve uzak ExpressRoute devresine yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing to load-balance inter-VNet traffic, some traffic flows will take the longer path and get routed at the remote ExpressRoute circuit.</span></span>

![ExpressRoute Vaka 3: Sanal ağlar arasında yetersiz yönlendirme](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-to-local-connection"></a><span data-ttu-id="5a3a6-178">Çözüm: yerel bağlantıya yüksek ağırlık atayın</span><span class="sxs-lookup"><span data-stu-id="5a3a6-178">Solution: assign a high weight to local connection</span></span>
<span data-ttu-id="5a3a6-179">Çözüm basittir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-179">The solution is simple.</span></span> <span data-ttu-id="5a3a6-180">Sanal ağların ve bağlantı hatlarının nerede olduğunu bildiğiniz için, her bir sanal ağın hangi yolu tercih etmesi gerektiğini siz belirleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-180">Since you know where the VNets and the circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="5a3a6-181">Özellikle bu örnek için, yerel bağlantıya atadığınız ağırlık, uzak bağlantıya atadığınız ağırlıktan daha yüksek olmalıdır ([buradaki](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection) yapılandırma örneğine bakın).</span><span class="sxs-lookup"><span data-stu-id="5a3a6-181">Specifically for this example, you assign a higher weight to the local connection than to the remote connection (see the configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="5a3a6-182">Bir sanal ağ, birden fazla bağlantıda diğer sanal ağın ön ekini alırsa, bu ön eki hedefleyen trafiği göndermek için ağırlık değeri en fazla olan bağlantıyı tercih eder.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-182">When a VNet receives the prefix of the other VNet on multiple connections it will prefer the connection with the highest weight to send traffic destined for that prefix.</span></span>

![ExpressRoute Vaka 3 çözümü - yerel bağlantıya yüksek ağırlık atayın](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="5a3a6-184">Ayrıca, birden fazla ExpressRoute devreniz varsa, yukarıdaki örnekte açıklanan AS YOLU eklenme tekniğini uygulamak yerine ağırlığı yapılandırarak sanal ağınızdan şirket içi ağınıza yönlendirmeyi etkileyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-184">You can also influence routing from VNet to your on-premises network, if you have multiple ExpressRoute circuits, by configuring the weight of a connection instead of applying AS PATH prepending, a technique described in the second scenario above.</span></span> <span data-ttu-id="5a3a6-185">Her ön ek için, trafiğin nasıl gönderileceğine karar verirken AS Yolu uzunluğundan önce mutlaka bağlantı ağırlığına bakmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="5a3a6-185">For each prefix, we will always look at the connection weight before the AS Path length when deciding how to send traffic.</span></span>
>
>
