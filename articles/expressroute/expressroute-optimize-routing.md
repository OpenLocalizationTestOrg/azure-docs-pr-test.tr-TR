---
title: "ExpressRoute yönlendirmesini en iyi duruma getirme: Azure | Microsoft Docs"
description: "Bu sayfa nasıl birden fazla ExpressRoute olduğunda toooptimize yönlendirme, bağlantı hattına Ayrıntılar corp ağınız ve Microsoft arasında bağlantı sağlar."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="034aa-103">ExpressRoute Yönlendirmeyi En iyi Duruma Getirme</span><span class="sxs-lookup"><span data-stu-id="034aa-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="034aa-104">Birden çok ExpressRoute bağlantı hattına sahip birden fazla yol tooconnect tooMicrosoft vardır.</span><span class="sxs-lookup"><span data-stu-id="034aa-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="034aa-105">Sonuç olarak, yetersiz yönlendirme olabilir - diğer bir deyişle, trafiğinizin daha uzun bir yol tooreach Microsoft, alabilir ve Microsoft tooyour ağ.</span><span class="sxs-lookup"><span data-stu-id="034aa-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="034aa-106">Merhaba uzun hello ağ yolu, hello daha yüksek hello gecikme süresi.</span><span class="sxs-lookup"><span data-stu-id="034aa-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="034aa-107">Gecikmenin uygulama performansı ve kullanıcı deneyimi üzerinde doğrudan etkisi vardır.</span><span class="sxs-lookup"><span data-stu-id="034aa-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="034aa-108">Bu makalede, bu sorunu gösterir ve standart yönlendirme teknolojilerini kullanarak yönlendirme toooptimize nasıl hello açıklar.</span><span class="sxs-lookup"><span data-stu-id="034aa-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="034aa-109">Yetersiz müşteri tooMicrosoft yönlendirme</span><span class="sxs-lookup"><span data-stu-id="034aa-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="034aa-110">Bir kapatma hello yönlendirme sorun örneği tarafından bakalım.</span><span class="sxs-lookup"><span data-stu-id="034aa-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="034aa-111">Merhaba ABD, biri, Los Angeles ve diğeri New York'ta içinde iki ofisiniz olduğunu düşünün.</span><span class="sxs-lookup"><span data-stu-id="034aa-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="034aa-112">Ofisleriniz, kendi omurga ağınız veya hizmet sağlayıcınızın IP VPN’i olabilen bir Geniş Alan Ağı (WAN) üzerine bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="034aa-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="034aa-113">ABD Batı'daki biri diğeri ABD Doğu'daki hello WAN üzerinde de bağlanan, iki ExpressRoute bağlantı hatları var.</span><span class="sxs-lookup"><span data-stu-id="034aa-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="034aa-114">Belli ki, iki yolları tooconnect toohello Microsoft ağına sahip.</span><span class="sxs-lookup"><span data-stu-id="034aa-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="034aa-115">Şimdi, hem ABD Batı hem de ABD Doğu’da Azure dağıtımına (örneğin, Azure Uygulama Hizmeti) sahip olduğunuzu düşünün.</span><span class="sxs-lookup"><span data-stu-id="034aa-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="034aa-116">Amacınız her office Access'in kullanıcılara en iyi deneyimler için Azure services yakındaki hello Hizmet yöneticiniz tanıtır tooconnect Los Angeles tooAzure ABD Batı'nda kullanıcılarınıza ve New York tooAzure ABD Doğu'nda kullanıcılarınıza olduğundan.</span><span class="sxs-lookup"><span data-stu-id="034aa-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="034aa-117">Ne yazık ki, hello planı iyi hello Doğu Yakası kullanıcıları için kullanılabilir ancak hello Batı Yakası kullanıcıları üretir.</span><span class="sxs-lookup"><span data-stu-id="034aa-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="034aa-118">Merhaba hello sorunun nedenini hello aşağıda verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="034aa-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="034aa-119">Her expressroute bağlantı hattı üzerinde şu hello öneki Azure ABD Doğu (23.100.0.0/16) hem Azure ABD Batı'daki (13.100.0.0/16) önekini hello tooyou tanıtır.</span><span class="sxs-lookup"><span data-stu-id="034aa-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="034aa-120">Hangi önekin hangi bölgeden olduğunu bilmiyorsanız, mümkün tootreat olmayan, farklı.</span><span class="sxs-lookup"><span data-stu-id="034aa-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="034aa-121">WAN ağınız hello öneklerini her ikisi de yakın tooUS Doğu ABD Batı'dan olan ve bu nedenle hem office kullanıcılar toohello expressroute bağlantı hattı ABD Doğu'rota düşünebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="034aa-122">Merhaba sonunda, Los Angeles office hello birçok mutsuz kullanıcılar gerekir.</span><span class="sxs-lookup"><span data-stu-id="034aa-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![ExpressRoute durum 1 sorunu - müşteri tooMicrosoft yönlendirme yetersiz](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="034aa-124">Çözüm: BGP Toplulukları’nı kullanın</span><span class="sxs-lookup"><span data-stu-id="034aa-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="034aa-125">toooptimize her iki ofis kullanıcıları için yönlendirmeyi, hangi önekin Azure Batı ABD ve hangi Azure Doğu ABD olduğunu tooknow gerekir.</span><span class="sxs-lookup"><span data-stu-id="034aa-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="034aa-126">Bu bilgileri [BGP Topluluğu değerlerini](expressroute-routing.md) kullanarak kodlarız.</span><span class="sxs-lookup"><span data-stu-id="034aa-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="034aa-127">Benzersiz bir BGP topluluğu değeri tooeach Azure bölgesi, örneğin atanan Doğu ABD için "12076:51004", Batı ABD için "12076:51006".</span><span class="sxs-lookup"><span data-stu-id="034aa-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="034aa-128">Artık hangi önekin hangi Azure bölgesinden olduğunu bildiğinize göre, tercih edilmesi gereken ExpressRoute bağlantı hattını yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="034aa-129">Merhaba BGP tooexchange yönlendirme bilgilerinin kullandığımız için BGP'nin yerel tercihini tooinfluence yönlendirme kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="034aa-130">Bizim örneğimizde, ABD Doğu'daki daha ABD Batı'daki daha yüksek bir yerel tercih değeri too13.100.0.0/16 ve benzer şekilde, ABD Doğu'daki ABD Batı'daki daha yüksek bir yerel tercih değeri too23.100.0.0/16 atayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="034aa-131">Bu yapılandırma her iki yolları tooMicrosoft kullanılabilir, New York'taki kullanıcılarınız ABD Doğu tooAzure ABD Doğu ExpressRoute hello kullanırken Los Angeles'taki kullanıcılarınızın hello BİZE Batı tooconnect tooAzure ABD Batı'daki expressroute bağlantı hattına olur, emin olun .</span><span class="sxs-lookup"><span data-stu-id="034aa-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="034aa-132">Her iki tarafta da yönlendirme en iyi duruma getirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="034aa-132">Routing is optimized on both sides.</span></span> 

![ExpressRoute Vaka 1 çözümü: BGP Toplulukları’nı kullanın](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="034aa-134">Yerel tercihini kullanarak aynı tekniği Merhaba, müşteri tooAzure sanal ağ'dan uygulanan toorouting olabilir.</span><span class="sxs-lookup"><span data-stu-id="034aa-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="034aa-135">Biz Azure tooyour ağdan tanıtılan BGP topluluk değeri toohello ön eklere yok.</span><span class="sxs-lookup"><span data-stu-id="034aa-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="034aa-136">Sanal ağ dağıtımınız, Office'in Kapat toowhich olduğu bildiğiniz olduğundan, ancak yönlendiricileriniz uygun şekilde yapılandırabilirsiniz tooprefer bir ExpressRoute bağlantı hattı tooanother.</span><span class="sxs-lookup"><span data-stu-id="034aa-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="034aa-137">Yetersiz Microsoft toocustomer yönlendirme</span><span class="sxs-lookup"><span data-stu-id="034aa-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="034aa-138">İşte başka bir örnek burada Microsoft bağlantılarının ağınıza daha uzun bir yol tooreach alın.</span><span class="sxs-lookup"><span data-stu-id="034aa-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="034aa-139">Bu durumda, [karma bir ortamda](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx) şirket içi Exchange sunucularını ve Exchange Online kullanın.</span><span class="sxs-lookup"><span data-stu-id="034aa-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="034aa-140">Ofisleriniz bağlı tooa WAN ' dir.</span><span class="sxs-lookup"><span data-stu-id="034aa-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="034aa-141">Şirket içi sunucularınızı hem de, ofisler tooMicrosoft hello iki ExpressRoute bağlantı hatları aracılığıyla hello öneklerini tanıtır.</span><span class="sxs-lookup"><span data-stu-id="034aa-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="034aa-142">Exchange Online posta kutusu geçişi gibi durumlarda bağlantıları toohello şirket içi sunucular başlatır.</span><span class="sxs-lookup"><span data-stu-id="034aa-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="034aa-143">Ne yazık ki, hello bağlantı tooyour Los Angeles office hello tüm kıtadan geçmeden geri toohello Batı Yakası geçiş önce yönlendirilmiş toohello ABD Doğu'daki expressroute bağlantı hattı olur.</span><span class="sxs-lookup"><span data-stu-id="034aa-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="034aa-144">Merhaba hello sorununun benzer toohello nedeni ilk.</span><span class="sxs-lookup"><span data-stu-id="034aa-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="034aa-145">Herhangi bir ipucu hello Microsoft ağı hangi müşteri önekinin Kapat tooUS Doğu ve hangisinin tooUS Batı kapatmak bildiremez.</span><span class="sxs-lookup"><span data-stu-id="034aa-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="034aa-146">Toopick hello yanlış yolu tooyour Los Angeles ofisinde olur.</span><span class="sxs-lookup"><span data-stu-id="034aa-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![2 - Microsoft toocustomer yönlendirme yetersiz ExpressRoute durumu](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="034aa-148">Çözüm: AS YOLU eklenmesini kullanın</span><span class="sxs-lookup"><span data-stu-id="034aa-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="034aa-149">İki çözümleri toohello sorun vardır.</span><span class="sxs-lookup"><span data-stu-id="034aa-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="034aa-150">Merhaba ilk Los Angeles ofisiniz hello ABD Batı'daki expressroute bağlantı hattı üzerinde 177.2.0.0/31 için şirket içi öneki yalnızca tanıtım ve New York ofisiniz 177.2.0.2/31 şirket hello ABD Doğu'daki expressroute bağlantı hattı için şirket içi öneki biridir.</span><span class="sxs-lookup"><span data-stu-id="034aa-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="034aa-151">Sonuç olarak, Microsoft tooconnect tooeach ofisinize için yalnızca bir yolu yoktur.</span><span class="sxs-lookup"><span data-stu-id="034aa-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="034aa-152">Belirsizlik olmaz ve yönlendirme en iyi duruma getirilir.</span><span class="sxs-lookup"><span data-stu-id="034aa-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="034aa-153">Bu tasarımla, yük devretme stratejinizi toothink gerekir.</span><span class="sxs-lookup"><span data-stu-id="034aa-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="034aa-154">Hello yolu tooMicrosoft ExpressRoute aracılığıyla hello olay bozuk, Exchange Online hala tooyour şirket içi sunucular bağlanabildiğinden emin toomake gerekir.</span><span class="sxs-lookup"><span data-stu-id="034aa-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="034aa-155">Merhaba ikinci iki expressroute bağlantı hattında tooadvertise hem hello öneklerini, devam etmek ve ayrıca bize hangi önekin Kapat toowhich bir ofisinize olduğunu ipucu size çözümüdür.</span><span class="sxs-lookup"><span data-stu-id="034aa-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="034aa-156">BGP AS yolu eklenmesini desteklemek için önek tooinfluence yönlendirme için hello AS Yolu'nu yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="034aa-157">Bu örnekte, böylece ABD Batı'daki hello expressroute bağlantı hattı için bu önek (ağımız hello yolu toothis öneki hello batıdan daha kısa olacağını düşüneceğinden) hedefleyen trafik için tercih eder ABD Doğu'daki 172.2.0.0/31 AS yolu hello uzatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="034aa-158">Benzer şekilde biz hello ABD Doğu'daki expressroute bağlantı hattını tercih ABD Batı'daki 172.2.0.2/31 için AS YOLU'nu hello uzatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="034aa-159">Her iki ofis için de yönlendirme en iyi duruma getirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="034aa-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="034aa-160">Bu tasarımla, bir ExpressRoute bağlantı hattı bozuk ise, Exchange Online başka bir ExpressRoute bağlantı hattı ve WAN’ınız aracılığıyla yine de size ulaşabilir.</span><span class="sxs-lookup"><span data-stu-id="034aa-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="034aa-161">Microsoft Peering'nde hello önekler için AS YOLU'nu hello numaraları alındı olarak size özel kaldırın.</span><span class="sxs-lookup"><span data-stu-id="034aa-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="034aa-162">Tooappend gereken ortak AS numaraları akışındaki hello AS yolu tooinfluence Microsoft Peering için.</span><span class="sxs-lookup"><span data-stu-id="034aa-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![ExpressRoute Vaka 2 çözümü: AS YOLU eklenmesini kullanın](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="034aa-164">Burada verilen hello örnekleri Microsoft ve ortak eşlemeleri için olsa da, destekliyoruz hello hello özel eşleme için aynı yetenekleri.</span><span class="sxs-lookup"><span data-stu-id="034aa-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="034aa-165">Ayrıca, hello AS yolu eklenmesini tek tek expressroute bağlantı hattı içinde tooinfluence hello seçimi hello birincil ve ikincil yol çalışır.</span><span class="sxs-lookup"><span data-stu-id="034aa-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="034aa-166">Sanal ağlar arasında yetersiz yönlendirme</span><span class="sxs-lookup"><span data-stu-id="034aa-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="034aa-167">ExpressRoute ile sanal ağ tooVirtual (olan olarak da bilinen "VNet") ağ etkinleştirebilirsiniz tooan expressroute bağlantı hattı bağlayarak iletişim.</span><span class="sxs-lookup"><span data-stu-id="034aa-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="034aa-168">Toomultiple ExpressRoute bağlantı hatları bağlantı, yetersiz yönlendirme hello sanal ağlar arasında ortaya çıkar.</span><span class="sxs-lookup"><span data-stu-id="034aa-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="034aa-169">Bir örnek düşünelim.</span><span class="sxs-lookup"><span data-stu-id="034aa-169">Let's consider an example.</span></span> <span data-ttu-id="034aa-170">Biri ABD Batı ve diğeri ABD Doğu’da olmak üzere iki ExpressRoute devreniz vardır.</span><span class="sxs-lookup"><span data-stu-id="034aa-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="034aa-171">Her bölgede, iki sanal ağınız vardır.</span><span class="sxs-lookup"><span data-stu-id="034aa-171">In each region, you have two VNets.</span></span> <span data-ttu-id="034aa-172">Web sunucusu, bir VNet içinde dağıtılır ve uygulama sunucuları diğer hello.</span><span class="sxs-lookup"><span data-stu-id="034aa-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="034aa-173">Fazlalık için bağlantı iki Vnet'in de her bölgeye tooboth hello yerel expressroute bağlantı hattı hello ve uzak expressroute bağlantı hattı hello.</span><span class="sxs-lookup"><span data-stu-id="034aa-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="034aa-174">Aşağıda görüldüğü gibi her sanal ağdan vardır iki yolları toohello diğer sanal ağ.</span><span class="sxs-lookup"><span data-stu-id="034aa-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="034aa-175">expressroute bağlantı hattını yerel ve hangisinin uzak Hello sanal ağlar bilmediğiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="034aa-176">Sonuç olarak eşit maliyet çoklu yol (ECMP) yönlendirme tooload Bakiye arası-VNet trafiği yapmak gibi bazı trafik akışına hello uzun yol sürer ve hello uzak expressroute bağlantı hattı yönlendirilmiş.</span><span class="sxs-lookup"><span data-stu-id="034aa-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![ExpressRoute Vaka 3: Sanal ağlar arasında yetersiz yönlendirme](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="034aa-178">Çözüm: yüksek ağırlık toolocal bağlantı atayın</span><span class="sxs-lookup"><span data-stu-id="034aa-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="034aa-179">Merhaba çözüm, basit bir işlemdir.</span><span class="sxs-lookup"><span data-stu-id="034aa-179">hello solution is simple.</span></span> <span data-ttu-id="034aa-180">Merhaba sanal ağlar ve hello devreler nerede bildiğiniz olduğundan, bize her VNet tercih etmelisiniz yolu anlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="034aa-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="034aa-181">Özellikle bu örnek için daha yüksek ağırlık toohello yerel bağlantı toohello uzak bağlantı daha atayın (Merhaba yapılandırma örneği bkz [burada](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="034aa-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="034aa-182">Bir VNet hello hello öneki aldığında diğer VNet birden çok bağlantı üzerinde onu hello bağlantı için bu önek hedefleyen hello en yüksek ağırlık toosend trafiği ile tercih eder.</span><span class="sxs-lookup"><span data-stu-id="034aa-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![ExpressRoute servis talebi 3 çözüm - Ata yüksek ağırlık toolocal bağlantı](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="034aa-184">Ayrıca, birden çok ExpressRoute bağlantı hatları AS yolu eklenmesini, hello İkinci senaryoda yukarıda açıklanan teknikleri uygulamak yerine bir bağlantı hello ağırlığını yapılandırarak varsa VNet tooyour şirket içi ağdan yönlendirme etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="034aa-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="034aa-185">Her öneki için her zaman hello bağlantı ağırlık hello AS yol uzunluğu önce karar verirken ele alacağız nasıl toosend trafiği.</span><span class="sxs-lookup"><span data-stu-id="034aa-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
