---
title: "Anahtar kasası (Klasik) azure'da Windows vm'lerinde SQL Server ile aaaIntegrate | Microsoft Docs"
description: "Nasıl tooautomate hello Azure anahtar kasası ile kullanmak için SQL Server şifreleme yapılandırma hakkında bilgi edinin. Bu konu, SQL Server sanal makinelerle toouse Azure anahtar kasası tümleştirmeyi hello Klasik dağıtım modelinde nasıl oluşturacağınızı açıklar."
services: virtual-machines-windows
documentationcenter: 
author: rothja
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: ab8d41a7-1971-4032-ab71-eb435c455dc1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 02/17/2017
ms.author: jroth
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 54664875b76dac7271d5a9f00b3f41fdc9c08491
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-key-vault-integration-for-sql-server-on-azure-virtual-machines-classic"></a><span data-ttu-id="4d4bf-104">SQL Server için Azure anahtar kasası tümleştirme Azure sanal makinelerde (Klasik) yapılandırma</span><span class="sxs-lookup"><span data-stu-id="4d4bf-104">Configure Azure Key Vault Integration for SQL Server on Azure Virtual Machines (Classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="4d4bf-105">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="4d4bf-105">Resource Manager</span></span>](../sql/virtual-machines-windows-ps-sql-keyvault.md)
> * [<span data-ttu-id="4d4bf-106">Klasik</span><span class="sxs-lookup"><span data-stu-id="4d4bf-106">Classic</span></span>](../classic/ps-sql-keyvault.md)
> 
> 

## <a name="overview"></a><span data-ttu-id="4d4bf-107">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="4d4bf-107">Overview</span></span>
<span data-ttu-id="4d4bf-108">Birden çok SQL Server şifreleme özellikleri vardır, gibi [saydam veri şifreleme (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [sütun düzeyinde şifreleme (Temizle)](https://msdn.microsoft.com/library/ms173744.aspx), ve [yedek şifreleme](https://msdn.microsoft.com/library/dn449489.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d4bf-108">There are multiple SQL Server encryption features, such as [transparent data encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [column level encryption (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), and [backup encryption](https://msdn.microsoft.com/library/dn449489.aspx).</span></span> <span data-ttu-id="4d4bf-109">Bu formlar şifreleme ve şifreleme için kullandığınız hello şifreleme anahtarlarını saklamak toomanage gerektirir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-109">These forms of encryption require you toomanage and store hello cryptographic keys you use for encryption.</span></span> <span data-ttu-id="4d4bf-110">Hello Azure anahtar kasası (AKV) hizmeti tasarlanmış tooimprove hello güvenliği ve yönetimi için güvenli ve yüksek oranda kullanılabilir bir konumda Bu anahtarları ' dir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-110">hello Azure Key Vault (AKV) service is designed tooimprove hello security and management of these keys in a secure and highly available location.</span></span> <span data-ttu-id="4d4bf-111">Merhaba [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) SQL Server toouse Bu anahtarları Azure anahtar Kasası'ndan sağlar.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-111">hello [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) enables SQL Server toouse these keys from Azure Key Vault.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="4d4bf-112">Azure oluşturmak ve kaynaklarla çalışmak için iki farklı dağıtım modeli vardır: [Resource Manager ve klasik](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="4d4bf-112">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="4d4bf-113">Bu makalede, hello Klasik dağıtım modeli kullanarak yer almaktadır.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-113">This article covers using hello Classic deployment model.</span></span> <span data-ttu-id="4d4bf-114">Microsoft, en yeni dağıtımların hello Resource Manager modelini kullanmasını önerir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-114">Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

<span data-ttu-id="4d4bf-115">Şirket içi makineler ile SQL Server çalışıyorsa, vardır [şirket içi SQL Server makinenizden tooaccess Azure anahtar kasası izlemeniz adımları](https://msdn.microsoft.com/library/dn198405.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d4bf-115">If you are running SQL Server with on-premises machines, there are [steps you can follow tooaccess Azure Key Vault from your on-premises SQL Server machine](https://msdn.microsoft.com/library/dn198405.aspx).</span></span> <span data-ttu-id="4d4bf-116">Ancak Azure vm'lerinde SQL Server için hello kullanarak zaman kazanabilirsiniz *Azure anahtar kasası tümleştirmeyi* özelliği.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-116">But for SQL Server in Azure VMs, you can save time by using hello *Azure Key Vault Integration* feature.</span></span> <span data-ttu-id="4d4bf-117">Bu özellik ile birkaç Azure PowerShell cmdlet'leri tooenable otomatikleştirebilirsiniz yapılandırması için bir SQL VM tooaccess gerekli anahtar kasanızı hello.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-117">With a few Azure PowerShell cmdlets tooenable this feature, you can automate hello configuration necessary for a SQL VM tooaccess your key vault.</span></span>

<span data-ttu-id="4d4bf-118">Bu özellik etkinleştirildiğinde, otomatik olarak yükler hello SQL Server Bağlayıcısı, hello EKM sağlayıcısı tooaccess Azure anahtar kasası yapılandırır ve hello kimlik bilgisi tooallow oluşturur, tooaccess kasanızı.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-118">When this feature is enabled, it automatically installs hello SQL Server Connector, configures hello EKM provider tooaccess Azure Key Vault, and creates hello credential tooallow you tooaccess your vault.</span></span> <span data-ttu-id="4d4bf-119">Konumundaki görünüyorsa hello hello adımlarda şirket içi belgelerine daha önce bahsedilen, bu özellik adım 2 ve 3 otomatikleştirir görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-119">If you looked at hello steps in hello previously mentioned on-premises documentation, you can see that this feature automates steps 2 and 3.</span></span> <span data-ttu-id="4d4bf-120">toodo el ile gerekir hello yalnızca toocreate hello anahtar kasasını ve anahtarları şeydir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-120">hello only thing you would still need toodo manually is toocreate hello key vault and keys.</span></span> <span data-ttu-id="4d4bf-121">Buradan, hello tüm Kurulum, SQL VM otomatik hale getirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-121">From there, hello entire setup of your SQL VM is automated.</span></span> <span data-ttu-id="4d4bf-122">Bu özellik, bu kurulum tamamlandıktan sonra veritabanları veya yedeklemeler normal olarak şifreleme T-SQL deyimleri toobegin yürütebilir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-122">Once this feature has completed this setup, you can execute T-SQL statements toobegin encrypting your databases or backups as you normally would.</span></span>

[!INCLUDE [AKV Integration Prepare](../../../../includes/virtual-machines-sql-server-akv-prepare.md)]

## <a name="configure-akv-integration"></a><span data-ttu-id="4d4bf-123">AKV tümleştirme yapılandırın</span><span class="sxs-lookup"><span data-stu-id="4d4bf-123">Configure AKV Integration</span></span>
<span data-ttu-id="4d4bf-124">PowerShell tooconfigure Azure anahtar kasası tümleştirmeyi kullanın.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-124">Use PowerShell tooconfigure Azure Key Vault Integration.</span></span> <span data-ttu-id="4d4bf-125">Aşağıdaki bölümlerde hello hello gerekli parametreleri genel bir bakış ve örnek bir PowerShell komut dosyası sağlar.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-125">hello following sections provide an overview of hello required parameters and then a sample PowerShell script.</span></span>

### <a name="install-hello-sql-server-iaas-extension"></a><span data-ttu-id="4d4bf-126">SQL Server Iaas uzantısı Hello yükleyin</span><span class="sxs-lookup"><span data-stu-id="4d4bf-126">Install hello SQL Server IaaS Extension</span></span>
<span data-ttu-id="4d4bf-127">İlk olarak, [hello SQL Server Iaas uzantısı yüklemek](../classic/sql-server-agent-extension.md).</span><span class="sxs-lookup"><span data-stu-id="4d4bf-127">First, [install hello SQL Server IaaS Extension](../classic/sql-server-agent-extension.md).</span></span>

### <a name="understand-hello-input-parameters"></a><span data-ttu-id="4d4bf-128">Merhaba giriş parametreleri anlamak</span><span class="sxs-lookup"><span data-stu-id="4d4bf-128">Understand hello input parameters</span></span>
<span data-ttu-id="4d4bf-129">Merhaba aşağıdaki tabloda listeleri hello parametreleri toorun hello PowerShell Betiği hello sonraki bölümde gereklidir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-129">hello following table lists hello parameters required toorun hello PowerShell script in hello next section.</span></span>

| <span data-ttu-id="4d4bf-130">Parametre</span><span class="sxs-lookup"><span data-stu-id="4d4bf-130">Parameter</span></span> | <span data-ttu-id="4d4bf-131">Açıklama</span><span class="sxs-lookup"><span data-stu-id="4d4bf-131">Description</span></span> | <span data-ttu-id="4d4bf-132">Örnek</span><span class="sxs-lookup"><span data-stu-id="4d4bf-132">Example</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4d4bf-133">**$akvURL**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-133">**$akvURL**</span></span> |<span data-ttu-id="4d4bf-134">**Merhaba anahtar kasası URL'si**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-134">**hello key vault URL**</span></span> |<span data-ttu-id="4d4bf-135">"https://contosokeyvault.vault.azure.net/"</span><span class="sxs-lookup"><span data-stu-id="4d4bf-135">"https://contosokeyvault.vault.azure.net/"</span></span> |
| <span data-ttu-id="4d4bf-136">**$spName**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-136">**$spName**</span></span> |<span data-ttu-id="4d4bf-137">**Hizmet asıl adı**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-137">**Service Principal name**</span></span> |<span data-ttu-id="4d4bf-138">"fde2b411 - 33d 5-4e11-af04eb07b669ccf2"</span><span class="sxs-lookup"><span data-stu-id="4d4bf-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span></span> |
| <span data-ttu-id="4d4bf-139">**$spSecret**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-139">**$spSecret**</span></span> |<span data-ttu-id="4d4bf-140">**Hizmet asıl gizli anahtarı**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-140">**Service Principal secret**</span></span> |<span data-ttu-id="4d4bf-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM ="</span><span class="sxs-lookup"><span data-stu-id="4d4bf-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span></span> |
| <span data-ttu-id="4d4bf-142">**$credName**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-142">**$credName**</span></span> |<span data-ttu-id="4d4bf-143">**Kimlik bilgisi adı**: AKV tümleştirme, SQL Server, hello VM toohave erişim toohello anahtar kasası sağlayan bir kimlik bilgisi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-143">**Credential name**: AKV Integration creates a credential within SQL Server, allowing hello VM toohave access toohello key vault.</span></span> <span data-ttu-id="4d4bf-144">Bu kimlik bilgisi için bir ad seçin.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-144">Choose a name for this credential.</span></span> |<span data-ttu-id="4d4bf-145">"mycred1"</span><span class="sxs-lookup"><span data-stu-id="4d4bf-145">"mycred1"</span></span> |
| <span data-ttu-id="4d4bf-146">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-146">**$vmName**</span></span> |<span data-ttu-id="4d4bf-147">**Sanal makine adı**: önceden oluşturulmuş bir SQL VM hello adı.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-147">**Virtual machine name**: hello name of a previously created SQL VM.</span></span> |<span data-ttu-id="4d4bf-148">"myvmname"</span><span class="sxs-lookup"><span data-stu-id="4d4bf-148">"myvmname"</span></span> |
| <span data-ttu-id="4d4bf-149">**$serviceName**</span><span class="sxs-lookup"><span data-stu-id="4d4bf-149">**$serviceName**</span></span> |<span data-ttu-id="4d4bf-150">**Hizmet adı**: hello SQL VM ile ilişkili hello bulut hizmeti adını.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-150">**Service name**: hello Cloud Service name that is associated with hello SQL VM.</span></span> |<span data-ttu-id="4d4bf-151">"mycloudservicename"</span><span class="sxs-lookup"><span data-stu-id="4d4bf-151">"mycloudservicename"</span></span> |

### <a name="enable-akv-integration-with-powershell"></a><span data-ttu-id="4d4bf-152">PowerShell ile AKV tümleştirmeyi etkinleştir</span><span class="sxs-lookup"><span data-stu-id="4d4bf-152">Enable AKV Integration with PowerShell</span></span>
<span data-ttu-id="4d4bf-153">Merhaba **yeni AzureVMSqlServerKeyVaultCredentialConfig** cmdlet'i hello Azure anahtar kasası tümleştirme özelliği için bir yapılandırma nesnesi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-153">hello **New-AzureVMSqlServerKeyVaultCredentialConfig** cmdlet creates a configuration object for hello Azure Key Vault Integration feature.</span></span> <span data-ttu-id="4d4bf-154">Merhaba **kümesi AzureVMSqlServerExtension** Bu tümleştirme ile Merhaba yapılandırır **KeyVaultCredentialSettings** parametresi.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-154">hello **Set-AzureVMSqlServerExtension** configures this integration with hello **KeyVaultCredentialSettings** parameter.</span></span> <span data-ttu-id="4d4bf-155">adımları Göster nasıl aşağıdaki hello toouse bu komutları.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-155">hello following steps show how toouse these commands.</span></span>

1. <span data-ttu-id="4d4bf-156">Azure PowerShell'de ilk hello giriş parametreleri belirli değerlerinizle, bu konunun hello önceki bölümlerde açıklandığı gibi yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-156">In Azure PowerShell, first configure hello input parameters with your specific values as described in hello previous sections of this topic.</span></span> <span data-ttu-id="4d4bf-157">komut dosyası izleyen hello bir örnektir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-157">hello following script is an example.</span></span>
   
        $akvURL = "https://contosokeyvault.vault.azure.net/"
        $spName = "fde2b411-33d5-4e11-af04eb07b669ccf2"
        $spSecret = "9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="
        $credName = "mycred1"
        $vmName = "myvmname"
        $serviceName = "mycloudservicename"
2. <span data-ttu-id="4d4bf-158">Ardından kullanım hello aşağıdaki tooconfigure komut dosyası ve AKV tümleştirme etkinleştirin.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-158">Then use hello following script tooconfigure and enable AKV Integration.</span></span>
   
        $secureakv =  $spSecret | ConvertTo-SecureString -AsPlainText -Force
        $akvs = New-AzureVMSqlServerKeyVaultCredentialConfig -Enable -CredentialName $credname -AzureKeyVaultUrl $akvURL -ServicePrincipalName $spName -ServicePrincipalSecret $secureakv
        Get-AzureVM -ServiceName $serviceName -Name $vmName | Set-AzureVMSqlServerExtension -KeyVaultCredentialSettings $akvs | Update-AzureVM

<span data-ttu-id="4d4bf-159">Merhaba SQL Iaas Aracısı uzantısı hello SQL VM yeni bu yapılandırmasıyla güncelleştirir.</span><span class="sxs-lookup"><span data-stu-id="4d4bf-159">hello SQL IaaS Agent Extension will update hello SQL VM with this new configuration.</span></span>

[!INCLUDE [AKV Integration Next Steps](../../../../includes/virtual-machines-sql-server-akv-next-steps.md)]

