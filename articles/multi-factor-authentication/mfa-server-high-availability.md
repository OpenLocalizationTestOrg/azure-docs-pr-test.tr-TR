---
title: "Azure MFA sunucusu yüksek kullanılabilirlik için yapılandırma | Microsoft Docs"
description: "Azure multi-Factor Authentication sunucusu yüksek kullanılabilirlik sağlamak yapılandırmalarında birden çok örneğini dağıtın."
services: multi-factor-authentication
keywords: Azure MFA
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 9f03e61e05383c309fb66b67e0641b17df5ab00f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/29/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a><span data-ttu-id="6c183-104">Azure multi-Factor Authentication sunucusu yüksek kullanılabilirlik için yapılandırma</span><span class="sxs-lookup"><span data-stu-id="6c183-104">Configure Azure Multi-Factor Authentication Server for high availability</span></span>

<span data-ttu-id="6c183-105">Azure sunucusu MFA dağıtımınız ile yüksek kullanılabilirlik elde etmek için birden çok MFA sunucusu dağıtmak için gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-105">To achieve high-availability with your Azure Server MFA deployment, you need to deploy multiple MFA servers.</span></span> <span data-ttu-id="6c183-106">Bu bölümde, Azure MFS sunucu dağıtımı, yüksek kullanılabilirlik hedeflerini elde etmek için yük dengeli bir tasarım hakkında bilgiler sağlar.</span><span class="sxs-lookup"><span data-stu-id="6c183-106">This section provides information on a load-balanced design to achieve your high availability targets in you Azure MFS Server deployment.</span></span>

## <a name="mfa-server-overview"></a><span data-ttu-id="6c183-107">MFA sunucusu genel bakış</span><span class="sxs-lookup"><span data-stu-id="6c183-107">MFA Server overview</span></span>

<span data-ttu-id="6c183-108">Azure MFA sunucusu hizmet mimarisi, aşağıdaki çizimde gösterildiği gibi birçok bileşenden oluşur:</span><span class="sxs-lookup"><span data-stu-id="6c183-108">The Azure MFA Server service architecture comprises several components as shown in the following diagram:</span></span>

 ![MFA sunucusu mimarisi](./media/mfa-server-high-availability/mfa-ha-architecture.png)

<span data-ttu-id="6c183-110">Azure multi-Factor Authentication yazılımı yüklü olan bir Windows Server bir MFA sunucusudur.</span><span class="sxs-lookup"><span data-stu-id="6c183-110">An MFA Server is a Windows Server that has the Azure Multi-Factor Authentication software installed.</span></span> <span data-ttu-id="6c183-111">MFA sunucusu örneğini Azure MFA hizmeti tarafından çalışması için etkinleştirilmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-111">The MFA Server instance must be activated by the MFA Service in Azure to function.</span></span> <span data-ttu-id="6c183-112">Birden fazla MFA sunucusu içi yüklü olabilir.</span><span class="sxs-lookup"><span data-stu-id="6c183-112">More than one MFA Server can be installed on-premises.</span></span>

<span data-ttu-id="6c183-113">Yüklü ilk MFA sunucusu MFA sunucusu varsayılan olarak Azure MFA hizmeti tarafından etkinleştirme sırasında yöneticisidir.</span><span class="sxs-lookup"><span data-stu-id="6c183-113">The first MFA Server that is installed is the master MFA Server upon activation by the Azure MFA Service by default.</span></span> <span data-ttu-id="6c183-114">Ana MFA sunucusu PhoneFactor.pfdata veritabanı yazılabilir bir kopyası bulunur.</span><span class="sxs-lookup"><span data-stu-id="6c183-114">The master MFA server has a writeable copy of the PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6c183-115">MFA sunucusu örneklerinin sonraki yüklemelerini slaves bilinir.</span><span class="sxs-lookup"><span data-stu-id="6c183-115">Subsequent installations of instances of MFA Server are known as slaves.</span></span> <span data-ttu-id="6c183-116">MFA slaves çoğaltılmış salt okunur veritabanının bir kopyasını PhoneFactor.pfdata sahip.</span><span class="sxs-lookup"><span data-stu-id="6c183-116">The MFA slaves have a replicated read-only copy of the PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6c183-117">MFA sunucusu uzak yordam çağrısı (RPC) kullanarak bilgileri çoğaltarak.</span><span class="sxs-lookup"><span data-stu-id="6c183-117">MFA servers replicate information using Remote Procedure Call (RPC).</span></span> <span data-ttu-id="6c183-118">Tüm MFA sunucularının topluca ya da etki alanına katılmış veya bilgi çoğaltmak için tek başına olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-118">All MFA Severs must collectively either be domain joined or standalone to replicate information.</span></span>

<span data-ttu-id="6c183-119">İki faktörlü kimlik doğrulaması gerekli olduğunda MFA ana ve bağımlı MFA sunucuları MFA hizmetiyle iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="6c183-119">Both MFA master and slave MFA Servers communicate with the MFA Service when two-factor authentication is required.</span></span> <span data-ttu-id="6c183-120">Örneğin, bir kullanıcı iki öğeli kimlik doğrulama gerektiren bir uygulamaya erişim girişiminde bulunduğunda, kullanıcı ilk gibi Active Directory (AD) bir kimlik sağlayıcısı tarafından doğrulanır.</span><span class="sxs-lookup"><span data-stu-id="6c183-120">For example, when a user attempts to gain access to an application that requires two-factor authentication, the user will first be authenticated by an identity provider, such as Active Directory (AD).</span></span>

<span data-ttu-id="6c183-121">AD ile başarılı kimlik doğrulamasından sonra MFA sunucusu MFA hizmetiyle iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="6c183-121">After successful authentication with AD, the MFA Server will communicate with the MFA Service.</span></span> <span data-ttu-id="6c183-122">MFA sunucusu veya uygulama için kullanıcı erişimini reddetmek için MFA hizmetinden bildirim bekler.</span><span class="sxs-lookup"><span data-stu-id="6c183-122">The MFA Server waits for notification from the MFA Service to allow or deny the user access to the application.</span></span>

<span data-ttu-id="6c183-123">MFA ana sunucu çevrimdışı olursa, kimlik doğrulamaları hala işlenebilir, ancak MFA veritabanında yapılan değişiklikler gerektiren işlemler işlenemiyor.</span><span class="sxs-lookup"><span data-stu-id="6c183-123">If the MFA master server goes offline, authentications can still be processed, but operations that require changes to the MFA database cannot be processed.</span></span> <span data-ttu-id="6c183-124">(Örnekler: Ayrıca kullanıcılar, Self Servis PIN değişiklikleri ve kullanıcı bilgilerini değiştirme)</span><span class="sxs-lookup"><span data-stu-id="6c183-124">(Examples include: the addition of users, self-service PIN changes, and changing user information)</span></span>

## <a name="deployment"></a><span data-ttu-id="6c183-125">Dağıtım</span><span class="sxs-lookup"><span data-stu-id="6c183-125">Deployment</span></span>

<span data-ttu-id="6c183-126">Yük Dengeleme Azure MFA sunucusu ve ilişkili bileşenler için aşağıdaki önemli noktaları göz önünde bulundurun.</span><span class="sxs-lookup"><span data-stu-id="6c183-126">Consider the following important points for load balancing Azure MFA Server and its related components.</span></span>

* <span data-ttu-id="6c183-127">**Yüksek kullanılabilirlik elde etmek için RADIUS Standart kullanarak**.</span><span class="sxs-lookup"><span data-stu-id="6c183-127">**Using RADIUS standard to achieve high availability**.</span></span> <span data-ttu-id="6c183-128">RADIUS sunucuları olarak Azure MFA sunucuları kullanıyorsanız, bir MFA sunucusu birincil RADIUS kimlik doğrulaması hedefi ve diğer Azure MFA sunucusu ikincil kimlik doğrulama hedefleri olarak potansiyel olarak yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6c183-128">If you are using Azure MFA Servers as RADIUS servers, you can potentially configure one MFA Server as a primary RADIUS authentication target and other Azure MFA Servers as secondary authentication targets.</span></span> <span data-ttu-id="6c183-129">Ancak, ikincil kimlik doğrulama hedefe karşı doğrulanabilmesinden önce birincil kimlik doğrulaması hedef kimlik doğrulama başarısız olduğunda gerçekleşmesi bir zaman aşımı süresi beklemeniz gerekir çünkü yüksek kullanılabilirlik elde etmek için bu yöntem pratik olmayabilir.</span><span class="sxs-lookup"><span data-stu-id="6c183-129">However, this method to achieve high availability may not be practical because you must wait for a time-out period to occur when authentication fails on the primary authentication target before you can be authenticated against the secondary authentication target.</span></span> <span data-ttu-id="6c183-130">RADIUS istemcisi ve RADIUS sunucuları (Bu durumda, Azure MFA RADIUS sunucuları olarak hareket sunucuları) arasındaki RADIUS trafiği dengelemek için daha verimlidir böylelikle işaret edebilir tek bir URL ile RADIUS istemcileri yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6c183-130">It is more efficient to load balance the RADIUS traffic between the RADIUS client and the RADIUS Servers (in this case, the Azure MFA Servers acting as RADIUS servers) so that you can configure the RADIUS clients with a single URL that they can point to.</span></span>
* <span data-ttu-id="6c183-131">**MFA slaves el ile yükseltmeniz gerektiği**.</span><span class="sxs-lookup"><span data-stu-id="6c183-131">**Need to manually promote MFA slaves**.</span></span> <span data-ttu-id="6c183-132">Ana Azure MFA sunucusunun çevrimdışı olması durumunda ikincil Azure MFA sunucuları MFA istekleri işlemeye devam eder.</span><span class="sxs-lookup"><span data-stu-id="6c183-132">If the master Azure MFA server goes offline, the secondary Azure MFA Servers continue to process MFA requests.</span></span> <span data-ttu-id="6c183-133">Ancak, bir ana MFA sunucusu kullanılabilir olana kadar Yöneticileri olmayan kullanıcılar ekleyebilir veya MFA ayarları değiştirebilirsiniz ve kullanıcılar Kullanıcı Portalı'nı kullanarak değişiklik yapabilirsiniz değil.</span><span class="sxs-lookup"><span data-stu-id="6c183-133">However, until a master MFA server is available, admins can not add users or modify MFA settings, and users can not make changes using the user portal.</span></span> <span data-ttu-id="6c183-134">MFA ikincil ana rolüne yükseltme her zaman el ile bir işlemdir.</span><span class="sxs-lookup"><span data-stu-id="6c183-134">Promoting an MFA slave to the master role is always a manual process.</span></span>
* <span data-ttu-id="6c183-135">**Bileşenlerinin separability**.</span><span class="sxs-lookup"><span data-stu-id="6c183-135">**Separability of components**.</span></span> <span data-ttu-id="6c183-136">Azure MFA sunucusu, aynı Windows Server örneğine veya farklı örneklerinde yüklü birçok bileşenden oluşur.</span><span class="sxs-lookup"><span data-stu-id="6c183-136">The Azure MFA Server comprises several components that can be installed on the same Windows Server instance or on different instances.</span></span> <span data-ttu-id="6c183-137">Bu bileşenler, kullanıcı portalı, mobil uygulama Web hizmeti ve ADFS bağdaştırıcı (aracı) içerir.</span><span class="sxs-lookup"><span data-stu-id="6c183-137">These components include the User Portal, Mobile App Web Service, and the ADFS adapter (agent).</span></span> <span data-ttu-id="6c183-138">Bu separability Kullanıcı Portalı ile mobil uygulama Web sunucusu çevre ağından yayımlamak için Web uygulaması proxy'si kullanmayı mümkün kılar.</span><span class="sxs-lookup"><span data-stu-id="6c183-138">This separability makes it possible to use the Web Application Proxy to publish the User Portal and Mobile App Web Server from the perimeter network.</span></span> <span data-ttu-id="6c183-139">Bu tür bir yapılandırma, aşağıdaki çizimde gösterildiği gibi tasarımınızın genel güvenlik ekler.</span><span class="sxs-lookup"><span data-stu-id="6c183-139">Such a configuration adds to the overall security of your design, as shown in the following diagram.</span></span> <span data-ttu-id="6c183-140">Ayrıca MFA Kullanıcı Portalı ve mobil uygulama Web sunucusu HA yük dengeli yapılandırmasında dağıtılabilir.</span><span class="sxs-lookup"><span data-stu-id="6c183-140">The MFA User Portal and Mobile App Web Server may also be deployed in HA load-balanced configurations.</span></span>

   ![MFA sunucusu çevre ağı ile](./media/mfa-server-high-availability/mfasecurity.png)

* <span data-ttu-id="6c183-142">**Tek kullanımlık parola (OTP) SMS (diğer adıyla tek yönlü SMS) üzerinden trafik yükü dengelenmiş ise Yapışkan oturumları kullanılmasını gerektiren**.</span><span class="sxs-lookup"><span data-stu-id="6c183-142">**One-time password (OTP) over SMS (aka one-way SMS) requires the use of sticky sessions if traffic is load-balanced**.</span></span> <span data-ttu-id="6c183-143">Tek yönlü SMS kullanıcılar bir OTP içeren bir kısa mesaj göndermek için MFA sunucusunu neden olan bir kimlik doğrulama seçenektir.</span><span class="sxs-lookup"><span data-stu-id="6c183-143">One-way SMS is an authentication option that causes the MFA Server to send the users a text message containing an OTP.</span></span> <span data-ttu-id="6c183-144">Kullanıcı, OTP MFA testini tamamlamanız için bir komut istemi penceresinde girer.</span><span class="sxs-lookup"><span data-stu-id="6c183-144">The user enters the OTP in a prompt window to complete the MFA challenge.</span></span> <span data-ttu-id="6c183-145">Azure MFA sunucuları dengelemek ilk kimlik doğrulaması isteği sunan sunucunun kullanıcıdan OTP iletiyi alır sunucu olması gerekir; başka bir MFA sunucusu OTP yanıt alırsa, kimlik doğrulaması sınaması başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="6c183-145">If you load balance Azure MFA Servers, the same server that served the initial authentication request must be the server that receives the OTP message from the user; if another MFA Server receives the OTP reply, the authentication challenge fails.</span></span> <span data-ttu-id="6c183-146">Daha fazla bilgi için bkz: [SMS eklenen Azure MFA sunucusu üzerinden bir zaman parola](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span><span class="sxs-lookup"><span data-stu-id="6c183-146">For more information, see [One Time Password over SMS Added to Azure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span></span>
* <span data-ttu-id="6c183-147">**Yük dengeli dağıtımı Kullanıcı Portalı ve mobil uygulama Web hizmeti gerektirir Yapışkan oturumları**.</span><span class="sxs-lookup"><span data-stu-id="6c183-147">**Load-Balanced deployments of the User Portal and Mobile App Web Service require sticky sessions**.</span></span> <span data-ttu-id="6c183-148">Yük MFA Kullanıcı Portalı ile mobil uygulama Web hizmeti Dengeleme izliyorsanız, aynı sunucuda kalmak her oturum gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-148">If you are load-balancing the MFA User Portal and the Mobile App Web Service, each session needs to stay on the same server.</span></span>

## <a name="high-availability-deployment"></a><span data-ttu-id="6c183-149">Yüksek kullanılabilirlik dağıtımı</span><span class="sxs-lookup"><span data-stu-id="6c183-149">High-availability deployment</span></span>

<span data-ttu-id="6c183-150">Aşağıdaki diyagramda, tam bir HA yük dengeli uygulama, Azure MFA ve başvuru için ADFS birlikte bileşenlerinin gösterir.</span><span class="sxs-lookup"><span data-stu-id="6c183-150">The following diagram shows a complete HA load-balanced implementation of Azure MFA and its components, along with ADFS for reference.</span></span>

 ![Azure MFA Server HA uygulama](./media/mfa-server-high-availability/mfa-ha-deployment.png)

<span data-ttu-id="6c183-152">Önceki diyagramda gelenlere numaralı alanı için aşağıdaki öğelerden unutmayın.</span><span class="sxs-lookup"><span data-stu-id="6c183-152">Note the following items for the correspondingly numbered area of the preceding diagram.</span></span>

1. <span data-ttu-id="6c183-153">İki Azure MFA sunucusu (MFA1 ve MFA2) yükü dengelenmiş (mfaapp.contoso.com) ve statik bağlantı noktasını kullanmak üzere yapılandırılmış PhoneFactor.pfdata veritabanı çoğaltmak için (4443).</span><span class="sxs-lookup"><span data-stu-id="6c183-153">The two Azure MFA Servers (MFA1 and MFA2) are load balanced (mfaapp.contoso.com) and are configured to use a static port (4443) to replicate the PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6c183-154">Web hizmeti SDK'sı her ADFS sunucularıyla TCP bağlantı noktası 443 üzerinden iletişimi etkinleştirmek için MFA sunucusu yüklenir.</span><span class="sxs-lookup"><span data-stu-id="6c183-154">The Web Service SDK is installed on each of the MFA Server to enable communication over TCP port 443 with the ADFS servers.</span></span> <span data-ttu-id="6c183-155">MFA sunucusu, durum bilgisi olmayan bir yük dengeli yapılandırmasında dağıtılır.</span><span class="sxs-lookup"><span data-stu-id="6c183-155">The MFA servers are deployed in a stateless load-balanced configuration.</span></span> <span data-ttu-id="6c183-156">Ancak, OTP SMS kullanmak istiyorsanız, durum bilgisi olan Yük Dengeleme kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-156">However, if you wanted to use OTP over SMS, you must use stateful load balancing.</span></span>
   <span data-ttu-id="6c183-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span><span class="sxs-lookup"><span data-stu-id="6c183-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span></span>

   > [!NOTE]
   > <span data-ttu-id="6c183-158">RPC dinamik bağlantı noktaları kullandığından, güvenlik duvarları RPC potansiyel olarak kullanabileceğiniz dinamik bağlantı noktaları aralığı kadar açmak için önerilmez.</span><span class="sxs-lookup"><span data-stu-id="6c183-158">Because RPC uses dynamic ports, it is not recommended to open firewalls up to the range of dynamic ports that RPC can potentially use.</span></span> <span data-ttu-id="6c183-159">Bir güvenlik duvarınız varsa **arasında** MFA uygulama sunucularınızın bağımlı ve asıl sunucuları arasındaki çoğaltma trafiği için statik bir bağlantı noktası iletişim ve güvenlik duvarını Bu bağlantı noktasını açmak için MFA sunucusunu yapılandırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-159">If you have a firewall **between** your MFA application servers, you should configure the MFA Server to communicate on a static port for the replication traffic between slave and master servers and open that port on your firewall.</span></span> <span data-ttu-id="6c183-160">Bir DWORD kayıt defteri değerinde oluşturarak statik bağlantı noktası zorlayabilirsiniz ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` adlı ```Pfsvc_ncan_ip_tcp_port``` ve kullanılabilir bir statik bağlantı noktası değerini ayarlar.</span><span class="sxs-lookup"><span data-stu-id="6c183-160">You can force the static port by creating a DWORD registry value at ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` called ```Pfsvc_ncan_ip_tcp_port``` and setting the value to an available static port.</span></span> <span data-ttu-id="6c183-161">Bağlantıları her zaman ana bağımlı MFA sunucuları tarafından başlatılan, statik bağlantı noktası yalnızca ana gereklidir, ancak bağımlı herhangi bir zamanda ana olacak şekilde yükseltebilirsiniz olduğundan, tüm MFA sunucularında statik bağlantı noktasına ayarlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="6c183-161">Connections are always initiated by the slave MFA Servers to the master, the static port is only required on the master, but since you can promote a slave to be the master at any time, you should set the static port on all MFA Servers.</span></span>

2. <span data-ttu-id="6c183-162">İki kullanıcı portalı/MFA mobil uygulama sunucularını (MFA yukarı MAS1 ve MFA yukarı MAS2) içinde dengeleneceğini bir **durum bilgisi olan** yapılandırma (mfa.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="6c183-162">The two User Portal/MFA Mobile App servers (MFA-UP-MAS1 and MFA-UP-MAS2) are load balanced in a **stateful** configuration (mfa.contoso.com).</span></span> <span data-ttu-id="6c183-163">Yapışkan oturumları Yük Dengeleme MFA Kullanıcı Portalı ve mobil uygulama hizmeti için bir gereksinim olan bir geri çağırma.</span><span class="sxs-lookup"><span data-stu-id="6c183-163">Recall that sticky sessions are a requirement for load balancing the MFA User Portal and Mobile App Service.</span></span>
   <span data-ttu-id="6c183-164">![Azure MFA sunucusu - kullanıcı portalı ile mobil uygulama hizmeti HA](./media/mfa-server-high-availability/mfaportal.png)</span><span class="sxs-lookup"><span data-stu-id="6c183-164">![Azure MFA Server - User Portal and Mobile App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span></span>
3. <span data-ttu-id="6c183-165">ADFS sunucu grubu yükü dengelenir ve Yük Dengelemesi ADFS proxy'leri çevre ağındaki üzerinden internet yayımlanan ' dir.</span><span class="sxs-lookup"><span data-stu-id="6c183-165">The ADFS Server farm is load balanced and published to the Internet through load-balanced ADFS proxies in the perimeter network.</span></span> <span data-ttu-id="6c183-166">Her ADFS sunucusu ADFS Aracısı TCP bağlantı noktası 443 bir tek bir yük dengeli URL (mfaapp.contoso.com) kullanarak Azure MFA sunucularıyla iletişim kurmak için kullanır.</span><span class="sxs-lookup"><span data-stu-id="6c183-166">Each ADFS Server uses the ADFS agent to communicate with the Azure MFA Servers using a single load-balanced URL (mfaapp.contoso.com) over TCP port 443.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6c183-167">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="6c183-167">Next steps</span></span>

* [<span data-ttu-id="6c183-168">Azure MFA sunucusu yükleme ve yapılandırma</span><span class="sxs-lookup"><span data-stu-id="6c183-168">Install and configure Azure MFA Server</span></span>](multi-factor-authentication-get-started-server.md)
