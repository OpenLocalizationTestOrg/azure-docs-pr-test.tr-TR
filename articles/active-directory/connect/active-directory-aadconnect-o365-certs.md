---
title: "Sertifika yenileme Office 365 ve Azure AD kullanıcıları için | Microsoft Docs"
description: "Bu makalede, Office 365 kullanıcıları için bir sertifika yenileme hakkında bildirim e-postalar ile ilgili sorunları gidermek nasıl açıklanmaktadır."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 7f1a3303eff9c413602e745b702baa659343eba6
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/03/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="ad49c-103">Office 365 ve Azure Active Directory Federasyon sertifikalarını yenileme</span><span class="sxs-lookup"><span data-stu-id="ad49c-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="ad49c-104">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="ad49c-104">Overview</span></span>
<span data-ttu-id="ad49c-105">Azure Active Directory (Azure AD) ve Active Directory Federasyon Hizmetleri (AD FS) arasındaki başarılı Federasyon için Azure AD içinde yapılandırılmış Azure AD'ye güvenlik belirteçleri imzalamak için AD FS tarafından kullanılan sertifikalar ile eşleşmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), the certificates used by AD FS to sign security tokens to Azure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="ad49c-106">Öğelerdeki uyuşmazlık kaldırılmış güven yol açabilir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-106">Any mismatch can lead to broken trust.</span></span> <span data-ttu-id="ad49c-107">Azure AD, AD FS ve Web uygulama proxy'si (extranet erişimi için) dağıtırken bu bilgileri eşitlenmiş olarak saklanmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="ad49c-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="ad49c-108">Bu makalede, belirteç imzalama sertifikalarını yönetmek ve aşağıdaki durumlarda bunları Azure AD ile eşitlenmiş tutmak için ek bilgiler sağlanmaktadır:</span><span class="sxs-lookup"><span data-stu-id="ad49c-108">This article provides you additional information to manage your token signing certificates and keep them in sync with Azure AD, in the following cases:</span></span>

* <span data-ttu-id="ad49c-109">Web uygulaması Ara sunucusu dağıtma değil ve bu nedenle Federasyon meta verilerinin extranet kullanılabilir değildir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-109">You are not deploying the Web Application Proxy, and therefore the federation metadata is not available in the extranet.</span></span>
* <span data-ttu-id="ad49c-110">AD FS varsayılan yapılandırması için belirteç imzalama sertifikaları kullanarak değil.</span><span class="sxs-lookup"><span data-stu-id="ad49c-110">You are not using the default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="ad49c-111">Bir üçüncü taraf kimlik sağlayıcısı kullanıyor.</span><span class="sxs-lookup"><span data-stu-id="ad49c-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="ad49c-112">AD FS belirteç imzalama sertifikaları için varsayılan yapılandırma</span><span class="sxs-lookup"><span data-stu-id="ad49c-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="ad49c-113">Belirteç imzalama ve belirteç şifre çözme sertifikaları genellikle otomatik olarak imzalanan sertifikalar ve bir yıl için iyidir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-113">The token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="ad49c-114">Varsayılan olarak, AD FS adlı bir otomatik yenileme işlemi içerir **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="ad49c-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="ad49c-115">Otomatik olarak AD FS 2.0 veya üstü, Office 365 ve Azure AD kullanıyorsanız, sertifikanızın süresi dolmadan önce güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="ad49c-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-the-office-365-portal-or-an-email"></a><span data-ttu-id="ad49c-116">Office 365 portalı ya da bir e-posta bildirim yenileme</span><span class="sxs-lookup"><span data-stu-id="ad49c-116">Renewal notification from the Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="ad49c-117">Bir e-posta veya Office sertifikanızı yenilemek için bkz: isteyen bir portal bildirim alınırsa, [belirteç imzalama sertifikaları yapılan değişiklikleri yönetme](#managecerts) herhangi bir eylemde bulunmanız gerektiğinde denetlemek için.</span><span class="sxs-lookup"><span data-stu-id="ad49c-117">If you received an email or a portal notification asking you to renew your certificate for Office, see [Managing changes to token signing certificates](#managecerts) to check if you need to take any action.</span></span> <span data-ttu-id="ad49c-118">Microsoft, hiçbir eylem gerekli olduğunda bile, gönderilen sertifika yenileme için bildirimleri yol açabilir olası bir sorunu bilmektedir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-118">Microsoft is aware of a possible issue that can lead to notifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="ad49c-119">Federasyon meta verilerini izlemek ve bu meta verileri tarafından belirtildiği şekilde imzalama sertifikalarının belirtecinizi güncelleştirmek Azure AD çalışır.</span><span class="sxs-lookup"><span data-stu-id="ad49c-119">Azure AD attempts to monitor the federation metadata, and update the token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="ad49c-120">30 gün önce sona erme tarihini belirteç imzalama sertifikalarını, Azure AD Federasyon meta verileri yoklayarak yeni sertifikalar kullanılabilir olup olmadığını denetler.</span><span class="sxs-lookup"><span data-stu-id="ad49c-120">30 days before the expiration of the token signing certificates, Azure AD checks if new certificates are available by polling the federation metadata.</span></span>

* <span data-ttu-id="ad49c-121">Bu başarılı şekilde Federasyon meta verileri sorgulamak ve yeni sertifika almak, kullanıcıya e-posta bildirim veya Office 365 portalında uyarı verilir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-121">If it can successfully poll the federation metadata and retrieve the new certificates, no email notification or warning in the Office 365 portal is issued to the user.</span></span>
* <span data-ttu-id="ad49c-122">Yeni belirteç imzalama sertifikaları alamıyorsa, ya da Federasyon meta verilerinin ulaşılabilir olmadığından veya otomatik sertifika aktarma etkin değil, Azure AD bir e-posta bildirimi ve Office 365 portalında bir uyarı verir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-122">If it cannot retrieve the new token signing certificates, either because the federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in the Office 365 portal.</span></span>

![Office 365 portalı bildirim](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="ad49c-124">İş sürekliliğini sağlamak üzere AD FS kullanıyorsanız, böylece bilinen sorunlara yönelik kimlik doğrulama hatalarının meydana gelmediğinden, sunucularınızı aşağıdaki güncelleştirmeleri olduğunu doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-124">If you are using AD FS, to ensure business continuity, please verify that your servers have the following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="ad49c-125">Bu yenileme ve gelecekteki yenileme dönemleri için bilinen AD FS proxy sunucu sorunları azaltır:</span><span class="sxs-lookup"><span data-stu-id="ad49c-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="ad49c-126">Server 2012 R2 - [Windows Server Mayıs 2014 paketi](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="ad49c-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="ad49c-127">Server 2008 R2 ve 2012 - [proxy üzerinden kimlik doğrulaması başarısız Windows Server 2012 veya Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="ad49c-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="ad49c-128">Sertifikaları güncelleştirilmesi gerekip gerekmediğini denetleyin<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="ad49c-128">Check if the certificates need to be updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-the-autocertificaterollover-state"></a><span data-ttu-id="ad49c-129">1. adım: AutoCertificateRollover durumunu denetle</span><span class="sxs-lookup"><span data-stu-id="ad49c-129">Step 1: Check the AutoCertificateRollover state</span></span>
<span data-ttu-id="ad49c-130">AD FS sunucunuzda, PowerShell'i açın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="ad49c-131">AutoCertificateRollover değeri True olarak ayarlanmış olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="ad49c-131">Check that the AutoCertificateRollover value is set to True.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="ad49c-133">AD FS 2.0 kullanıyorsanız, önce Ekle-Pssnapın Microsoft.Adfs.Powershell çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="ad49c-134">2. adım: AD FS ile Azure AD eşitleme olduğundan emin olun</span><span class="sxs-lookup"><span data-stu-id="ad49c-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="ad49c-135">AD FS sunucunuzun Azure AD PowerShell komut istemini açın ve Azure AD connect.</span><span class="sxs-lookup"><span data-stu-id="ad49c-135">On your AD FS server, open the Azure AD PowerShell prompt, and connect to Azure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="ad49c-136">Azure AD PowerShell indirebilirsiniz [burada](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="ad49c-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="ad49c-137">AD FS ile Azure AD güven özellikleri belirtilen etki alanı için yapılandırılan sertifikaları denetleyin.</span><span class="sxs-lookup"><span data-stu-id="ad49c-137">Check the certificates configured in AD FS and Azure AD trust properties for the specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="ad49c-139">Her iki çıkışları parmak eşleşiyorsa sertifikalarınızı Azure AD ile eşitlenmiş.</span><span class="sxs-lookup"><span data-stu-id="ad49c-139">If the thumbprints in both the outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-to-expire"></a><span data-ttu-id="ad49c-140">3. adım: sertifikanızı dolmak üzere olup olmadığını denetleyin</span><span class="sxs-lookup"><span data-stu-id="ad49c-140">Step 3: Check if your certificate is about to expire</span></span>
<span data-ttu-id="ad49c-141">Get-MsolFederationProperty veya Get-AdfsCertificate çıktısında "Değil sonra" altında tarihi denetleyin</span><span class="sxs-lookup"><span data-stu-id="ad49c-141">In the output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for the date under "Not After."</span></span> <span data-ttu-id="ad49c-142">Tarih 30 günden az hemen ise eylemi gerçekleştirmelisiniz.</span><span class="sxs-lookup"><span data-stu-id="ad49c-142">If the date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="ad49c-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="ad49c-143">AutoCertificateRollover</span></span> | <span data-ttu-id="ad49c-144">Sertifikaları Azure AD ile eşitleme</span><span class="sxs-lookup"><span data-stu-id="ad49c-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="ad49c-145">Federasyon meta verileri genel olarak erişilebilir</span><span class="sxs-lookup"><span data-stu-id="ad49c-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="ad49c-146">Geçerlilik</span><span class="sxs-lookup"><span data-stu-id="ad49c-146">Validity</span></span> | <span data-ttu-id="ad49c-147">Eylem</span><span class="sxs-lookup"><span data-stu-id="ad49c-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="ad49c-148">Evet</span><span class="sxs-lookup"><span data-stu-id="ad49c-148">Yes</span></span> |<span data-ttu-id="ad49c-149">Evet</span><span class="sxs-lookup"><span data-stu-id="ad49c-149">Yes</span></span> |<span data-ttu-id="ad49c-150">Evet</span><span class="sxs-lookup"><span data-stu-id="ad49c-150">Yes</span></span> |- |<span data-ttu-id="ad49c-151">Eyleme gerek yok.</span><span class="sxs-lookup"><span data-stu-id="ad49c-151">No action needed.</span></span> <span data-ttu-id="ad49c-152">Bkz: [yenileme belirteç imzalama sertifikası otomatik olarak](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="ad49c-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="ad49c-153">Evet</span><span class="sxs-lookup"><span data-stu-id="ad49c-153">Yes</span></span> |<span data-ttu-id="ad49c-154">Hayır</span><span class="sxs-lookup"><span data-stu-id="ad49c-154">No</span></span> |- |<span data-ttu-id="ad49c-155">15 günden az</span><span class="sxs-lookup"><span data-stu-id="ad49c-155">Less than 15 days</span></span> |<span data-ttu-id="ad49c-156">Hemen yenileyin.</span><span class="sxs-lookup"><span data-stu-id="ad49c-156">Renew immediately.</span></span> <span data-ttu-id="ad49c-157">Bkz: [el ile yenileme belirteç imzalama sertifikası](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="ad49c-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="ad49c-158">Hayır</span><span class="sxs-lookup"><span data-stu-id="ad49c-158">No</span></span> |- |- |<span data-ttu-id="ad49c-159">30 günden az</span><span class="sxs-lookup"><span data-stu-id="ad49c-159">Less than 30 days</span></span> |<span data-ttu-id="ad49c-160">Hemen yenileyin.</span><span class="sxs-lookup"><span data-stu-id="ad49c-160">Renew immediately.</span></span> <span data-ttu-id="ad49c-161">Bkz: [el ile yenileme belirteç imzalama sertifikası](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="ad49c-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="ad49c-162">\[-] Önemli değildir</span><span class="sxs-lookup"><span data-stu-id="ad49c-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="ad49c-163">Belirteç imzalama sertifikasının otomatik yenileme (önerilir)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="ad49c-163">Renew the token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="ad49c-164">Aşağıdakilerin her ikisi de doğruysa herhangi manuel adımları uygulamanız gerekmez:</span><span class="sxs-lookup"><span data-stu-id="ad49c-164">You don't need to perform any manual steps if both of the following are true:</span></span>

* <span data-ttu-id="ad49c-165">Erişim için Federasyon meta verilerinin extranet etkinleştirebilirsiniz Web uygulaması proxy'si dağıtmış.</span><span class="sxs-lookup"><span data-stu-id="ad49c-165">You have deployed Web Application Proxy, which can enable access to the federation metadata from the extranet.</span></span>
* <span data-ttu-id="ad49c-166">AD FS varsayılan yapılandırması (AutoCertificateRollover etkin) kullanıyor.</span><span class="sxs-lookup"><span data-stu-id="ad49c-166">You are using the AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="ad49c-167">Sertifika otomatik olarak güncelleştirilebilir onaylamak için şunları denetleyin.</span><span class="sxs-lookup"><span data-stu-id="ad49c-167">Check the following to confirm that the certificate can be automatically updated.</span></span>

<span data-ttu-id="ad49c-168">**1. AutoCertificateRollover AD FS özelliği True olarak ayarlanması gerekir.**</span><span class="sxs-lookup"><span data-stu-id="ad49c-168">**1. The AD FS property AutoCertificateRollover must be set to True.**</span></span> <span data-ttu-id="ad49c-169">Bu AD FS yeni belirteç imzalama ve belirteç şifre çözme sertifikaları otomatik olarak oluşturur, önce eski olanları sona gösterir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before the old ones expire.</span></span>

<span data-ttu-id="ad49c-170">**2. AD FS federasyon meta verileri genel olarak erişilebilir.**</span><span class="sxs-lookup"><span data-stu-id="ad49c-170">**2. The AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="ad49c-171">(Dışına şirket ağına) genel internet üzerindeki bir bilgisayardan aşağıdaki URL'sine giderek Federasyon meta verileri genel olarak erişilebilir olduğundan emin olun:</span><span class="sxs-lookup"><span data-stu-id="ad49c-171">Check that your federation metadata is publicly accessible by navigating to the following URL from a computer on the public internet (off of the corporate network):</span></span>

<span data-ttu-id="ad49c-172">https:// (your_FS_name) /federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="ad49c-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="ad49c-173">Burada `(your_FS_name) `kuruluşunuzun kullandığı, fs.contoso.com gibi Federasyon Hizmeti ana bilgisayar adı ile değiştirilir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-173">where `(your_FS_name) `is replaced with the federation service host name your organization uses, such as fs.contoso.com.</span></span>  <span data-ttu-id="ad49c-174">Her ikisi de doğrulayamazsınız varsa bu ayarları başarıyla, başka bir şey yapmanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="ad49c-174">If you are able to verify both of these settings successfully, you do not have to do anything else.</span></span>  

<span data-ttu-id="ad49c-175">Örnek: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="ad49c-175">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="ad49c-176">Belirteç imzalama sertifikasının el ile yenileme<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="ad49c-176">Renew the token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="ad49c-177">Belirteç imzalama sertifikalarının el ile yenilemek tercih edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ad49c-177">You may choose to renew the token signing certificates manually.</span></span> <span data-ttu-id="ad49c-178">Örneğin, aşağıdaki senaryolar için el ile yenileme daha iyi çalışabilir:</span><span class="sxs-lookup"><span data-stu-id="ad49c-178">For example, the following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="ad49c-179">Belirteç imzalama sertifikalarının otomatik olarak imzalanan sertifikalar.</span><span class="sxs-lookup"><span data-stu-id="ad49c-179">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="ad49c-180">Bunun en yaygın nedeni, kuruluşunuzun AD FS sertifikalarının bir kuruluş sertifika yetkilisinden kayıtlı yönetir ' dir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-180">The most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="ad49c-181">Ağ güvenliği genel olarak kullanılabilir olması Federasyon meta verilerinin izin vermiyor.</span><span class="sxs-lookup"><span data-stu-id="ad49c-181">Network security does not allow the federation metadata to be publicly available.</span></span>

<span data-ttu-id="ad49c-182">Belirteç imzalama sertifikalarını, güncelleştirdiğiniz her sefer bu senaryolarda da Office 365 etki alanınızın güncelleştirme MsolFederatedDomain PowerShell komutunu kullanarak güncelleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-182">In these scenarios, every time you update the token signing certificates, you must also update your Office 365 domain by using the PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="ad49c-183">1. adım: AD FS yeni bir belirteç imzalama sertifikalarının sahip olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="ad49c-183">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="ad49c-184">**Varsayılan olmayan yapılandırma**</span><span class="sxs-lookup"><span data-stu-id="ad49c-184">**Non-default configuration**</span></span>

<span data-ttu-id="ad49c-185">Varsayılan olmayan yapılandırma AD FS kullanıyorsanız, (burada **AutoCertificateRollover** ayarlanır **False**), büyük olasılıkla özel sertifikaları (kendinden imzalı) kullanıyor.</span><span class="sxs-lookup"><span data-stu-id="ad49c-185">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set to **False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="ad49c-186">AD FS belirteç imzalama sertifikalarını yenileme hakkında daha fazla bilgi için bkz: [yönergeler AD FS kullanmayan müşterileri için otomatik olarak imzalanan sertifikalar](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="ad49c-186">For more information about how to renew the AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="ad49c-187">**Federasyon meta veri genel kullanıma açık değil**</span><span class="sxs-lookup"><span data-stu-id="ad49c-187">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="ad49c-188">Öte yandan, **AutoCertificateRollover** ayarlanır **doğru**, ancak, Federasyon meta verileri genel olarak erişilebilir değil, öncelikle yeni belirteç imzalama sertifikaları AD FS tarafından oluşturulan olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="ad49c-188">On the other hand, if **AutoCertificateRollover** is set to **True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="ad49c-189">Yeni bir belirteç imzalama sertifikalarının aşağıdaki adımları uygulayarak sahip onaylayın:</span><span class="sxs-lookup"><span data-stu-id="ad49c-189">Confirm you have new token signing certificates by taking the following steps:</span></span>

1. <span data-ttu-id="ad49c-190">Birincil AD FS sunucusunda oturum açan doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-190">Verify that you are logged on to the primary AD FS server.</span></span>
2. <span data-ttu-id="ad49c-191">Bir PowerShell komut penceresi açıp aşağıdaki komutu çalıştırarak AD FS geçerli İmzalama sertifikaları denetleyin:</span><span class="sxs-lookup"><span data-stu-id="ad49c-191">Check the current signing certificates in AD FS by opening a PowerShell command window, and running the following command:</span></span>

    <span data-ttu-id="ad49c-192">PS C:\>Get-ADFSCertificate – Encryption belirteç imzalama</span><span class="sxs-lookup"><span data-stu-id="ad49c-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="ad49c-193">AD FS 2.0 kullanıyorsanız, Add-Pssnapın Microsoft.Adfs.Powershell ilk çalıştırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-193">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="ad49c-194">Listelenen herhangi bir sertifika komutu çıktıyı bakın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-194">Look at the command output at any certificates listed.</span></span> <span data-ttu-id="ad49c-195">AD FS yeni bir sertifika oluşturmuşsa, iki sertifika çıktı görmeniz gerekir: biri için hangi **IsPrimary** değer **True** ve **NotAfter** tarihidir 5 gün ve biri için hangi içinde **IsPrimary** olan **False** ve **NotAfter** gelecekte bir yıl hakkında.</span><span class="sxs-lookup"><span data-stu-id="ad49c-195">If AD FS has generated a new certificate, you should see two certificates in the output: one for which the **IsPrimary** value is **True** and the **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in the future.</span></span>
4. <span data-ttu-id="ad49c-196">Yalnızca bir sertifika görüyorsanız ve **NotAfter** tarihi 5 gün içinde yeni bir sertifika oluşturmak gerekir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-196">If you only see one certificate, and the **NotAfter** date is within 5 days, you need to generate a new certificate.</span></span>
5. <span data-ttu-id="ad49c-197">Yeni bir sertifika oluşturmak için bir PowerShell komut isteminde aşağıdaki komutu yürütün: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="ad49c-197">To generate a new certificate, execute the following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="ad49c-198">Aşağıdaki komutu yeniden çalıştırarak güncelleştirme doğrulayın: PS C:\>Get-ADFSCertificate – Encryption belirteç imzalama</span><span class="sxs-lookup"><span data-stu-id="ad49c-198">Verify the update by running the following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="ad49c-199">İki sertifika artık listelenir, bunlardan biri olan bir **NotAfter** tarih yaklaşık bir yıl sonra ve hangi **IsPrimary** değer **False**.</span><span class="sxs-lookup"><span data-stu-id="ad49c-199">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in the future, and for which the **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-the-new-token-signing-certificates-for-the-office-365-trust"></a><span data-ttu-id="ad49c-200">2. adım: yeni belirteç imzalama sertifikalarının Office 365 güven güncelleştirmek</span><span class="sxs-lookup"><span data-stu-id="ad49c-200">Step 2: Update the new token signing certificates for the Office 365 trust</span></span>
<span data-ttu-id="ad49c-201">Office 365 imzalama sertifikalarının gibi güven için kullanılacak olan yeni belirteci ile güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="ad49c-201">Update Office 365 with the new token signing certificates to be used for the trust, as follows.</span></span>

1. <span data-ttu-id="ad49c-202">Microsoft Azure Active Directory modülü için Windows PowerShell'i açın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-202">Open the Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="ad49c-203">$Cred Çalıştır Get-Credential =.</span><span class="sxs-lookup"><span data-stu-id="ad49c-203">Run $cred=Get-Credential.</span></span> <span data-ttu-id="ad49c-204">Bu cmdlet, kimlik bilgilerini ister, bulut hizmet yönetici hesabı kimlik bilgilerini yazın.</span><span class="sxs-lookup"><span data-stu-id="ad49c-204">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="ad49c-205">Connect MsolService Çalıştır – kimlik bilgisi $cred.</span><span class="sxs-lookup"><span data-stu-id="ad49c-205">Run Connect-MsolService –Credential $cred.</span></span> <span data-ttu-id="ad49c-206">Bu cmdlet bulut hizmetine bağlanır.</span><span class="sxs-lookup"><span data-stu-id="ad49c-206">This cmdlet connects you to the cloud service.</span></span> <span data-ttu-id="ad49c-207">Bulut hizmetine bağlanan bir içeriği oluşturma aracı tarafından yüklü ek cmdlet'lerinden herhangi birini çalıştırmadan önce gereklidir.</span><span class="sxs-lookup"><span data-stu-id="ad49c-207">Creating a context that connects you to the cloud service is required before running any of the additional cmdlets installed by the tool.</span></span>
4. <span data-ttu-id="ad49c-208">Bu komutlar, AD FS birincil Federasyon sunucusu olmayan bir bilgisayar üzerinde çalıştırıyorsanız, Set-MSOLAdfscontext Çalıştır-bilgisayar <AD FS primary server>, burada <AD FS primary server> iç FQDN birincil AD FS sunucusunun adıdır.</span><span class="sxs-lookup"><span data-stu-id="ad49c-208">If you are running these commands on a computer that is not the AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is the internal FQDN name of the primary AD FS server.</span></span> <span data-ttu-id="ad49c-209">Bu cmdlet için AD FS bağlanan bir içeriği oluşturur.</span><span class="sxs-lookup"><span data-stu-id="ad49c-209">This cmdlet creates a context that connects you to AD FS.</span></span>
5. <span data-ttu-id="ad49c-210">Güncelleştirme MSOLFederatedDomain – DomainName çalıştırmak <domain>.</span><span class="sxs-lookup"><span data-stu-id="ad49c-210">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="ad49c-211">Bu cmdlet, AD FS ayarları bulut hizmete güncelleştirir ve ikisi arasında güven ilişkisi yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="ad49c-211">This cmdlet updates the settings from AD FS into the cloud service, and configures the trust relationship between the two.</span></span>

> [!NOTE]
> <span data-ttu-id="ad49c-212">Contoso.com ve fabrikam.com, gibi birden çok üst düzey etki alanlarının desteklemeniz gerekiyorsa, kullanmalısınız **SupportMultipleDomain** geçiş herhangi cmdlet'lerle.</span><span class="sxs-lookup"><span data-stu-id="ad49c-212">If you need to support multiple top-level domains, such as contoso.com and fabrikam.com, you must use the **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="ad49c-213">Daha fazla bilgi için bkz: [birden çok üst düzey etki alanı için destek](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="ad49c-213">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="ad49c-214">Azure AD Connect kullanarak Azure AD güvenini Onar<a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="ad49c-214">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="ad49c-215">Azure AD Connect kullanarak AD FS grubu ve Azure AD güveni yapılandırdıysanız, belirteç imzalama sertifikaları için herhangi bir eylemde bulunmanız gerektiğinde algılamak için Azure AD Connect kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ad49c-215">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect to detect if you need to take any action for your token signing certificates.</span></span> <span data-ttu-id="ad49c-216">Sertifikaları yenilemek gerekiyorsa, bunu yapmak için Azure AD Connect kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ad49c-216">If you need to renew the certificates, you can use Azure AD Connect to do so.</span></span>

<span data-ttu-id="ad49c-217">Daha fazla bilgi için bkz: [güven onarma](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="ad49c-217">For more information, see [Repairing the trust](active-directory-aadconnect-federation-management.md).</span></span>
