---
title: "Uygulama proxy'si uygulama toouse Kerberos Kısıtlı temsilci aaaHow tooconfigure | Microsoft Docs"
description: "Nasıl bir Azure AD uygulama proxy'si uygulama için Kerberos Kısıtlı temsilci tooconfigure."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="cd3ad-103">Nasıl tooconfigure uygulama proxy'si uygulama toouse Kerberos Kısıtlı temsilci</span><span class="sxs-lookup"><span data-stu-id="cd3ad-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="cd3ad-104">Merhaba uygulamaları uygulama tooapplication ve Azure uygulama proxy'si hello kutusu dışında sağ sunar hello seçeneklerden birini biraz değişebilir SSO toopublished elde etmek için kullanılabilen yöntemler olan Kerberos Kısıtlı temsilci (KCD).</span><span class="sxs-lookup"><span data-stu-id="cd3ad-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="cd3ad-105">Bir bağlayıcı konak yapılandırılmış tooperform kısıtlı kerberos kimlik doğrulaması toobackend uygulamalar, kullanıcılar adına olduğu budur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="cd3ad-106">KCD etkinleştirmek için gerçek yordam hello oldukça basittir ve genellikle hello genel bir anlayış en çok çeşitli bileşenler ve SSO kolaylaştıran kimlik doğrulaması akışı gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="cd3ad-107">Bilgi toohelp iyi kaynaklarının nerede KCD SSO beklendiği gibi işlev olmayan senaryolar sorun giderme bulma, seyrek olabilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="cd3ad-108">Bu nedenle, bu makalede tooprovide tek bir sorun giderme ve bazı biz bkz hello en yaygın sorunları otomatik olarak düzeltmek yardımcı olması başvuru noktası çalışır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="cd3ad-109">Merhaba tanılamak için aynı süre teklif ek yönergeler daha karmaşık hello ve uyarlamasını troubled.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="cd3ad-110">Bu makalede varsayımlar aşağıdaki hello kullandığına dikkat edin:</span><span class="sxs-lookup"><span data-stu-id="cd3ad-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="cd3ad-111">Azure uygulama proxy'si dağıtılan göre bizim [belgelerine](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) ve genel erişim toonon KCD uygulamaları beklendiği gibi çalıştığını.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="cd3ad-112">Merhaba yayımlanan hedef uygulama IIS ve Microsoft'un kerberos üzerinde temel alır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="cd3ad-113">Merhaba sunucu ve uygulama ana bilgisayar tek bir Active Directory etki alanında bulunur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="cd3ad-114">Etki alanı ve orman senaryoları çapraz ilgili ayrıntılı bilgiler bulunabilir bizim [KCD Teknik İnceleme](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="cd3ad-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="cd3ad-115">Merhaba konu uygulama yayımlanan bir Azure Kiracı ile ön kimlik doğrulama etkinleştirildi ve kullanıcıların tooauthenticate tooAzure aracılığıyla forms tabanlı kimlik doğrulama beklenir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="cd3ad-116">Zengin istemci kimlik doğrulama senaryoları bu makalenin kapsamında değildir, ancak gelecekteki hello belirli bir noktada eklenmesi.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="cd3ad-117">Ön koşullar</span><span class="sxs-lookup"><span data-stu-id="cd3ad-117">Prerequisites</span></span>

<span data-ttu-id="cd3ad-118">Azure uygulama Proxy altyapısını neredeyse herhangi bir tür dağıtılabilir veya ortam ve hello mimarileri Şüphesiz kuruluş tooorganization farklı.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="cd3ad-119">Merhaba en yaygın nedenlerinden biri KCD sorunları hello ortamları kendileri ancak bunun yerine basit yanlış yapılandırmaları veya genel gözetim değil ilişkilidir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="cd3ad-120">Bu nedenle, bizim öneriler her zaman toostart bizim ana düzenlendiği tüm hello ön koşul karşılanır olduğundan emin olarak tarafından [KCD SSO'su kullanarak hello uygulama proxy'si makale](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) önce başlatma sorunlarını giderme.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="cd3ad-121">Bu önceki sürümlerinde Windows, aynı zamanda bazı başka noktalar oluşturduğunu sırasında temelde farklı bir yaklaşım tooconfiguring KCD kullanır gibi KCD 2012R2 üzerinde yapılandırma konusunda özellikle hello bölümü:</span><span class="sxs-lookup"><span data-stu-id="cd3ad-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="cd3ad-122">Bir etki alanı üye sunucusu tooopen belirli etki alanı denetleyicisiyle güvenli kanal iletişim için seyrek değil.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="cd3ad-123">Bağlayıcı konakları genellikle yalnızca belirli yerel site DC'leri ile kısıtlı toobeing mümkün toocommunicate olmamalıdır şekilde tooanother iletişim belirli bir zamanda taşıyın.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="cd3ad-124">Benzer toohello noktası yukarıdaki etki alanları arası senaryolar hello yerel ağ çevre dışında yer alabileceği bir bağlayıcı konak tooDCs doğrudan başvuruları kullanır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="cd3ad-125">Eşit olduğu Bu senaryoda önemli toomake başlayarak trafiği diğer ilgili etki alanları, aksi takdirde temsilci temsil eden tooDCs de izin emin başarısız.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="cd3ad-126">Bunlar bazen zorlayıcı ve çekirdek RPC trafiğine engel olarak mümkün olduğunda, tüm etkin IP'leri/Kimlikler cihazlar bağlayıcı konakları ve DC'leri arasında yerleştirmekten kaçınmalısınız</span><span class="sxs-lookup"><span data-stu-id="cd3ad-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="cd3ad-127">Tooresolve sorunları hızla isteriz ve etkili bir şekilde zaman alabilir kadar bu nedenle, mümkün olduğunda deneyin ve gerekir hello senaryoları basit temsilci test.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="cd3ad-128">Daha fazla değişken, tanıtmak Merhaba, hello daha, toocontend sahip olabilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="cd3ad-129">Örneğin, test tooa tek Bağlayıcınızı sınırlama değerli zamandan tasarruf edebilirsiniz ve hello sorunları giderildikten sonra ek bağlayıcı eklenebilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="cd3ad-130">Olası çalışırsanız ve test etmek için hello mimarisi tooa tam minimum en aza bazı çevresel etmenler de tooan sorun, böylece yeniden katkıda bulunan.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="cd3ad-131">Örneğin, yanlış yapılandırılmış iç güvenlik duvarı ACL'ler seyrek, böylece mümkünse düz toohello DC'leri ve arka uç uygulaması aracılığıyla izin verilen bir bağlayıcı gelen tüm trafiği vardır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="cd3ad-132">Gerçekte hello mutlak en iyi yeri tooposition bağlayıcılar olabilir yakın tootheir hedefleri olur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="cd3ad-133">Bir Güvenlik Duvarı'nı sat satır içi sahip yalnızca sınama adımında gereksiz karmaşıklık ekler ve yalnızca, araştırmalar uzatmak.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="cd3ad-134">Bu nedenle, nelerin KCD sorun yine de oluşturduğunu?</span><span class="sxs-lookup"><span data-stu-id="cd3ad-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="cd3ad-135">İyi var. KCD bir sorun başarısız olan ve hello ilk belirtileri genellikle kendileri de bildirim SSO birkaç Klasik göstergeleri tarayıcı hello.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Yanlış KCD yapılandırma hatası](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Yetkilendirme toomissing izinleri başarısız oldu](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="cd3ad-138">hangi tooperform SSO başarısız ve sonuç olarak reddetme aynı belirti ayı hello tüm kullanıcı erişimi toohello uygulaması hello.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="cd3ad-139">Sorun giderme</span><span class="sxs-lookup"><span data-stu-id="cd3ad-139">Troubleshooting</span></span>

<span data-ttu-id="cd3ad-140">Ardından sorun giderme nasıl hello sorunu ve gözlemlenen Belirtiler bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="cd3ad-141">Henüz gelmiş olabilir üzerinden değil yararlı bilgiler içerdiğinden herhangi geçmeden önce daha fazla bağlantılar, aşağıdaki hello önerdiğimiz:</span><span class="sxs-lookup"><span data-stu-id="cd3ad-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="cd3ad-142">Uygulama proxy'si sorunları ve hata iletileri sorunlarını giderme</span><span class="sxs-lookup"><span data-stu-id="cd3ad-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="cd3ad-143">Kerberos hataları ve belirtileri</span><span class="sxs-lookup"><span data-stu-id="cd3ad-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="cd3ad-144">SSO ile çalışan, şirket içi ve bulut kimlikleri aynı değildir</span><span class="sxs-lookup"><span data-stu-id="cd3ad-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="cd3ad-145">Sorun, bu kadar ardından hello ana becerilere sahipseniz kesinlikle bulunmaktadır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="cd3ad-146">Toodig daha derin, gereksinim duyduğunuz giderebileceğinizi üç ayrı aşamaları hello akışına ayırarak başlatın.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="cd3ad-147">**İstemcisi ön kimlik doğrulaması** -hello dış kullanıcı tooAzure bir tarayıcı aracılığıyla kimlik doğrulaması.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="cd3ad-148">Mümkün toopre edilen-kimlik doğrulaması tooAzure KCD SSO toofunction kesinlik temelli.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="cd3ad-149">Bu test edilip herhangi bir sorun varsa, ilk olarak ele.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="cd3ad-150">Merhaba ön kimlik doğrulama aşama hiçbir ilişkisi tooKCD veya hello sahip olduğuna dikkat edin, uygulama yayımlanır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="cd3ad-151">Bu oldukça kolay toocorrect uyumsuzlukları sağlamlık hello konu hesabı denetimi tarafından Azure'da var olmalıdır ve, olmadığını devre dışı bırakılmış/engelledi.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="cd3ad-152">Merhaba hata yanıtı hello tarayıcıda genellikle açıklayıcı yeterince toounderstand hello neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="cd3ad-153">Emin değilseniz, diğer sorun giderme belgeleri tooverify kontrol edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="cd3ad-154">**Temsilci hizmet** -kullanıcılar adına bir kerberos hizmet biletini bir KDC (Kerberos Dağıtım Merkezi), alma Azure Ara sunucusu Bağlayıcısı hello.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="cd3ad-155">Merhaba dış iletişimleri hello istemci hello Azure ön uç arasında şifrelemeyle KCD üzerinde doğabilecek, diğerinden sağlama çalıştığını olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="cd3ad-156">Böylece Hello Azure Proxy Hizmeti kullanılan tooobtain bir kerberos anahtarı olması geçerli bir kullanıcı kimliği ile sağlanan budur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="cd3ad-157">Bu KCD mümkün değildir ve başarısız olacağı olmadan.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="cd3ad-158">Daha önce belirtildiği gibi hello tarayıcı hata iletileri şey neden başarısız iyi bazı ipuçları genellikle sağlar.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="cd3ad-159">Bu izin, toocorrelate hello davranışı tooactual olayları hello Azure Proxy olay günlüğü'nde hello etkinlik kimliği ve zaman damgası aşağı emin toonote hello yanıtta kılın.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Yanlış KCD yapılandırma hatası](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="cd3ad-161">Ve hello karşılık gelen girişleri görülen hello olay günlüğü olay 13019 veya 12027 görülen.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="cd3ad-162">Bağlayıcı olay günlüklerinde hello bulabilirsiniz **uygulama ve hizmet günlükleri** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Bağlayıcı**&gt;**yönetici**.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Uygulama proxy'si olay günlüğündeki olay 13019](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Uygulama proxy'si olay günlüğündeki olay 12027](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="cd3ad-165">Bir A kaydı iç DNS sunucunuzun hello uygulamanın adresi ve bir CName kullanın</span><span class="sxs-lookup"><span data-stu-id="cd3ad-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="cd3ad-166">Merhaba bağlayıcı barındıran hedef hesabının SPN ve atanan hello hakları toodelegate toohello verildiğini yeniden onaylayın **herhangi bir kimlik doğrulama protokolünü kullan** seçilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="cd3ad-167">Bu bizim ana kapsamdaki [SSO yapılandırma makale](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="cd3ad-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="cd3ad-168">Olduğunu hello SPN varlığı AD içinde yalnızca tek bir örneğini vererek doğrulayın bir **setspn - x** herhangi bir etki alanı üye ana bir komut isteminden</span><span class="sxs-lookup"><span data-stu-id="cd3ad-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="cd3ad-169">Bir etki alanı ilkesi yaşanıyorsa toosee zorlanan toolimit hello denetleyin [en büyük boyut verilen kerberos belirteçlerin](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/)gibi bir belirteç edinme öğesinden bu engelle hello bağlayıcı toobe aşırı bulundu</span><span class="sxs-lookup"><span data-stu-id="cd3ad-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="cd3ad-170">Merhaba alışverişleri hello bağlayıcı konağı ve etki alanı KDC arasında yakalama bir ağ izlemesi sonra daha düşük düzey ayrıntı hello sorunları alma hello sonraki en iyi adım olacaktır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="cd3ad-171">Bu konuda bulabilirsiniz [derinlemesine sorun giderme kağıt](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="cd3ad-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="cd3ad-172">Raporlama iyi görünüyorsa, bir olay bir 401 döndürme toohello uygulama kimlik doğrulamasının başarısız belirten hello günlüklerine görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="cd3ad-173">Bu genellikle, bilet reddetme bu hello hedef uygulama gösterir, böylece sonraki aşamaya aşağıdaki hello ile devam.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="cd3ad-174">**Hedef uygulama** -hello Bağlayıcısı tarafından sağlanan hello kerberos bileti hello tüketicisi</span><span class="sxs-lookup"><span data-stu-id="cd3ad-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="cd3ad-175">Bu aşama hello bağlayıcı sırasında beklenen toohave bir kerberos hizmet bileti toohello arka üstbilgisi hello ilk uygulama isteği içinde olarak gönderilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="cd3ad-176">Merhaba uygulamanın kullanarak hello Portalı'nda tanımlanan iç URL'yi doğrula Merhaba uygulaması hello bağlayıcı konaktaki hello tarayıcısından doğrudan erişilebilir olduğunu.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="cd3ad-177">Ardından, başarılı bir şekilde oturum açabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-177">Then you can login successfully.</span></span> <span data-ttu-id="cd3ad-178">Bunun yapılması ile ilgili ayrıntılar hello connector sorunlarını giderme sayfasında bulunabilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="cd3ad-179">Merhaba tarayıcı arasındaki bu hello kimlik doğrulaması hala hello bağlayıcı konakta onaylayın ve Merhaba uygulaması, kerberos, hello aşağıdakilerden birini yaparak kullanıyor:</span><span class="sxs-lookup"><span data-stu-id="cd3ad-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="cd3ad-180">Geliştirme araçları çalıştırma (**F12**) Internet Explorer ya da kullanım [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) hello bağlayıcı ana bilgisayardan.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="cd3ad-181">Merhaba iç URL'yi kullanarak toohello uygulamasına gidin ve hello uygulamasından hello yanıtta döndürülen WWW yetkilendirme üstbilgileri sunulan hello inceleyin, ya da anlaşma tooensure veya kerberos mevcuttur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="cd3ad-182">Bir sonraki kerberos blob hello yanıtta döndürülen hello tarayıcı toohello genellikle uygulama başlayarak **YII**bu göstergesidir oynama olan kerberos gelir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="cd3ad-183">NTLM hello üzerinde her zaman diğer yandan başlayarak **TlRMTVNTUAAB**, Base64 kodlaması kodunu çözdü zaman NTLMSSP okur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="cd3ad-184">Görürseniz **TlRMTVNTUAAB** hello blob hello başlangıcında, bu Kerberos anlamına gelir **değil** kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="cd3ad-185">Bu görmüyorsanız, Kerberos olasıdır kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="cd3ad-186">Not: Fiddler, kullanıyorsanız bu yöntem geçici olarak hello uygulamanın yapılandırma dosyasında IIS üzerinde genişletilmiş koruma devre dışı bırakılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Ağ İnceleme tarayıcının](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="cd3ad-188">*Şekil:* TIRMTVNTUAAB ile başlamıyor olduğundan, bu Kerberos kullanılabilir bir örnektir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="cd3ad-189">Bu, YII ile başlamıyor Kerberos Blob örneğidir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="cd3ad-190">Geçici olarak NTLM IIS site ve erişim uygulamasından doğrudan IE bağlayıcı konaktaki üzerinde hello sağlayıcıları listesinden kaldırın.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="cd3ad-191">Merhaba sağlayıcılar listesinde artık NTLM ile mümkün tooaccess Merhaba uygulaması yalnızca Kerberos kullanılarak olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="cd3ad-192">Bu başarısız olursa, daha sonra hello uygulamanın yapılandırma ile ilgili bir sorun yoktur ve Kerberos kimlik doğrulaması çalışmıyor önerir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="cd3ad-193">Kerberos kullanılabilir durumda değilse, IIS toomake emin ayarlarında anlaşma onay hello uygulamanın kimlik doğrulaması en üstteki hemen altındaki NTLM ile listelenir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="cd3ad-194">(Değil Anlaş: kerberos veya anlaşma: pku2u ile).</span><span class="sxs-lookup"><span data-stu-id="cd3ad-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="cd3ad-195">Yalnızca Kerberos işlevsel ise devam edin.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-195">Only continue if Kerberos is functional.</span></span>

   ![Windows kimlik doğrulama sağlayıcıları](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="cd3ad-197">Kerberos ve NTLM yerinde ile Merhaba portalında hello uygulaması için ön kimlik doğrulaması şimdi geçici olarak devre dışı olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="cd3ad-198">Hello erişebildiğinizi varsa bkz hello dış URL'yi kullanarak Internet.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="cd3ad-199">İstendiğinde tooauthenticate olmalıdır ve hello ile kullanılan hello aynı hesap adına mümkün toodo olmalıdır önceki adımı.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="cd3ad-200">Aksi durumda, bu hiç Merhaba arka uç uygulaması ve değil KCD bir sorun gösterir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="cd3ad-201">Şimdi hello Portalı'nda ön kimlik doğrulama yeniden etkinleştirin ve tooconnect toohello uygulaması, dış URL yoluyla deneyerek Azure üzerinden kimlik doğrulaması.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="cd3ad-202">SSO başarısız olursa, hello tarayıcı yanı sıra 13022 olay günlüğünde olay hello Yasak hata iletisini görmeniz gerekir:</span><span class="sxs-lookup"><span data-stu-id="cd3ad-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="cd3ad-203">*Microsoft AAD Application Proxy Connector, çünkü bir HTTP 401 hata ile tooKerberos kimlik doğrulama girişimlerini Hello arka uç sunucusuna yanıtlar hello kullanıcının kimliğini doğrulayamıyor.*</span><span class="sxs-lookup"><span data-stu-id="cd3ad-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![HTTTP 401 Yasak hata alır](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="cd3ad-205">SPN hello aynı hesabı karşı AD içinde aşağıda gösterildiği gibi IIS'de giderek yapılandırıldı yapılandırılmış toouse hello Hello IIS uygulama tooensure yapılandırılmış hello uygulama havuzu denetleyin</span><span class="sxs-lookup"><span data-stu-id="cd3ad-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![IIS uygulama yapılandırma penceresi](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="cd3ad-207">Merhaba kimlik öğrendikten sonra bu hesabı kesinlikle SPN söz konusu hello ile yapılandırıldığından emin bir cmd komut istemi toomake hello aşağıdakini gönderin.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="cd3ad-208">Örneğin, **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="cd3ad-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![SetSPN komut penceresi](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="cd3ad-210">Merhaba portalındaki hello uygulamanın ayarları karşı tanımlanmış SPN hello hedef AD hesabı hello uygulamanın uygulama havuzunun kullandığı karşı yapılandırılmış aynı SPN hello bu hello denetleyin</span><span class="sxs-lookup"><span data-stu-id="cd3ad-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![Azure Portalı'nda SPN yapılandırma](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="cd3ad-212">IIS ve select hello na **yapılandırma Düzenleyicisi** seçeneği hello uygulama için ve çok gidin**system.webServer/security/authentication/windowsAuthentication** toomake emin bu **UseAppPoolCredentials** tootrue ayarlayın</span><span class="sxs-lookup"><span data-stu-id="cd3ad-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![IIS yapılandırması uygulama havuzları seçeneği kimlik bilgisi](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="cd3ad-214">Yararlı Kerberos işlemlerinin Hello performansını geliştirmeye devam ederken, çekirdek modu etkin bırakarak ayrıca hello hello biletini neden olan makine hesabı kullanarak şifresi hizmet toobe istedi.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="cd3ad-215">Bu nedenle bu kümesi tootrue sonu sahip hello yerel sistem olarak da adlandırılır Merhaba uygulaması bir grupta birden fazla sunucuda barındırılıyorsa KCD.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="cd3ad-216">Ek bir onay toodisable hello ayrıca isteyebilir **Genişletilmiş** koruma çok.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="cd3ad-217">Bir uygulama hello varsayılan Web sitesi bir alt klasörü burada yayımlanan burada bu toobreak belirli yapılandırmalarında etkinleştirildiğinde KCD oluyor uygulamasına yol açıyordu karşılaşılan senaryoları olmuştur.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="cd3ad-218">Bu kendisine bağımlı nesneler herhangi bir etkin ayarı devralarak öneren çıkışı gri hello tüm iletişim kutularını bırakarak anonim kimlik doğrulaması için yalnızca yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="cd3ad-219">Ancak burada olası her zaman bu etkinleştirildiğinde sahip öneririz böylece her şekilde test, toorestore bu tooenabled unutmayın.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="cd3ad-220">Bu ek denetimleri kullanarak, yayımlanan uygulama izleme toostart üzerinde yerleştirdiğiniz.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="cd3ad-221">Devam edin ve ayrıca ek bağlayıcı yukarı döndürme toodelegate yapılandırılmış, ancak sonra şeyleri daha fazla olup olmadığını biz bizim daha ayrıntılı teknik kılavuz okuma önerebileceğiniz [sorun giderme Azure AD uygulaması için hello tam Kılavuzu Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="cd3ad-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="cd3ad-222">Kullanıcısıysanız sorununuzu oluşturulamıyor tooprogress hala, destek ve mutluluk tooassist'dan çok olmalıdır buradan devam.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="cd3ad-223">Merhaba portalındaki doğrudan bir destek bileti oluşturun ve bizim mühendisleri tooyou ulaşabileceği.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="cd3ad-224">Diğer senaryolar</span><span class="sxs-lookup"><span data-stu-id="cd3ad-224">Other scenarios</span></span>

-   <span data-ttu-id="cd3ad-225">Azure uygulama proxy'si, istek tooan uygulama göndermeden önce bir Kerberos anahtarı ister.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="cd3ad-226">Tableau Server gibi bazı 3 taraf uygulamalar kimlik doğrulama yöntemi gibi değil ve hello yerine daha geleneksel bekliyor anlaşmaları tootake yerleştir.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="cd3ad-227">Merhaba ilk istek anonim bir 401 destekleyen hello kimlik doğrulama türleri ile Merhaba uygulama toorespond izin verme.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="cd3ad-228">Burada bir uygulama, bir arka uç hem ön uç SQL Reporting Services gibi gerektiren her iki kimlik doğrulama ile katmanlı senaryolarda yaygın olarak kullanılan çift atlama kimlik doğrulaması -.</span><span class="sxs-lookup"><span data-stu-id="cd3ad-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cd3ad-229">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="cd3ad-229">Next steps</span></span>
[<span data-ttu-id="cd3ad-230">Yönetilen bir etki alanında kerberos Kısıtlı temsilci (KCD) yapılandırma</span><span class="sxs-lookup"><span data-stu-id="cd3ad-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
