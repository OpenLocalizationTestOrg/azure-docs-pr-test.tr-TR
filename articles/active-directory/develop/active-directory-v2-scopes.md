---
title: "Azure Active Directory v2.0 kapsamları, izinler ve onay | Microsoft Docs"
description: "Kapsam, izinleri ve onay dahil olmak üzere Azure AD v2.0 uç yetkilendirme açıklaması."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="dea77-103">Kapsam, izinleri ve Azure Active Directory v2.0 uç onay</span><span class="sxs-lookup"><span data-stu-id="dea77-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="dea77-104">Azure Active Directory (Azure AD) ile tümleştirme uygulamalarını kullanıcılara bir uygulama verilerini nasıl erişebileceğinizi üzerinde denetim sağlar bir yetkilendirme modelini izler.</span><span class="sxs-lookup"><span data-stu-id="dea77-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="dea77-105">Yetkilendirme modelini v2.0 uyarlamasını güncelleştirilen ve bir uygulamayı Azure AD ile nasıl etkileşim kurmalıdır değiştirir.</span><span class="sxs-lookup"><span data-stu-id="dea77-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="dea77-106">Bu makalede, kapsamları, izinler ve onay dahil olmak üzere bu yetkilendirme modelini temel kavramları kapsar.</span><span class="sxs-lookup"><span data-stu-id="dea77-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="dea77-107">V2.0 uç noktası, tüm Azure Active Directory senaryolarını ve özelliklerini desteklemez.</span><span class="sxs-lookup"><span data-stu-id="dea77-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="dea77-108">V2.0 uç kullanması gerekip gerekmediğini belirlemek için okuyun [v2.0 sınırlamaları](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="dea77-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="dea77-109">Kapsamlar ve izinleri</span><span class="sxs-lookup"><span data-stu-id="dea77-109">Scopes and permissions</span></span>
<span data-ttu-id="dea77-110">Azure AD uygulayan [OAuth 2.0](active-directory-v2-protocols.md) Yetkilendirme Protokolü.</span><span class="sxs-lookup"><span data-stu-id="dea77-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="dea77-111">OAuth 2.0 üzerinden bir üçüncü taraf uygulama bir kullanıcı adına web barındırılan kaynaklara erişebilir bir yöntemdir.</span><span class="sxs-lookup"><span data-stu-id="dea77-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="dea77-112">Azure AD ile tümleşir web barındırılan kaynak bir kaynak tanımlayıcısı vardır veya *uygulama kimliği URI'si*.</span><span class="sxs-lookup"><span data-stu-id="dea77-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="dea77-113">Örneğin, Microsoft'un web barındırılan kaynaklar bazıları şunlardır:</span><span class="sxs-lookup"><span data-stu-id="dea77-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="dea77-114">Office 365 posta API birleşik:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="dea77-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="dea77-115">Azure AD grafik API'si:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="dea77-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="dea77-116">Microsoft Graph:`https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="dea77-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="dea77-117">Aynı Azure AD ile tümleşik tüm üçüncü taraf kaynaklar için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="dea77-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="dea77-118">Bu kaynaklardan herhangi birini de bu kaynak işlevselliğini daha küçük parçalara bölmek için kullanılan izinler kümesini tanımlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="dea77-119">Örneğin, [Microsoft Graph](https://graph.microsoft.io) diğerlerinin yanı sıra aşağıdaki görevleri gerçekleştirmek için izinler tanımlanır:</span><span class="sxs-lookup"><span data-stu-id="dea77-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="dea77-120">Kullanıcının Takvim okuma</span><span class="sxs-lookup"><span data-stu-id="dea77-120">Read a user's calendar</span></span>
* <span data-ttu-id="dea77-121">Kullanıcının Takvim yazma</span><span class="sxs-lookup"><span data-stu-id="dea77-121">Write to a user's calendar</span></span>
* <span data-ttu-id="dea77-122">Kullanıcı olarak posta gönderme</span><span class="sxs-lookup"><span data-stu-id="dea77-122">Send mail as a user</span></span>

<span data-ttu-id="dea77-123">Bu tür izin tanımlayarak, kaynak verilerini ve verilerin açığa hassas denetime sahiptir.</span><span class="sxs-lookup"><span data-stu-id="dea77-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="dea77-124">Bir üçüncü taraf uygulaması bu izinleri bir uygulama kullanıcıdan isteyebilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="dea77-125">Uygulama kullanıcı, uygulamayı kullanıcının adına işlem yapabileceği önce izinleri onaylamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="dea77-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="dea77-126">Daha küçük izin kümeleri kaynağın işlevsellik Öbekleme tarafından işlevleri gerçekleştirmek için ihtiyaç duydukları belirli izinleri istemek için üçüncü taraf uygulamaları derlenebilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="dea77-127">Uygulama kullanıcıların tam olarak bir uygulama verilerini nasıl kullanılacağını bilmeniz ve uygulama ile kötü amaçlı çalışmıyorsa doğrulayabilirse olabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="dea77-128">Azure AD'de ve OAuth, izinleri bu tür çağrılır *kapsamları*.</span><span class="sxs-lookup"><span data-stu-id="dea77-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="dea77-129">Bunlar da olarak da adlandırılır *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="dea77-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="dea77-130">Bir kapsam Azure AD'de bir dize değeri olarak temsil edilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="dea77-131">Microsoft Graph örnekle devam edersek, her izin için kapsam değeridir:</span><span class="sxs-lookup"><span data-stu-id="dea77-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="dea77-132">Kullanıcının takvim kullanarak okuyun`Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="dea77-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="dea77-133">Kullanıcının takvim kullanarak yazma`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="dea77-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="dea77-134">Kullanarak bir kullanıcı tarafından olarak posta gönderme`Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="dea77-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="dea77-135">Bir uygulama, v2.0 uç noktasına istek kapsamlar belirterek bu izinleri isteyebilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="dea77-136">Openıd Connect kapsamları</span><span class="sxs-lookup"><span data-stu-id="dea77-136">OpenID Connect scopes</span></span>
<span data-ttu-id="dea77-137">Openıd Connect v2.0 uyarlamasını belirli bir kaynak için geçerli olmayan birkaç iyi tanımlanmış kapsamına sahiptir: `openid`, `email`, `profile`, ve `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="dea77-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="dea77-138">openıd</span><span class="sxs-lookup"><span data-stu-id="dea77-138">openid</span></span>
<span data-ttu-id="dea77-139">Bir uygulama oturum açma kullanarak gerçekleştirirse [Openıd Connect](active-directory-v2-protocols.md), isteği göndermelidir `openid` kapsam.</span><span class="sxs-lookup"><span data-stu-id="dea77-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="dea77-140">`openid` Kapsam, iş hesabı onay sayfasında "oturum" iznini ve kişisel Microsoft hesabı onay sayfasında "Profilinizi görüntüleyin ve uygulamaları ve Microsoft hesabınızı kullanarak hizmetlere bağlanma" iznini gösterir.</span><span class="sxs-lookup"><span data-stu-id="dea77-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="dea77-141">Bu izne sahip bir uygulamanın kullanıcı için benzersiz bir tanımlayıcı biçiminde alabileceği `sub` talep.</span><span class="sxs-lookup"><span data-stu-id="dea77-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="dea77-142">Ayrıca kullanıcı bilgisi uç noktasına uygulama erişimi sağlar.</span><span class="sxs-lookup"><span data-stu-id="dea77-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="dea77-143">`openid` Kapsamı, bir uygulamanın farklı bileşenler arasındaki HTTP çağrıları güvenliğini sağlamak için kullanılan kimlik belirteçlerini edinmeye v2.0 belirteç uç noktada kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="dea77-144">E-posta</span><span class="sxs-lookup"><span data-stu-id="dea77-144">email</span></span>
<span data-ttu-id="dea77-145">`email` Kapsam ile kullanılabilir `openid` kapsam ve herhangi diğer.</span><span class="sxs-lookup"><span data-stu-id="dea77-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="dea77-146">Kullanıcının birincil e-posta adresine biçiminde uygulama erişim sağlayan `email` talep.</span><span class="sxs-lookup"><span data-stu-id="dea77-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="dea77-147">`email` Yalnızca bir e-posta adresi her zaman bir durum yoksa kullanıcı hesabı ile ilişkili ise talep bir belirteç içine eklenmiştir.</span><span class="sxs-lookup"><span data-stu-id="dea77-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="dea77-148">Bunu kullanıyorsa `email` kapsamı, uygulamanız hazırlanmış bir durumda işlemek için `email` talep belirteci yok.</span><span class="sxs-lookup"><span data-stu-id="dea77-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="dea77-149">Profili</span><span class="sxs-lookup"><span data-stu-id="dea77-149">profile</span></span>
<span data-ttu-id="dea77-150">`profile` Kapsam ile kullanılabilir `openid` kapsam ve herhangi diğer.</span><span class="sxs-lookup"><span data-stu-id="dea77-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="dea77-151">Kullanıcı hakkındaki bilgileri önemli miktarda uygulama erişim sağlar.</span><span class="sxs-lookup"><span data-stu-id="dea77-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="dea77-152">Erişebilmesi için bilgi içerir, ancak kullanıcının verilen ad, Soyadı, tercih edilen kullanıcı adı ve nesne kimliği için sınırlı değildir</span><span class="sxs-lookup"><span data-stu-id="dea77-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="dea77-153">Belirli bir kullanıcı için id_tokens parametresinde kullanılabilir profil talepleri tam bir listesi için bkz: [v2.0 belirteçler başvuru](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="dea77-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="dea77-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="dea77-154">offline_access</span></span>
<span data-ttu-id="dea77-155">[ `offline_access` Kapsam](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) uygulama erişiminizi kaynaklara kullanıcı adına uzun bir süre sağlar.</span><span class="sxs-lookup"><span data-stu-id="dea77-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="dea77-156">İş hesabı onay sayfasında, bu kapsamı "dilediğiniz zaman, veri erişim" izin olarak görünür.</span><span class="sxs-lookup"><span data-stu-id="dea77-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="dea77-157">Kişisel Microsoft hesabı onay sayfasında, "bilgilerinize dilediğiniz zaman erişin" izin olarak görünür.</span><span class="sxs-lookup"><span data-stu-id="dea77-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="dea77-158">Bir kullanıcının ne zaman onaylar `offline_access` kapsamı, uygulamanızı v2.0 belirteç uç noktasından yenileme belirteçleri alabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="dea77-159">Yenileme belirteçleri uzun süreli.</span><span class="sxs-lookup"><span data-stu-id="dea77-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="dea77-160">Eskiler süresi dolduğundan, uygulamanızın yeni erişim belirteçleri elde edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="dea77-161">Uygulamanızı değil istemiyorsa `offline_access` kapsamı, yenileme belirteçleri almazsınız.</span><span class="sxs-lookup"><span data-stu-id="dea77-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="dea77-162">Bir yetkilendirme kodu kullanmak olduğunda bunun anlamı [OAuth 2.0 yetkilendirme kodu akışını](active-directory-v2-protocols.md), yalnızca bir erişim belirtecinden alırsınız `/token` uç noktası.</span><span class="sxs-lookup"><span data-stu-id="dea77-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="dea77-163">Erişim belirteci kısa bir süre için geçerli değil.</span><span class="sxs-lookup"><span data-stu-id="dea77-163">The access token is valid for a short time.</span></span> <span data-ttu-id="dea77-164">Erişim belirteci, genellikle bir saat içinde süresi dolar.</span><span class="sxs-lookup"><span data-stu-id="dea77-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="dea77-165">At noktası, kullanıcı yeniden yönlendirmek uygulamanız gereken başa `/authorize` yeni bir yetkilendirme kodu almak için uç nokta.</span><span class="sxs-lookup"><span data-stu-id="dea77-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="dea77-166">Uygulama, türünü bağlı olarak bu yeniden yönlendirme sırasında kullanıcı kimlik bilgilerini yeniden girin veya yeniden izinleri onayı gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="dea77-167">Alma ve yenileme belirteçleri kullanma hakkında daha fazla bilgi için bkz: [v2.0 protokol başvurusu](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="dea77-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="dea77-168">Tek tek kullanıcı izni isteniyor</span><span class="sxs-lookup"><span data-stu-id="dea77-168">Requesting individual user consent</span></span>
<span data-ttu-id="dea77-169">İçinde bir [Openıd Connect veya OAuth 2.0](active-directory-v2-protocols.md) yetkilendirme isteği, bir uygulama gerekiyor kullanarak izinleri isteyebileceği `scope` sorgu parametresi.</span><span class="sxs-lookup"><span data-stu-id="dea77-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="dea77-170">Örneğin, bir kullanıcı bir uygulama, uygulama gönderir oturum açtığında bir istek aşağıdaki örnekteki gibi (okunabilirliği için eklenen satır sonuyla):</span><span class="sxs-lookup"><span data-stu-id="dea77-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="dea77-171">`scope` Parametresi uygulama isteyen kapsamları boşlukla ayrılmış bir listesi verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="dea77-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="dea77-172">Her kapsam, kaynak tanımlayıcısına (uygulama kimliği URI) kapsam değeri ekleyerek belirtilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="dea77-173">İstek örnekte, uygulama kullanıcının Takvim okumak ve kullanıcı olarak posta göndermek için izniniz gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="dea77-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="dea77-174">Kullanıcı kimlik bilgilerini girdikten sonra v2.0 uç noktası için eşleşen bir kayıt denetler *kullanıcı izni*.</span><span class="sxs-lookup"><span data-stu-id="dea77-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="dea77-175">Kullanıcının istenen izinleri hiçbirine geçmişte seçtiği değil, v2.0 uç istenen izinleri vermek için kullanıcıya sorar.</span><span class="sxs-lookup"><span data-stu-id="dea77-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![İş hesabı onayı](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="dea77-177">Kullanıcının izni onayladığında, böylece kullanıcının yeniden sonraki hesap oturum açma işlemlerini üzerinde kabul yoksa izin kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="dea77-178">Tüm Kiracı onay isteme</span><span class="sxs-lookup"><span data-stu-id="dea77-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="dea77-179">Genellikle, bir kuruluş lisans ya da bir uygulama için abonelik satın aldığında kuruluş uygulama çalışanlarının için tam olarak sağlayacak istemektedir.</span><span class="sxs-lookup"><span data-stu-id="dea77-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="dea77-180">Bu işlemin bir parçası olarak, bir yönetici uygulamanın adına bir çalışan işlem izin verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="dea77-181">Yönetici tüm Kiracı izin verirse, kuruluşun çalışanlar uygulama için bir onay sayfasına görmezsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="dea77-182">Bir kiracıdaki tüm kullanıcılar için izni istemek için uygulamanızı yönetici onayı uç noktası kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="dea77-183">Yönetici kısıtlanmış kapsamları</span><span class="sxs-lookup"><span data-stu-id="dea77-183">Admin-restricted scopes</span></span>
<span data-ttu-id="dea77-184">Bazı yüksek ayrıcalıklı izinlere Microsoft ekosistemindeki ayarlanabilir *yönetici kısıtlanmış*.</span><span class="sxs-lookup"><span data-stu-id="dea77-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="dea77-185">Bu tür kapsamları örnekleri aşağıdaki izinleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="dea77-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="dea77-186">Kullanarak bir kuruluşun dizin verilerini okuma`Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="dea77-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="dea77-187">Kullanarak bir kuruluşun dizinine veri yazma`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="dea77-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="dea77-188">Bir kuruluşun Directory'de güvenlik gruplarını kullanarak okuyun`Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="dea77-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="dea77-189">Bir tüketici kullanıcı bir uygulama bu tür verilerin erişim ancak Kurumsal kullanıcılara hassas şirket verilerini aynı dizi için erişim verme kısıtlanır.</span><span class="sxs-lookup"><span data-stu-id="dea77-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="dea77-190">Uygulamanızı erişim bu izinleri birine bir kuruluş kullanıcıdan isterse, kullanıcı, uygulamanızın izinlerini onayı yetkiniz yok bildiren bir hata iletisi alır.</span><span class="sxs-lookup"><span data-stu-id="dea77-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="dea77-191">Uygulamanızı kuruluşlar için yönetici kısıtlanmış kapsamlara erişim gerekiyorsa, bunları bir şirket yöneticisinden doğrudan da yönetici onayı sonraki bölümde açıklandığı uç noktası, kullanarak isteğinde.</span><span class="sxs-lookup"><span data-stu-id="dea77-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="dea77-192">Bir yönetici bu izinleri yönetici onayı uç noktası aracılığıyla veriyorsa kiracıdaki tüm kullanıcılar için izin verilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="dea77-193">Yönetici onayı uç noktası kullanma</span><span class="sxs-lookup"><span data-stu-id="dea77-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="dea77-194">Bu adımları izlerseniz, uygulamanızı yönetici kısıtlanmış kapsamları dahil olmak üzere, bir kiracıdaki tüm kullanıcılar için izinler toplayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="dea77-195">Adımları uygulayan bir kod örnek görmek için [yönetici kısıtlanmış kapsamları örnek](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="dea77-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="dea77-196">Uygulama kayıt Portalı'nda izinleri iste</span><span class="sxs-lookup"><span data-stu-id="dea77-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="dea77-197">Uygulamanızda gidin [uygulama kayıt portalı](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), veya [bir uygulama oluşturmak](active-directory-v2-app-registration.md) yapmadıysanız.</span><span class="sxs-lookup"><span data-stu-id="dea77-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="dea77-198">Bulun **Microsoft Graph izinleri** bölümünde ve uygulamanızın gerektirdiği izinleri ekleyin.</span><span class="sxs-lookup"><span data-stu-id="dea77-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="dea77-199">Emin olun **kaydetmek** uygulama kaydı.</span><span class="sxs-lookup"><span data-stu-id="dea77-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="dea77-200">Önerilir: kullanıcı uygulamanızda oturum</span><span class="sxs-lookup"><span data-stu-id="dea77-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="dea77-201">Genellikle, yönetici onayı uç noktası kullanan bir uygulama oluşturduğunuzda, uygulamanın bir sayfa veya yönetici uygulamanın izinleri onaylayabilirsiniz görünüm gerekir.</span><span class="sxs-lookup"><span data-stu-id="dea77-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="dea77-202">Bu sayfa uygulamanın kaydolma akış, uygulamanın ayarlarının bir parçası parçası olabilir veya özel bir "Bağlan" akış olabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="dea77-203">Çoğu durumda, "yalnızca bir kullanıcı bir iş veya Okul Microsoft hesabı oturum imzaladığı sonra uygulamanın bunu göstermek için bağlantı görünümü" mantıklıdır.</span><span class="sxs-lookup"><span data-stu-id="dea77-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="dea77-204">Kullanıcının uygulamanıza oturum açtığınızda, yönetici gerekli izinleri onaylanacak yönergelerinin önce ait olduğu kuruluş tanımlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="dea77-205">Kesinlikle gerekli olmasa da, kuruluş, kullanıcılarınızın daha sezgisel bir deneyim oluşturmanıza yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="dea77-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="dea77-206">Kullanıcıyla oturum açmak için izleyin bizim [v2.0 protokol öğreticileri](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="dea77-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="dea77-207">Bir dizin yönetici olarak izinleri iste</span><span class="sxs-lookup"><span data-stu-id="dea77-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="dea77-208">Kuruluşunuzun yönetici olarak izinleri istemek hazır olduğunuzda, kullanıcıyı v2.0 yönlendirebilirsiniz *yönetici onayı uç noktası*.</span><span class="sxs-lookup"><span data-stu-id="dea77-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="dea77-209">Parametre</span><span class="sxs-lookup"><span data-stu-id="dea77-209">Parameter</span></span> | <span data-ttu-id="dea77-210">Koşul</span><span class="sxs-lookup"><span data-stu-id="dea77-210">Condition</span></span> | <span data-ttu-id="dea77-211">Açıklama</span><span class="sxs-lookup"><span data-stu-id="dea77-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="dea77-212">Kiracı</span><span class="sxs-lookup"><span data-stu-id="dea77-212">tenant</span></span> |<span data-ttu-id="dea77-213">Gerekli</span><span class="sxs-lookup"><span data-stu-id="dea77-213">Required</span></span> |<span data-ttu-id="dea77-214">İzni istemek için istediğiniz dizin Kiracı.</span><span class="sxs-lookup"><span data-stu-id="dea77-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="dea77-215">GUID veya kolay ad biçiminde sağlanabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="dea77-216">client_id</span><span class="sxs-lookup"><span data-stu-id="dea77-216">client_id</span></span> |<span data-ttu-id="dea77-217">Gerekli</span><span class="sxs-lookup"><span data-stu-id="dea77-217">Required</span></span> |<span data-ttu-id="dea77-218">Uygulama Kimliği [uygulama kayıt portalı](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) uygulamanıza atanmış.</span><span class="sxs-lookup"><span data-stu-id="dea77-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="dea77-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="dea77-219">redirect_uri</span></span> |<span data-ttu-id="dea77-220">Gerekli</span><span class="sxs-lookup"><span data-stu-id="dea77-220">Required</span></span> |<span data-ttu-id="dea77-221">Yeniden yönlendirme işlemek uygulamanız için gönderilecek yanıt istediğiniz URI'si.</span><span class="sxs-lookup"><span data-stu-id="dea77-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="dea77-222">Bu tam olarak yeniden yönlendirme uygulama kayıt Portalı'nda kayıtlı URI'ler biriyle eşleşmelidir.</span><span class="sxs-lookup"><span data-stu-id="dea77-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="dea77-223">durum</span><span class="sxs-lookup"><span data-stu-id="dea77-223">state</span></span> |<span data-ttu-id="dea77-224">Önerilen</span><span class="sxs-lookup"><span data-stu-id="dea77-224">Recommended</span></span> |<span data-ttu-id="dea77-225">Belirteç yanıtta döndürülen de istekte bulunan bir değer.</span><span class="sxs-lookup"><span data-stu-id="dea77-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="dea77-226">İstediğiniz herhangi bir içerik dizesi olabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-226">It can be a string of any content you want.</span></span> <span data-ttu-id="dea77-227">Sayfa veya görünüm üzerinde oldukları gibi kimlik doğrulama isteği oluşmadan önce uygulama kullanıcının durumu hakkında bilgi kodlanacak durumunu kullanın.</span><span class="sxs-lookup"><span data-stu-id="dea77-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="dea77-228">Bu noktada, Azure AD isteği tamamlamak oturum açmak bir kiracı Yöneticisi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="dea77-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="dea77-229">Yönetici uygulama kayıt Portalı'nda, uygulamanız için istenen tüm izinleri onaylamanız istenir.</span><span class="sxs-lookup"><span data-stu-id="dea77-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="dea77-230">Başarılı yanıt</span><span class="sxs-lookup"><span data-stu-id="dea77-230">Successful response</span></span>
<span data-ttu-id="dea77-231">Yönetici, uygulamanızın izinlerini onaylarsa, başarılı yanıtı şuna benzer:</span><span class="sxs-lookup"><span data-stu-id="dea77-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="dea77-232">Parametre</span><span class="sxs-lookup"><span data-stu-id="dea77-232">Parameter</span></span> | <span data-ttu-id="dea77-233">Açıklama</span><span class="sxs-lookup"><span data-stu-id="dea77-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="dea77-234">Kiracı</span><span class="sxs-lookup"><span data-stu-id="dea77-234">tenant</span></span> |<span data-ttu-id="dea77-235">Uygulamanız bu GUID biçiminde istenen izinlerin dizin Kiracı.</span><span class="sxs-lookup"><span data-stu-id="dea77-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="dea77-236">durum</span><span class="sxs-lookup"><span data-stu-id="dea77-236">state</span></span> |<span data-ttu-id="dea77-237">Aynı zamanda isteğinde bir değer belirteci yanıt olarak döndürülür.</span><span class="sxs-lookup"><span data-stu-id="dea77-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="dea77-238">İstediğiniz herhangi bir içerik dizesi olabilir.</span><span class="sxs-lookup"><span data-stu-id="dea77-238">It can be a string of any content you want.</span></span> <span data-ttu-id="dea77-239">Durum, uygulama kullanıcının durumu hakkında bilgi sayfa veya görünüm üzerinde oldukları gibi kimlik doğrulama isteği oluşmadan önce kodlamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="dea77-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="dea77-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="dea77-240">admin_consent</span></span> |<span data-ttu-id="dea77-241">Ayarlanacak **doğru**.</span><span class="sxs-lookup"><span data-stu-id="dea77-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="dea77-242">Hata yanıtı</span><span class="sxs-lookup"><span data-stu-id="dea77-242">Error response</span></span>
<span data-ttu-id="dea77-243">Yönetici, uygulamanızın izinlerini onaylamaz, başarısız yanıtı şuna benzer:</span><span class="sxs-lookup"><span data-stu-id="dea77-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="dea77-244">Parametre</span><span class="sxs-lookup"><span data-stu-id="dea77-244">Parameter</span></span> | <span data-ttu-id="dea77-245">Açıklama</span><span class="sxs-lookup"><span data-stu-id="dea77-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="dea77-246">error</span><span class="sxs-lookup"><span data-stu-id="dea77-246">error</span></span> |<span data-ttu-id="dea77-247">Oluşan hataları türlerini sınıflandırmak için kullanılan ve hataları tepki vermek için kullanılan bir hata kodu dizesi.</span><span class="sxs-lookup"><span data-stu-id="dea77-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="dea77-248">error_description</span><span class="sxs-lookup"><span data-stu-id="dea77-248">error_description</span></span> |<span data-ttu-id="dea77-249">Bir geliştirici hata kök nedenini belirlemenize yardımcı olabilecek belirli bir hata iletisi.</span><span class="sxs-lookup"><span data-stu-id="dea77-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="dea77-250">Yönetici onayı uç noktasından başarılı bir yanıt aldık sonra uygulamanızı istendiğinde izinleri kazanmıştır.</span><span class="sxs-lookup"><span data-stu-id="dea77-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="dea77-251">Ardından, istediğiniz kaynağı için bir belirteç talep edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="dea77-252">İzinlerini kullanma</span><span class="sxs-lookup"><span data-stu-id="dea77-252">Using permissions</span></span>
<span data-ttu-id="dea77-253">Uygulamanız için izinleri için kullanıcı izin sonra uygulamanızı uygulamanızın bazı kapasite bir kaynağa erişim izni temsil erişim belirteçleri elde edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="dea77-254">Bir erişim belirteci, yalnızca tek bir kaynak için kullanılabilir, ancak erişim belirteci içine kodlanmış uygulamanız bu kaynak için verilen her izni yok.</span><span class="sxs-lookup"><span data-stu-id="dea77-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="dea77-255">Bir erişim belirteci edinmek için uygulamanızı bir istek şöyle v2.0 belirteç uç yapabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="dea77-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="dea77-256">Sonuçta elde edilen erişim belirteci kaynak HTTP isteklerine kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="dea77-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="dea77-257">Güvenilir bir şekilde, kaynağa'nin uygulamanızı belirli bir görevi gerçekleştirmek için uygun izne sahip olduğunu gösterir.</span><span class="sxs-lookup"><span data-stu-id="dea77-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="dea77-258">OAuth 2.0 protokolünü ve erişim belirteçleri alma hakkında daha fazla bilgi için bkz: [v2.0 uç noktası Protokolü başvurusu](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="dea77-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
