## <a name="prepare-for-akv-integration"></a><span data-ttu-id="f997b-101">AKV tümleştirme için hazırlama</span><span class="sxs-lookup"><span data-stu-id="f997b-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="f997b-102">SQL Server VM'nize yapılandırmak için Azure anahtar kasası tümleştirmeyi kullanmak için birkaç önkoşul vardır:</span><span class="sxs-lookup"><span data-stu-id="f997b-102">To use Azure Key Vault Integration to configure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="f997b-103">Azure PowerShell'i yükleme</span><span class="sxs-lookup"><span data-stu-id="f997b-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="f997b-104">Bir Azure Active Directory oluşturun</span><span class="sxs-lookup"><span data-stu-id="f997b-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="f997b-105">Bir anahtar kasası oluşturma</span><span class="sxs-lookup"><span data-stu-id="f997b-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="f997b-106">Aşağıdaki bölümlerde bu önkoşulları ve daha sonra PowerShell cmdlet'lerini çalıştırmak için toplamanız gereken bilgiler açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="f997b-106">The following sections describe these prerequisites and the information you need to collect to later run the PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="f997b-107">Azure PowerShell'i yükleme</span><span class="sxs-lookup"><span data-stu-id="f997b-107">Install Azure PowerShell</span></span>
<span data-ttu-id="f997b-108">En son Azure PowerShell SDK'sı yüklediğinizden emin olun.</span><span class="sxs-lookup"><span data-stu-id="f997b-108">Make sure you have installed the latest Azure PowerShell SDK.</span></span> <span data-ttu-id="f997b-109">Daha fazla bilgi için bkz. [Azure PowerShell’i yükleme ve yapılandırma](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="f997b-109">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="f997b-110">Bir Azure Active Directory oluşturun</span><span class="sxs-lookup"><span data-stu-id="f997b-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="f997b-111">İlk olarak, şunlara sahip olmanız gerekir bir [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) aboneliğinizde.</span><span class="sxs-lookup"><span data-stu-id="f997b-111">First, you need to have an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="f997b-112">Birçok avantaj arasında anahtar kasanızı belirli kullanıcılar ve uygulamalar için izni olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="f997b-112">Among many benefits, this allows you to grant permission to your key vault for certain users and applications.</span></span>

<span data-ttu-id="f997b-113">Ardından, bir uygulamanın AAD ile kaydedin.</span><span class="sxs-lookup"><span data-stu-id="f997b-113">Next, register an application with AAD.</span></span> <span data-ttu-id="f997b-114">Bu, VM ihtiyaç duyacağı anahtar kasanızı erişimi olan bir hizmet sorumlusu hesabı verir.</span><span class="sxs-lookup"><span data-stu-id="f997b-114">This will give you a Service Principal account that has access to your key vault which your VM will need.</span></span> <span data-ttu-id="f997b-115">Azure anahtar kasası makalede, bu adımları bulabilirsiniz [bir uygulamayı Azure Active Directory ile kaydetme](../articles/key-vault/key-vault-get-started.md#register) bölüm veya ekran görüntüleri ile adımları görebilirsiniz **uygulama bölümü için bir kimlik alma**  , [bu blog gönderisine](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="f997b-115">In the Azure Key Vault article, you can find these steps in the [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see the steps with screen shots in the **Get an identity for the application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="f997b-116">Bu adımları gerçekleştirmeden önce SQL VM üzerinde Azure anahtar kasası tümleştirmeyi etkinleştirdiğinizde, daha sonra gerekli bu kaydı sırasında aşağıdaki bilgileri toplamak gerektiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="f997b-116">Before completing these steps, note that you need to collect the following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="f997b-117">Uygulama eklendikten sonra bulma **istemci kimliği** üzerinde **yapılandırma** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="f997b-117">After the application is added, find the **CLIENT ID**  on the **CONFIGURE** tab.</span></span> 
    <span data-ttu-id="f997b-118">![Azure Active Directory istemci kimliği](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="f997b-118">![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="f997b-119">İstemci Kimliğini daha sonra atanan **$spName** Azure anahtar kasası tümleştirmeyi etkinleştirmek için PowerShell betiğini parametresinde (hizmet asıl adı).</span><span class="sxs-lookup"><span data-stu-id="f997b-119">The client ID is assigned later to the **$spName** (Service Principal name) parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="f997b-120">Ayrıca, anahtarınızı oluşturduğunuzda, bu adımları sırasında gizli anahtarınız için aşağıdaki ekran görüntüsünde gösterildiği gibi kopyalayın.</span><span class="sxs-lookup"><span data-stu-id="f997b-120">Also, during these steps when you create your key, copy the secret for your key as is shown in the following screenshot.</span></span> <span data-ttu-id="f997b-121">Bu anahtar sırrı daha sonra atanan **$spSecret** PowerShell Betiği parametresinde (hizmet sorumlusu gizli).</span><span class="sxs-lookup"><span data-stu-id="f997b-121">This key secret is assigned later to the **$spSecret** (Service Principal secret) parameter in the PowerShell script.</span></span>  
    <span data-ttu-id="f997b-122">![Azure Active Directory parolası](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="f997b-122">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="f997b-123">Bu yeni istemci kimliği aşağıdaki erişim izinlerine sahip yetkilendirmeniz gerekir: **şifrelemek**, **şifresini**, **wrapKey**, **unwrapKey**, **oturum**, ve **doğrulayın**.</span><span class="sxs-lookup"><span data-stu-id="f997b-123">You must authorize this new client ID to have the following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="f997b-124">Bu gerçekleştirilir [kümesi AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet'i.</span><span class="sxs-lookup"><span data-stu-id="f997b-124">This is done with the [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="f997b-125">Daha fazla bilgi için bkz: [anahtar veya gizli kullanmak için uygulamayı yetkilendirmeniz](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="f997b-125">For more information see [Authorize the application to use the key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="f997b-126">Bir anahtar kasası oluşturma</span><span class="sxs-lookup"><span data-stu-id="f997b-126">Create a key vault</span></span>
<span data-ttu-id="f997b-127">Azure anahtar kasası, VM şifreleme için kullanacağınız anahtarları depolamak için kullanmak için bir anahtar kasası erişim gerekir.</span><span class="sxs-lookup"><span data-stu-id="f997b-127">In order to use Azure Key Vault to store the keys you will use for encryption in your VM, you need access to a key vault.</span></span> <span data-ttu-id="f997b-128">Anahtar kasanız zaten ayarlamadıysanız içindeki adımları izleyerek oluşturun [Azure anahtar kasası ile çalışmaya başlama](../articles/key-vault/key-vault-get-started.md) konu.</span><span class="sxs-lookup"><span data-stu-id="f997b-128">If you have not already set up your key vault, create one by following the steps in the [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="f997b-129">Bu adımları gerçekleştirmeden önce SQL VM üzerinde Azure anahtar kasası tümleştirmeyi etkinleştirdiğinizde, bu kurulum sırasında toplamanız gereken bazı bilgiler daha sonra gerekli olduğuna dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="f997b-129">Before completing these steps, note that there is some information you need to collect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="f997b-130">Bir anahtar kasası adımı Oluştur aldığınızda, döndürülen Not **vaultUri** anahtar kasası URL'si özelliği.</span><span class="sxs-lookup"><span data-stu-id="f997b-130">When you get to the Create a key vault step, note the returned **vaultUri** property, which is the key vault URL.</span></span> <span data-ttu-id="f997b-131">Aşağıda, ContosoKeyVault, anahtar kasası addır Bu adımda sağlanan örnekte bu nedenle anahtar kasası URL'si https://contosokeyvault.vault.azure.net/ olacaktır.</span><span class="sxs-lookup"><span data-stu-id="f997b-131">In the example provided in that step, shown below, the key vault name is ContosoKeyVault, therefore the key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="f997b-132">Anahtar kasası URL'si daha sonra atanan **$akvURL** Azure anahtar kasası tümleştirmeyi etkinleştirmek için PowerShell komut parametresi.</span><span class="sxs-lookup"><span data-stu-id="f997b-132">The key vault URL is assigned later to the **$akvURL** parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span>

